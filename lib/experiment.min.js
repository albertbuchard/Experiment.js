!function(root,factory){"object"==typeof exports&&"object"==typeof module?module.exports=factory(require("lodash"),require("experiment-babylon-js"),require("jQuery"),require("experiment-boxes"),require("experiment-mathjs")):"function"==typeof define&&define.amd?define("experiment",["lodash","experiment-babylon-js","jQuery","experiment-boxes","experiment-mathjs"],factory):"object"==typeof exports?exports.experiment=factory(require("lodash"),require("experiment-babylon-js"),require("jQuery"),require("experiment-boxes"),require("experiment-mathjs")):root.experiment=factory(root._,root.BABYLON,root.jQuery,root.experimentBoxes,root.math)}(this,function(__WEBPACK_EXTERNAL_MODULE_1__,__WEBPACK_EXTERNAL_MODULE_4__,__WEBPACK_EXTERNAL_MODULE_8__,__WEBPACK_EXTERNAL_MODULE_12__,__WEBPACK_EXTERNAL_MODULE_13__){return function(modules){function __webpack_require__(moduleId){if(installedModules[moduleId])return installedModules[moduleId].exports;var module=installedModules[moduleId]={i:moduleId,l:!1,exports:{}};return modules[moduleId].call(module.exports,module,module.exports,__webpack_require__),module.l=!0,module.exports}var installedModules={};return __webpack_require__.m=modules,__webpack_require__.c=installedModules,__webpack_require__.i=function(value){return value},__webpack_require__.d=function(exports,name,getter){__webpack_require__.o(exports,name)||Object.defineProperty(exports,name,{configurable:!1,enumerable:!0,get:getter})},__webpack_require__.n=function(module){var getter=module&&module.__esModule?function(){return module.default}:function(){return module};return __webpack_require__.d(getter,"a",getter),getter},__webpack_require__.o=function(object,property){return Object.prototype.hasOwnProperty.call(object,property)},__webpack_require__.p="",__webpack_require__(__webpack_require__.s=16)}([function(module,exports,__webpack_require__){"use strict";function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}function _toConsumableArray(arr){if(Array.isArray(arr)){for(var i=0,arr2=Array(arr.length);i<arr.length;i++)arr2[i]=arr[i];return arr2}return Array.from(arr)}function noop(){}function mandatory(){var param=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"";throw new Error("Missing parameter "+param)}function mustBeDefined(){for(var _len=arguments.length,args=Array(_len),_key=0;_key<_len;_key++)args[_key]=arguments[_key];for(var i=0;i<args.length;i++)if(void 0===args[i])throw new Error("Argument "+i+" is undefined.");return!0}function spreadToObject(object,defaultValue){if(void 0===object||null===object)return defaultValue;var TargetClass=defaultValue.constructor;return object.constructor===TargetClass?object:object.constructor===Array?new(Function.prototype.bind.apply(TargetClass,[null].concat(_toConsumableArray(object)))):(debugWarn("spreadToObject: cannot spread to target class"),defaultValue)}function mustHaveConstructor(constructorObject){for(var _len2=arguments.length,args=Array(_len2>1?_len2-1:0),_key2=1;_key2<_len2;_key2++)args[_key2-1]=arguments[_key2];if(!1===args.allHaveConstructor(constructorObject))throw new Error("Wrong constructor in arguments.");return!0}function hasConstructor(constructorObject){for(var _len3=arguments.length,args=Array(_len3>1?_len3-1:0),_key3=1;_key3<_len3;_key3++)args[_key3-1]=arguments[_key3];return!1!==args.allHaveConstructor(constructorObject)}function looksLikeAPromise(o){return o&&"function"==typeof o.then&&"function"==typeof o.catch}function delay(ms){return new _bluebird2.default(function(resolve){setTimeout(resolve,ms)})}function jitter(){var min=arguments.length>0&&void 0!==arguments[0]?arguments[0]:mandatory(),max=arguments.length>1&&void 0!==arguments[1]?arguments[1]:mandatory();return new _bluebird2.default(function(resolve){var randomDuration=_lodash2.default.random(min,max);setTimeout(resolve,randomDuration)})}function recurse(){var promiseGenerator=arguments.length>0&&void 0!==arguments[0]?arguments[0]:mandatory(),amount=arguments.length>1&&void 0!==arguments[1]?arguments[1]:mandatory(),target=arguments.length>2&&void 0!==arguments[2]?arguments[2]:this,args=arguments.length>3&&void 0!==arguments[3]?arguments[3]:[],concatOnArray=arguments.length>4&&void 0!==arguments[4]?arguments[4]:[];return 0===amount?new _bluebird2.default(function(resolve){resolve(concatOnArray)}):promiseGenerator.apply(target,args).then(function(r){return concatOnArray=concatOnArray.concat(r),recurse(promiseGenerator,amount-1,target,args,concatOnArray)})}function Deferred(){var _this=this;this.resolve=null,this.reject=null,this.resolved=!1,this.rejected=!1,this.pending=!0,this.status=0,this.promise=new _bluebird2.default(function(resolve,reject){_this.resolve=function(data){_this.resolved=!0,_this.pending=!1,resolve(data)},_this.reject=function(e){_this.rejected=!0,_this.pending=!1,reject(e)}})}function rep(){var content=arguments.length>0&&void 0!==arguments[0]?arguments[0]:mandatory(),count=arguments.length>1&&void 0!==arguments[1]?arguments[1]:mandatory(),result=[];if("function"==typeof content)for(var i=0;i<count;i++)result=result.concat(content(i));else for(var _i=0;_i<count;_i++)result=result.concat(content);return result}function samplePermutation(){var sequence=arguments.length>0&&void 0!==arguments[0]?arguments[0]:mandatory(),repetition=arguments.length>1&&void 0!==arguments[1]&&arguments[1],n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;if(sequence.constructor!==Array)throw new Error("samplePermutation: sequence needs to be an array.");null===n&&(n=sequence.length);for(var copy=sequence.slice(0),permutation=[],add=void 0;repetition&&permutation.length<n||!repetition&&copy.length;){var index=Math.floor(Math.random()*copy.length);add=repetition?copy[index]:copy.splice(index,1),permutation=permutation.concat(add)}return permutation}function preloadImages(){for(var imgArray=[],promiseArray=[],_len4=arguments.length,images=Array(_len4),_key4=0;_key4<_len4;_key4++)images[_key4]=arguments[_key4];var _iteratorNormalCompletion=!0,_didIteratorError=!1,_iteratorError=void 0;try{for(var _step,_iterator=images[Symbol.iterator]();!(_iteratorNormalCompletion=(_step=_iterator.next()).done);_iteratorNormalCompletion=!0){var image=_step.value;if(image.constructor===String){var deferred=new Deferred,img=new Image;img.src=image,imgArray.push(img),img.complete?deferred.resolve():img.addEventListener("load",function(){this.resolve()}.bind(deferred)),promiseArray.push(deferred.promise)}else debugError("preloadImages: invalid string url ",image)}}catch(err){_didIteratorError=!0,_iteratorError=err}finally{try{!_iteratorNormalCompletion&&_iterator.return&&_iterator.return()}finally{if(_didIteratorError)throw _iteratorError}}return[_bluebird2.default.all(promiseArray),imgArray]}function matrix(){for(var rows=arguments.length>0&&void 0!==arguments[0]?arguments[0]:mandatory(),cols=arguments.length>1&&void 0!==arguments[1]?arguments[1]:mandatory(),fill=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,matrixObject=[],i=0;i<rows;i++){matrixObject[i]=[];for(var j=0;j<cols;j++)matrixObject[i][j]=fill}return matrixObject}function getRow(){var matrixObject=arguments.length>0&&void 0!==arguments[0]?arguments[0]:mandatory(),rowIndex=arguments.length>1&&void 0!==arguments[1]?arguments[1]:mandatory();matrixObject=_experimentMathjs2.default.matrix(matrixObject);var size=matrixObject.size()[0];return _experimentMathjs2.default.subset(matrixObject,_experimentMathjs2.default.index(rowIndex,_experimentMathjs2.default.range(0,size)))}function rowSum(){var matrixObject=arguments.length>0&&void 0!==arguments[0]?arguments[0]:mandatory(),rows=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;matrixObject=_experimentMathjs2.default.matrix(matrixObject);var size=matrixObject.size()[0];null===rows&&(rows=_experimentMathjs2.default.range(0,size-1)),rows.constructor!==Array&&(rows=[rows]);for(var rowSumArray=[],i=0;i<rows.length;i++)rowSumArray.push(_experimentMathjs2.default.sum(getRow(matrixObject,rows[i])));return rowSumArray}function diag(){for(var matrixObject=arguments.length>0&&void 0!==arguments[0]?arguments[0]:mandatory(),setTo=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,rows=matrixObject.length,diagonalValues=[],i=0;i<rows;i++)setTo&&(matrixObject[i][i]=setTo),diagonalValues.push(matrixObject[i][i]);return[diagonalValues,matrixObject]}function sizeToVec(){var size=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;return mustHaveConstructor(_experimentBabylonJs2.default.Size,size),new _experimentBabylonJs2.default.Vector2(size.width,size.height)}function scaleSize(){var size=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null,scale=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1;mustHaveConstructor(_experimentBabylonJs2.default.Size,size);var floatScale=parseFloat(scale);if(isNaN(floatScale))throw new Error("taskObject.scaleSize: scale is invalid "+scale);return new _experimentBabylonJs2.default.Size(size.width*floatScale,size.height*floatScale)}function getQueryString(){for(var queryString={},query=window.location.search.substring(1),vars=query.split("&"),i=0;i<vars.length;i++){var pair=vars[i].split("=");if(void 0===queryString[pair[0]])queryString[pair[0]]=decodeURIComponent(pair[1]);else if("string"==typeof queryString[pair[0]]){var arr=[queryString[pair[0]],decodeURIComponent(pair[1])];queryString[pair[0]]=arr}else queryString[pair[0]].push(decodeURIComponent(pair[1]))}return queryString}Object.defineProperty(exports,"__esModule",{value:!0}),exports.getQueryString=exports.preloadImages=exports.hasConstructor=exports.scaleSize=exports.sizeToVec=exports.spreadToObject=exports.noop=exports.debugError=exports.debugWarn=exports.debuglog=exports.mandatory=exports.mustBeDefined=exports.mustHaveConstructor=exports.looksLikeAPromise=exports.delay=exports.jitter=exports.recurse=exports.Deferred=exports.rep=exports.samplePermutation=exports.matrix=exports.getRow=exports.rowSum=exports.diag=exports.Set=exports.Number=exports.Object=exports.String=exports.Array=void 0;var _jquery=__webpack_require__(8),_lodash=(_interopRequireDefault(_jquery),__webpack_require__(1)),_lodash2=_interopRequireDefault(_lodash),_experimentMathjs=__webpack_require__(13),_experimentMathjs2=_interopRequireDefault(_experimentMathjs),_bluebird=__webpack_require__(2),_bluebird2=_interopRequireDefault(_bluebird),_experimentBabylonJs=__webpack_require__(4),_experimentBabylonJs2=_interopRequireDefault(_experimentBabylonJs);__webpack_require__(17);_bluebird2.default.config({warnings:!1,longStackTraces:!1,cancellation:!1,monitoring:!1});var debuglog=function(){var _console;return window&&window.DEBUG_MODE_ON?(_console=console).log.apply(_console,arguments):void 0},debugWarn=function(){var _console2;return window&&window.DEBUG_MODE_ON?(_console2=console).warn.apply(_console2,arguments):void 0},debugError=function(){var _console3;return window&&window.DEBUG_MODE_ON?(_console3=console).error.apply(_console3,arguments):void 0};Number.prototype.boundTo=function(){var min=arguments.length>0&&void 0!==arguments[0]?arguments[0]:mandatory(),max=arguments.length>1&&void 0!==arguments[1]?arguments[1]:mandatory();return mustHaveConstructor(Number,min,max),Math.max(Math.min(this,max),min)},String.prototype.indicesOf=function(){for(var needle=arguments.length>0&&void 0!==arguments[0]?arguments[0]:mandatory(),haystack=this,indices=[],i=0;i<haystack.length;i++)haystack.substr(i,needle.length)===needle&&indices.push(i);return indices.length?indices:-1},Array.prototype.hasNeighbouringRepeat=function(){for(var previousElement=null,i=0;i<this.length;i++){if(previousElement===this[i])return!0;previousElement=this[i]}return!1},Array.prototype.toCsv=function(){var lineArray=[];return this.forEach(function(array,index){var line=array.join(",");lineArray.push(0===index?"data:text/csv;charset=utf-8,"+line:line)}),lineArray.join("\n")},Array.prototype.uniqueValues=function(){for(var u={},a=[],i=0;i<this.length;i++)u.hasOwnProperty(this[i])||(a.push(this[i]),u[this[i]]=1);return a},Array.prototype.min=function(){var u=this.uniqueValues();if(u.allHaveConstructor(Number)){for(var minValue=u[0],i=0;i<u.length;i++)u[i]<minValue&&(minValue=u[i]);return minValue}return NaN},Array.prototype.max=function(){var u=this.uniqueValues();if(u.allHaveConstructor(Number)){for(var maxValue=u[0],i=0;i<u.length;i++)u[i]>maxValue&&(maxValue=u[i]);return maxValue}return NaN},Array.prototype.multisplice=function(){for(var _len5=arguments.length,args=Array(_len5),_key5=0;_key5<_len5;_key5++)args[_key5]=arguments[_key5];args.sort(function(a,b){return a-b});for(var spliced=[],i=0;i<args.length;i++){var index=args[i]-i;spliced.push(this.splice(index,1)[0])}return spliced},Array.prototype.getXY=function(){var x=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;if(null!==x){if(x.constructor!==Array)throw new Error("Array.getXY: x needs to be an array.");if(x.length!==this.length)throw new Error("Array.getXY: x needs to be of the same length as array")}else debuglog("Array.getXY: x === null, x will be taken as the index of each value.");for(var xyArray=[],i=0;i<this.length;i++)null!==x?xyArray.push({x:x[i],y:this[i]}):xyArray.push({x:i,y:this[i]});return xyArray},Array.prototype.average=function(){var type=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"global",size=arguments.length>1&&void 0!==arguments[1]?arguments[1]:5;if("global"===type){var sum=this.sum();if(!isNaN(sum))return sum/this.length}else{if("sliding"===type){for(var windowAverages=[],i=0;i<this.length;i++){var endIndex=i+size;endIndex>this.length&&(endIndex=this.length);var windowArray=this.slice(i,endIndex),_sum=windowArray.sum();isNaN(_sum)||windowAverages.push(_sum/windowArray.length)}return windowAverages}if("bins"===type){for(var bins=[],position=0;position<this.length;){var _endIndex=position+size;if(_endIndex>this.length)break;var _windowArray=this.slice(position,_endIndex),_sum2=_windowArray.sum();isNaN(_sum2)||bins.push(_sum2/_windowArray.length),position=_endIndex}return bins}}},Array.prototype.sum=function(){for(var total=0,i=0;i<this.length;i++){if(isNaN(this[i]))return NaN;total+=this[i]}return total},Array.prototype.integrate=function(){for(var sum=0,cumulativeArray=[],i=0;i<this.length;i++){if(isNaN(this[i]))return NaN;sum+=this[i],cumulativeArray.push(sum)}return cumulativeArray},Array.prototype.equals=function(value){for(var resultVector=[],result=null,i=0,l=this.length;i<l;++i)result=this[i]===value,resultVector.push(result);return resultVector},Array.prototype.ntrue=function(){for(var resultSum=0,result=null,i=0,l=this.length;i<l;++i)result=!0===this[i]?1:0,resultSum+=result;return resultSum},Array.prototype.nEquals=function(value){return this.equals(value).ntrue()},Array.prototype.indicesOf=function(value){for(var resultVector=[],i=0,l=this.length;i<l;i++)this[i]===value&&resultVector.push(i);return resultVector},Array.prototype.exclude=function(values){for(var resultVector=[],i=0,l=this.length;i<l;++i){for(var addit=!0,j=0;j<values.length;++j)this[i]===values[j]&&(addit=!1);addit&&resultVector.push(this[i])}return resultVector},Array.prototype.allHaveConstructor=function(constructorObject){for(var i=0;i<this.length;i++)if(void 0===this[i]||null===this[i]||this[i].constructor!==constructorObject)return!1;return!0},Array.prototype.includes=function(){for(var _len6=arguments.length,array=Array(_len6),_key6=0;_key6<_len6;_key6++)array[_key6]=arguments[_key6];1!==array.length||array[0].constructor!==Set&&array[0].constructor!==Array||(array=array[0]);for(var i=0;i<array.length;i++)if(-1===this.indexOf(array[i]))return!1;return!0},Object.defineProperty(Object.prototype,"observe",{value:function(){var attribute=arguments.length>0&&void 0!==arguments[0]?arguments[0]:mandatory(),_this2=this,lookForValue=!(arguments.length>1&&void 0!==arguments[1])||arguments[1],rate=arguments.length>2&&void 0!==arguments[2]?arguments[2]:500,deferred=new Deferred;debuglog("Started observing ",this," attribute ",attribute," for value ",lookForValue," current value ",this[attribute]);return function checkForValue(){_this2[attribute]===lookForValue?(debuglog("Finished observing ",_this2," attribute ",attribute," for value ",lookForValue," current value ",_this2[attribute]),deferred.resolve(lookForValue)):(debuglog("im still observing ",_this2," attribute ",attribute," for value ",lookForValue," current value ",_this2[attribute]),delay(rate).then(checkForValue))}(),deferred.promise},enumerable:!1}),Set.prototype.isSuperset=function(subset){var _iteratorNormalCompletion2=!0,_didIteratorError2=!1,_iteratorError2=void 0;try{for(var _step2,_iterator2=subset[Symbol.iterator]();!(_iteratorNormalCompletion2=(_step2=_iterator2.next()).done);_iteratorNormalCompletion2=!0){var elem=_step2.value;if(!this.has(elem))return!1}}catch(err){_didIteratorError2=!0,_iteratorError2=err}finally{try{!_iteratorNormalCompletion2&&_iterator2.return&&_iterator2.return()}finally{if(_didIteratorError2)throw _iteratorError2}}return!0},Set.prototype.union=function(setB){var union=new Set(this),_iteratorNormalCompletion3=!0,_didIteratorError3=!1,_iteratorError3=void 0;try{for(var _step3,_iterator3=setB[Symbol.iterator]();!(_iteratorNormalCompletion3=(_step3=_iterator3.next()).done);_iteratorNormalCompletion3=!0){var elem=_step3.value;union.add(elem)}}catch(err){_didIteratorError3=!0,_iteratorError3=err}finally{try{!_iteratorNormalCompletion3&&_iterator3.return&&_iterator3.return()}finally{if(_didIteratorError3)throw _iteratorError3}}return union},Set.prototype.sample=function(){for(var n=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,repeat=!(arguments.length>1&&void 0!==arguments[1])||arguments[1],result=[],array=Array.from(this),i=0;i<n;i++){var index=_lodash2.default.random(0,array.length-1);result.push(array[index]),repeat||array.splice(index,1)}return result},Set.prototype.unite=function(setB){var _iteratorNormalCompletion4=!0,_didIteratorError4=!1,_iteratorError4=void 0;try{for(var _step4,_iterator4=setB[Symbol.iterator]();!(_iteratorNormalCompletion4=(_step4=_iterator4.next()).done);_iteratorNormalCompletion4=!0){var elem=_step4.value;this.add(elem)}}catch(err){_didIteratorError4=!0,_iteratorError4=err}finally{try{!_iteratorNormalCompletion4&&_iterator4.return&&_iterator4.return()}finally{if(_didIteratorError4)throw _iteratorError4}}},Set.prototype.intersection=function(setB){var intersection=new Set,_iteratorNormalCompletion5=!0,_didIteratorError5=!1,_iteratorError5=void 0;try{for(var _step5,_iterator5=setB[Symbol.iterator]();!(_iteratorNormalCompletion5=(_step5=_iterator5.next()).done);_iteratorNormalCompletion5=!0){var elem=_step5.value;this.has(elem)&&intersection.add(elem)}}catch(err){_didIteratorError5=!0,_iteratorError5=err}finally{try{!_iteratorNormalCompletion5&&_iterator5.return&&_iterator5.return()}finally{if(_didIteratorError5)throw _iteratorError5}}return intersection},Set.prototype.intersect=function(setB){var _iteratorNormalCompletion6=!0,_didIteratorError6=!1,_iteratorError6=void 0;try{for(var _step6,_iterator6=this[Symbol.iterator]();!(_iteratorNormalCompletion6=(_step6=_iterator6.next()).done);_iteratorNormalCompletion6=!0){var elem=_step6.value;setB.has(elem)||this.remove(elem)}}catch(err){_didIteratorError6=!0,_iteratorError6=err}finally{try{!_iteratorNormalCompletion6&&_iterator6.return&&_iterator6.return()}finally{if(_didIteratorError6)throw _iteratorError6}}},Set.prototype.difference=function(setB){var difference=new Set(this),_iteratorNormalCompletion7=!0,_didIteratorError7=!1,_iteratorError7=void 0;try{for(var _step7,_iterator7=setB[Symbol.iterator]();!(_iteratorNormalCompletion7=(_step7=_iterator7.next()).done);_iteratorNormalCompletion7=!0){var elem=_step7.value;difference.delete(elem)}}catch(err){_didIteratorError7=!0,_iteratorError7=err}finally{try{!_iteratorNormalCompletion7&&_iterator7.return&&_iterator7.return()}finally{if(_didIteratorError7)throw _iteratorError7}}return difference},exports.Array=Array,exports.String=String,exports.Object=Object,exports.Number=Number,exports.Set=Set,exports.diag=diag,exports.rowSum=rowSum,exports.getRow=getRow,exports.matrix=matrix,exports.samplePermutation=samplePermutation,exports.rep=rep,exports.Deferred=Deferred,exports.recurse=recurse,exports.jitter=jitter,exports.delay=delay,exports.looksLikeAPromise=looksLikeAPromise,exports.mustHaveConstructor=mustHaveConstructor,exports.mustBeDefined=mustBeDefined,exports.mandatory=mandatory,exports.debuglog=debuglog,exports.debugWarn=debugWarn,exports.debugError=debugError,exports.noop=noop,exports.spreadToObject=spreadToObject,exports.sizeToVec=sizeToVec,exports.scaleSize=scaleSize,exports.hasConstructor=hasConstructor,exports.preloadImages=preloadImages,exports.getQueryString=getQueryString},function(module,exports){module.exports=__WEBPACK_EXTERNAL_MODULE_1__},function(module,exports,__webpack_require__){(function(process,global,setImmediate){/* @preserve
 * The MIT License (MIT)
 * 
 * Copyright (c) 2013-2017 Petka Antonov
 * 
 * Permission is hereby granted, free of charge, to any person obtaining a copy
 * of this software and associated documentation files (the "Software"), to deal
 * in the Software without restriction, including without limitation the rights
 * to use, copy, modify, merge, publish, distribute, sublicense, and/or sell
 * copies of the Software, and to permit persons to whom the Software is
 * furnished to do so, subject to the following conditions:
 * 
 * The above copyright notice and this permission notice shall be included in
 * all copies or substantial portions of the Software.
 * 
 * THE SOFTWARE IS PROVIDED "AS IS", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR
 * IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,
 * FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT.  IN NO EVENT SHALL THE
 * AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER
 * LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,
 * OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN
 * THE SOFTWARE.
 * 
 */
!function(e){module.exports=e()}(function(){var define,module,exports;return function e(t,n,r){function s(o,u){if(!n[o]){if(!t[o]){var a="function"==typeof _dereq_&&_dereq_;if(!u&&a)return a(o,!0);if(i)return i(o,!0);var f=new Error("Cannot find module '"+o+"'");throw f.code="MODULE_NOT_FOUND",f}var l=n[o]={exports:{}};t[o][0].call(l.exports,function(e){var n=t[o][1][e];return s(n||e)},l,l.exports,e,t,n,r)}return n[o].exports}for(var i="function"==typeof _dereq_&&_dereq_,o=0;o<r.length;o++)s(r[o]);return s}({1:[function(_dereq_,module,exports){"use strict";module.exports=function(Promise){function any(promises){var ret=new SomePromiseArray(promises),promise=ret.promise();return ret.setHowMany(1),ret.setUnwrap(),ret.init(),promise}var SomePromiseArray=Promise._SomePromiseArray;Promise.any=function(promises){return any(promises)},Promise.prototype.any=function(){return any(this)}}},{}],2:[function(_dereq_,module,exports){"use strict";function Async(){this._customScheduler=!1,this._isTickUsed=!1,this._lateQueue=new Queue(16),this._normalQueue=new Queue(16),this._haveDrainedQueues=!1,this._trampolineEnabled=!0;var self=this;this.drainQueues=function(){self._drainQueues()},this._schedule=schedule}function AsyncInvokeLater(fn,receiver,arg){this._lateQueue.push(fn,receiver,arg),this._queueTick()}function AsyncInvoke(fn,receiver,arg){this._normalQueue.push(fn,receiver,arg),this._queueTick()}function AsyncSettlePromises(promise){this._normalQueue._pushOne(promise),this._queueTick()}var firstLineError;try{throw new Error}catch(e){firstLineError=e}var schedule=_dereq_("./schedule"),Queue=_dereq_("./queue"),util=_dereq_("./util");Async.prototype.setScheduler=function(fn){var prev=this._schedule;return this._schedule=fn,this._customScheduler=!0,prev},Async.prototype.hasCustomScheduler=function(){return this._customScheduler},Async.prototype.enableTrampoline=function(){this._trampolineEnabled=!0},Async.prototype.disableTrampolineIfNecessary=function(){util.hasDevTools&&(this._trampolineEnabled=!1)},Async.prototype.haveItemsQueued=function(){return this._isTickUsed||this._haveDrainedQueues},Async.prototype.fatalError=function(e,isNode){isNode?(process.stderr.write("Fatal "+(e instanceof Error?e.stack:e)+"\n"),process.exit(2)):this.throwLater(e)},Async.prototype.throwLater=function(fn,arg){if(1===arguments.length&&(arg=fn,fn=function(){throw arg}),"undefined"!=typeof setTimeout)setTimeout(function(){fn(arg)},0);else try{this._schedule(function(){fn(arg)})}catch(e){throw new Error("No async scheduler available\n\n    See http://goo.gl/MqrFmX\n")}},util.hasDevTools?(Async.prototype.invokeLater=function(fn,receiver,arg){this._trampolineEnabled?AsyncInvokeLater.call(this,fn,receiver,arg):this._schedule(function(){setTimeout(function(){fn.call(receiver,arg)},100)})},Async.prototype.invoke=function(fn,receiver,arg){this._trampolineEnabled?AsyncInvoke.call(this,fn,receiver,arg):this._schedule(function(){fn.call(receiver,arg)})},Async.prototype.settlePromises=function(promise){this._trampolineEnabled?AsyncSettlePromises.call(this,promise):this._schedule(function(){promise._settlePromises()})}):(Async.prototype.invokeLater=AsyncInvokeLater,Async.prototype.invoke=AsyncInvoke,Async.prototype.settlePromises=AsyncSettlePromises),Async.prototype._drainQueue=function(queue){for(;queue.length()>0;){var fn=queue.shift();if("function"==typeof fn){var receiver=queue.shift(),arg=queue.shift();fn.call(receiver,arg)}else fn._settlePromises()}},Async.prototype._drainQueues=function(){this._drainQueue(this._normalQueue),this._reset(),this._haveDrainedQueues=!0,this._drainQueue(this._lateQueue)},Async.prototype._queueTick=function(){this._isTickUsed||(this._isTickUsed=!0,this._schedule(this.drainQueues))},Async.prototype._reset=function(){this._isTickUsed=!1},module.exports=Async,module.exports.firstLineError=firstLineError},{"./queue":26,"./schedule":29,"./util":36}],3:[function(_dereq_,module,exports){"use strict";module.exports=function(Promise,INTERNAL,tryConvertToPromise,debug){var calledBind=!1,rejectThis=function(_,e){this._reject(e)},targetRejected=function(e,context){context.promiseRejectionQueued=!0,context.bindingPromise._then(rejectThis,rejectThis,null,this,e)},bindingResolved=function(thisArg,context){0==(50397184&this._bitField)&&this._resolveCallback(context.target)},bindingRejected=function(e,context){context.promiseRejectionQueued||this._reject(e)};Promise.prototype.bind=function(thisArg){calledBind||(calledBind=!0,Promise.prototype._propagateFrom=debug.propagateFromFunction(),Promise.prototype._boundValue=debug.boundValueFunction());var maybePromise=tryConvertToPromise(thisArg),ret=new Promise(INTERNAL);ret._propagateFrom(this,1);var target=this._target();if(ret._setBoundTo(maybePromise),maybePromise instanceof Promise){var context={promiseRejectionQueued:!1,promise:ret,target:target,bindingPromise:maybePromise};target._then(INTERNAL,targetRejected,void 0,ret,context),maybePromise._then(bindingResolved,bindingRejected,void 0,ret,context),ret._setOnCancel(maybePromise)}else ret._resolveCallback(target);return ret},Promise.prototype._setBoundTo=function(obj){void 0!==obj?(this._bitField=2097152|this._bitField,this._boundTo=obj):this._bitField=-2097153&this._bitField},Promise.prototype._isBound=function(){return 2097152==(2097152&this._bitField)},Promise.bind=function(thisArg,value){return Promise.resolve(value).bind(thisArg)}}},{}],4:[function(_dereq_,module,exports){"use strict";function noConflict(){try{Promise===bluebird&&(Promise=old)}catch(e){}return bluebird}var old;"undefined"!=typeof Promise&&(old=Promise);var bluebird=_dereq_("./promise")();bluebird.noConflict=noConflict,module.exports=bluebird},{"./promise":22}],5:[function(_dereq_,module,exports){"use strict";var cr=Object.create;if(cr){var callerCache=cr(null),getterCache=cr(null);callerCache[" size"]=getterCache[" size"]=0}module.exports=function(Promise){function ensureMethod(obj,methodName){var fn;if(null!=obj&&(fn=obj[methodName]),"function"!=typeof fn){var message="Object "+util.classString(obj)+" has no method '"+util.toString(methodName)+"'";throw new Promise.TypeError(message)}return fn}function caller(obj){return ensureMethod(obj,this.pop()).apply(obj,this)}function namedGetter(obj){return obj[this]}function indexedGetter(obj){var index=+this;return index<0&&(index=Math.max(0,index+obj.length)),obj[index]}var getGetter,util=_dereq_("./util"),canEvaluate=util.canEvaluate;util.isIdentifier;Promise.prototype.call=function(methodName){var args=[].slice.call(arguments,1);return args.push(methodName),this._then(caller,void 0,void 0,args,void 0)},Promise.prototype.get=function(propertyName){var getter,isIndex="number"==typeof propertyName;if(isIndex)getter=indexedGetter;else if(canEvaluate){var maybeGetter=getGetter(propertyName);getter=null!==maybeGetter?maybeGetter:namedGetter}else getter=namedGetter;return this._then(getter,void 0,void 0,propertyName,void 0)}}},{"./util":36}],6:[function(_dereq_,module,exports){"use strict";module.exports=function(Promise,PromiseArray,apiRejection,debug){var util=_dereq_("./util"),tryCatch=util.tryCatch,errorObj=util.errorObj,async=Promise._async;Promise.prototype.break=Promise.prototype.cancel=function(){if(!debug.cancellation())return this._warn("cancellation is disabled");for(var promise=this,child=promise;promise._isCancellable();){if(!promise._cancelBy(child)){child._isFollowing()?child._followee().cancel():child._cancelBranched();break}var parent=promise._cancellationParent;if(null==parent||!parent._isCancellable()){promise._isFollowing()?promise._followee().cancel():promise._cancelBranched();break}promise._isFollowing()&&promise._followee().cancel(),promise._setWillBeCancelled(),child=promise,promise=parent}},Promise.prototype._branchHasCancelled=function(){this._branchesRemainingToCancel--},Promise.prototype._enoughBranchesHaveCancelled=function(){return void 0===this._branchesRemainingToCancel||this._branchesRemainingToCancel<=0},Promise.prototype._cancelBy=function(canceller){return canceller===this?(this._branchesRemainingToCancel=0,this._invokeOnCancel(),!0):(this._branchHasCancelled(),!!this._enoughBranchesHaveCancelled()&&(this._invokeOnCancel(),!0))},Promise.prototype._cancelBranched=function(){this._enoughBranchesHaveCancelled()&&this._cancel()},Promise.prototype._cancel=function(){this._isCancellable()&&(this._setCancelled(),async.invoke(this._cancelPromises,this,void 0))},Promise.prototype._cancelPromises=function(){this._length()>0&&this._settlePromises()},Promise.prototype._unsetOnCancel=function(){this._onCancelField=void 0},Promise.prototype._isCancellable=function(){return this.isPending()&&!this._isCancelled()},Promise.prototype.isCancellable=function(){return this.isPending()&&!this.isCancelled()},Promise.prototype._doInvokeOnCancel=function(onCancelCallback,internalOnly){if(util.isArray(onCancelCallback))for(var i=0;i<onCancelCallback.length;++i)this._doInvokeOnCancel(onCancelCallback[i],internalOnly);else if(void 0!==onCancelCallback)if("function"==typeof onCancelCallback){if(!internalOnly){var e=tryCatch(onCancelCallback).call(this._boundValue());e===errorObj&&(this._attachExtraTrace(e.e),async.throwLater(e.e))}}else onCancelCallback._resultCancelled(this)},Promise.prototype._invokeOnCancel=function(){var onCancelCallback=this._onCancel();this._unsetOnCancel(),async.invoke(this._doInvokeOnCancel,this,onCancelCallback)},Promise.prototype._invokeInternalOnCancel=function(){this._isCancellable()&&(this._doInvokeOnCancel(this._onCancel(),!0),this._unsetOnCancel())},Promise.prototype._resultCancelled=function(){this.cancel()}}},{"./util":36}],7:[function(_dereq_,module,exports){"use strict";module.exports=function(NEXT_FILTER){function catchFilter(instances,cb,promise){return function(e){var boundTo=promise._boundValue();predicateLoop:for(var i=0;i<instances.length;++i){var item=instances[i];if(item===Error||null!=item&&item.prototype instanceof Error){if(e instanceof item)return tryCatch(cb).call(boundTo,e)}else if("function"==typeof item){var matchesPredicate=tryCatch(item).call(boundTo,e);if(matchesPredicate===errorObj)return matchesPredicate;if(matchesPredicate)return tryCatch(cb).call(boundTo,e)}else if(util.isObject(e)){for(var keys=getKeys(item),j=0;j<keys.length;++j){var key=keys[j];if(item[key]!=e[key])continue predicateLoop}return tryCatch(cb).call(boundTo,e)}}return NEXT_FILTER}}var util=_dereq_("./util"),getKeys=_dereq_("./es5").keys,tryCatch=util.tryCatch,errorObj=util.errorObj;return catchFilter}},{"./es5":13,"./util":36}],8:[function(_dereq_,module,exports){"use strict";module.exports=function(Promise){function Context(){this._trace=new Context.CapturedTrace(peekContext())}function createContext(){if(longStackTraces)return new Context}function peekContext(){var lastIndex=contextStack.length-1;if(lastIndex>=0)return contextStack[lastIndex]}var longStackTraces=!1,contextStack=[];return Promise.prototype._promiseCreated=function(){},Promise.prototype._pushContext=function(){},Promise.prototype._popContext=function(){return null},Promise._peekContext=Promise.prototype._peekContext=function(){},Context.prototype._pushContext=function(){void 0!==this._trace&&(this._trace._promiseCreated=null,contextStack.push(this._trace))},Context.prototype._popContext=function(){if(void 0!==this._trace){var trace=contextStack.pop(),ret=trace._promiseCreated;return trace._promiseCreated=null,ret}return null},Context.CapturedTrace=null,Context.create=createContext,Context.deactivateLongStackTraces=function(){},Context.activateLongStackTraces=function(){var Promise_pushContext=Promise.prototype._pushContext,Promise_popContext=Promise.prototype._popContext,Promise_PeekContext=Promise._peekContext,Promise_peekContext=Promise.prototype._peekContext,Promise_promiseCreated=Promise.prototype._promiseCreated;Context.deactivateLongStackTraces=function(){Promise.prototype._pushContext=Promise_pushContext,Promise.prototype._popContext=Promise_popContext,Promise._peekContext=Promise_PeekContext,Promise.prototype._peekContext=Promise_peekContext,Promise.prototype._promiseCreated=Promise_promiseCreated,longStackTraces=!1},longStackTraces=!0,Promise.prototype._pushContext=Context.prototype._pushContext,Promise.prototype._popContext=Context.prototype._popContext,Promise._peekContext=Promise.prototype._peekContext=peekContext,Promise.prototype._promiseCreated=function(){var ctx=this._peekContext();ctx&&null==ctx._promiseCreated&&(ctx._promiseCreated=this)}},Context}},{}],9:[function(_dereq_,module,exports){"use strict";module.exports=function(Promise,Context){function generatePromiseLifecycleEventObject(name,promise){return{promise:promise}}function defaultFireEvent(){return!1}function cancellationExecute(executor,resolve,reject){var promise=this;try{executor(resolve,reject,function(onCancel){if("function"!=typeof onCancel)throw new TypeError("onCancel must be a function, got: "+util.toString(onCancel));promise._attachCancellationCallback(onCancel)})}catch(e){return e}}function cancellationAttachCancellationCallback(onCancel){if(!this._isCancellable())return this;var previousOnCancel=this._onCancel();void 0!==previousOnCancel?util.isArray(previousOnCancel)?previousOnCancel.push(onCancel):this._setOnCancel([previousOnCancel,onCancel]):this._setOnCancel(onCancel)}function cancellationOnCancel(){return this._onCancelField}function cancellationSetOnCancel(onCancel){this._onCancelField=onCancel}function cancellationClearCancellationData(){this._cancellationParent=void 0,this._onCancelField=void 0}function cancellationPropagateFrom(parent,flags){if(0!=(1&flags)){this._cancellationParent=parent;var branchesRemainingToCancel=parent._branchesRemainingToCancel;void 0===branchesRemainingToCancel&&(branchesRemainingToCancel=0),parent._branchesRemainingToCancel=branchesRemainingToCancel+1}0!=(2&flags)&&parent._isBound()&&this._setBoundTo(parent._boundTo)}function bindingPropagateFrom(parent,flags){0!=(2&flags)&&parent._isBound()&&this._setBoundTo(parent._boundTo)}function boundValueFunction(){var ret=this._boundTo;return void 0!==ret&&ret instanceof Promise?ret.isFulfilled()?ret.value():void 0:ret}function longStackTracesCaptureStackTrace(){this._trace=new CapturedTrace(this._peekContext())}function longStackTracesAttachExtraTrace(error,ignoreSelf){if(canAttachTrace(error)){var trace=this._trace;if(void 0!==trace&&ignoreSelf&&(trace=trace._parent),void 0!==trace)trace.attachExtraTrace(error);else if(!error.__stackCleaned__){var parsed=parseStackAndMessage(error);util.notEnumerableProp(error,"stack",parsed.message+"\n"+parsed.stack.join("\n")),util.notEnumerableProp(error,"__stackCleaned__",!0)}}}function checkForgottenReturns(returnValue,promiseCreated,name,promise,parent){if(void 0===returnValue&&null!==promiseCreated&&wForgottenReturn){if(void 0!==parent&&parent._returnedNonUndefined())return;if(0==(65535&promise._bitField))return;name&&(name+=" ");var handlerLine="",creatorLine="";if(promiseCreated._trace){for(var traceLines=promiseCreated._trace.stack.split("\n"),stack=cleanStack(traceLines),i=stack.length-1;i>=0;--i){var line=stack[i];if(!nodeFramePattern.test(line)){var lineMatches=line.match(parseLinePattern);lineMatches&&(handlerLine="at "+lineMatches[1]+":"+lineMatches[2]+":"+lineMatches[3]+" ");break}}if(stack.length>0)for(var firstUserLine=stack[0],i=0;i<traceLines.length;++i)if(traceLines[i]===firstUserLine){i>0&&(creatorLine="\n"+traceLines[i-1]);break}}var msg="a promise was created in a "+name+"handler "+handlerLine+"but was not returned from it, see http://goo.gl/rRqMUw"+creatorLine;promise._warn(msg,!0,promiseCreated)}}function deprecated(name,replacement){var message=name+" is deprecated and will be removed in a future version.";return replacement&&(message+=" Use "+replacement+" instead."),warn(message)}function warn(message,shouldUseOwnTrace,promise){if(config.warnings){var ctx,warning=new Warning(message);if(shouldUseOwnTrace)promise._attachExtraTrace(warning);else if(config.longStackTraces&&(ctx=Promise._peekContext()))ctx.attachExtraTrace(warning);else{var parsed=parseStackAndMessage(warning);warning.stack=parsed.message+"\n"+parsed.stack.join("\n")}activeFireEvent("warning",warning)||formatAndLogError(warning,"",!0)}}function reconstructStack(message,stacks){for(var i=0;i<stacks.length-1;++i)stacks[i].push("From previous event:"),stacks[i]=stacks[i].join("\n");return i<stacks.length&&(stacks[i]=stacks[i].join("\n")),message+"\n"+stacks.join("\n")}function removeDuplicateOrEmptyJumps(stacks){for(var i=0;i<stacks.length;++i)(0===stacks[i].length||i+1<stacks.length&&stacks[i][0]===stacks[i+1][0])&&(stacks.splice(i,1),i--)}function removeCommonRoots(stacks){for(var current=stacks[0],i=1;i<stacks.length;++i){for(var prev=stacks[i],currentLastIndex=current.length-1,currentLastLine=current[currentLastIndex],commonRootMeetPoint=-1,j=prev.length-1;j>=0;--j)if(prev[j]===currentLastLine){commonRootMeetPoint=j;break}for(var j=commonRootMeetPoint;j>=0;--j){var line=prev[j];if(current[currentLastIndex]!==line)break;current.pop(),currentLastIndex--}current=prev}}function cleanStack(stack){for(var ret=[],i=0;i<stack.length;++i){var line=stack[i],isTraceLine="    (No stack trace)"===line||stackFramePattern.test(line),isInternalFrame=isTraceLine&&shouldIgnore(line);isTraceLine&&!isInternalFrame&&(indentStackFrames&&" "!==line.charAt(0)&&(line="    "+line),ret.push(line))}return ret}function stackFramesAsArray(error){for(var stack=error.stack.replace(/\s+$/g,"").split("\n"),i=0;i<stack.length;++i){var line=stack[i];if("    (No stack trace)"===line||stackFramePattern.test(line))break}return i>0&&"SyntaxError"!=error.name&&(stack=stack.slice(i)),stack}function parseStackAndMessage(error){var stack=error.stack,message=error.toString();return stack="string"==typeof stack&&stack.length>0?stackFramesAsArray(error):["    (No stack trace)"],{message:message,stack:"SyntaxError"==error.name?stack:cleanStack(stack)}}function formatAndLogError(error,title,isSoft){if("undefined"!=typeof console){var message;if(util.isObject(error)){var stack=error.stack;message=title+formatStack(stack,error)}else message=title+String(error);"function"==typeof printWarning?printWarning(message,isSoft):"function"!=typeof console.log&&"object"!=typeof console.log||console.log(message)}}function fireRejectionEvent(name,localHandler,reason,promise){var localEventFired=!1;try{"function"==typeof localHandler&&(localEventFired=!0,"rejectionHandled"===name?localHandler(promise):localHandler(reason,promise))}catch(e){async.throwLater(e)}"unhandledRejection"===name?activeFireEvent(name,reason,promise)||localEventFired||formatAndLogError(reason,"Unhandled rejection "):activeFireEvent(name,promise)}function formatNonError(obj){var str;if("function"==typeof obj)str="[function "+(obj.name||"anonymous")+"]";else{str=obj&&"function"==typeof obj.toString?obj.toString():util.toString(obj);if(/\[object [a-zA-Z0-9$_]+\]/.test(str))try{str=JSON.stringify(obj)}catch(e){}0===str.length&&(str="(empty array)")}return"(<"+snip(str)+">, no stack trace)"}function snip(str){return str.length<41?str:str.substr(0,38)+"..."}function longStackTracesIsSupported(){return"function"==typeof captureStackTrace}function parseLineInfo(line){var matches=line.match(parseLineInfoRegex);if(matches)return{fileName:matches[1],line:parseInt(matches[2],10)}}function setBounds(firstLineError,lastLineError){if(longStackTracesIsSupported()){for(var firstFileName,lastFileName,firstStackLines=firstLineError.stack.split("\n"),lastStackLines=lastLineError.stack.split("\n"),firstIndex=-1,lastIndex=-1,i=0;i<firstStackLines.length;++i){var result=parseLineInfo(firstStackLines[i]);if(result){firstFileName=result.fileName,firstIndex=result.line;break}}for(var i=0;i<lastStackLines.length;++i){var result=parseLineInfo(lastStackLines[i]);if(result){lastFileName=result.fileName,lastIndex=result.line;break}}firstIndex<0||lastIndex<0||!firstFileName||!lastFileName||firstFileName!==lastFileName||firstIndex>=lastIndex||(shouldIgnore=function(line){if(bluebirdFramePattern.test(line))return!0;var info=parseLineInfo(line);return!!(info&&info.fileName===firstFileName&&firstIndex<=info.line&&info.line<=lastIndex)})}}function CapturedTrace(parent){this._parent=parent,this._promisesCreated=0;var length=this._length=1+(void 0===parent?0:parent._length);captureStackTrace(this,CapturedTrace),length>32&&this.uncycle()}var unhandledRejectionHandled,possiblyUnhandledRejection,printWarning,getDomain=Promise._getDomain,async=Promise._async,Warning=_dereq_("./errors").Warning,util=_dereq_("./util"),canAttachTrace=util.canAttachTrace,bluebirdFramePattern=/[\\\/]bluebird[\\\/]js[\\\/](release|debug|instrumented)/,nodeFramePattern=/\((?:timers\.js):\d+:\d+\)/,parseLinePattern=/[\/<\(](.+?):(\d+):(\d+)\)?\s*$/,stackFramePattern=null,formatStack=null,indentStackFrames=!1,debugging=!(0==util.env("BLUEBIRD_DEBUG")),warnings=!(0==util.env("BLUEBIRD_WARNINGS")||!debugging&&!util.env("BLUEBIRD_WARNINGS")),longStackTraces=!(0==util.env("BLUEBIRD_LONG_STACK_TRACES")||!debugging&&!util.env("BLUEBIRD_LONG_STACK_TRACES")),wForgottenReturn=0!=util.env("BLUEBIRD_W_FORGOTTEN_RETURN")&&(warnings||!!util.env("BLUEBIRD_W_FORGOTTEN_RETURN"));Promise.prototype.suppressUnhandledRejections=function(){var target=this._target();target._bitField=-1048577&target._bitField|524288},Promise.prototype._ensurePossibleRejectionHandled=function(){0==(524288&this._bitField)&&(this._setRejectionIsUnhandled(),async.invokeLater(this._notifyUnhandledRejection,this,void 0))},Promise.prototype._notifyUnhandledRejectionIsHandled=function(){fireRejectionEvent("rejectionHandled",unhandledRejectionHandled,void 0,this)},Promise.prototype._setReturnedNonUndefined=function(){this._bitField=268435456|this._bitField},Promise.prototype._returnedNonUndefined=function(){return 0!=(268435456&this._bitField)},Promise.prototype._notifyUnhandledRejection=function(){if(this._isRejectionUnhandled()){var reason=this._settledValue();this._setUnhandledRejectionIsNotified(),fireRejectionEvent("unhandledRejection",possiblyUnhandledRejection,reason,this)}},Promise.prototype._setUnhandledRejectionIsNotified=function(){this._bitField=262144|this._bitField},Promise.prototype._unsetUnhandledRejectionIsNotified=function(){this._bitField=-262145&this._bitField},Promise.prototype._isUnhandledRejectionNotified=function(){return(262144&this._bitField)>0},Promise.prototype._setRejectionIsUnhandled=function(){this._bitField=1048576|this._bitField},Promise.prototype._unsetRejectionIsUnhandled=function(){this._bitField=-1048577&this._bitField,this._isUnhandledRejectionNotified()&&(this._unsetUnhandledRejectionIsNotified(),this._notifyUnhandledRejectionIsHandled())},Promise.prototype._isRejectionUnhandled=function(){return(1048576&this._bitField)>0},Promise.prototype._warn=function(message,shouldUseOwnTrace,promise){return warn(message,shouldUseOwnTrace,promise||this)},Promise.onPossiblyUnhandledRejection=function(fn){var domain=getDomain();possiblyUnhandledRejection="function"==typeof fn?null===domain?fn:util.domainBind(domain,fn):void 0},Promise.onUnhandledRejectionHandled=function(fn){var domain=getDomain();unhandledRejectionHandled="function"==typeof fn?null===domain?fn:util.domainBind(domain,fn):void 0};var disableLongStackTraces=function(){};Promise.longStackTraces=function(){if(async.haveItemsQueued()&&!config.longStackTraces)throw new Error("cannot enable long stack traces after promises have been created\n\n    See http://goo.gl/MqrFmX\n");if(!config.longStackTraces&&longStackTracesIsSupported()){var Promise_captureStackTrace=Promise.prototype._captureStackTrace,Promise_attachExtraTrace=Promise.prototype._attachExtraTrace;config.longStackTraces=!0,disableLongStackTraces=function(){if(async.haveItemsQueued()&&!config.longStackTraces)throw new Error("cannot enable long stack traces after promises have been created\n\n    See http://goo.gl/MqrFmX\n");Promise.prototype._captureStackTrace=Promise_captureStackTrace,Promise.prototype._attachExtraTrace=Promise_attachExtraTrace,Context.deactivateLongStackTraces(),async.enableTrampoline(),config.longStackTraces=!1},Promise.prototype._captureStackTrace=longStackTracesCaptureStackTrace,Promise.prototype._attachExtraTrace=longStackTracesAttachExtraTrace,Context.activateLongStackTraces(),async.disableTrampolineIfNecessary()}},Promise.hasLongStackTraces=function(){return config.longStackTraces&&longStackTracesIsSupported()};var fireDomEvent=function(){try{if("function"==typeof CustomEvent){var event=new CustomEvent("CustomEvent");return util.global.dispatchEvent(event),function(name,event){var domEvent=new CustomEvent(name.toLowerCase(),{detail:event,cancelable:!0});return!util.global.dispatchEvent(domEvent)}}if("function"==typeof Event){var event=new Event("CustomEvent");return util.global.dispatchEvent(event),function(name,event){var domEvent=new Event(name.toLowerCase(),{cancelable:!0});return domEvent.detail=event,!util.global.dispatchEvent(domEvent)}}var event=document.createEvent("CustomEvent");return event.initCustomEvent("testingtheevent",!1,!0,{}),util.global.dispatchEvent(event),function(name,event){var domEvent=document.createEvent("CustomEvent");return domEvent.initCustomEvent(name.toLowerCase(),!1,!0,event),!util.global.dispatchEvent(domEvent)}}catch(e){}return function(){return!1}}(),fireGlobalEvent=function(){return util.isNode?function(){return process.emit.apply(process,arguments)}:util.global?function(name){var methodName="on"+name.toLowerCase(),method=util.global[methodName];return!!method&&(method.apply(util.global,[].slice.call(arguments,1)),!0)}:function(){return!1}}(),eventToObjectGenerator={promiseCreated:generatePromiseLifecycleEventObject,promiseFulfilled:generatePromiseLifecycleEventObject,promiseRejected:generatePromiseLifecycleEventObject,promiseResolved:generatePromiseLifecycleEventObject,promiseCancelled:generatePromiseLifecycleEventObject,promiseChained:function(name,promise,child){return{promise:promise,child:child}},warning:function(name,warning){return{warning:warning}},unhandledRejection:function(name,reason,promise){return{reason:reason,promise:promise}},rejectionHandled:generatePromiseLifecycleEventObject},activeFireEvent=function(name){var globalEventFired=!1;try{globalEventFired=fireGlobalEvent.apply(null,arguments)}catch(e){async.throwLater(e),globalEventFired=!0}var domEventFired=!1;try{domEventFired=fireDomEvent(name,eventToObjectGenerator[name].apply(null,arguments))}catch(e){async.throwLater(e),domEventFired=!0}return domEventFired||globalEventFired};Promise.config=function(opts){if(opts=Object(opts),"longStackTraces"in opts&&(opts.longStackTraces?Promise.longStackTraces():!opts.longStackTraces&&Promise.hasLongStackTraces()&&disableLongStackTraces()),"warnings"in opts){var warningsOption=opts.warnings;config.warnings=!!warningsOption,wForgottenReturn=config.warnings,util.isObject(warningsOption)&&"wForgottenReturn"in warningsOption&&(wForgottenReturn=!!warningsOption.wForgottenReturn)}if("cancellation"in opts&&opts.cancellation&&!config.cancellation){if(async.haveItemsQueued())throw new Error("cannot enable cancellation after promises are in use");Promise.prototype._clearCancellationData=cancellationClearCancellationData,Promise.prototype._propagateFrom=cancellationPropagateFrom,Promise.prototype._onCancel=cancellationOnCancel,Promise.prototype._setOnCancel=cancellationSetOnCancel,Promise.prototype._attachCancellationCallback=cancellationAttachCancellationCallback,Promise.prototype._execute=cancellationExecute,propagateFromFunction=cancellationPropagateFrom,config.cancellation=!0}return"monitoring"in opts&&(opts.monitoring&&!config.monitoring?(config.monitoring=!0,Promise.prototype._fireEvent=activeFireEvent):!opts.monitoring&&config.monitoring&&(config.monitoring=!1,Promise.prototype._fireEvent=defaultFireEvent)),Promise},Promise.prototype._fireEvent=defaultFireEvent,Promise.prototype._execute=function(executor,resolve,reject){try{executor(resolve,reject)}catch(e){return e}},Promise.prototype._onCancel=function(){},Promise.prototype._setOnCancel=function(handler){},Promise.prototype._attachCancellationCallback=function(onCancel){},Promise.prototype._captureStackTrace=function(){},Promise.prototype._attachExtraTrace=function(){},Promise.prototype._clearCancellationData=function(){},Promise.prototype._propagateFrom=function(parent,flags){};var propagateFromFunction=bindingPropagateFrom,shouldIgnore=function(){return!1},parseLineInfoRegex=/[\/<\(]([^:\/]+):(\d+):(?:\d+)\)?\s*$/;util.inherits(CapturedTrace,Error),Context.CapturedTrace=CapturedTrace,CapturedTrace.prototype.uncycle=function(){var length=this._length;if(!(length<2)){for(var nodes=[],stackToIndex={},i=0,node=this;void 0!==node;++i)nodes.push(node),node=node._parent;length=this._length=i;for(var i=length-1;i>=0;--i){var stack=nodes[i].stack;void 0===stackToIndex[stack]&&(stackToIndex[stack]=i)}for(var i=0;i<length;++i){var currentStack=nodes[i].stack,index=stackToIndex[currentStack];if(void 0!==index&&index!==i){index>0&&(nodes[index-1]._parent=void 0,nodes[index-1]._length=1),nodes[i]._parent=void 0,nodes[i]._length=1;var cycleEdgeNode=i>0?nodes[i-1]:this;index<length-1?(cycleEdgeNode._parent=nodes[index+1],cycleEdgeNode._parent.uncycle(),cycleEdgeNode._length=cycleEdgeNode._parent._length+1):(cycleEdgeNode._parent=void 0,cycleEdgeNode._length=1);for(var currentChildLength=cycleEdgeNode._length+1,j=i-2;j>=0;--j)nodes[j]._length=currentChildLength,currentChildLength++;return}}}},CapturedTrace.prototype.attachExtraTrace=function(error){if(!error.__stackCleaned__){this.uncycle();for(var parsed=parseStackAndMessage(error),message=parsed.message,stacks=[parsed.stack],trace=this;void 0!==trace;)stacks.push(cleanStack(trace.stack.split("\n"))),trace=trace._parent;removeCommonRoots(stacks),removeDuplicateOrEmptyJumps(stacks),util.notEnumerableProp(error,"stack",reconstructStack(message,stacks)),util.notEnumerableProp(error,"__stackCleaned__",!0)}};var captureStackTrace=function(){var v8stackFramePattern=/^\s*at\s*/,v8stackFormatter=function(stack,error){return"string"==typeof stack?stack:void 0!==error.name&&void 0!==error.message?error.toString():formatNonError(error)};if("number"==typeof Error.stackTraceLimit&&"function"==typeof Error.captureStackTrace){Error.stackTraceLimit+=6,stackFramePattern=v8stackFramePattern,formatStack=v8stackFormatter;var captureStackTrace=Error.captureStackTrace;return shouldIgnore=function(line){return bluebirdFramePattern.test(line)},function(receiver,ignoreUntil){Error.stackTraceLimit+=6,captureStackTrace(receiver,ignoreUntil),Error.stackTraceLimit-=6}}var err=new Error;if("string"==typeof err.stack&&err.stack.split("\n")[0].indexOf("stackDetection@")>=0)return stackFramePattern=/@/,formatStack=v8stackFormatter,indentStackFrames=!0,function(o){o.stack=(new Error).stack};var hasStackAfterThrow;try{throw new Error}catch(e){hasStackAfterThrow="stack"in e}return"stack"in err||!hasStackAfterThrow||"number"!=typeof Error.stackTraceLimit?(formatStack=function(stack,error){return"string"==typeof stack?stack:"object"!=typeof error&&"function"!=typeof error||void 0===error.name||void 0===error.message?formatNonError(error):error.toString()},null):(stackFramePattern=v8stackFramePattern,formatStack=v8stackFormatter,function(o){Error.stackTraceLimit+=6;try{throw new Error}catch(e){o.stack=e.stack}Error.stackTraceLimit-=6})}();"undefined"!=typeof console&&void 0!==console.warn&&(printWarning=function(message){console.warn(message)},util.isNode&&process.stderr.isTTY?printWarning=function(message,isSoft){var color=isSoft?"[33m":"[31m";console.warn(color+message+"[0m\n")}:util.isNode||"string"!=typeof(new Error).stack||(printWarning=function(message,isSoft){console.warn("%c"+message,isSoft?"color: darkorange":"color: red")}));var config={warnings:warnings,longStackTraces:!1,cancellation:!1,monitoring:!1};return longStackTraces&&Promise.longStackTraces(),{longStackTraces:function(){return config.longStackTraces},warnings:function(){return config.warnings},cancellation:function(){return config.cancellation},monitoring:function(){return config.monitoring},propagateFromFunction:function(){return propagateFromFunction},boundValueFunction:function(){return boundValueFunction},checkForgottenReturns:checkForgottenReturns,setBounds:setBounds,warn:warn,deprecated:deprecated,CapturedTrace:CapturedTrace,fireDomEvent:fireDomEvent,fireGlobalEvent:fireGlobalEvent}}},{"./errors":12,"./util":36}],10:[function(_dereq_,module,exports){"use strict";module.exports=function(Promise){function returner(){return this.value}function thrower(){throw this.reason}Promise.prototype.return=Promise.prototype.thenReturn=function(value){return value instanceof Promise&&value.suppressUnhandledRejections(),this._then(returner,void 0,void 0,{value:value},void 0)},Promise.prototype.throw=Promise.prototype.thenThrow=function(reason){return this._then(thrower,void 0,void 0,{reason:reason},void 0)},Promise.prototype.catchThrow=function(reason){if(arguments.length<=1)return this._then(void 0,thrower,void 0,{reason:reason},void 0);var _reason=arguments[1],handler=function(){throw _reason};return this.caught(reason,handler)},Promise.prototype.catchReturn=function(value){if(arguments.length<=1)return value instanceof Promise&&value.suppressUnhandledRejections(),this._then(void 0,returner,void 0,{value:value},void 0);var _value=arguments[1];_value instanceof Promise&&_value.suppressUnhandledRejections();var handler=function(){return _value};return this.caught(value,handler)}}},{}],11:[function(_dereq_,module,exports){"use strict";module.exports=function(Promise,INTERNAL){function promiseAllThis(){return PromiseAll(this)}function PromiseMapSeries(promises,fn){return PromiseReduce(promises,fn,INTERNAL,INTERNAL)}var PromiseReduce=Promise.reduce,PromiseAll=Promise.all;Promise.prototype.each=function(fn){return PromiseReduce(this,fn,INTERNAL,0)._then(promiseAllThis,void 0,void 0,this,void 0)},Promise.prototype.mapSeries=function(fn){return PromiseReduce(this,fn,INTERNAL,INTERNAL)},Promise.each=function(promises,fn){return PromiseReduce(promises,fn,INTERNAL,0)._then(promiseAllThis,void 0,void 0,promises,void 0)},Promise.mapSeries=PromiseMapSeries}},{}],12:[function(_dereq_,module,exports){"use strict";function subError(nameProperty,defaultMessage){function SubError(message){if(!(this instanceof SubError))return new SubError(message);notEnumerableProp(this,"message","string"==typeof message?message:defaultMessage),notEnumerableProp(this,"name",nameProperty),Error.captureStackTrace?Error.captureStackTrace(this,this.constructor):Error.call(this)}return inherits(SubError,Error),SubError}function OperationalError(message){if(!(this instanceof OperationalError))return new OperationalError(message);notEnumerableProp(this,"name","OperationalError"),notEnumerableProp(this,"message",message),this.cause=message,this.isOperational=!0,message instanceof Error?(notEnumerableProp(this,"message",message.message),notEnumerableProp(this,"stack",message.stack)):Error.captureStackTrace&&Error.captureStackTrace(this,this.constructor)}var _TypeError,_RangeError,es5=_dereq_("./es5"),Objectfreeze=es5.freeze,util=_dereq_("./util"),inherits=util.inherits,notEnumerableProp=util.notEnumerableProp,Warning=subError("Warning","warning"),CancellationError=subError("CancellationError","cancellation error"),TimeoutError=subError("TimeoutError","timeout error"),AggregateError=subError("AggregateError","aggregate error");try{_TypeError=TypeError,_RangeError=RangeError}catch(e){_TypeError=subError("TypeError","type error"),_RangeError=subError("RangeError","range error")}for(var methods="join pop push shift unshift slice filter forEach some every map indexOf lastIndexOf reduce reduceRight sort reverse".split(" "),i=0;i<methods.length;++i)"function"==typeof Array.prototype[methods[i]]&&(AggregateError.prototype[methods[i]]=Array.prototype[methods[i]]);es5.defineProperty(AggregateError.prototype,"length",{value:0,configurable:!1,writable:!0,enumerable:!0}),AggregateError.prototype.isOperational=!0;var level=0;AggregateError.prototype.toString=function(){var indent=Array(4*level+1).join(" "),ret="\n"+indent+"AggregateError of:\n";level++,indent=Array(4*level+1).join(" ");for(var i=0;i<this.length;++i){for(var str=this[i]===this?"[Circular AggregateError]":this[i]+"",lines=str.split("\n"),j=0;j<lines.length;++j)lines[j]=indent+lines[j];str=lines.join("\n"),ret+=str+"\n"}return level--,ret},inherits(OperationalError,Error);var errorTypes=Error.__BluebirdErrorTypes__;errorTypes||(errorTypes=Objectfreeze({CancellationError:CancellationError,TimeoutError:TimeoutError,OperationalError:OperationalError,RejectionError:OperationalError,AggregateError:AggregateError}),es5.defineProperty(Error,"__BluebirdErrorTypes__",{value:errorTypes,writable:!1,enumerable:!1,configurable:!1})),module.exports={Error:Error,TypeError:_TypeError,RangeError:_RangeError,CancellationError:errorTypes.CancellationError,OperationalError:errorTypes.OperationalError,TimeoutError:errorTypes.TimeoutError,AggregateError:errorTypes.AggregateError,Warning:Warning}},{"./es5":13,"./util":36}],13:[function(_dereq_,module,exports){var isES5=function(){"use strict";return void 0===this}();if(isES5)module.exports={freeze:Object.freeze,defineProperty:Object.defineProperty,getDescriptor:Object.getOwnPropertyDescriptor,keys:Object.keys,names:Object.getOwnPropertyNames,getPrototypeOf:Object.getPrototypeOf,isArray:Array.isArray,isES5:isES5,propertyIsWritable:function(obj,prop){var descriptor=Object.getOwnPropertyDescriptor(obj,prop);return!(descriptor&&!descriptor.writable&&!descriptor.set)}};else{var has={}.hasOwnProperty,str={}.toString,proto={}.constructor.prototype,ObjectKeys=function(o){var ret=[];for(var key in o)has.call(o,key)&&ret.push(key);return ret},ObjectGetDescriptor=function(o,key){return{value:o[key]}},ObjectDefineProperty=function(o,key,desc){return o[key]=desc.value,o},ObjectFreeze=function(obj){return obj},ObjectGetPrototypeOf=function(obj){try{return Object(obj).constructor.prototype}catch(e){return proto}},ArrayIsArray=function(obj){try{return"[object Array]"===str.call(obj)}catch(e){return!1}};module.exports={isArray:ArrayIsArray,keys:ObjectKeys,names:ObjectKeys,defineProperty:ObjectDefineProperty,getDescriptor:ObjectGetDescriptor,freeze:ObjectFreeze,getPrototypeOf:ObjectGetPrototypeOf,isES5:isES5,propertyIsWritable:function(){return!0}}}},{}],14:[function(_dereq_,module,exports){"use strict";module.exports=function(Promise,INTERNAL){var PromiseMap=Promise.map;Promise.prototype.filter=function(fn,options){return PromiseMap(this,fn,options,INTERNAL)},Promise.filter=function(promises,fn,options){return PromiseMap(promises,fn,options,INTERNAL)}}},{}],15:[function(_dereq_,module,exports){"use strict";module.exports=function(Promise,tryConvertToPromise,NEXT_FILTER){function PassThroughHandlerContext(promise,type,handler){this.promise=promise,this.type=type,this.handler=handler,this.called=!1,this.cancelPromise=null}function FinallyHandlerCancelReaction(finallyHandler){this.finallyHandler=finallyHandler}function checkCancel(ctx,reason){return null!=ctx.cancelPromise&&(arguments.length>1?ctx.cancelPromise._reject(reason):ctx.cancelPromise._cancel(),ctx.cancelPromise=null,!0)}function succeed(){return finallyHandler.call(this,this.promise._target()._settledValue())}function fail(reason){if(!checkCancel(this,reason))return errorObj.e=reason,errorObj}function finallyHandler(reasonOrValue){var promise=this.promise,handler=this.handler;if(!this.called){this.called=!0;var ret=this.isFinallyHandler()?handler.call(promise._boundValue()):handler.call(promise._boundValue(),reasonOrValue);if(ret===NEXT_FILTER)return ret;if(void 0!==ret){promise._setReturnedNonUndefined();var maybePromise=tryConvertToPromise(ret,promise);if(maybePromise instanceof Promise){if(null!=this.cancelPromise){if(maybePromise._isCancelled()){var reason=new CancellationError("late cancellation observer");return promise._attachExtraTrace(reason),errorObj.e=reason,errorObj}maybePromise.isPending()&&maybePromise._attachCancellationCallback(new FinallyHandlerCancelReaction(this))}return maybePromise._then(succeed,fail,void 0,this,void 0)}}}return promise.isRejected()?(checkCancel(this),errorObj.e=reasonOrValue,errorObj):(checkCancel(this),reasonOrValue)}var util=_dereq_("./util"),CancellationError=Promise.CancellationError,errorObj=util.errorObj,catchFilter=_dereq_("./catch_filter")(NEXT_FILTER);return PassThroughHandlerContext.prototype.isFinallyHandler=function(){return 0===this.type},FinallyHandlerCancelReaction.prototype._resultCancelled=function(){checkCancel(this.finallyHandler)},Promise.prototype._passThrough=function(handler,type,success,fail){return"function"!=typeof handler?this.then():this._then(success,fail,void 0,new PassThroughHandlerContext(this,type,handler),void 0)},Promise.prototype.lastly=Promise.prototype.finally=function(handler){return this._passThrough(handler,0,finallyHandler,finallyHandler)},Promise.prototype.tap=function(handler){return this._passThrough(handler,1,finallyHandler)},Promise.prototype.tapCatch=function(handlerOrPredicate){var len=arguments.length;if(1===len)return this._passThrough(handlerOrPredicate,1,void 0,finallyHandler);var i,catchInstances=new Array(len-1),j=0;for(i=0;i<len-1;++i){var item=arguments[i];if(!util.isObject(item))return Promise.reject(new TypeError("tapCatch statement predicate: expecting an object but got "+util.classString(item)));catchInstances[j++]=item}catchInstances.length=j;var handler=arguments[i];return this._passThrough(catchFilter(catchInstances,handler,this),1,void 0,finallyHandler)},PassThroughHandlerContext}},{"./catch_filter":7,"./util":36}],16:[function(_dereq_,module,exports){"use strict";module.exports=function(Promise,apiRejection,INTERNAL,tryConvertToPromise,Proxyable,debug){function promiseFromYieldHandler(value,yieldHandlers,traceParent){for(var i=0;i<yieldHandlers.length;++i){traceParent._pushContext();var result=tryCatch(yieldHandlers[i])(value);if(traceParent._popContext(),result===errorObj){traceParent._pushContext();var ret=Promise.reject(errorObj.e);return traceParent._popContext(),ret}var maybePromise=tryConvertToPromise(result,traceParent);if(maybePromise instanceof Promise)return maybePromise}return null}function PromiseSpawn(generatorFunction,receiver,yieldHandler,stack){if(debug.cancellation()){var internal=new Promise(INTERNAL),_finallyPromise=this._finallyPromise=new Promise(INTERNAL);this._promise=internal.lastly(function(){return _finallyPromise}),internal._captureStackTrace(),internal._setOnCancel(this)}else{(this._promise=new Promise(INTERNAL))._captureStackTrace()}this._stack=stack,this._generatorFunction=generatorFunction,this._receiver=receiver,this._generator=void 0,this._yieldHandlers="function"==typeof yieldHandler?[yieldHandler].concat(yieldHandlers):yieldHandlers,this._yieldedPromise=null,this._cancellationPhase=!1}var errors=_dereq_("./errors"),TypeError=errors.TypeError,util=_dereq_("./util"),errorObj=util.errorObj,tryCatch=util.tryCatch,yieldHandlers=[];util.inherits(PromiseSpawn,Proxyable),PromiseSpawn.prototype._isResolved=function(){return null===this._promise},PromiseSpawn.prototype._cleanup=function(){this._promise=this._generator=null,debug.cancellation()&&null!==this._finallyPromise&&(this._finallyPromise._fulfill(),this._finallyPromise=null)},PromiseSpawn.prototype._promiseCancelled=function(){if(!this._isResolved()){var result,implementsReturn=void 0!==this._generator.return;if(implementsReturn)this._promise._pushContext(),result=tryCatch(this._generator.return).call(this._generator,void 0),this._promise._popContext();else{var reason=new Promise.CancellationError("generator .return() sentinel");Promise.coroutine.returnSentinel=reason,this._promise._attachExtraTrace(reason),this._promise._pushContext(),result=tryCatch(this._generator.throw).call(this._generator,reason),this._promise._popContext()}this._cancellationPhase=!0,this._yieldedPromise=null,this._continue(result)}},PromiseSpawn.prototype._promiseFulfilled=function(value){this._yieldedPromise=null,this._promise._pushContext();var result=tryCatch(this._generator.next).call(this._generator,value);this._promise._popContext(),this._continue(result)},PromiseSpawn.prototype._promiseRejected=function(reason){this._yieldedPromise=null,this._promise._attachExtraTrace(reason),this._promise._pushContext();var result=tryCatch(this._generator.throw).call(this._generator,reason);this._promise._popContext(),this._continue(result)},PromiseSpawn.prototype._resultCancelled=function(){if(this._yieldedPromise instanceof Promise){var promise=this._yieldedPromise;this._yieldedPromise=null,promise.cancel()}},PromiseSpawn.prototype.promise=function(){return this._promise},PromiseSpawn.prototype._run=function(){this._generator=this._generatorFunction.call(this._receiver),this._receiver=this._generatorFunction=void 0,this._promiseFulfilled(void 0)},PromiseSpawn.prototype._continue=function(result){var promise=this._promise;if(result===errorObj)return this._cleanup(),this._cancellationPhase?promise.cancel():promise._rejectCallback(result.e,!1);var value=result.value;if(!0===result.done)return this._cleanup(),this._cancellationPhase?promise.cancel():promise._resolveCallback(value);var maybePromise=tryConvertToPromise(value,this._promise);if(!(maybePromise instanceof Promise)&&null===(maybePromise=promiseFromYieldHandler(maybePromise,this._yieldHandlers,this._promise)))return void this._promiseRejected(new TypeError("A value %s was yielded that could not be treated as a promise\n\n    See http://goo.gl/MqrFmX\n\n".replace("%s",String(value))+"From coroutine:\n"+this._stack.split("\n").slice(1,-7).join("\n")));maybePromise=maybePromise._target();var bitField=maybePromise._bitField;0==(50397184&bitField)?(this._yieldedPromise=maybePromise,maybePromise._proxy(this,null)):0!=(33554432&bitField)?Promise._async.invoke(this._promiseFulfilled,this,maybePromise._value()):0!=(16777216&bitField)?Promise._async.invoke(this._promiseRejected,this,maybePromise._reason()):this._promiseCancelled()},Promise.coroutine=function(generatorFunction,options){if("function"!=typeof generatorFunction)throw new TypeError("generatorFunction must be a function\n\n    See http://goo.gl/MqrFmX\n");var yieldHandler=Object(options).yieldHandler,PromiseSpawn$=PromiseSpawn,stack=(new Error).stack;return function(){var generator=generatorFunction.apply(this,arguments),spawn=new PromiseSpawn$(void 0,void 0,yieldHandler,stack),ret=spawn.promise();return spawn._generator=generator,spawn._promiseFulfilled(void 0),ret}},Promise.coroutine.addYieldHandler=function(fn){if("function"!=typeof fn)throw new TypeError("expecting a function but got "+util.classString(fn));yieldHandlers.push(fn)},Promise.spawn=function(generatorFunction){if(debug.deprecated("Promise.spawn()","Promise.coroutine()"),"function"!=typeof generatorFunction)return apiRejection("generatorFunction must be a function\n\n    See http://goo.gl/MqrFmX\n");var spawn=new PromiseSpawn(generatorFunction,this),ret=spawn.promise();return spawn._run(Promise.spawn),ret}}},{"./errors":12,"./util":36}],17:[function(_dereq_,module,exports){"use strict";module.exports=function(Promise,PromiseArray,tryConvertToPromise,INTERNAL,async,getDomain){var util=_dereq_("./util");util.canEvaluate,util.tryCatch,util.errorObj;Promise.join=function(){var fn,last=arguments.length-1;if(last>0&&"function"==typeof arguments[last]){fn=arguments[last];var ret}var args=[].slice.call(arguments);fn&&args.pop();var ret=new PromiseArray(args).promise();return void 0!==fn?ret.spread(fn):ret}}},{"./util":36}],18:[function(_dereq_,module,exports){"use strict";module.exports=function(Promise,PromiseArray,apiRejection,tryConvertToPromise,INTERNAL,debug){function MappingPromiseArray(promises,fn,limit,_filter){this.constructor$(promises),this._promise._captureStackTrace();var domain=getDomain();this._callback=null===domain?fn:util.domainBind(domain,fn),this._preservedValues=_filter===INTERNAL?new Array(this.length()):null,this._limit=limit,this._inFlight=0,this._queue=[],async.invoke(this._asyncInit,this,void 0)}function map(promises,fn,options,_filter){if("function"!=typeof fn)return apiRejection("expecting a function but got "+util.classString(fn));var limit=0;if(void 0!==options){if("object"!=typeof options||null===options)return Promise.reject(new TypeError("options argument must be an object but it is "+util.classString(options)));if("number"!=typeof options.concurrency)return Promise.reject(new TypeError("'concurrency' must be a number but it is "+util.classString(options.concurrency)));limit=options.concurrency}return limit="number"==typeof limit&&isFinite(limit)&&limit>=1?limit:0,new MappingPromiseArray(promises,fn,limit,_filter).promise()}var getDomain=Promise._getDomain,util=_dereq_("./util"),tryCatch=util.tryCatch,errorObj=util.errorObj,async=Promise._async;util.inherits(MappingPromiseArray,PromiseArray),MappingPromiseArray.prototype._asyncInit=function(){this._init$(void 0,-2)},MappingPromiseArray.prototype._init=function(){},MappingPromiseArray.prototype._promiseFulfilled=function(value,index){var values=this._values,length=this.length(),preservedValues=this._preservedValues,limit=this._limit;if(index<0){if(index=-1*index-1,values[index]=value,limit>=1&&(this._inFlight--,this._drainQueue(),this._isResolved()))return!0}else{if(limit>=1&&this._inFlight>=limit)return values[index]=value,this._queue.push(index),!1;null!==preservedValues&&(preservedValues[index]=value);var promise=this._promise,callback=this._callback,receiver=promise._boundValue();promise._pushContext();var ret=tryCatch(callback).call(receiver,value,index,length),promiseCreated=promise._popContext();if(debug.checkForgottenReturns(ret,promiseCreated,null!==preservedValues?"Promise.filter":"Promise.map",promise),ret===errorObj)return this._reject(ret.e),!0;var maybePromise=tryConvertToPromise(ret,this._promise);if(maybePromise instanceof Promise){maybePromise=maybePromise._target();var bitField=maybePromise._bitField;if(0==(50397184&bitField))return limit>=1&&this._inFlight++,values[index]=maybePromise,maybePromise._proxy(this,-1*(index+1)),!1;if(0==(33554432&bitField))return 0!=(16777216&bitField)?(this._reject(maybePromise._reason()),!0):(this._cancel(),!0);ret=maybePromise._value()}values[index]=ret}return++this._totalResolved>=length&&(null!==preservedValues?this._filter(values,preservedValues):this._resolve(values),!0)},MappingPromiseArray.prototype._drainQueue=function(){for(var queue=this._queue,limit=this._limit,values=this._values;queue.length>0&&this._inFlight<limit;){if(this._isResolved())return;var index=queue.pop();this._promiseFulfilled(values[index],index)}},MappingPromiseArray.prototype._filter=function(booleans,values){for(var len=values.length,ret=new Array(len),j=0,i=0;i<len;++i)booleans[i]&&(ret[j++]=values[i]);ret.length=j,this._resolve(ret)},MappingPromiseArray.prototype.preservedValues=function(){return this._preservedValues},Promise.prototype.map=function(fn,options){return map(this,fn,options,null)},Promise.map=function(promises,fn,options,_filter){return map(promises,fn,options,_filter)}}},{"./util":36}],19:[function(_dereq_,module,exports){"use strict";module.exports=function(Promise,INTERNAL,tryConvertToPromise,apiRejection,debug){var util=_dereq_("./util"),tryCatch=util.tryCatch;Promise.method=function(fn){if("function"!=typeof fn)throw new Promise.TypeError("expecting a function but got "+util.classString(fn));return function(){var ret=new Promise(INTERNAL);ret._captureStackTrace(),ret._pushContext();var value=tryCatch(fn).apply(this,arguments),promiseCreated=ret._popContext();return debug.checkForgottenReturns(value,promiseCreated,"Promise.method",ret),ret._resolveFromSyncValue(value),ret}},Promise.attempt=Promise.try=function(fn){if("function"!=typeof fn)return apiRejection("expecting a function but got "+util.classString(fn));var ret=new Promise(INTERNAL);ret._captureStackTrace(),ret._pushContext();var value;if(arguments.length>1){debug.deprecated("calling Promise.try with more than 1 argument");var arg=arguments[1],ctx=arguments[2];value=util.isArray(arg)?tryCatch(fn).apply(ctx,arg):tryCatch(fn).call(ctx,arg)}else value=tryCatch(fn)();var promiseCreated=ret._popContext();return debug.checkForgottenReturns(value,promiseCreated,"Promise.try",ret),ret._resolveFromSyncValue(value),ret},Promise.prototype._resolveFromSyncValue=function(value){value===util.errorObj?this._rejectCallback(value.e,!1):this._resolveCallback(value,!0)}}},{"./util":36}],20:[function(_dereq_,module,exports){"use strict";function isUntypedError(obj){return obj instanceof Error&&es5.getPrototypeOf(obj)===Error.prototype}function wrapAsOperationalError(obj){var ret;if(isUntypedError(obj)){ret=new OperationalError(obj),ret.name=obj.name,ret.message=obj.message,ret.stack=obj.stack;for(var keys=es5.keys(obj),i=0;i<keys.length;++i){var key=keys[i];rErrorKey.test(key)||(ret[key]=obj[key])}return ret}return util.markAsOriginatingFromRejection(obj),obj}function nodebackForPromise(promise,multiArgs){return function(err,value){if(null!==promise){if(err){var wrapped=wrapAsOperationalError(maybeWrapAsError(err));promise._attachExtraTrace(wrapped),promise._reject(wrapped)}else if(multiArgs){var args=[].slice.call(arguments,1);promise._fulfill(args)}else promise._fulfill(value);promise=null}}}var util=_dereq_("./util"),maybeWrapAsError=util.maybeWrapAsError,errors=_dereq_("./errors"),OperationalError=errors.OperationalError,es5=_dereq_("./es5"),rErrorKey=/^(?:name|message|stack|cause)$/;module.exports=nodebackForPromise},{"./errors":12,"./es5":13,"./util":36}],21:[function(_dereq_,module,exports){"use strict";module.exports=function(Promise){function spreadAdapter(val,nodeback){var promise=this;if(!util.isArray(val))return successAdapter.call(promise,val,nodeback);var ret=tryCatch(nodeback).apply(promise._boundValue(),[null].concat(val));ret===errorObj&&async.throwLater(ret.e)}function successAdapter(val,nodeback){var promise=this,receiver=promise._boundValue(),ret=void 0===val?tryCatch(nodeback).call(receiver,null):tryCatch(nodeback).call(receiver,null,val);ret===errorObj&&async.throwLater(ret.e)}function errorAdapter(reason,nodeback){var promise=this;if(!reason){var newReason=new Error(reason+"");newReason.cause=reason,reason=newReason}var ret=tryCatch(nodeback).call(promise._boundValue(),reason);ret===errorObj&&async.throwLater(ret.e)}var util=_dereq_("./util"),async=Promise._async,tryCatch=util.tryCatch,errorObj=util.errorObj;Promise.prototype.asCallback=Promise.prototype.nodeify=function(nodeback,options){if("function"==typeof nodeback){var adapter=successAdapter;void 0!==options&&Object(options).spread&&(adapter=spreadAdapter),this._then(adapter,errorAdapter,void 0,this,nodeback)}return this}}},{"./util":36}],22:[function(_dereq_,module,exports){"use strict";module.exports=function(){function Proxyable(){}function check(self,executor){if(null==self||self.constructor!==Promise)throw new TypeError("the promise constructor cannot be invoked directly\n\n    See http://goo.gl/MqrFmX\n");if("function"!=typeof executor)throw new TypeError("expecting a function but got "+util.classString(executor))}function Promise(executor){executor!==INTERNAL&&check(this,executor),this._bitField=0,this._fulfillmentHandler0=void 0,this._rejectionHandler0=void 0,this._promise0=void 0,this._receiver0=void 0,this._resolveFromExecutor(executor),this._promiseCreated(),this._fireEvent("promiseCreated",this)}function deferResolve(v){this.promise._resolveCallback(v)}function deferReject(v){this.promise._rejectCallback(v,!1)}function fillTypes(value){var p=new Promise(INTERNAL);p._fulfillmentHandler0=value,p._rejectionHandler0=value,p._promise0=value,p._receiver0=value}var getDomain,makeSelfResolutionError=function(){return new TypeError("circular promise resolution chain\n\n    See http://goo.gl/MqrFmX\n")},reflectHandler=function(){return new Promise.PromiseInspection(this._target())},apiRejection=function(msg){return Promise.reject(new TypeError(msg))},UNDEFINED_BINDING={},util=_dereq_("./util");getDomain=util.isNode?function(){var ret=process.domain;return void 0===ret&&(ret=null),ret}:function(){return null},util.notEnumerableProp(Promise,"_getDomain",getDomain);var es5=_dereq_("./es5"),Async=_dereq_("./async"),async=new Async;es5.defineProperty(Promise,"_async",{value:async});var errors=_dereq_("./errors"),TypeError=Promise.TypeError=errors.TypeError;Promise.RangeError=errors.RangeError;var CancellationError=Promise.CancellationError=errors.CancellationError;Promise.TimeoutError=errors.TimeoutError,Promise.OperationalError=errors.OperationalError,Promise.RejectionError=errors.OperationalError,Promise.AggregateError=errors.AggregateError;var INTERNAL=function(){},APPLY={},NEXT_FILTER={},tryConvertToPromise=_dereq_("./thenables")(Promise,INTERNAL),PromiseArray=_dereq_("./promise_array")(Promise,INTERNAL,tryConvertToPromise,apiRejection,Proxyable),Context=_dereq_("./context")(Promise),createContext=Context.create,debug=_dereq_("./debuggability")(Promise,Context),PassThroughHandlerContext=(debug.CapturedTrace,_dereq_("./finally")(Promise,tryConvertToPromise,NEXT_FILTER)),catchFilter=_dereq_("./catch_filter")(NEXT_FILTER),nodebackForPromise=_dereq_("./nodeback"),errorObj=util.errorObj,tryCatch=util.tryCatch;return Promise.prototype.toString=function(){return"[object Promise]"},Promise.prototype.caught=Promise.prototype.catch=function(fn){var len=arguments.length;if(len>1){var i,catchInstances=new Array(len-1),j=0;for(i=0;i<len-1;++i){var item=arguments[i];if(!util.isObject(item))return apiRejection("Catch statement predicate: expecting an object but got "+util.classString(item));catchInstances[j++]=item}return catchInstances.length=j,fn=arguments[i],this.then(void 0,catchFilter(catchInstances,fn,this))}return this.then(void 0,fn)},Promise.prototype.reflect=function(){return this._then(reflectHandler,reflectHandler,void 0,this,void 0)},Promise.prototype.then=function(didFulfill,didReject){if(debug.warnings()&&arguments.length>0&&"function"!=typeof didFulfill&&"function"!=typeof didReject){var msg=".then() only accepts functions but was passed: "+util.classString(didFulfill);arguments.length>1&&(msg+=", "+util.classString(didReject)),this._warn(msg)}return this._then(didFulfill,didReject,void 0,void 0,void 0)},Promise.prototype.done=function(didFulfill,didReject){this._then(didFulfill,didReject,void 0,void 0,void 0)._setIsFinal()},Promise.prototype.spread=function(fn){return"function"!=typeof fn?apiRejection("expecting a function but got "+util.classString(fn)):this.all()._then(fn,void 0,void 0,APPLY,void 0)},Promise.prototype.toJSON=function(){var ret={isFulfilled:!1,isRejected:!1,fulfillmentValue:void 0,rejectionReason:void 0};return this.isFulfilled()?(ret.fulfillmentValue=this.value(),ret.isFulfilled=!0):this.isRejected()&&(ret.rejectionReason=this.reason(),ret.isRejected=!0),ret},Promise.prototype.all=function(){return arguments.length>0&&this._warn(".all() was passed arguments but it does not take any"),new PromiseArray(this).promise()},Promise.prototype.error=function(fn){return this.caught(util.originatesFromRejection,fn)},Promise.getNewLibraryCopy=module.exports,Promise.is=function(val){return val instanceof Promise},Promise.fromNode=Promise.fromCallback=function(fn){var ret=new Promise(INTERNAL);ret._captureStackTrace();var multiArgs=arguments.length>1&&!!Object(arguments[1]).multiArgs,result=tryCatch(fn)(nodebackForPromise(ret,multiArgs));return result===errorObj&&ret._rejectCallback(result.e,!0),ret._isFateSealed()||ret._setAsyncGuaranteed(),ret},Promise.all=function(promises){return new PromiseArray(promises).promise()},Promise.cast=function(obj){var ret=tryConvertToPromise(obj);return ret instanceof Promise||(ret=new Promise(INTERNAL),ret._captureStackTrace(),ret._setFulfilled(),ret._rejectionHandler0=obj),ret},Promise.resolve=Promise.fulfilled=Promise.cast,Promise.reject=Promise.rejected=function(reason){var ret=new Promise(INTERNAL);return ret._captureStackTrace(),ret._rejectCallback(reason,!0),ret},Promise.setScheduler=function(fn){if("function"!=typeof fn)throw new TypeError("expecting a function but got "+util.classString(fn));return async.setScheduler(fn)},Promise.prototype._then=function(didFulfill,didReject,_,receiver,internalData){var haveInternalData=void 0!==internalData,promise=haveInternalData?internalData:new Promise(INTERNAL),target=this._target(),bitField=target._bitField;haveInternalData||(promise._propagateFrom(this,3),promise._captureStackTrace(),void 0===receiver&&0!=(2097152&this._bitField)&&(receiver=0!=(50397184&bitField)?this._boundValue():target===this?void 0:this._boundTo),this._fireEvent("promiseChained",this,promise));var domain=getDomain();if(0!=(50397184&bitField)){var handler,value,settler=target._settlePromiseCtx;0!=(33554432&bitField)?(value=target._rejectionHandler0,handler=didFulfill):0!=(16777216&bitField)?(value=target._fulfillmentHandler0,handler=didReject,target._unsetRejectionIsUnhandled()):(settler=target._settlePromiseLateCancellationObserver,value=new CancellationError("late cancellation observer"),target._attachExtraTrace(value),handler=didReject),async.invoke(settler,target,{handler:null===domain?handler:"function"==typeof handler&&util.domainBind(domain,handler),promise:promise,receiver:receiver,value:value})}else target._addCallbacks(didFulfill,didReject,promise,receiver,domain);return promise},Promise.prototype._length=function(){return 65535&this._bitField},Promise.prototype._isFateSealed=function(){return 0!=(117506048&this._bitField)},Promise.prototype._isFollowing=function(){return 67108864==(67108864&this._bitField)},Promise.prototype._setLength=function(len){this._bitField=-65536&this._bitField|65535&len},Promise.prototype._setFulfilled=function(){this._bitField=33554432|this._bitField,this._fireEvent("promiseFulfilled",this)},Promise.prototype._setRejected=function(){this._bitField=16777216|this._bitField,this._fireEvent("promiseRejected",this)},Promise.prototype._setFollowing=function(){this._bitField=67108864|this._bitField,this._fireEvent("promiseResolved",this)},Promise.prototype._setIsFinal=function(){this._bitField=4194304|this._bitField},Promise.prototype._isFinal=function(){return(4194304&this._bitField)>0},Promise.prototype._unsetCancelled=function(){this._bitField=-65537&this._bitField},Promise.prototype._setCancelled=function(){this._bitField=65536|this._bitField,this._fireEvent("promiseCancelled",this)},Promise.prototype._setWillBeCancelled=function(){this._bitField=8388608|this._bitField},Promise.prototype._setAsyncGuaranteed=function(){async.hasCustomScheduler()||(this._bitField=134217728|this._bitField)},Promise.prototype._receiverAt=function(index){var ret=0===index?this._receiver0:this[4*index-4+3];if(ret!==UNDEFINED_BINDING)return void 0===ret&&this._isBound()?this._boundValue():ret},Promise.prototype._promiseAt=function(index){return this[4*index-4+2]},Promise.prototype._fulfillmentHandlerAt=function(index){return this[4*index-4+0]},Promise.prototype._rejectionHandlerAt=function(index){return this[4*index-4+1]},Promise.prototype._boundValue=function(){},Promise.prototype._migrateCallback0=function(follower){var fulfill=(follower._bitField,follower._fulfillmentHandler0),reject=follower._rejectionHandler0,promise=follower._promise0,receiver=follower._receiverAt(0);void 0===receiver&&(receiver=UNDEFINED_BINDING),this._addCallbacks(fulfill,reject,promise,receiver,null)},Promise.prototype._migrateCallbackAt=function(follower,index){var fulfill=follower._fulfillmentHandlerAt(index),reject=follower._rejectionHandlerAt(index),promise=follower._promiseAt(index),receiver=follower._receiverAt(index);void 0===receiver&&(receiver=UNDEFINED_BINDING),this._addCallbacks(fulfill,reject,promise,receiver,null)},Promise.prototype._addCallbacks=function(fulfill,reject,promise,receiver,domain){var index=this._length();if(index>=65531&&(index=0,this._setLength(0)),0===index)this._promise0=promise,this._receiver0=receiver,"function"==typeof fulfill&&(this._fulfillmentHandler0=null===domain?fulfill:util.domainBind(domain,fulfill)),"function"==typeof reject&&(this._rejectionHandler0=null===domain?reject:util.domainBind(domain,reject));else{var base=4*index-4;this[base+2]=promise,this[base+3]=receiver,"function"==typeof fulfill&&(this[base+0]=null===domain?fulfill:util.domainBind(domain,fulfill)),"function"==typeof reject&&(this[base+1]=null===domain?reject:util.domainBind(domain,reject))}return this._setLength(index+1),index},Promise.prototype._proxy=function(proxyable,arg){this._addCallbacks(void 0,void 0,arg,proxyable,null)},Promise.prototype._resolveCallback=function(value,shouldBind){if(0==(117506048&this._bitField)){if(value===this)return this._rejectCallback(makeSelfResolutionError(),!1);var maybePromise=tryConvertToPromise(value,this);if(!(maybePromise instanceof Promise))return this._fulfill(value);shouldBind&&this._propagateFrom(maybePromise,2);var promise=maybePromise._target();if(promise===this)return void this._reject(makeSelfResolutionError());var bitField=promise._bitField;if(0==(50397184&bitField)){var len=this._length();len>0&&promise._migrateCallback0(this);for(var i=1;i<len;++i)promise._migrateCallbackAt(this,i);this._setFollowing(),this._setLength(0),this._setFollowee(promise)}else if(0!=(33554432&bitField))this._fulfill(promise._value());else if(0!=(16777216&bitField))this._reject(promise._reason());else{var reason=new CancellationError("late cancellation observer");promise._attachExtraTrace(reason),this._reject(reason)}}},Promise.prototype._rejectCallback=function(reason,synchronous,ignoreNonErrorWarnings){var trace=util.ensureErrorObject(reason),hasStack=trace===reason;if(!hasStack&&!ignoreNonErrorWarnings&&debug.warnings()){var message="a promise was rejected with a non-error: "+util.classString(reason);this._warn(message,!0)}this._attachExtraTrace(trace,!!synchronous&&hasStack),this._reject(reason)},Promise.prototype._resolveFromExecutor=function(executor){if(executor!==INTERNAL){var promise=this;this._captureStackTrace(),this._pushContext();var synchronous=!0,r=this._execute(executor,function(value){promise._resolveCallback(value)},function(reason){promise._rejectCallback(reason,synchronous)});synchronous=!1,this._popContext(),void 0!==r&&promise._rejectCallback(r,!0)}},Promise.prototype._settlePromiseFromHandler=function(handler,receiver,value,promise){var bitField=promise._bitField;if(0==(65536&bitField)){promise._pushContext();var x;receiver===APPLY?value&&"number"==typeof value.length?x=tryCatch(handler).apply(this._boundValue(),value):(x=errorObj,x.e=new TypeError("cannot .spread() a non-array: "+util.classString(value))):x=tryCatch(handler).call(receiver,value);var promiseCreated=promise._popContext();bitField=promise._bitField,0==(65536&bitField)&&(x===NEXT_FILTER?promise._reject(value):x===errorObj?promise._rejectCallback(x.e,!1):(debug.checkForgottenReturns(x,promiseCreated,"",promise,this),promise._resolveCallback(x)))}},Promise.prototype._target=function(){for(var ret=this;ret._isFollowing();)ret=ret._followee();return ret},Promise.prototype._followee=function(){return this._rejectionHandler0},Promise.prototype._setFollowee=function(promise){this._rejectionHandler0=promise},Promise.prototype._settlePromise=function(promise,handler,receiver,value){var isPromise=promise instanceof Promise,bitField=this._bitField,asyncGuaranteed=0!=(134217728&bitField);0!=(65536&bitField)?(isPromise&&promise._invokeInternalOnCancel(),receiver instanceof PassThroughHandlerContext&&receiver.isFinallyHandler()?(receiver.cancelPromise=promise,tryCatch(handler).call(receiver,value)===errorObj&&promise._reject(errorObj.e)):handler===reflectHandler?promise._fulfill(reflectHandler.call(receiver)):receiver instanceof Proxyable?receiver._promiseCancelled(promise):isPromise||promise instanceof PromiseArray?promise._cancel():receiver.cancel()):"function"==typeof handler?isPromise?(asyncGuaranteed&&promise._setAsyncGuaranteed(),this._settlePromiseFromHandler(handler,receiver,value,promise)):handler.call(receiver,value,promise):receiver instanceof Proxyable?receiver._isResolved()||(0!=(33554432&bitField)?receiver._promiseFulfilled(value,promise):receiver._promiseRejected(value,promise)):isPromise&&(asyncGuaranteed&&promise._setAsyncGuaranteed(),0!=(33554432&bitField)?promise._fulfill(value):promise._reject(value))},Promise.prototype._settlePromiseLateCancellationObserver=function(ctx){var handler=ctx.handler,promise=ctx.promise,receiver=ctx.receiver,value=ctx.value;"function"==typeof handler?promise instanceof Promise?this._settlePromiseFromHandler(handler,receiver,value,promise):handler.call(receiver,value,promise):promise instanceof Promise&&promise._reject(value)},Promise.prototype._settlePromiseCtx=function(ctx){this._settlePromise(ctx.promise,ctx.handler,ctx.receiver,ctx.value)},Promise.prototype._settlePromise0=function(handler,value,bitField){var promise=this._promise0,receiver=this._receiverAt(0);this._promise0=void 0,this._receiver0=void 0,this._settlePromise(promise,handler,receiver,value)},Promise.prototype._clearCallbackDataAtIndex=function(index){var base=4*index-4;this[base+2]=this[base+3]=this[base+0]=this[base+1]=void 0},Promise.prototype._fulfill=function(value){var bitField=this._bitField;if(!((117506048&bitField)>>>16)){if(value===this){var err=makeSelfResolutionError();return this._attachExtraTrace(err),this._reject(err)}this._setFulfilled(),this._rejectionHandler0=value,(65535&bitField)>0&&(0!=(134217728&bitField)?this._settlePromises():async.settlePromises(this))}},Promise.prototype._reject=function(reason){var bitField=this._bitField;if(!((117506048&bitField)>>>16)){if(this._setRejected(),this._fulfillmentHandler0=reason,this._isFinal())return async.fatalError(reason,util.isNode);(65535&bitField)>0?async.settlePromises(this):this._ensurePossibleRejectionHandled()}},Promise.prototype._fulfillPromises=function(len,value){for(var i=1;i<len;i++){var handler=this._fulfillmentHandlerAt(i),promise=this._promiseAt(i),receiver=this._receiverAt(i);this._clearCallbackDataAtIndex(i),this._settlePromise(promise,handler,receiver,value)}},Promise.prototype._rejectPromises=function(len,reason){for(var i=1;i<len;i++){var handler=this._rejectionHandlerAt(i),promise=this._promiseAt(i),receiver=this._receiverAt(i);this._clearCallbackDataAtIndex(i),this._settlePromise(promise,handler,receiver,reason)}},Promise.prototype._settlePromises=function(){var bitField=this._bitField,len=65535&bitField;if(len>0){if(0!=(16842752&bitField)){var reason=this._fulfillmentHandler0;this._settlePromise0(this._rejectionHandler0,reason,bitField),this._rejectPromises(len,reason)}else{var value=this._rejectionHandler0;this._settlePromise0(this._fulfillmentHandler0,value,bitField),this._fulfillPromises(len,value)}this._setLength(0)}this._clearCancellationData()},Promise.prototype._settledValue=function(){var bitField=this._bitField;return 0!=(33554432&bitField)?this._rejectionHandler0:0!=(16777216&bitField)?this._fulfillmentHandler0:void 0},Promise.defer=Promise.pending=function(){return debug.deprecated("Promise.defer","new Promise"),{promise:new Promise(INTERNAL),resolve:deferResolve,reject:deferReject}},util.notEnumerableProp(Promise,"_makeSelfResolutionError",makeSelfResolutionError),_dereq_("./method")(Promise,INTERNAL,tryConvertToPromise,apiRejection,debug),_dereq_("./bind")(Promise,INTERNAL,tryConvertToPromise,debug),_dereq_("./cancel")(Promise,PromiseArray,apiRejection,debug),_dereq_("./direct_resolve")(Promise),_dereq_("./synchronous_inspection")(Promise),_dereq_("./join")(Promise,PromiseArray,tryConvertToPromise,INTERNAL,async,getDomain),Promise.Promise=Promise,Promise.version="3.5.0",_dereq_("./map.js")(Promise,PromiseArray,apiRejection,tryConvertToPromise,INTERNAL,debug),_dereq_("./call_get.js")(Promise),_dereq_("./using.js")(Promise,apiRejection,tryConvertToPromise,createContext,INTERNAL,debug),_dereq_("./timers.js")(Promise,INTERNAL,debug),_dereq_("./generators.js")(Promise,apiRejection,INTERNAL,tryConvertToPromise,Proxyable,debug),_dereq_("./nodeify.js")(Promise),_dereq_("./promisify.js")(Promise,INTERNAL),_dereq_("./props.js")(Promise,PromiseArray,tryConvertToPromise,apiRejection),_dereq_("./race.js")(Promise,INTERNAL,tryConvertToPromise,apiRejection),_dereq_("./reduce.js")(Promise,PromiseArray,apiRejection,tryConvertToPromise,INTERNAL,debug),_dereq_("./settle.js")(Promise,PromiseArray,debug),_dereq_("./some.js")(Promise,PromiseArray,apiRejection),_dereq_("./filter.js")(Promise,INTERNAL),_dereq_("./each.js")(Promise,INTERNAL),_dereq_("./any.js")(Promise),util.toFastProperties(Promise),util.toFastProperties(Promise.prototype),fillTypes({a:1}),fillTypes({b:2}),fillTypes({c:3}),fillTypes(1),fillTypes(function(){}),fillTypes(void 0),fillTypes(!1),fillTypes(new Promise(INTERNAL)),debug.setBounds(Async.firstLineError,util.lastLineError),Promise}},{"./any.js":1,"./async":2,"./bind":3,"./call_get.js":5,"./cancel":6,"./catch_filter":7,"./context":8,"./debuggability":9,"./direct_resolve":10,"./each.js":11,"./errors":12,"./es5":13,"./filter.js":14,"./finally":15,"./generators.js":16,"./join":17,"./map.js":18,"./method":19,"./nodeback":20,"./nodeify.js":21,"./promise_array":23,"./promisify.js":24,"./props.js":25,"./race.js":27,"./reduce.js":28,"./settle.js":30,"./some.js":31,"./synchronous_inspection":32,"./thenables":33,"./timers.js":34,"./using.js":35,"./util":36}],23:[function(_dereq_,module,exports){"use strict";module.exports=function(Promise,INTERNAL,tryConvertToPromise,apiRejection,Proxyable){function toResolutionValue(val){switch(val){case-2:return[];case-3:return{};case-6:return new Map}}function PromiseArray(values){var promise=this._promise=new Promise(INTERNAL);values instanceof Promise&&promise._propagateFrom(values,3),promise._setOnCancel(this),this._values=values,this._length=0,this._totalResolved=0,this._init(void 0,-2)}var util=_dereq_("./util");util.isArray;return util.inherits(PromiseArray,Proxyable),PromiseArray.prototype.length=function(){return this._length},PromiseArray.prototype.promise=function(){return this._promise},PromiseArray.prototype._init=function init(_,resolveValueIfEmpty){var values=tryConvertToPromise(this._values,this._promise);if(values instanceof Promise){values=values._target();var bitField=values._bitField;if(this._values=values,0==(50397184&bitField))return this._promise._setAsyncGuaranteed(),values._then(init,this._reject,void 0,this,resolveValueIfEmpty);if(0==(33554432&bitField))return 0!=(16777216&bitField)?this._reject(values._reason()):this._cancel();values=values._value()}if(null===(values=util.asArray(values))){var err=apiRejection("expecting an array or an iterable object but got "+util.classString(values)).reason();return void this._promise._rejectCallback(err,!1)}if(0===values.length)return void(-5===resolveValueIfEmpty?this._resolveEmptyArray():this._resolve(toResolutionValue(resolveValueIfEmpty)));this._iterate(values)},PromiseArray.prototype._iterate=function(values){var len=this.getActualLength(values.length);this._length=len,this._values=this.shouldCopyValues()?new Array(len):this._values;for(var result=this._promise,isResolved=!1,bitField=null,i=0;i<len;++i){var maybePromise=tryConvertToPromise(values[i],result);maybePromise instanceof Promise?(maybePromise=maybePromise._target(),bitField=maybePromise._bitField):bitField=null,isResolved?null!==bitField&&maybePromise.suppressUnhandledRejections():null!==bitField?0==(50397184&bitField)?(maybePromise._proxy(this,i),this._values[i]=maybePromise):isResolved=0!=(33554432&bitField)?this._promiseFulfilled(maybePromise._value(),i):0!=(16777216&bitField)?this._promiseRejected(maybePromise._reason(),i):this._promiseCancelled(i):isResolved=this._promiseFulfilled(maybePromise,i)}isResolved||result._setAsyncGuaranteed()},PromiseArray.prototype._isResolved=function(){return null===this._values},PromiseArray.prototype._resolve=function(value){this._values=null,this._promise._fulfill(value)},PromiseArray.prototype._cancel=function(){!this._isResolved()&&this._promise._isCancellable()&&(this._values=null,this._promise._cancel())},PromiseArray.prototype._reject=function(reason){this._values=null,this._promise._rejectCallback(reason,!1)},PromiseArray.prototype._promiseFulfilled=function(value,index){return this._values[index]=value,++this._totalResolved>=this._length&&(this._resolve(this._values),!0)},PromiseArray.prototype._promiseCancelled=function(){return this._cancel(),!0},PromiseArray.prototype._promiseRejected=function(reason){return this._totalResolved++,this._reject(reason),!0},PromiseArray.prototype._resultCancelled=function(){if(!this._isResolved()){var values=this._values;if(this._cancel(),values instanceof Promise)values.cancel();else for(var i=0;i<values.length;++i)values[i]instanceof Promise&&values[i].cancel()}},PromiseArray.prototype.shouldCopyValues=function(){return!0},PromiseArray.prototype.getActualLength=function(len){return len},PromiseArray}},{"./util":36}],24:[function(_dereq_,module,exports){"use strict";module.exports=function(Promise,INTERNAL){function propsFilter(key){return!noCopyPropsPattern.test(key)}function isPromisified(fn){try{return!0===fn.__isPromisified__}catch(e){return!1}}function hasPromisified(obj,key,suffix){var val=util.getDataPropertyOrDefault(obj,key+suffix,defaultPromisified);return!!val&&isPromisified(val)}function checkValid(ret,suffix,suffixRegexp){for(var i=0;i<ret.length;i+=2){var key=ret[i];if(suffixRegexp.test(key))for(var keyWithoutAsyncSuffix=key.replace(suffixRegexp,""),j=0;j<ret.length;j+=2)if(ret[j]===keyWithoutAsyncSuffix)throw new TypeError("Cannot promisify an API that has normal methods with '%s'-suffix\n\n    See http://goo.gl/MqrFmX\n".replace("%s",suffix))}}function promisifiableMethods(obj,suffix,suffixRegexp,filter){for(var keys=util.inheritedDataKeys(obj),ret=[],i=0;i<keys.length;++i){var key=keys[i],value=obj[key],passesDefaultFilter=filter===defaultFilter||defaultFilter(key,value,obj);"function"!=typeof value||isPromisified(value)||hasPromisified(obj,key,suffix)||!filter(key,value,obj,passesDefaultFilter)||ret.push(key,value)}return checkValid(ret,suffix,suffixRegexp),ret}function makeNodePromisifiedClosure(callback,receiver,_,fn,__,multiArgs){function promisified(){var _receiver=receiver;receiver===THIS&&(_receiver=this);var promise=new Promise(INTERNAL);promise._captureStackTrace();var cb="string"==typeof method&&this!==defaultThis?this[method]:callback,fn=nodebackForPromise(promise,multiArgs);try{cb.apply(_receiver,withAppended(arguments,fn))}catch(e){promise._rejectCallback(maybeWrapAsError(e),!0,!0)}return promise._isFateSealed()||promise._setAsyncGuaranteed(),promise}var defaultThis=function(){return this}(),method=callback;return"string"==typeof method&&(callback=fn),util.notEnumerableProp(promisified,"__isPromisified__",!0),promisified}function promisifyAll(obj,suffix,filter,promisifier,multiArgs){for(var suffixRegexp=new RegExp(escapeIdentRegex(suffix)+"$"),methods=promisifiableMethods(obj,suffix,suffixRegexp,filter),i=0,len=methods.length;i<len;i+=2){var key=methods[i],fn=methods[i+1],promisifiedKey=key+suffix;if(promisifier===makeNodePromisified)obj[promisifiedKey]=makeNodePromisified(key,THIS,key,fn,suffix,multiArgs);else{var promisified=promisifier(fn,function(){return makeNodePromisified(key,THIS,key,fn,suffix,multiArgs)});util.notEnumerableProp(promisified,"__isPromisified__",!0),obj[promisifiedKey]=promisified}}return util.toFastProperties(obj),obj}function promisify(callback,receiver,multiArgs){return makeNodePromisified(callback,receiver,void 0,callback,null,multiArgs)}var makeNodePromisifiedEval,THIS={},util=_dereq_("./util"),nodebackForPromise=_dereq_("./nodeback"),withAppended=util.withAppended,maybeWrapAsError=util.maybeWrapAsError,canEvaluate=util.canEvaluate,TypeError=_dereq_("./errors").TypeError,defaultPromisified={__isPromisified__:!0},noCopyProps=["arity","length","name","arguments","caller","callee","prototype","__isPromisified__"],noCopyPropsPattern=new RegExp("^(?:"+noCopyProps.join("|")+")$"),defaultFilter=function(name){return util.isIdentifier(name)&&"_"!==name.charAt(0)&&"constructor"!==name},escapeIdentRegex=function(str){return str.replace(/([$])/,"\\$")},makeNodePromisified=canEvaluate?makeNodePromisifiedEval:makeNodePromisifiedClosure;Promise.promisify=function(fn,options){if("function"!=typeof fn)throw new TypeError("expecting a function but got "+util.classString(fn));if(isPromisified(fn))return fn;options=Object(options);var receiver=void 0===options.context?THIS:options.context,multiArgs=!!options.multiArgs,ret=promisify(fn,receiver,multiArgs);return util.copyDescriptors(fn,ret,propsFilter),ret},Promise.promisifyAll=function(target,options){if("function"!=typeof target&&"object"!=typeof target)throw new TypeError("the target of promisifyAll must be an object or a function\n\n    See http://goo.gl/MqrFmX\n");options=Object(options);var multiArgs=!!options.multiArgs,suffix=options.suffix;"string"!=typeof suffix&&(suffix="Async");var filter=options.filter;"function"!=typeof filter&&(filter=defaultFilter);var promisifier=options.promisifier;if("function"!=typeof promisifier&&(promisifier=makeNodePromisified),!util.isIdentifier(suffix))throw new RangeError("suffix must be a valid identifier\n\n    See http://goo.gl/MqrFmX\n");for(var keys=util.inheritedDataKeys(target),i=0;i<keys.length;++i){var value=target[keys[i]];"constructor"!==keys[i]&&util.isClass(value)&&(promisifyAll(value.prototype,suffix,filter,promisifier,multiArgs),promisifyAll(value,suffix,filter,promisifier,multiArgs))}return promisifyAll(target,suffix,filter,promisifier,multiArgs)}}},{"./errors":12,"./nodeback":20,"./util":36}],25:[function(_dereq_,module,exports){"use strict";module.exports=function(Promise,PromiseArray,tryConvertToPromise,apiRejection){function PropertiesPromiseArray(obj){var entries,isMap=!1;if(void 0!==Es6Map&&obj instanceof Es6Map)entries=mapToEntries(obj),isMap=!0;else{var keys=es5.keys(obj),len=keys.length;entries=new Array(2*len);for(var i=0;i<len;++i){var key=keys[i];entries[i]=obj[key],entries[i+len]=key}}this.constructor$(entries),this._isMap=isMap,this._init$(void 0,isMap?-6:-3)}function props(promises){var ret,castValue=tryConvertToPromise(promises);return isObject(castValue)?(ret=castValue instanceof Promise?castValue._then(Promise.props,void 0,void 0,void 0,void 0):new PropertiesPromiseArray(castValue).promise(),castValue instanceof Promise&&ret._propagateFrom(castValue,2),ret):apiRejection("cannot await properties of a non-object\n\n    See http://goo.gl/MqrFmX\n")}var Es6Map,util=_dereq_("./util"),isObject=util.isObject,es5=_dereq_("./es5");"function"==typeof Map&&(Es6Map=Map);var mapToEntries=function(){function extractEntry(value,key){this[index]=value,this[index+size]=key,index++}var index=0,size=0;return function(map){size=map.size,index=0;var ret=new Array(2*map.size);return map.forEach(extractEntry,ret),ret}}(),entriesToMap=function(entries){for(var ret=new Es6Map,length=entries.length/2|0,i=0;i<length;++i){var key=entries[length+i],value=entries[i];ret.set(key,value)}return ret};util.inherits(PropertiesPromiseArray,PromiseArray),PropertiesPromiseArray.prototype._init=function(){},PropertiesPromiseArray.prototype._promiseFulfilled=function(value,index){if(this._values[index]=value,++this._totalResolved>=this._length){var val;if(this._isMap)val=entriesToMap(this._values);else{val={};for(var keyOffset=this.length(),i=0,len=this.length();i<len;++i)val[this._values[i+keyOffset]]=this._values[i]}return this._resolve(val),!0}return!1},PropertiesPromiseArray.prototype.shouldCopyValues=function(){return!1},PropertiesPromiseArray.prototype.getActualLength=function(len){return len>>1},Promise.prototype.props=function(){return props(this)},Promise.props=function(promises){return props(promises)}}},{"./es5":13,"./util":36}],26:[function(_dereq_,module,exports){"use strict";function arrayMove(src,srcIndex,dst,dstIndex,len){for(var j=0;j<len;++j)dst[j+dstIndex]=src[j+srcIndex],src[j+srcIndex]=void 0}function Queue(capacity){this._capacity=capacity,this._length=0,this._front=0}Queue.prototype._willBeOverCapacity=function(size){return this._capacity<size},Queue.prototype._pushOne=function(arg){var length=this.length();this._checkCapacity(length+1),this[this._front+length&this._capacity-1]=arg,this._length=length+1},Queue.prototype.push=function(fn,receiver,arg){var length=this.length()+3;if(this._willBeOverCapacity(length))return this._pushOne(fn),this._pushOne(receiver),void this._pushOne(arg);var j=this._front+length-3;this._checkCapacity(length);var wrapMask=this._capacity-1;this[j+0&wrapMask]=fn,this[j+1&wrapMask]=receiver,this[j+2&wrapMask]=arg,this._length=length},Queue.prototype.shift=function(){var front=this._front,ret=this[front];return this[front]=void 0,this._front=front+1&this._capacity-1,this._length--,ret},Queue.prototype.length=function(){return this._length},Queue.prototype._checkCapacity=function(size){this._capacity<size&&this._resizeTo(this._capacity<<1)},Queue.prototype._resizeTo=function(capacity){var oldCapacity=this._capacity;this._capacity=capacity,arrayMove(this,0,this,oldCapacity,this._front+this._length&oldCapacity-1)},module.exports=Queue},{}],27:[function(_dereq_,module,exports){"use strict";module.exports=function(Promise,INTERNAL,tryConvertToPromise,apiRejection){function race(promises,parent){var maybePromise=tryConvertToPromise(promises);if(maybePromise instanceof Promise)return raceLater(maybePromise);if(null===(promises=util.asArray(promises)))return apiRejection("expecting an array or an iterable object but got "+util.classString(promises));var ret=new Promise(INTERNAL);void 0!==parent&&ret._propagateFrom(parent,3);for(var fulfill=ret._fulfill,reject=ret._reject,i=0,len=promises.length;i<len;++i){var val=promises[i];(void 0!==val||i in promises)&&Promise.cast(val)._then(fulfill,reject,void 0,ret,null)}return ret}var util=_dereq_("./util"),raceLater=function(promise){return promise.then(function(array){return race(array,promise)})};Promise.race=function(promises){return race(promises,void 0)},Promise.prototype.race=function(){return race(this,void 0)}}},{"./util":36}],28:[function(_dereq_,module,exports){"use strict";module.exports=function(Promise,PromiseArray,apiRejection,tryConvertToPromise,INTERNAL,debug){function ReductionPromiseArray(promises,fn,initialValue,_each){this.constructor$(promises);var domain=getDomain();this._fn=null===domain?fn:util.domainBind(domain,fn),void 0!==initialValue&&(initialValue=Promise.resolve(initialValue),initialValue._attachCancellationCallback(this)),this._initialValue=initialValue,this._currentCancellable=null,this._eachValues=_each===INTERNAL?Array(this._length):0===_each?null:void 0,this._promise._captureStackTrace(),this._init$(void 0,-5)}function completed(valueOrReason,array){this.isFulfilled()?array._resolve(valueOrReason):array._reject(valueOrReason)}function reduce(promises,fn,initialValue,_each){return"function"!=typeof fn?apiRejection("expecting a function but got "+util.classString(fn)):new ReductionPromiseArray(promises,fn,initialValue,_each).promise()}function gotAccum(accum){this.accum=accum,this.array._gotAccum(accum);var value=tryConvertToPromise(this.value,this.array._promise);return value instanceof Promise?(this.array._currentCancellable=value,value._then(gotValue,void 0,void 0,this,void 0)):gotValue.call(this,value)}function gotValue(value){var array=this.array,promise=array._promise,fn=tryCatch(array._fn);promise._pushContext();var ret;(ret=void 0!==array._eachValues?fn.call(promise._boundValue(),value,this.index,this.length):fn.call(promise._boundValue(),this.accum,value,this.index,this.length))instanceof Promise&&(array._currentCancellable=ret);var promiseCreated=promise._popContext();return debug.checkForgottenReturns(ret,promiseCreated,void 0!==array._eachValues?"Promise.each":"Promise.reduce",promise),ret}var getDomain=Promise._getDomain,util=_dereq_("./util"),tryCatch=util.tryCatch;util.inherits(ReductionPromiseArray,PromiseArray),ReductionPromiseArray.prototype._gotAccum=function(accum){void 0!==this._eachValues&&null!==this._eachValues&&accum!==INTERNAL&&this._eachValues.push(accum)},ReductionPromiseArray.prototype._eachComplete=function(value){return null!==this._eachValues&&this._eachValues.push(value),this._eachValues},ReductionPromiseArray.prototype._init=function(){},ReductionPromiseArray.prototype._resolveEmptyArray=function(){this._resolve(void 0!==this._eachValues?this._eachValues:this._initialValue)},ReductionPromiseArray.prototype.shouldCopyValues=function(){return!1},ReductionPromiseArray.prototype._resolve=function(value){this._promise._resolveCallback(value),this._values=null},ReductionPromiseArray.prototype._resultCancelled=function(sender){if(sender===this._initialValue)return this._cancel();this._isResolved()||(this._resultCancelled$(),this._currentCancellable instanceof Promise&&this._currentCancellable.cancel(),this._initialValue instanceof Promise&&this._initialValue.cancel())},ReductionPromiseArray.prototype._iterate=function(values){this._values=values;var value,i,length=values.length;if(void 0!==this._initialValue?(value=this._initialValue,i=0):(value=Promise.resolve(values[0]),i=1),this._currentCancellable=value,!value.isRejected())for(;i<length;++i){var ctx={accum:null,value:values[i],index:i,length:length,array:this};value=value._then(gotAccum,void 0,void 0,ctx,void 0)}void 0!==this._eachValues&&(value=value._then(this._eachComplete,void 0,void 0,this,void 0)),value._then(completed,completed,void 0,value,this)},Promise.prototype.reduce=function(fn,initialValue){return reduce(this,fn,initialValue,null)},Promise.reduce=function(promises,fn,initialValue,_each){return reduce(promises,fn,initialValue,_each)}}},{"./util":36}],29:[function(_dereq_,module,exports){"use strict";var schedule,util=_dereq_("./util"),noAsyncScheduler=function(){throw new Error("No async scheduler available\n\n    See http://goo.gl/MqrFmX\n")},NativePromise=util.getNativePromise();if(util.isNode&&"undefined"==typeof MutationObserver){var GlobalSetImmediate=global.setImmediate,ProcessNextTick=process.nextTick;schedule=util.isRecentNode?function(fn){GlobalSetImmediate.call(global,fn)}:function(fn){ProcessNextTick.call(process,fn)}}else if("function"==typeof NativePromise&&"function"==typeof NativePromise.resolve){var nativePromise=NativePromise.resolve();schedule=function(fn){nativePromise.then(fn)}}else schedule="undefined"==typeof MutationObserver||"undefined"!=typeof window&&window.navigator&&(window.navigator.standalone||window.cordova)?void 0!==setImmediate?function(fn){setImmediate(fn)}:"undefined"!=typeof setTimeout?function(fn){setTimeout(fn,0)}:noAsyncScheduler:function(){var div=document.createElement("div"),opts={attributes:!0},toggleScheduled=!1,div2=document.createElement("div");new MutationObserver(function(){div.classList.toggle("foo"),toggleScheduled=!1}).observe(div2,opts);var scheduleToggle=function(){toggleScheduled||(toggleScheduled=!0,div2.classList.toggle("foo"))};return function(fn){var o=new MutationObserver(function(){o.disconnect(),fn()});o.observe(div,opts),scheduleToggle()}}();module.exports=schedule},{"./util":36}],30:[function(_dereq_,module,exports){"use strict";module.exports=function(Promise,PromiseArray,debug){function SettledPromiseArray(values){this.constructor$(values)}var PromiseInspection=Promise.PromiseInspection;_dereq_("./util").inherits(SettledPromiseArray,PromiseArray),SettledPromiseArray.prototype._promiseResolved=function(index,inspection){return this._values[index]=inspection,++this._totalResolved>=this._length&&(this._resolve(this._values),!0)},SettledPromiseArray.prototype._promiseFulfilled=function(value,index){var ret=new PromiseInspection;return ret._bitField=33554432,ret._settledValueField=value,this._promiseResolved(index,ret)},SettledPromiseArray.prototype._promiseRejected=function(reason,index){var ret=new PromiseInspection;return ret._bitField=16777216,ret._settledValueField=reason,this._promiseResolved(index,ret)},Promise.settle=function(promises){return debug.deprecated(".settle()",".reflect()"),new SettledPromiseArray(promises).promise()},Promise.prototype.settle=function(){return Promise.settle(this)}}},{"./util":36}],31:[function(_dereq_,module,exports){"use strict";module.exports=function(Promise,PromiseArray,apiRejection){function SomePromiseArray(values){this.constructor$(values),this._howMany=0,this._unwrap=!1,this._initialized=!1}function some(promises,howMany){if((0|howMany)!==howMany||howMany<0)return apiRejection("expecting a positive integer\n\n    See http://goo.gl/MqrFmX\n");var ret=new SomePromiseArray(promises),promise=ret.promise();return ret.setHowMany(howMany),ret.init(),promise}var util=_dereq_("./util"),RangeError=_dereq_("./errors").RangeError,AggregateError=_dereq_("./errors").AggregateError,isArray=util.isArray,CANCELLATION={};util.inherits(SomePromiseArray,PromiseArray),SomePromiseArray.prototype._init=function(){if(this._initialized){if(0===this._howMany)return void this._resolve([]);this._init$(void 0,-5);var isArrayResolved=isArray(this._values);!this._isResolved()&&isArrayResolved&&this._howMany>this._canPossiblyFulfill()&&this._reject(this._getRangeError(this.length()))}},SomePromiseArray.prototype.init=function(){this._initialized=!0,this._init()},SomePromiseArray.prototype.setUnwrap=function(){this._unwrap=!0},SomePromiseArray.prototype.howMany=function(){return this._howMany},SomePromiseArray.prototype.setHowMany=function(count){this._howMany=count},SomePromiseArray.prototype._promiseFulfilled=function(value){return this._addFulfilled(value),this._fulfilled()===this.howMany()&&(this._values.length=this.howMany(),1===this.howMany()&&this._unwrap?this._resolve(this._values[0]):this._resolve(this._values),!0)},SomePromiseArray.prototype._promiseRejected=function(reason){return this._addRejected(reason),this._checkOutcome()},SomePromiseArray.prototype._promiseCancelled=function(){return this._values instanceof Promise||null==this._values?this._cancel():(this._addRejected(CANCELLATION),this._checkOutcome())},SomePromiseArray.prototype._checkOutcome=function(){if(this.howMany()>this._canPossiblyFulfill()){for(var e=new AggregateError,i=this.length();i<this._values.length;++i)this._values[i]!==CANCELLATION&&e.push(this._values[i]);return e.length>0?this._reject(e):this._cancel(),!0}return!1},SomePromiseArray.prototype._fulfilled=function(){return this._totalResolved},SomePromiseArray.prototype._rejected=function(){return this._values.length-this.length()},SomePromiseArray.prototype._addRejected=function(reason){this._values.push(reason)},SomePromiseArray.prototype._addFulfilled=function(value){this._values[this._totalResolved++]=value},SomePromiseArray.prototype._canPossiblyFulfill=function(){return this.length()-this._rejected()},SomePromiseArray.prototype._getRangeError=function(count){var message="Input array must contain at least "+this._howMany+" items but contains only "+count+" items";return new RangeError(message)},SomePromiseArray.prototype._resolveEmptyArray=function(){this._reject(this._getRangeError(0))},Promise.some=function(promises,howMany){return some(promises,howMany)},Promise.prototype.some=function(howMany){return some(this,howMany)},Promise._SomePromiseArray=SomePromiseArray}},{"./errors":12,"./util":36}],32:[function(_dereq_,module,exports){"use strict";module.exports=function(Promise){function PromiseInspection(promise){void 0!==promise?(promise=promise._target(),this._bitField=promise._bitField,this._settledValueField=promise._isFateSealed()?promise._settledValue():void 0):(this._bitField=0,this._settledValueField=void 0)}PromiseInspection.prototype._settledValue=function(){return this._settledValueField};var value=PromiseInspection.prototype.value=function(){if(!this.isFulfilled())throw new TypeError("cannot get fulfillment value of a non-fulfilled promise\n\n    See http://goo.gl/MqrFmX\n");return this._settledValue()},reason=PromiseInspection.prototype.error=PromiseInspection.prototype.reason=function(){if(!this.isRejected())throw new TypeError("cannot get rejection reason of a non-rejected promise\n\n    See http://goo.gl/MqrFmX\n");return this._settledValue()},isFulfilled=PromiseInspection.prototype.isFulfilled=function(){return 0!=(33554432&this._bitField)},isRejected=PromiseInspection.prototype.isRejected=function(){return 0!=(16777216&this._bitField)},isPending=PromiseInspection.prototype.isPending=function(){return 0==(50397184&this._bitField)},isResolved=PromiseInspection.prototype.isResolved=function(){return 0!=(50331648&this._bitField)};PromiseInspection.prototype.isCancelled=function(){return 0!=(8454144&this._bitField)},Promise.prototype.__isCancelled=function(){return 65536==(65536&this._bitField)},Promise.prototype._isCancelled=function(){return this._target().__isCancelled()},Promise.prototype.isCancelled=function(){return 0!=(8454144&this._target()._bitField)},Promise.prototype.isPending=function(){return isPending.call(this._target())},Promise.prototype.isRejected=function(){return isRejected.call(this._target())},Promise.prototype.isFulfilled=function(){return isFulfilled.call(this._target())},Promise.prototype.isResolved=function(){return isResolved.call(this._target())},Promise.prototype.value=function(){return value.call(this._target())},Promise.prototype.reason=function(){var target=this._target();return target._unsetRejectionIsUnhandled(),reason.call(target)},Promise.prototype._value=function(){return this._settledValue()},Promise.prototype._reason=function(){return this._unsetRejectionIsUnhandled(),this._settledValue()},Promise.PromiseInspection=PromiseInspection}},{}],33:[function(_dereq_,module,exports){"use strict";module.exports=function(Promise,INTERNAL){function tryConvertToPromise(obj,context){if(isObject(obj)){if(obj instanceof Promise)return obj;var then=getThen(obj);if(then===errorObj){context&&context._pushContext();var ret=Promise.reject(then.e);return context&&context._popContext(),ret}if("function"==typeof then){if(isAnyBluebirdPromise(obj)){var ret=new Promise(INTERNAL);return obj._then(ret._fulfill,ret._reject,void 0,ret,null),ret}return doThenable(obj,then,context)}}return obj}function doGetThen(obj){return obj.then}function getThen(obj){try{return doGetThen(obj)}catch(e){return errorObj.e=e,errorObj}}function isAnyBluebirdPromise(obj){try{return hasProp.call(obj,"_promise0")}catch(e){return!1}}function doThenable(x,then,context){function resolve(value){promise&&(promise._resolveCallback(value),promise=null)}function reject(reason){promise&&(promise._rejectCallback(reason,synchronous,!0),promise=null)}var promise=new Promise(INTERNAL),ret=promise;context&&context._pushContext(),promise._captureStackTrace(),context&&context._popContext();var synchronous=!0,result=util.tryCatch(then).call(x,resolve,reject);return synchronous=!1,promise&&result===errorObj&&(promise._rejectCallback(result.e,!0,!0),promise=null),ret}var util=_dereq_("./util"),errorObj=util.errorObj,isObject=util.isObject,hasProp={}.hasOwnProperty;return tryConvertToPromise}},{"./util":36}],34:[function(_dereq_,module,exports){"use strict";module.exports=function(Promise,INTERNAL,debug){function HandleWrapper(handle){this.handle=handle}function successClear(value){return clearTimeout(this.handle),value}function failureClear(reason){throw clearTimeout(this.handle),reason}var util=_dereq_("./util"),TimeoutError=Promise.TimeoutError;HandleWrapper.prototype._resultCancelled=function(){clearTimeout(this.handle)};var afterValue=function(value){return delay(+this).thenReturn(value)},delay=Promise.delay=function(ms,value){var ret,handle;return void 0!==value?(ret=Promise.resolve(value)._then(afterValue,null,null,ms,void 0),debug.cancellation()&&value instanceof Promise&&ret._setOnCancel(value)):(ret=new Promise(INTERNAL),handle=setTimeout(function(){ret._fulfill()},+ms),debug.cancellation()&&ret._setOnCancel(new HandleWrapper(handle)),ret._captureStackTrace()),ret._setAsyncGuaranteed(),ret};Promise.prototype.delay=function(ms){return delay(ms,this)};var afterTimeout=function(promise,message,parent){var err;err="string"!=typeof message?message instanceof Error?message:new TimeoutError("operation timed out"):new TimeoutError(message),util.markAsOriginatingFromRejection(err),promise._attachExtraTrace(err),promise._reject(err),null!=parent&&parent.cancel()};Promise.prototype.timeout=function(ms,message){ms=+ms;var ret,parent,handleWrapper=new HandleWrapper(setTimeout(function(){ret.isPending()&&afterTimeout(ret,message,parent)},ms));return debug.cancellation()?(parent=this.then(),ret=parent._then(successClear,failureClear,void 0,handleWrapper,void 0),ret._setOnCancel(handleWrapper)):ret=this._then(successClear,failureClear,void 0,handleWrapper,void 0),ret}}},{"./util":36}],35:[function(_dereq_,module,exports){"use strict";module.exports=function(Promise,apiRejection,tryConvertToPromise,createContext,INTERNAL,debug){function thrower(e){setTimeout(function(){throw e},0)}function castPreservingDisposable(thenable){var maybePromise=tryConvertToPromise(thenable);return maybePromise!==thenable&&"function"==typeof thenable._isDisposable&&"function"==typeof thenable._getDisposer&&thenable._isDisposable()&&maybePromise._setDisposable(thenable._getDisposer()),maybePromise}function dispose(resources,inspection){function iterator(){if(i>=len)return ret._fulfill();var maybePromise=castPreservingDisposable(resources[i++]);if(maybePromise instanceof Promise&&maybePromise._isDisposable()){try{maybePromise=tryConvertToPromise(maybePromise._getDisposer().tryDispose(inspection),resources.promise)}catch(e){return thrower(e)}if(maybePromise instanceof Promise)return maybePromise._then(iterator,thrower,null,null,null)}iterator()}var i=0,len=resources.length,ret=new Promise(INTERNAL);return iterator(),ret}function Disposer(data,promise,context){this._data=data,this._promise=promise,this._context=context}function FunctionDisposer(fn,promise,context){this.constructor$(fn,promise,context)}function maybeUnwrapDisposer(value){return Disposer.isDisposer(value)?(this.resources[this.index]._setDisposable(value),value.promise()):value}function ResourceList(length){this.length=length,this.promise=null,this[length-1]=null}var util=_dereq_("./util"),TypeError=_dereq_("./errors").TypeError,inherits=_dereq_("./util").inherits,errorObj=util.errorObj,tryCatch=util.tryCatch,NULL={};Disposer.prototype.data=function(){return this._data},Disposer.prototype.promise=function(){return this._promise},Disposer.prototype.resource=function(){return this.promise().isFulfilled()?this.promise().value():NULL},Disposer.prototype.tryDispose=function(inspection){var resource=this.resource(),context=this._context;void 0!==context&&context._pushContext();var ret=resource!==NULL?this.doDispose(resource,inspection):null;return void 0!==context&&context._popContext(),this._promise._unsetDisposable(),this._data=null,ret},Disposer.isDisposer=function(d){return null!=d&&"function"==typeof d.resource&&"function"==typeof d.tryDispose},inherits(FunctionDisposer,Disposer),FunctionDisposer.prototype.doDispose=function(resource,inspection){return this.data().call(resource,resource,inspection)},ResourceList.prototype._resultCancelled=function(){for(var len=this.length,i=0;i<len;++i){var item=this[i];item instanceof Promise&&item.cancel()}},Promise.using=function(){var len=arguments.length;if(len<2)return apiRejection("you must pass at least 2 arguments to Promise.using");var fn=arguments[len-1];if("function"!=typeof fn)return apiRejection("expecting a function but got "+util.classString(fn));var input,spreadArgs=!0;2===len&&Array.isArray(arguments[0])?(input=arguments[0],len=input.length,spreadArgs=!1):(input=arguments,len--);for(var resources=new ResourceList(len),i=0;i<len;++i){var resource=input[i];if(Disposer.isDisposer(resource)){var disposer=resource;resource=resource.promise(),resource._setDisposable(disposer)}else{var maybePromise=tryConvertToPromise(resource);maybePromise instanceof Promise&&(resource=maybePromise._then(maybeUnwrapDisposer,null,null,{resources:resources,index:i},void 0))}resources[i]=resource}for(var reflectedResources=new Array(resources.length),i=0;i<reflectedResources.length;++i)reflectedResources[i]=Promise.resolve(resources[i]).reflect();var resultPromise=Promise.all(reflectedResources).then(function(inspections){for(var i=0;i<inspections.length;++i){var inspection=inspections[i];if(inspection.isRejected())return errorObj.e=inspection.error(),errorObj;if(!inspection.isFulfilled())return void resultPromise.cancel();inspections[i]=inspection.value()}promise._pushContext(),fn=tryCatch(fn);var ret=spreadArgs?fn.apply(void 0,inspections):fn(inspections),promiseCreated=promise._popContext();return debug.checkForgottenReturns(ret,promiseCreated,"Promise.using",promise),ret}),promise=resultPromise.lastly(function(){var inspection=new Promise.PromiseInspection(resultPromise);return dispose(resources,inspection)});return resources.promise=promise,promise._setOnCancel(resources),promise},Promise.prototype._setDisposable=function(disposer){this._bitField=131072|this._bitField,this._disposer=disposer},Promise.prototype._isDisposable=function(){return(131072&this._bitField)>0},Promise.prototype._getDisposer=function(){return this._disposer},Promise.prototype._unsetDisposable=function(){this._bitField=-131073&this._bitField,this._disposer=void 0},Promise.prototype.disposer=function(fn){if("function"==typeof fn)return new FunctionDisposer(fn,this,createContext());throw new TypeError}}},{"./errors":12,"./util":36}],36:[function(_dereq_,module,exports){"use strict";function tryCatcher(){try{var target=tryCatchTarget;return tryCatchTarget=null,target.apply(this,arguments)}catch(e){return errorObj.e=e,errorObj}}function tryCatch(fn){return tryCatchTarget=fn,tryCatcher}function isPrimitive(val){return null==val||!0===val||!1===val||"string"==typeof val||"number"==typeof val}function isObject(value){return"function"==typeof value||"object"==typeof value&&null!==value}function maybeWrapAsError(maybeError){return isPrimitive(maybeError)?new Error(safeToString(maybeError)):maybeError}function withAppended(target,appendee){var i,len=target.length,ret=new Array(len+1);for(i=0;i<len;++i)ret[i]=target[i];return ret[i]=appendee,ret}function getDataPropertyOrDefault(obj,key,defaultValue){if(!es5.isES5)return{}.hasOwnProperty.call(obj,key)?obj[key]:void 0;var desc=Object.getOwnPropertyDescriptor(obj,key);return null!=desc?null==desc.get&&null==desc.set?desc.value:defaultValue:void 0}function notEnumerableProp(obj,name,value){if(isPrimitive(obj))return obj;var descriptor={value:value,configurable:!0,enumerable:!1,writable:!0};return es5.defineProperty(obj,name,descriptor),obj}function thrower(r){throw r}function isClass(fn){try{if("function"==typeof fn){var keys=es5.names(fn.prototype),hasMethods=es5.isES5&&keys.length>1,hasMethodsOtherThanConstructor=keys.length>0&&!(1===keys.length&&"constructor"===keys[0]),hasThisAssignmentAndStaticMethods=thisAssignmentPattern.test(fn+"")&&es5.names(fn).length>0;if(hasMethods||hasMethodsOtherThanConstructor||hasThisAssignmentAndStaticMethods)return!0}return!1}catch(e){return!1}}function toFastProperties(obj){function FakeConstructor(){}FakeConstructor.prototype=obj;for(var l=8;l--;)new FakeConstructor;return obj}function isIdentifier(str){return rident.test(str)}function filledRange(count,prefix,suffix){for(var ret=new Array(count),i=0;i<count;++i)ret[i]=prefix+i+suffix;return ret}function safeToString(obj){try{return obj+""}catch(e){return"[no string representation]"}}function isError(obj){return null!==obj&&"object"==typeof obj&&"string"==typeof obj.message&&"string"==typeof obj.name}function markAsOriginatingFromRejection(e){try{notEnumerableProp(e,"isOperational",!0)}catch(ignore){}}function originatesFromRejection(e){return null!=e&&(e instanceof Error.__BluebirdErrorTypes__.OperationalError||!0===e.isOperational)}function canAttachTrace(obj){return isError(obj)&&es5.propertyIsWritable(obj,"stack")}function classString(obj){return{}.toString.call(obj)}function copyDescriptors(from,to,filter){for(var keys=es5.names(from),i=0;i<keys.length;++i){var key=keys[i];if(filter(key))try{es5.defineProperty(to,key,es5.getDescriptor(from,key))}catch(ignore){}}}function env(key){return hasEnvVariables?process.env[key]:void 0}function getNativePromise(){if("function"==typeof Promise)try{var promise=new Promise(function(){});if("[object Promise]"==={}.toString.call(promise))return Promise}catch(e){}}function domainBind(self,cb){return self.bind(cb)}var es5=_dereq_("./es5"),canEvaluate="undefined"==typeof navigator,errorObj={e:{}},tryCatchTarget,globalObject="undefined"!=typeof self?self:"undefined"!=typeof window?window:void 0!==global?global:void 0!==this?this:null,inherits=function(Child,Parent){function T(){this.constructor=Child,this.constructor$=Parent;for(var propertyName in Parent.prototype)hasProp.call(Parent.prototype,propertyName)&&"$"!==propertyName.charAt(propertyName.length-1)&&(this[propertyName+"$"]=Parent.prototype[propertyName])}var hasProp={}.hasOwnProperty;return T.prototype=Parent.prototype,Child.prototype=new T,Child.prototype},inheritedDataKeys=function(){var excludedPrototypes=[Array.prototype,Object.prototype,Function.prototype],isExcludedProto=function(val){for(var i=0;i<excludedPrototypes.length;++i)if(excludedPrototypes[i]===val)return!0;return!1};if(es5.isES5){var getKeys=Object.getOwnPropertyNames;return function(obj){for(var ret=[],visitedKeys=Object.create(null);null!=obj&&!isExcludedProto(obj);){var keys;try{keys=getKeys(obj)}catch(e){return ret}for(var i=0;i<keys.length;++i){var key=keys[i];if(!visitedKeys[key]){visitedKeys[key]=!0;var desc=Object.getOwnPropertyDescriptor(obj,key);null!=desc&&null==desc.get&&null==desc.set&&ret.push(key)}}obj=es5.getPrototypeOf(obj)}return ret}}var hasProp={}.hasOwnProperty;return function(obj){if(isExcludedProto(obj))return[];var ret=[];enumeration:for(var key in obj)if(hasProp.call(obj,key))ret.push(key);else{for(var i=0;i<excludedPrototypes.length;++i)if(hasProp.call(excludedPrototypes[i],key))continue enumeration;ret.push(key)}return ret}}(),thisAssignmentPattern=/this\s*\.\s*\S+\s*=/,rident=/^[a-z$_][a-z$_0-9]*$/i,ensureErrorObject=function(){return"stack"in new Error?function(value){return canAttachTrace(value)?value:new Error(safeToString(value))}:function(value){if(canAttachTrace(value))return value;try{throw new Error(safeToString(value))}catch(err){return err}}}(),asArray=function(v){return es5.isArray(v)?v:null};if("undefined"!=typeof Symbol&&Symbol.iterator){var ArrayFrom="function"==typeof Array.from?function(v){return Array.from(v)}:function(v){for(var itResult,ret=[],it=v[Symbol.iterator]();!(itResult=it.next()).done;)ret.push(itResult.value);return ret};asArray=function(v){return es5.isArray(v)?v:null!=v&&"function"==typeof v[Symbol.iterator]?ArrayFrom(v):null}}var isNode=void 0!==process&&"[object process]"===classString(process).toLowerCase(),hasEnvVariables=void 0!==process&&void 0!==process.env,ret={isClass:isClass,isIdentifier:isIdentifier,inheritedDataKeys:inheritedDataKeys,getDataPropertyOrDefault:getDataPropertyOrDefault,thrower:thrower,isArray:es5.isArray,asArray:asArray,notEnumerableProp:notEnumerableProp,isPrimitive:isPrimitive,isObject:isObject,isError:isError,canEvaluate:canEvaluate,errorObj:errorObj,tryCatch:tryCatch,inherits:inherits,withAppended:withAppended,maybeWrapAsError:maybeWrapAsError,toFastProperties:toFastProperties,filledRange:filledRange,toString:safeToString,canAttachTrace:canAttachTrace,ensureErrorObject:ensureErrorObject,originatesFromRejection:originatesFromRejection,markAsOriginatingFromRejection:markAsOriginatingFromRejection,classString:classString,copyDescriptors:copyDescriptors,hasDevTools:"undefined"!=typeof chrome&&chrome&&"function"==typeof chrome.loadTimes,isNode:isNode,hasEnvVariables:hasEnvVariables,env:env,global:globalObject,getNativePromise:getNativePromise,domainBind:domainBind};ret.isRecentNode=ret.isNode&&function(){var version=process.versions.node.split(".").map(Number);return 0===version[0]&&version[1]>10||version[0]>0}(),ret.isNode&&ret.toFastProperties(process);try{throw new Error}catch(e){ret.lastLineError=e}module.exports=ret},{"./es5":13}]},{},[4])(4)}),"undefined"!=typeof window&&null!==window?window.P=window.Promise:"undefined"!=typeof self&&null!==self&&(self.P=self.Promise)}).call(exports,__webpack_require__(10),__webpack_require__(11),__webpack_require__(20).setImmediate)},function(module,exports,__webpack_require__){"use strict";function _classCallCheck(instance,Constructor){if(!(instance instanceof Constructor))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(exports,"__esModule",{value:!0});var _createClass=function(){function defineProperties(target,props){for(var i=0;i<props.length;i++){var descriptor=props[i];descriptor.enumerable=descriptor.enumerable||!1,descriptor.configurable=!0,"value"in descriptor&&(descriptor.writable=!0),Object.defineProperty(target,descriptor.key,descriptor)}}return function(Constructor,protoProps,staticProps){return protoProps&&defineProperties(Constructor.prototype,protoProps),staticProps&&defineProperties(Constructor,staticProps),Constructor}}(),_lodash=__webpack_require__(1),_lodash2=function(obj){return obj&&obj.__esModule?obj:{default:obj}}(_lodash),_utilities=__webpack_require__(0),EventData=function(){function EventData(){var flag=arguments.length>0&&void 0!==arguments[0]?arguments[0]:(0,_utilities.mandatory)("flag"),happenedAt=arguments.length>1&&void 0!==arguments[1]?arguments[1]:EventData.timeInMs,data=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;_classCallCheck(this,EventData),this.flag=flag;var BASE_DATA_FIELDS={belongsTo:["globalLog"],handledAt:null,storedAt:null};if(happenedAt&&happenedAt.constructor===Object){if(null!==data)throw new Error("EventData.constructor: parameters order or type is invalid.");this.happenedAt=EventData.timeInMs,this.data=_lodash2.default.extend(BASE_DATA_FIELDS,happenedAt)}else this.happenedAt=happenedAt,this.data=_lodash2.default.extend(BASE_DATA_FIELDS,data);this.forState="any",this.data.hasOwnProperty("forState")&&(this.forState=this.data.forState),this.toStore=!0,this.data.hasOwnProperty("toStore")&&(this.toStore=this.data.toStore),this.handled=!1,this.stored=!1}return _createClass(EventData,[{key:"specificData",get:function(){for(var dataKeys=Object.keys(this.data),result={},i=0;i<dataKeys.length;i++)result[dataKeys[i]]=this.data[dataKeys[i]];return result}},{key:"formatted",get:function(){return{flag:this.flag,forState:this.forState,happenedAt:this.happenedAt,handledAt:this.data.handledAt,storedAt:this.data.storedAt,data:JSON.stringify(this.specificData)}}}],[{key:"timeInMs",get:function(){return(new Date).getTime()}}]),EventData}();exports.default=EventData},function(module,exports){module.exports=__WEBPACK_EXTERNAL_MODULE_4__},function(module,exports,__webpack_require__){"use strict";function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}function _classCallCheck(instance,Constructor){if(!(instance instanceof Constructor))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(exports,"__esModule",{value:!0});var _slicedToArray=function(){function sliceIterator(arr,i){var _arr=[],_n=!0,_d=!1,_e=void 0;try{for(var _s,_i=arr[Symbol.iterator]();!(_n=(_s=_i.next()).done)&&(_arr.push(_s.value),!i||_arr.length!==i);_n=!0);}catch(err){_d=!0,_e=err}finally{try{!_n&&_i.return&&_i.return()}finally{if(_d)throw _e}}return _arr}return function(arr,i){if(_utilities.Array.isArray(arr))return arr;if(Symbol.iterator in Object(arr))return sliceIterator(arr,i);throw new TypeError("Invalid attempt to destructure non-iterable instance")}}(),_createClass=function(){function defineProperties(target,props){for(var i=0;i<props.length;i++){var descriptor=props[i];descriptor.enumerable=descriptor.enumerable||!1,descriptor.configurable=!0,"value"in descriptor&&(descriptor.writable=!0),Object.defineProperty(target,descriptor.key,descriptor)}}return function(Constructor,protoProps,staticProps){return protoProps&&defineProperties(Constructor.prototype,protoProps),staticProps&&defineProperties(Constructor,staticProps),Constructor}}(),_lodash=__webpack_require__(1),_lodash2=_interopRequireDefault(_lodash),_jquery=__webpack_require__(8),_jquery2=_interopRequireDefault(_jquery),_bluebird=__webpack_require__(2),_bluebird2=_interopRequireDefault(_bluebird),_experimentBoxes=__webpack_require__(12),_utilities=__webpack_require__(0),DataManager=function(){function DataManager(){var parent=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null,subjectID=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;_classCallCheck(this,DataManager),this._parent=parent,subjectID&&(this._subjectID=subjectID),this.automaticID=!0,this.VALUE_FOR_NA=null,this.FLAG_EVENT_NOFLAG="EVENT_UNFLAGGED",this.logs={},this.dataTables={},this.tablesLastIndex={},this.toPush=new Set,this.waitForPush=!1,this.GLOBAL_LOG_FIELDS=["id","flag","forState","happenedAt","handledAt","data"],this.addTable("globalLog",this.GLOBAL_LOG_FIELDS),this.INTERFACE_REST="rest",this.INTERFACE_GRAPHQL="graphql",this.INTERFACE_WEBSOCKET="websocket",this.QUERY_LOGIN="login",this.QUERY_ADD="add",this.QUERY_GET_CHECKPOINT="getCheckpoints",this.QUERY_SET_CHECKPOINT="setCheckpoint",this.MAX_NUMBER_OF_RETRY=5,this.useLocalStorageCredentials=!0,this.connections=[],this.addRate=2e3,this.loginDeferred=null,this.isCurrentlySigningIn=null,this.authorize_manual_login=!0,this.isNode=!1,void 0!==module&&module.exports&&(this.isNode=!0)}return _createClass(DataManager,[{key:"log",value:function(){var data=arguments.length>0&&void 0!==arguments[0]?arguments[0]:(0,_utilities.mandatory)(),name=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"global";this.logs.hasOwnProperty(name)||(this.logs[name]=[]),this.logs[name].push(data)}},{key:"addTable",value:function(){var name=arguments.length>0&&void 0!==arguments[0]?arguments[0]:(0,_utilities.mandatory)(),fields=arguments.length>1&&void 0!==arguments[1]?arguments[1]:(0,_utilities.mandatory)();try{if(_lodash2.default.has(this.dataTables,name))throw new Error("DataManager.addTable: Data table with name '"+name+"' already exists");this.dataTables[name]={};for(var i=0;i<fields.length;i++)this.dataTables[name][fields[i]]=[];-1===_lodash2.default.indexOf(fields,"id")&&(this.dataTables[name].id=[])}catch(e){(0,_utilities.debugError)(e)}}},{key:"hasTable",value:function(){var name=arguments.length>0&&void 0!==arguments[0]?arguments[0]:(0,_utilities.mandatory)();return!!_lodash2.default.has(this.dataTables,name)}},{key:"fieldNames",value:function(){var name=arguments.length>0&&void 0!==arguments[0]?arguments[0]:(0,_utilities.mandatory)();return this.tableNames.has(name)?new Set(Object.keys(this.dataTables[name])):((0,_utilities.debugError)("DataManager.fieldNames: unknown table."),null)}},{key:"addRows",value:function(){var name=arguments.length>0&&void 0!==arguments[0]?arguments[0]:(0,_utilities.mandatory)(),rows=arguments.length>1&&void 0!==arguments[1]?arguments[1]:(0,_utilities.mandatory)();try{if(rows=this.toDataObject(rows,name),this.isValidRows(rows,name)){var columnNamesRows=new Set(Object.keys(rows)),columnNamesDataTableWithoutId=new Set(Object.keys(this.dataTables[name]));if(columnNamesDataTableWithoutId.delete("id"),!columnNamesRows.has("id")&&this.automaticID){var id=this.generateIds(name,1);this.dataTables[name].id=this.dataTables[name].id.concat(id)}var _iteratorNormalCompletion=!0,_didIteratorError=!1,_iteratorError=void 0;try{for(var _step,_iterator=columnNamesDataTableWithoutId[Symbol.iterator]();!(_iteratorNormalCompletion=(_step=_iterator.next()).done);_iteratorNormalCompletion=!0){var field=_step.value;this.dataTables[name][field]=this.dataTables[name][field].concat(rows[field])}}catch(err){_didIteratorError=!0,_iteratorError=err}finally{try{!_iteratorNormalCompletion&&_iterator.return&&_iterator.return()}finally{if(_didIteratorError)throw _iteratorError}}var firstField=_utilities.Array.from(columnNamesRows)[0],nrows=rows[firstField].constructor!==_utilities.Array?1:rows[firstField].length;return(0,_utilities.debuglog)("DataManager.addRows: added "+nrows+" rows to "+name+" data table."),this.prepareToPush(name)}throw new Error("DataManager.addRows: Row is of invalid format.")}catch(e){return(0,_utilities.debugError)("DataManager.addRows: ",e),_bluebird2.default.resolve()}}},{key:"generateIds",value:function(){var name=arguments.length>0&&void 0!==arguments[0]?arguments[0]:(0,_utilities.mandatory)(),numberOfIds=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1;try{if(!_lodash2.default.has(this.dataTables,name))throw new Error("DataManager.generateIds: Data table with name '"+name+"' does not exists");if(!_lodash2.default.has(this.dataTables[name],"id"))throw new Error("DataManager.generateIds: Data table with name '"+name+"' does not have an 'id' field");var startId=0;return 0!==this.dataTables[name].id.length&&(startId=_lodash2.default.max(this.dataTables[name].id)+1),_lodash2.default.range(startId,startId+numberOfIds)}catch(e){return(0,_utilities.debugError)(e),null}}},{key:"getEmptyRow",value:function(){var name=arguments.length>0&&void 0!==arguments[0]?arguments[0]:(0,_utilities.mandatory)();if(!_lodash2.default.has(this.dataTables,name))return(0,_utilities.debugError)("DataManager.getEmptyRow: Data table with name '"+name+"' does not exists"),null;for(var emptyTable={},columnNamesDataTable=_lodash2.default.keys(this.dataTables[name]),i=0;i<columnNamesDataTable.length;i++)emptyTable[columnNamesDataTable[i]]=[];return emptyTable}},{key:"isValidRows",value:function(){var rows=arguments.length>0&&void 0!==arguments[0]?arguments[0]:(0,_utilities.mandatory)(),name=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;if(null!==name&&!this.tableNames.has(name))throw new Error("DataManager.isValidRows: Data table with name '"+name+"' does not exists");if(rows.constructor!==Object)return!1;for(var columnNamesRows=Object.keys(rows),columnNamesDataTable=null===name?columnNamesRows:Object.keys(this.dataTables[name]),previousLenght=null,i=0;i<columnNamesDataTable.length;i++)if(-1!==_lodash2.default.indexOf(columnNamesRows,columnNamesDataTable[i])){if((0,_utilities.hasConstructor)(_utilities.Array,rows[columnNamesDataTable[i]]))if(null===previousLenght)previousLenght=rows[columnNamesDataTable[i]].length;else{var newLenght=rows[columnNamesDataTable[i]].length;if(previousLenght!==newLenght)return!1}else if(null!==previousLenght)return!1}else if("id"!==columnNamesDataTable[i]&&!this.automaticID)return(0,_utilities.debugError)("DataManager.isValidRows: Invalid row, does not contain column "+columnNamesDataTable[i]+" of dataTable"+name),!1;return!0}},{key:"toDataObject",value:function(){var rows=arguments.length>0&&void 0!==arguments[0]?arguments[0]:(0,_utilities.mandatory)(),name=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;if(rows.constructor===_utilities.Array){if(0===rows.length)return(0,_utilities.debugError)("DataManager.toDataObject: rows is empty."),null;if(rows[0].constructor!==Object)return(0,_utilities.debugError)("DataManager.toDataObject: dataArray rows are invalid."),null;for(var fields=Object.keys(rows[0]),dataObject=rows[0],i=0;i<rows.length;i++){var row=rows[i],_iteratorNormalCompletion2=!0,_didIteratorError2=!1,_iteratorError2=void 0;try{for(var _step2,_iterator2=fields[Symbol.iterator]();!(_iteratorNormalCompletion2=(_step2=_iterator2.next()).done);_iteratorNormalCompletion2=!0){var field=_step2.value;if(!row.hasOwnProperty(field))throw new Error("DataManager.toDataObject: field "+field+" absent from at least one row");dataObject[field].constructor!==_utilities.Array&&(dataObject[field]=[]),dataObject[field].push(row[field])}}catch(err){_didIteratorError2=!0,_iteratorError2=err}finally{try{!_iteratorNormalCompletion2&&_iterator2.return&&_iterator2.return()}finally{if(_didIteratorError2)throw _iteratorError2}}}}return this.isValidRows(rows,name)?rows:((0,_utilities.debugError)("DataManager.toDataObject: Row is of invalid format."),null)}},{key:"toDataArray",value:function(){var rows=arguments.length>0&&void 0!==arguments[0]?arguments[0]:(0,_utilities.mandatory)(),name=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;if(rows.constructor===_utilities.Array)return rows.length>0&&rows[0].constructor===Object?rows:((0,_utilities.debugError)("DataManager.toDataArray: Row is of invalid format."),null);if(this.isValidRows(rows,name)){for(var fields=new Set(Object.keys(rows)),numRows=rows[fields[0]].length,dataArray=[],i=0;i<numRows;i++){var row={},_iteratorNormalCompletion3=!0,_didIteratorError3=!1,_iteratorError3=void 0;try{for(var _step3,_iterator3=fields[Symbol.iterator]();!(_iteratorNormalCompletion3=(_step3=_iterator3.next()).done);_iteratorNormalCompletion3=!0){var field=_step3.value;if(rows[field].length<=i)return(0,_utilities.debugError)("DataManager.toDataArray: field array "+field+" is of invalid size."),null;row[field]=rows[field][i]}}catch(err){_didIteratorError3=!0,_iteratorError3=err}finally{try{!_iteratorNormalCompletion3&&_iterator3.return&&_iterator3.return()}finally{if(_didIteratorError3)throw _iteratorError3}}dataArray.push(row)}return dataArray}return(0,_utilities.debugError)("DataManager.toDataArray: Row is of invalid format."),null}},{key:"toCsv",value:function(){var data=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null,format=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"dataObject";if(data.constructor===_utilities.String){if(!this.hasTable(name))return(0,_utilities.debugError)("DataManager.toCsv: Data table with name '"+name+"' does not exists"),null;data=this.dataTables[data]}data="dataObject"===format?this.toDataObject(data):this.toDataArray(data);for(var columnNamesDataTable=Object.keys(data),lineArray=[],i=0;i<columnNamesDataTable[0].length;i++){for(var row=[],j=0;j<columnNamesDataTable.length;j++)row.push('"'+columnNamesDataTable[j][i]+'"');var line=row.join(",");lineArray.push(0===i?"data:text/csv;charset=utf-8,"+line:line)}return lineArray.join("\n")}},{key:"toJSON",value:function(){var data=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null,format=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"dataObject";if(null===data){data={};var tableNames=this.tableNames;if("dataArray"===format){var _iteratorNormalCompletion4=!0,_didIteratorError4=!1,_iteratorError4=void 0;try{for(var _step4,_iterator4=tableNames[Symbol.iterator]();!(_iteratorNormalCompletion4=(_step4=_iterator4.next()).done);_iteratorNormalCompletion4=!0){var _name=_step4.value;data[_name]=this.toDataArray(this.dataTables[_name])}}catch(err){_didIteratorError4=!0,_iteratorError4=err}finally{try{!_iteratorNormalCompletion4&&_iterator4.return&&_iterator4.return()}finally{if(_didIteratorError4)throw _iteratorError4}}}else data=this.dataTables}else data.constructor===_utilities.String&&this.hasTable(data)&&(data=this.toDataArray(this.dataTables[data]));return data="dataObject"===format?this.toDataObject(data):this.toDataArray(data),JSON.stringify(data)}},{key:"saveData",value:function(){}},{key:"sendData",value:function(){}},{key:"signInForm",value:function(){var formGenerator=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null,message=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,deferred=new _utilities.Deferred,form=null;if((0,_utilities.hasConstructor)(Function,formGenerator)&&(form=formGenerator(),(0,_utilities.hasConstructor)(_experimentBoxes.SmartForm,form)||(form=null,(0,_utilities.debugError)("DataManager.signInForm: sign in form function does not return a SmartForm"))),null===form){var fields={userId:{type:"input",constraints:"alpha; length:10,300",authorizedValues:null,parent:null,title:"Enter your UserId"},password:{type:"input",constraints:"alpha; length:6,300",authorizedValues:null,parent:null,title:"Enter your password:"}},options={fields:fields,title:"Login Form",format:"topCentralSmall"};form=new _experimentBoxes.SmartForm(options)}if((0,_utilities.hasConstructor)(_utilities.String,message)){var html='<div class="col-sm-10 bindedfield-errordiv" >\n                      <i class="glyphicon glyphicon-remove"></i><span class="bindedfield-error" style="font-size: 15px;">'+message+"</span>\n                    </div>";form.prepend(html)}return form.buttonText="OK",form.promise.then(function(fields){var values={};for(var field in fields)fields.hasOwnProperty(field)&&fields[field].value&&(values[field]=fields[field].value);deferred.resolve(values)}),deferred}},{key:"login",value:function(){var connection=arguments.length>0&&void 0!==arguments[0]?arguments[0]:(0,_utilities.mandatory)(),_this=this,variables=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,deferred=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;if((0,_utilities.hasConstructor)(_utilities.Deferred,this.loginDeferred)&&this.loginDeferred.pending){if(deferred!==this.loginDeferred)return this.loginDeferred.promise;deferred=this.loginDeferred}else(0,_utilities.hasConstructor)(_utilities.Deferred,deferred)||(deferred=new _utilities.Deferred),this.loginDeferred=deferred;if(deferred.status>this.MAX_NUMBER_OF_RETRY&&deferred.reject("DataManager.login: login failure - reach max retry."),deferred.status+=1,(0,_utilities.hasConstructor)(_utilities.Deferred,this.isCurrentlySigningIn)&&this.isCurrentlySigningIn.pending)return this.isCurrentlySigningIn.promise;if(_lodash2.default.has(connection,"login")&&connection.login.constructor===_utilities.String)if(null===variables){if(this.authorize_manual_login){var errorMessage=connection.lastErrorMessage||null,formDeferred=this.signInForm(connection.signInForm,errorMessage);return this.isCurrentlySigningIn=formDeferred,formDeferred.promise.then(function(credentials){return deferred.status=0,_this.login(connection,credentials,deferred)})}deferred.reject()}else{var data={interface:connection.type,credentials:variables,query:connection.login};_jquery2.default.ajax({url:connection.endpoint,type:"POST",data:JSON.stringify(data),contentType:"application/json"}).done(function(data,status){connection.credentials=data.credentials,connection.loggedIn=!0,_this.useLocalStorageCredentials&&_this.local(connection.name,{credentials:data.credentials}),(0,_utilities.debuglog)("DataManager.push: successful ajax call with status "+status,data),deferred.resolve()}).fail(function(connection,xhr){var json=xhr.responseJSON||{message:"",tooMuchTry:!1},message=json.message;if((0,_utilities.debugError)("DataManager.push: error during login with message "+message),connection.loggedIn=!1,connection.lastErrorMessage="Login error "+message,json.tooMuchTry){var modal=new _experimentBoxes.SmartModal("centralSmall");modal.title="Login Failure",modal.content="Too many login failure. Wait 5min before trying to log again.",deferred.reject("Too many login failure. Wait 5min before trying to log again.")}else this.authorize_manual_login?this.login(connection,null,deferred):deferred.reject(message)}.bind(this,connection))}else deferred.reject("DataManager.login: no valid login enpoint for the connection "+connection.name);return deferred.promise}},{key:"query",value:function(){var _query=arguments.length>0&&void 0!==arguments[0]?arguments[0]:(0,_utilities.mandatory)(),variables=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},_this2=this,connection=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,deferred=arguments.length>3&&void 0!==arguments[3]?arguments[3]:new _utilities.Deferred;if(deferred.status>this.MAX_NUMBER_OF_RETRY)deferred.reject("DataManager.query: query failure - reach max retry.",_query);else if(deferred.status+=1,null===connection&&(this.connections.length>0?connection=this.connections[0]:deferred.reject("DataManager.query: no valid connection available.")),connection.type===this.INTERFACE_REST){var data={interface:connection.type,credentials:connection.credentials,query:_query,variables:variables};_jquery2.default.ajax({url:connection.endpoint,type:"POST",data:JSON.stringify(data),contentType:"application/json"}).done(function(data,status){(0,_utilities.debuglog)("DataManager.push: successful ajax call with status "+status,data),deferred.resolve(data)}).fail(function(xhr){var json=xhr.responseJSON||{message:"",shouldLog:!1};json.shouldLog?((0,_utilities.debugError)("DataManager.push: user is not logged in -- will call the log function."),_this2.login(connection).then(function(){_this2.query(_query,variables,connection,deferred)})):((0,_utilities.debugError)("DataManager.push: could not perform query -- will retry",JSON.stringify(_query),json.message),_this2.query(_query,variables,connection,deferred))})}else deferred.reject("DataManager.query: unsupported connection.");return deferred.promise}},{key:"local",value:function(){var variable=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null,data=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;if(null===variable)return localStorage;if(null!==data)return void(localStorage[variable]=JSON.stringify(data));if(!localStorage.hasOwnProperty(variable))return void(0,_utilities.debugError)("DataManager.local: localStorage has no variable named "+variable);try{return JSON.parse(localStorage[variable])}catch(e){(0,_utilities.debugError)("DataManager.local: variable is probably not JSON ",e)}return localStorage[variable]}},{key:"prepareToPush",value:function(){for(var _this3=this,_len=arguments.length,names=(0,_utilities.Array)(_len),_key=0;_key<_len;_key++)names[_key]=arguments[_key];return names===[]&&(names=new Set(Object.keys(this.dataTables))),this.toPush.unite(names),this.waitForPush||(this.waitForPush=!0,(0,_utilities.delay)(this.addRate).then(function(){_this3.push()})),(0,_utilities.hasConstructor)(_utilities.Deferred,this.pushDeferred)&&this.pushDeferred.pending||(this.pushDeferred=new _utilities.Deferred),this.pushDeferred}},{key:"getStagedData",value:function(){var table=arguments.length>0&&void 0!==arguments[0]?arguments[0]:(0,_utilities.mandatory)(),format=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"dataArray",returned=[[],0];try{if(!this.tableNames.has(table))throw new Error("DataManager.getStagedData: unknown table.");-1===Object.keys(this.tablesLastIndex).indexOf(table)&&(this.tablesLastIndex[table]=0);for(var dataTable=this.dataTables[table],fields=this.fieldNames(table),numRows=dataTable[fields.sample()].length,lastIndex=this.tablesLastIndex[table],data="dataArray"===format?[]:{},j=0,i=lastIndex;i<numRows;i++)if("dataArray"===format){var row={},_iteratorNormalCompletion5=!0,_didIteratorError5=!1,_iteratorError5=void 0;try{for(var _step5,_iterator5=fields[Symbol.iterator]();!(_iteratorNormalCompletion5=(_step5=_iterator5.next()).done);_iteratorNormalCompletion5=!0){var field=_step5.value;if("id"!==field){if(dataTable[field].length<=i)throw new Error("DataManager.toDataArray: field array "+field+" is of invalid size.");row[field]=dataTable[field][i]}}}catch(err){_didIteratorError5=!0,_iteratorError5=err}finally{try{!_iteratorNormalCompletion5&&_iterator5.return&&_iterator5.return()}finally{if(_didIteratorError5)throw _iteratorError5}}data.push(row)}else{var _iteratorNormalCompletion6=!0,_didIteratorError6=!1,_iteratorError6=void 0;try{for(var _step6,_iterator6=fields[Symbol.iterator]();!(_iteratorNormalCompletion6=(_step6=_iterator6.next()).done);_iteratorNormalCompletion6=!0){var _field=_step6.value;if("id"!==_field){if(data.hasOwnProperty(_field)||(data[_field]=[]),dataTable[_field].length<=i)throw new Error("DataManager.getStagedData: field "+_field+" of invalid size in the DataManager.");data[_field][j].push(dataTable[_field][i])}}}catch(err){_didIteratorError6=!0,_iteratorError6=err}finally{try{!_iteratorNormalCompletion6&&_iterator6.return&&_iterator6.return()}finally{if(_didIteratorError6)throw _iteratorError6}}j+=1}returned=[data,numRows]}catch(e){(0,_utilities.debugError)(e)}return returned}},{key:"push",value:function(){var _this4=this;if((0,_utilities.hasConstructor)(_utilities.Deferred,this.loginDeferred)&&this.loginDeferred.pending)(0,_utilities.delay)(this.addRate).then(function(){_this4.push()});else{this.waitForPush=0;for(var i=0;i<this.connections.length;i++){var connection=this.connections[i];connection.type===this.INTERFACE_REST&&function(){var toPushSize=_this4.toPush.size,pushed=0,pushDeferred=_this4.pushDeferred,checkIfPushed=function(){pushed>=toPushSize&&pushDeferred.resolve()},_iteratorNormalCompletion7=!0,_didIteratorError7=!1,_iteratorError7=void 0;try{for(var _step7,_iterator7=_this4.toPush[Symbol.iterator]();!(_iteratorNormalCompletion7=(_step7=_iterator7.next()).done);_iteratorNormalCompletion7=!0){var table=_step7.value;_this4.useLocalStorageCredentials&&void 0!==_this4.local(connection.name)&&_this4.local(connection.name).hasOwnProperty("credentials")&&(connection.credentials=_this4.local(connection.name).credentials);var _getStagedData=_this4.getStagedData(table),_getStagedData2=_slicedToArray(_getStagedData,2),rows=_getStagedData2[0],lastIndex=_getStagedData2[1],data={interface:connection.type,credentials:connection.credentials,query:connection.add,variables:{table:table,rows:rows}};_jquery2.default.ajax({url:connection.endpoint,type:"POST",data:JSON.stringify(data),contentType:"application/json"}).done(function(table,lastIndex,data,status){pushed+=1,checkIfPushed(),this.tablesLastIndex[table]=lastIndex,this.toPush.delete(table),(0,_utilities.debuglog)("DataManager.push: successful ajax call with status "+status,data)}.bind(_this4,table,lastIndex)).fail(function(connection,table,xhr){var _this5=this,json=xhr.responseJSON||{message:"",shouldLog:!1};json.shouldLog?((0,_utilities.debugError)("DataManager.push: user is not logged in -- will call the log function."),this.login(connection).then(function(){_this5.prepareToPush(table)})):((0,_utilities.debugError)("DataManager.push: could not push "+table+" -- will retry",json.message),this.prepareToPush(table))}.bind(_this4,connection,table))}}catch(err){_didIteratorError7=!0,_iteratorError7=err}finally{try{!_iteratorNormalCompletion7&&_iterator7.return&&_iterator7.return()}finally{if(_didIteratorError7)throw _iteratorError7}}}(),connection.type,this.INTERFACE_GRAPHQL}}}},{key:"setConnection",value:function(){var _this6=this,variables=arguments.length>0&&void 0!==arguments[0]?arguments[0]:(0,_utilities.mandatory)(),deferred=new _utilities.Deferred;if(variables.hasOwnProperty("type")&&variables.type!==this.INTERFACE_REST)deferred.reject("DataManager.setInterface: unsupported connection type.");else{var defaultVariables={type:this.INTERFACE_REST,name:null,endpoint:null,credentials:null,loggedIn:!1,add:this.QUERY_ADD,checkpoint:this.QUERY_CHECKPOINT,login:this.QUERY_LOGIN},connection=_lodash2.default.extend(defaultVariables,variables);null!==connection.endpoint?(connection.name=connection.name||connection.type,null===connection.credentials&&this.useLocalStorageCredentials&&void 0!==this.local(connection.name)&&this.local(connection.name).hasOwnProperty("credentials")&&(connection.credentials=this.local(connection.name).credentials),null!==connection.credentials?this.login(connection,connection.credentials).then(function(){_this6.connections.push(connection),deferred.resolve(connection)}).catch(function(e){deferred.reject(e)}):(this.connections.push(connection),deferred.resolve(connection))):deferred.reject("DataManager.setInterface: needs at least an endpoint.")}return deferred.promise}},{key:"tableNames",get:function(){return new Set(Object.keys(this.dataTables))},set:function(value){throw new Error("DataManager.tableNames: readonly.")}},{key:"globalLog",get:function(){return this._globalLog},set:function(value){throw new Error("DataManager.tableNames: readonly.")}},{key:"nextLogId",get:function(){return this.globalLog.id.length>0?_lodash2.default.max(this.globalLog.id)+1:0},set:function(value){if(value.constructor!==_utilities.String)throw new Error("DataManager: id should be a string.");this._customNextID=value,console.log("DataManager: next event 'id' will be "+value)}}]),DataManager}();exports.default=DataManager},function(module,exports,__webpack_require__){"use strict";function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}function _defineProperty(obj,key,value){return key in obj?Object.defineProperty(obj,key,{value:value,enumerable:!0,configurable:!0,writable:!0}):obj[key]=value,obj}function _classCallCheck(instance,Constructor){if(!(instance instanceof Constructor))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(exports,"__esModule",{value:!0});var _createClass=function(){function defineProperties(target,props){for(var i=0;i<props.length;i++){var descriptor=props[i];descriptor.enumerable=descriptor.enumerable||!1,descriptor.configurable=!0,"value"in descriptor&&(descriptor.writable=!0),Object.defineProperty(target,descriptor.key,descriptor)}}return function(Constructor,protoProps,staticProps){return protoProps&&defineProperties(Constructor.prototype,protoProps),staticProps&&defineProperties(Constructor,staticProps),Constructor}}(),_jquery=__webpack_require__(8),_jquery2=_interopRequireDefault(_jquery),_bluebird=__webpack_require__(2),_bluebird2=_interopRequireDefault(_bluebird),_utilities=__webpack_require__(0),yaml=__webpack_require__(18),RessourceManager=function(){function RessourceManager(){_classCallCheck(this,RessourceManager),this.defaultLanguage="en",this.currentLanguage=this.defaultLanguage,this.data={},this.overwrite=!0,this.useAjax=!0;for(var _len=arguments.length,filepaths=Array(_len),_key=0;_key<_len;_key++)filepaths[_key]=arguments[_key];this.addFiles(filepaths)}return _createClass(RessourceManager,[{key:"addFiles",value:function(){var _ref;if(!1===this.useAjax)throw new Error("RessourceManager.addFiles: useAjax set to false - can't add files over the network");var concatFilepaths=(_ref=[]).concat.apply(_ref,arguments);this.files=[];for(var promises=[],i=0;i<concatFilepaths.length;i++)this.isOfValidFormat(concatFilepaths[i])?(this.files[i]={},this.files[i].type=this.getFormat(concatFilepaths[i]),this.files[i].path=concatFilepaths[i],this.files[i].loaded=!1,this.files[i].validated=!1,this.files[i].added=!1,this.files[i].raw=!1,this.files[i].data=null,promises.push(this.loadFile(i))):console.warn("RessourceManager.addFiles: invalid type for "+concatFilepaths[i]);return _bluebird2.default.all(promises)}},{key:"loadFile",value:function(){var fileIndex=arguments.length>0&&void 0!==arguments[0]?arguments[0]:(0,_utilities.mandatory)(),deffered=new _utilities.Deferred;if(void 0===this.files[fileIndex])return deffered.reject("RessourceManager.loadFile: files[fileIndex] is not defined");var thisObject=this;return _jquery2.default.ajax({type:"GET",url:this.files[fileIndex].path,crossDomain:!0}).done(function(data,textStatus,jqXHR){thisObject.files[fileIndex].loaded=!0,thisObject.files[fileIndex].raw=data;try{thisObject.parseRaw(fileIndex)}catch(e){deffered.reject(e)}finally{deffered.resolve("RessourceManager.loadFile: "+thisObject.files[fileIndex].path+" parsed")}}),deffered.promise}},{key:"parseRaw",value:function(){var fileIndex=arguments.length>0&&void 0!==arguments[0]?arguments[0]:(0,_utilities.mandatory)();if(void 0===this.files[fileIndex])throw new Error("RessourceManager.parseRaw: files[fileIndex] is not defined");var file=this.files[fileIndex];if(null===file.raw)throw new Error("RessourceManager.parseRaw: file.raw is null or not validated");if(file.raw.constructor===String){var parser=void 0,arg=null;switch(file.type){case"json":parser=JSON.parse;break;case"csv":parser=_jquery2.default.csv.toObjects;break;case"xml":window.DOMParser?(parser=new DOMParser,parser=parser.parseFromString,arg="text/xml"):(parser=new window.ActiveXObject("Microsoft.XMLDOM"),parser.async=!1,parser=parser.loadXML);break;case"yaml":parser=yaml.safeLoad;break;default:throw new Error("RessourceManager.parseRaw: file.type is null or not validated")}try{file.data=arg?parser(file.raw,arg):parser(file.raw)}catch(e){throw file.validated=!1,file.data=null,new Error(e)}finally{file.validated=!0,this.processParsed()}}else{if(file.raw.constructor!==Object)throw new Error("RessourceManager.parseRaw: invalid file.raw format");file.data=file.raw,file.validated=!0,this.processParsed()}}},{key:"processParsed",value:function(){for(var i=0;i<this.files.length;i++)if(!1!==this.files[i].validated&&this.files[i].data&&!this.files[i].added){for(var data=this.files[i].data,keys=Object.keys(data),j=0;j<keys.length;j++)this.addDataFamilly(keys[j],data[keys[j]]);this.files[i].added=!0}}},{key:"addDataFamilly",value:function(){var familly=arguments.length>0&&void 0!==arguments[0]?arguments[0]:(0,_utilities.mandatory)(),data=arguments.length>1&&void 0!==arguments[1]?arguments[1]:(0,_utilities.mandatory)(),overwrite=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,toAdd=data,id=void 0;data.constructor!==Object&&(id=familly,familly=data.constructor.name.toLowerCase()+"s",toAdd=_defineProperty({},id,data)),void 0===this.data[familly]&&(this.data[familly]={}),null===overwrite&&(overwrite=this.overwrite),this.data[familly]=overwrite?this.extend(this.data[familly],toAdd):this.extend(toAdd,this.data[familly])}},{key:"getNextId",value:function(){var familly=arguments.length>0&&void 0!==arguments[0]?arguments[0]:(0,_utilities.mandatory)();return this.data.hasOwnProperty(familly)?Object.keys(this.data[familly]).length:0}},{key:"add",value:function(){var object=arguments.length>0&&void 0!==arguments[0]?arguments[0]:(0,_utilities.mandatory)(),overwrite=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;if(object.constructor!==Object)throw new Error("RessourceManager.add: cannot add data from a non object");var oldOverwrite=this.overwrite;null===overwrite?overwrite=oldOverwrite:this.overwrite=overwrite;for(var keys=Object.keys(object),i=0;i<keys.length;i++)object[keys[i]].constructor===Object?this.addDataFamilly(keys[i],object[keys[i]]):object[keys[i]].constructor===Array?this.addByName(keys[i],object[keys[i]],"arrays"):this.addByName(keys[i],object[keys[i]]);this.overwrite=oldOverwrite}},{key:"addByName",value:function(){var name=arguments.length>0&&void 0!==arguments[0]?arguments[0]:(0,_utilities.mandatory)(),value=arguments.length>1&&void 0!==arguments[1]?arguments[1]:(0,_utilities.mandatory)(),familly=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"strings",overwrite=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null;void 0===this.data[familly]&&(this.data[familly]={}),null===overwrite&&(overwrite=this.overwrite),this.data[familly].hasOwnProperty(name)&&!overwrite||(console.warn("RessourceManager.addByName: already a ressource named "+name+" - Overwriting it."),this.data[familly][name]=value)}},{key:"getFormat",value:function(){var filepath=arguments.length>0&&void 0!==arguments[0]?arguments[0]:(0,_utilities.mandatory)();return filepath.substr(2+(~-filepath.lastIndexOf(".")>>>0))}},{key:"isOfValidFormat",value:function(){var filepath=arguments.length>0&&void 0!==arguments[0]?arguments[0]:(0,_utilities.mandatory)();return-1!==["json","csv","xml","yaml"].indexOf(this.getFormat(filepath))}},{key:"mergeWith",value:function(){var ressourceManager=arguments.length>0&&void 0!==arguments[0]?arguments[0]:(0,_utilities.mandatory)();if(ressourceManager.constructor!==RessourceManager)throw new Error("RessourceManager.mergeWith: specified ressourceManager is not of class RessourceManager.");for(var currentFamillies=this.famillies,mergingFamillies=ressourceManager.famillies,i=0;i<mergingFamillies.length;i++)-1===currentFamillies.indexOf(mergingFamillies[i])?this.data[mergingFamillies[i]]=ressourceManager.data[mergingFamillies[i]]:this.data[mergingFamillies[i]]=this.extend(this.data[mergingFamillies[i]],ressourceManager.data[mergingFamillies[i]])}},{key:"lookFor",value:function(){for(var result=void 0,_len2=arguments.length,variable=Array(_len2),_key2=0;_key2<_len2;_key2++)variable[_key2]=arguments[_key2];if(1===variable.length){if(this.data.hasOwnProperty(variable))result=this.data[variable];else for(var famillies=this.famillies,i=0;i<famillies.length;i++)if(this.data[famillies[i]].hasOwnProperty(variable)){result=this.data[famillies[i]][variable];break}}else if(variable.length>1){result={};for(var _i=0;_i<variable.length;_i++)result[variable[_i]]=this.lookFor(variable[_i])}return result}},{key:"extend",value:function(){var extended={},deep=!1,i=0,length=arguments.length;"[object Boolean]"===Object.prototype.toString.call(arguments.length<=0?void 0:arguments[0])&&(deep=arguments.length<=0?void 0:arguments[0],i+=1);for(;i<length;i++){var obj=arguments.length<=i?void 0:arguments[i];!function(obj){for(var prop in obj)Object.prototype.hasOwnProperty.call(obj,prop)&&(deep&&"[object Object]"===Object.prototype.toString.call(obj[prop])?extended[prop]=this.extend(!0,extended[prop],obj[prop]):extended[prop]=obj[prop])}(obj)}return extended}},{key:"famillies",get:function(){return Object.keys(this.data)}},{key:"has",get:function(){return new Proxy(this,{get:function(target,pathString){return void 0!==target.get[pathString]}})}},{key:"get",get:function(){return new Proxy(this,{get:function(target,pathString){for(var path=pathString.split("_"),famillies=target.famillies,lookForLanguage=target.currentLanguage,lookForFamilly="strings",lookForVariable=void 0,couldSwapForVariable=!1,i=0;i<path.length;i++)if(-1!==famillies.indexOf(path[i]))lookForFamilly=path[i],couldSwapForVariable=!0;else if(2===path[i].length)lookForLanguage=path[i];else{if(void 0!==lookForVariable)return void console.error("RessourceManager.get: at least two possible variable names into path: "+lookForVariable+" and "+path[i]);lookForVariable=path[i]}if(void 0===lookForVariable){if(!couldSwapForVariable)return void(0,_utilities.debugError)("RessourceManager.get: no variable name found in "+pathString);lookForVariable=lookForFamilly}var result=void 0;if(target.data.hasOwnProperty(lookForFamilly)&&target.data[lookForFamilly].hasOwnProperty(lookForVariable))result=target.data[lookForFamilly][lookForVariable];else if(void 0===(result=target.lookFor(lookForVariable)))return void console.error("RessourceManager.get: no ressource for path "+lookForFamilly+"."+lookForVariable);return result.constructor!==Object?result:result.hasOwnProperty(lookForLanguage)?result[lookForLanguage]:result.hasOwnProperty(target.currentLanguage)?(console.warn("RessourceManager.get: no valid language, defaulting to "+target.currentLanguage),result[target.currentLanguage]):(console.warn("RessourceManager.get: no localization language found, returning the whole object"),result)}})}}]),RessourceManager}();exports.default=RessourceManager},function(module,exports,__webpack_require__){"use strict";function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}function _classCallCheck(instance,Constructor){if(!(instance instanceof Constructor))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(exports,"__esModule",{value:!0});var _createClass=function(){function defineProperties(target,props){for(var i=0;i<props.length;i++){var descriptor=props[i];descriptor.enumerable=descriptor.enumerable||!1,descriptor.configurable=!0,"value"in descriptor&&(descriptor.writable=!0),Object.defineProperty(target,descriptor.key,descriptor)}}return function(Constructor,protoProps,staticProps){return protoProps&&defineProperties(Constructor.prototype,protoProps),staticProps&&defineProperties(Constructor,staticProps),Constructor}}(),_lodash=__webpack_require__(1),_lodash2=_interopRequireDefault(_lodash),_bluebird=__webpack_require__(2),_bluebird2=_interopRequireDefault(_bluebird),_EventData=__webpack_require__(3),_EventData2=_interopRequireDefault(_EventData),_utilities=__webpack_require__(0),State=function(){function State(){var stateManager=arguments.length>0&&void 0!==arguments[0]?arguments[0]:(0,_utilities.mandatory)(),stateKey=arguments.length>1&&void 0!==arguments[1]?arguments[1]:(0,_utilities.mandatory)();_classCallCheck(this,State),this._stateManager=stateManager,this._parent=stateManager._parent,this._dataManager=stateManager._dataManager,this.stateKey=stateKey,this._eventFunctions={},this._nextEventFunctions={},this._awakeningFunctions=[],this._endingFunctions=[],this._updateFunctions=[],this._frozenEvents=[],this._frozenAt=null,this.FREEZE_DELAY=50}return _createClass(State,[{key:"awake",value:function(){if(arguments.length>0&&void 0!==arguments[0]&&arguments[0]&&null!==this._frozenAt&&(this._frozenAt=null,this._frozenEvents=[],this.stateManager.stateWasUnfreezed(this.stateKey)),null!==this._frozenAt)this.unfreeze();else{void 0!==this._parent.sceneKey&&(0,_utilities.debuglog)(this.stateKey+" of scene "+this._parent.sceneKey+" awaken.");for(var calledFunctions=[],i=0;i<this._awakeningFunctions.length;i++)calledFunctions[i]=_bluebird2.default.method(this._awakeningFunctions[i].bind(this.context))();_bluebird2.default.all(calledFunctions).then(function(){(0,_utilities.debuglog)("State: Awakening functions completed as expected.",calledFunctions)}).catch(function(error){(0,_utilities.debugError)(error)})}}},{key:"end",value:function(){var _this=this;if(null===this._frozenAt){for(var calledFunctions=[],i=0;i<this._endingFunctions.length;i++)calledFunctions[i]=_bluebird2.default.method(this._endingFunctions[i].bind(this.context))();_bluebird2.default.all(calledFunctions).then(function(data){return(0,_utilities.debuglog)("State: Ending functions completed as expected.",calledFunctions),(0,_utilities.debuglog)(_this.stateKey+" ended."),data}).catch(function(error){return(0,_utilities.debugError)(error),null})}}},{key:"update",value:function(){if(null===this._frozenAt&&this._stateManager._eventHeap.length)for(var nextEvent=void 0,events=this._stateManager.spliceEventsForState(this.stateKey),i=0;i<events.length;i++)nextEvent=events[i],(0,_utilities.debuglog)("State: first event is "+nextEvent.flag),this.handleEvent(nextEvent)}},{key:"handleEvent",value:function(event){var handled=!1;if(this.hasEventFunction(event.flag)){var eventFunctions=this._eventFunctions[event.flag];if(eventFunctions.constructor===Array)for(var i=0;i<eventFunctions.length;i++)_bluebird2.default.method(eventFunctions[i].bind(this.context))(event).then(function(functionName,data){(0,_utilities.debuglog)(data);var eventClone=_lodash2.default.cloneDeep(event);eventClone.data.handlingFunction=functionName,this._stateManager.stateHasFinishedHandlingEvent(eventClone)}.bind(this,eventFunctions[i].name)).catch(function(error){(0,_utilities.debugError)(error)});else _bluebird2.default.method(eventFunctions.bind(this.context))().then(function(functionName,data){(0,_utilities.debuglog)(data);var eventClone=_lodash2.default.cloneDeep(event);eventClone.data.handlingFunction=functionName,this._stateManager.stateHasFinishedHandlingEvent(eventClone)}.bind(this,eventFunctions.name)).catch(function(error){(0,_utilities.debugError)(error)});handled=!0}if(this._nextEventFunctions.hasOwnProperty(event.flag)){var _eventFunctions=this._nextEventFunctions[event.flag];if(null!==_eventFunctions){_eventFunctions.constructor===Function&&(_eventFunctions=[_eventFunctions]);var _iteratorNormalCompletion=!0,_didIteratorError=!1,_iteratorError=void 0;try{for(var _step,_iterator=_eventFunctions[Symbol.iterator]();!(_iteratorNormalCompletion=(_step=_iterator.next()).done);_iteratorNormalCompletion=!0){var eventFunction=_step.value;_bluebird2.default.method(eventFunction)(event).then(function(functionName,data){(0,_utilities.debuglog)(data);var eventClone=_lodash2.default.cloneDeep(event);eventClone.data.handlingFunction=functionName,this._stateManager.stateHasFinishedHandlingEvent(eventClone)}.bind(this,eventFunction.name)).catch(function(error){(0,_utilities.debugError)(error)})}}catch(err){_didIteratorError=!0,_iteratorError=err}finally{try{!_iteratorNormalCompletion&&_iterator.return&&_iterator.return()}finally{if(_didIteratorError)throw _iteratorError}}this._nextEventFunctions[event.flag].length=0,handled=!0}}handled||(this._stateManager.stateHasFinishedHandlingEvent(event),(0,_utilities.debuglog)("State: Event '"+event.flag+"' not handled by state '"+this.stateKey+"'"))}},{key:"onNext",value:function(eventFlag){try{for(var _len=arguments.length,handlingFunctions=Array(_len>1?_len-1:0),_key=1;_key<_len;_key++)handlingFunctions[_key-1]=arguments[_key];_utilities.mustBeDefined.apply(void 0,[eventFlag].concat(handlingFunctions)),_utilities.mustHaveConstructor.apply(void 0,[Function].concat(handlingFunctions)),this._nextEventFunctions.hasOwnProperty(eventFlag)?this._nextEventFunctions[eventFlag].constructor===Array?(this._nextEventFunctions[eventFlag]=this._nextEventFunctions[eventFlag].concat(handlingFunctions),(0,_utilities.debuglog)("State "+this.stateKey+".onNext: several handling functions - handling function pushed to the array of event functions on event '"+eventFlag+"'")):(this._nextEventFunctions[eventFlag]=[this._nextEventFunctions[eventFlag]].concat(handlingFunctions),(0,_utilities.debuglog)("State "+this.stateKey+".onNext: several handling functions - array created for handling functions for state on event '"+eventFlag+"'")):(this._nextEventFunctions[eventFlag]=handlingFunctions,(0,_utilities.debuglog)("State "+this.stateKey+".onNext: handling function added to state '"+this.stateKey+"' for event '"+eventFlag+"'"))}catch(e){(0,_utilities.debugError)(e)}}},{key:"resolveOnKey",value:function(){var _this2=this,options=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{key:null,except:[32],eventFlag:"key_down"},baseOptions={key:null,except:[32],eventFlag:"key_down"};if(options.constructor!==Object){if(options.constructor!==Number)return(0,_utilities.debugError)("State.resolveOnKey: invalid options"),null;baseOptions.key=options,options={}}var _$extend=_lodash2.default.extend(baseOptions,options),key=_$extend.key,except=_$extend.except,eventFlag=_$extend.eventFlag;if(null!==key&&key.constructor!==Array){if(key.constructor!==Number)return(0,_utilities.debugError)("State.resolveOnKey: key must be numeric"),null;key=[key]}if(void 0!==except&&null!==except||(except=[]),except.constructor!==Array){if(except.constructor!==Number)return(0,_utilities.debugError)("State.resolveOnKey: except must be numeric"),null;except=[except]}var deferred=new _utilities.Deferred,f=function f(e){return null===key&&-1===except.indexOf(e.data.keyCode)||null!==key&&-1!==key.indexOf(e.data.keyCode)?(deferred.resolve(e),"State "+_this2.stateKey+".resolveOnKey: tested on '"+key+"' and resolved because key '"+e.data.keyCode+"' pressed"):deferred.resolved?"State "+_this2.stateKey+".resolveOnKey: should not stay in the function stack":((0,_utilities.delay)(5).then(function(){_this2.onNext(eventFlag,f)}),"State "+_this2.stateKey+".resolveOnKey: tested on '"+key+"' and did not resolved because wrong key '"+e.data.keyCode+"' pressed")};return this.onNext(eventFlag,f),deferred.promise}},{key:"resolveOnClick",value:function(){var _this3=this,eventFlag=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"mouse_click",deferred=new _utilities.Deferred,f=function(e){return deferred.resolve(e),"State "+_this3.stateKey+".resolveOnClick: resolved"};return this.onNext(eventFlag,f),deferred.promise}},{key:"freeze",value:function(){var stateManager=this._stateManager;this._frozenAt=stateManager.timeInMs,this._frozenEvents=stateManager.getAllEvents(),(0,_utilities.debugWarn)(this._frozenEvents),stateManager.stateWasFrozen(this.stateKey)}},{key:"unfreeze",value:function(){if(null===this._frozenAt)return void(0,_utilities.debugWarn)("State.unfreeze: state was not frozen");for(var stateManager=this._stateManager,frozenEvents=this._frozenEvents,i=0;i<frozenEvents.length;i++)frozenEvents[i].constructor===_EventData2.default&&(frozenEvents[i].happenedAt+=stateManager.timeInMs-this._frozenAt,frozenEvents[i].happenedAt-stateManager.timeInMs>this.FREEZE_DELAY?(stateManager.addTimeTriggerEvent(frozenEvents[i]),console.log("timetrigger"),(0,_utilities.debugWarn)(frozenEvents[i])):(stateManager.addEvent(frozenEvents[i]),console.log("added event"),(0,_utilities.debugWarn)(frozenEvents[i])));this._frozenAt=null,this._frozenEvents=[],stateManager.stateWasUnfreezed(this.stateKey)}},{key:"registerEventFunctions",value:function(eventFlag,overwrite){for(var _len2=arguments.length,handlingFunctions=Array(_len2>2?_len2-2:0),_key2=2;_key2<_len2;_key2++)handlingFunctions[_key2-2]=arguments[_key2];_utilities.mustBeDefined.apply(void 0,[eventFlag,overwrite].concat(handlingFunctions)),_utilities.mustHaveConstructor.apply(void 0,[Function].concat(handlingFunctions)),this.hasEventFunction(eventFlag)?this._eventFunctions[eventFlag].constructor===Array?(this._eventFunctions[eventFlag]=this._eventFunctions[eventFlag].concat(handlingFunctions),(0,_utilities.debuglog)("State "+this.stateKey+": several handling functions - handling function pushed to the array of event functions on event '"+eventFlag+"'")):(this._eventFunctions[eventFlag]=[this._eventFunctions[eventFlag]].concat(handlingFunctions),(0,_utilities.debuglog)("State "+this.stateKey+": several handling functions - array created for handling functions for state on event '"+eventFlag+"'")):(this._eventFunctions[eventFlag]=handlingFunctions,(0,_utilities.debuglog)("State "+this.stateKey+": handling function added to state '"+this.stateKey+"' for event '"+eventFlag+"'"))}},{key:"registerCycleFunctions",value:function(cycle,overwrite){for(var _len3=arguments.length,handlingFunctions=Array(_len3>2?_len3-2:0),_key3=2;_key3<_len3;_key3++)handlingFunctions[_key3-2]=arguments[_key3];_utilities.mustBeDefined.apply(void 0,[cycle,overwrite].concat(handlingFunctions)),_utilities.mustHaveConstructor.apply(void 0,[Function].concat(handlingFunctions));var arrayName=void 0;switch(cycle){case"awakening":arrayName="_awakeningFunctions";break;case"ending":arrayName="_endingFunctions";break;case"update":arrayName="_updateFunctions";break;default:throw new Error("State.registerCycleFunctions: Invalid cycle parameter.")}overwrite?(this[arrayName]=handlingFunctions,(0,_utilities.debuglog)("State "+this.stateKey+": handling function overwrited "+arrayName)):(this[arrayName]=this[arrayName].concat(handlingFunctions),(0,_utilities.debuglog)("State "+this.stateKey+": handling function added to "+arrayName+" array for state '"+this.stateKey+"'"))}},{key:"addHandledEvents",value:function(){for(var _len4=arguments.length,handlingFunctions=Array(_len4),_key4=0;_key4<_len4;_key4++)handlingFunctions[_key4]=arguments[_key4];_utilities.mustBeDefined.apply(void 0,handlingFunctions),_utilities.mustHaveConstructor.apply(void 0,[Function].concat(handlingFunctions));for(var i=0;i<handlingFunctions.length;i++)this.registerEventFunctions(handlingFunctions[i].name,!0,handlingFunctions[i])}},{key:"addEventFunctions",value:function(eventFlag){for(var _len5=arguments.length,handlingFunctions=Array(_len5>1?_len5-1:0),_key5=1;_key5<_len5;_key5++)handlingFunctions[_key5-1]=arguments[_key5];_utilities.mustBeDefined.apply(void 0,[eventFlag].concat(handlingFunctions)),_utilities.mustHaveConstructor.apply(void 0,[Function].concat(handlingFunctions)),this.registerEventFunctions.apply(this,[eventFlag,!1].concat(handlingFunctions))}},{key:"overwriteEventFunctions",value:function(eventFlag){for(var _len6=arguments.length,handlingFunctions=Array(_len6>1?_len6-1:0),_key6=1;_key6<_len6;_key6++)handlingFunctions[_key6-1]=arguments[_key6];_utilities.mustBeDefined.apply(void 0,[eventFlag].concat(handlingFunctions)),_utilities.mustHaveConstructor.apply(void 0,[Function].concat(handlingFunctions)),this.registerEventFunctions.apply(this,[eventFlag,!0].concat(handlingFunctions))}},{key:"addAwakeningFunctions",value:function(){for(var _len7=arguments.length,handlingFunctions=Array(_len7),_key7=0;_key7<_len7;_key7++)handlingFunctions[_key7]=arguments[_key7];_utilities.mustBeDefined.apply(void 0,handlingFunctions),_utilities.mustHaveConstructor.apply(void 0,[Function].concat(handlingFunctions)),this.registerCycleFunctions.apply(this,["awakening",!1].concat(handlingFunctions))}},{key:"overwriteAwakeningFunctions",value:function(){for(var _len8=arguments.length,handlingFunctions=Array(_len8),_key8=0;_key8<_len8;_key8++)handlingFunctions[_key8]=arguments[_key8];_utilities.mustBeDefined.apply(void 0,handlingFunctions),_utilities.mustHaveConstructor.apply(void 0,[Function].concat(handlingFunctions)),this.registerCycleFunctions.apply(this,["awakening",!0].concat(handlingFunctions))}},{key:"overwriteEndingFunction",value:function(){for(var _len9=arguments.length,handlingFunctions=Array(_len9),_key9=0;_key9<_len9;_key9++)handlingFunctions[_key9]=arguments[_key9];_utilities.mustBeDefined.apply(void 0,handlingFunctions),_utilities.mustHaveConstructor.apply(void 0,[Function].concat(handlingFunctions)),this.registerCycleFunctions.apply(this,["ending",!0].concat(handlingFunctions))}},{key:"addEndingFunctions",value:function(){for(var _len10=arguments.length,handlingFunctions=Array(_len10),_key10=0;_key10<_len10;_key10++)handlingFunctions[_key10]=arguments[_key10];_utilities.mustBeDefined.apply(void 0,handlingFunctions),_utilities.mustHaveConstructor.apply(void 0,[Function].concat(handlingFunctions)),this.registerCycleFunctions.apply(this,["ending",!1].concat(handlingFunctions))}},{key:"overwriteUpdateFunctions",value:function(){for(var _len11=arguments.length,handlingFunctions=Array(_len11),_key11=0;_key11<_len11;_key11++)handlingFunctions[_key11]=arguments[_key11];_utilities.mustBeDefined.apply(void 0,handlingFunctions),_utilities.mustHaveConstructor.apply(void 0,[Function].concat(handlingFunctions)),this.registerCycleFunctions.apply(this,["udpate",!1].concat(handlingFunctions))}},{key:"addUpdateFunctions",value:function(){for(var _len12=arguments.length,handlingFunctions=Array(_len12),_key12=0;_key12<_len12;_key12++)handlingFunctions[_key12]=arguments[_key12];_utilities.mustBeDefined.apply(void 0,handlingFunctions),_utilities.mustHaveConstructor.apply(void 0,[Function].concat(handlingFunctions)),this.registerCycleFunctions.apply(this,["udpate",!1].concat(handlingFunctions))}},{key:"hasEventFunction",value:function(){var eventFlag=arguments.length>0&&void 0!==arguments[0]?arguments[0]:(0,_utilities.mandatory)();return _lodash2.default.has(this._eventFunctions,eventFlag)}},{key:"getGlobal",value:function(){var name=arguments.length>0&&void 0!==arguments[0]?arguments[0]:(0,_utilities.mandatory)();return this._stateManager.getGlobal(name)}},{key:"setGlobal",value:function(){var name=arguments.length>0&&void 0!==arguments[0]?arguments[0]:(0,_utilities.mandatory)(),value=arguments.length>1&&void 0!==arguments[1]?arguments[1]:(0,_utilities.mandatory)();return this._stateManager.setGlobal(name,value)}},{key:"context",get:function(){return this._stateManager._taskObject?this._stateManager._taskObject.getContext(this):{taskObject:null,dataManager:this._stateManager._dataManager,scene:this._parent,stateManager:this._stateManager,state:this,R:this._stateManager.R}}}]),State}();exports.default=State},function(module,exports){module.exports=__WEBPACK_EXTERNAL_MODULE_8__},function(module,exports,__webpack_require__){"use strict";function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}function _toConsumableArray(arr){if(Array.isArray(arr)){for(var i=0,arr2=Array(arr.length);i<arr.length;i++)arr2[i]=arr[i];return arr2}return Array.from(arr)}function _classCallCheck(instance,Constructor){if(!(instance instanceof Constructor))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(exports,"__esModule",{value:!0});var _createClass=function(){function defineProperties(target,props){for(var i=0;i<props.length;i++){var descriptor=props[i];descriptor.enumerable=descriptor.enumerable||!1,descriptor.configurable=!0,"value"in descriptor&&(descriptor.writable=!0),Object.defineProperty(target,descriptor.key,descriptor)}}return function(Constructor,protoProps,staticProps){return protoProps&&defineProperties(Constructor.prototype,protoProps),staticProps&&defineProperties(Constructor,staticProps),Constructor}}(),_lodash=__webpack_require__(1),_lodash2=_interopRequireDefault(_lodash),_experimentBabylonJs=__webpack_require__(4),_experimentBabylonJs2=_interopRequireDefault(_experimentBabylonJs),_bluebird=__webpack_require__(2),_bluebird2=_interopRequireDefault(_bluebird),_RessourceManager=__webpack_require__(6),_RessourceManager2=_interopRequireDefault(_RessourceManager),_State=__webpack_require__(7),_State2=_interopRequireDefault(_State),_DataManager=__webpack_require__(5),_DataManager2=_interopRequireDefault(_DataManager),_EventData=__webpack_require__(3),_EventData2=_interopRequireDefault(_EventData),_utilities=__webpack_require__(0),StateManager=function(){function StateManager(){var parent=arguments.length>0&&void 0!==arguments[0]?arguments[0]:(0,_utilities.mandatory)("parent"),dataManager=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;_classCallCheck(this,StateManager),this._parent=parent,this.dataManager=dataManager,void 0!==parent.parentTaskObject?(this._taskObject=parent.parentTaskObject,this.R=this._taskObject.R):this.R=new _RessourceManager2.default;var R=this.R;this._eventHeap=[],this._timeTriggerEvents=[],this.errorLog=[],this.R.add({states:{idle:"idle",pause:"pause",active:"active"},values:{timestampThreshold:1e8},events:{unfrozen:"eventUnfrozen"}},!1),this.states={idle:new _State2.default(this,R.get.states_idle),active:new _State2.default(this,R.get.states_active),pause:new _State2.default(this,R.get.states_pause)},this._currentStateKey=R.get.states_idle,this.frozenState=null,this.globals={},this.globalFunctions={}}return _createClass(StateManager,[{key:"update",value:function(){for(var _timeTriggerEvents,toSplice=[],i=0;i<this._timeTriggerEvents.length;i++)this.timeInMs>=this._timeTriggerEvents[i].happenedAt&&(this._timeTriggerEvents[i].happenedAt=this.timeInMs,this.addEvent(this._timeTriggerEvents[i]),toSplice.push(i));(_timeTriggerEvents=this._timeTriggerEvents).multisplice.apply(_timeTriggerEvents,toSplice),this.currentState.update()}},{key:"storeEvent",value:function(){var event=arguments.length>0&&void 0!==arguments[0]?arguments[0]:(0,_utilities.mandatory)();try{if(this.dataManager.constructor!==_DataManager2.default)throw new Error("StateManager.storeEvent: dataManager is not set, cannot store event.");if(!event.handled)throw(0,_utilities.debuglog)(event),new Error("StateManager.storeEvent:cannot store an event that was not handled.");if(event.stored)throw(0,_utilities.debuglog)(event),new Error("StateManager.storeEvent: Event already stored");event.storedInErrorLog=!1;var belongsTo=event.data.belongsTo;belongsTo.constructor!==Array&&(belongsTo=[belongsTo]);for(var i=0;i<belongsTo.length;i++)try{event.data.storedAt=this.timeInMs,event.stored=!0,(0,_utilities.debuglog)("StateManager.storeEvent: storing event."),this.dataManager.addRows(belongsTo[i],event.formatted),(0,_utilities.debuglog)("StateManager.storeEvent: event stored.",event)}catch(error){(0,_utilities.debugError)("StateManager.storeEvent: Could not store data in "+belongsTo[i]+" dataTable. Data was stored in the errorLog. DataManager error was: "+error),this.storeInErrorLog(event)}}catch(e){(0,_utilities.debugError)(e)}}},{key:"storeData",value:function(){var data=arguments.length>0&&void 0!==arguments[0]?arguments[0]:(0,_utilities.mandatory)();try{if(this.dataManager.constructor!==_DataManager2.default)throw new Error("StateManager.storeData: dataManager is not set, cannot store event.");if(!_lodash2.default.has(data,"belongsTo"))throw(0,_utilities.debuglog)(data),new Error("StateManager: data needs a belongsTo property in order to store it in the dataManager.");(0,_utilities.hasConstructor)(String,data.belongsTo)&&(data.belongsTo=[data.belongsTo]),data.storedInErrorLog=!1;for(var i=0;i<data.belongsTo.length;i++)try{this.dataManager.addRows(data.belongsTo[i],data)}catch(error){console.error("StateManager: Could not store data in "+data.belongsTo[i]+" dataTable. Data was stored in the errorLog. DataManager error was: "+error),this.storeInErrorLog(data)}}catch(e){(0,_utilities.debugError)(e)}}},{key:"storeInErrorLog",value:function(){var data=arguments.length>0&&void 0!==arguments[0]?arguments[0]:(0,_utilities.mandatory)();!1===data.storedInErrorLog?(data.storedInErrorLog=!0,this.errorLog=this.errorLog.concat(data),(0,_utilities.debuglog)("StateManager: data stored in the errorLog.")):(0,_utilities.debugWarn)("StateManager: data already stored in errorLog. Did not store it again.")}},{key:"addState",value:function(){try{for(var returnedStates=[],stateKey=void 0,_len=arguments.length,stateKeys=Array(_len),_key=0;_key<_len;_key++)stateKeys[_key]=arguments[_key];for(var i=0;i<stateKeys.length;i++){if(stateKey=stateKeys[i],stateKey.constructor!==String)throw new Error("StateManager: stateKey must be a string.");if(_lodash2.default.has(this.states,stateKey))throw new Error("StateManager: a state with a similar stateKey '"+stateKey+"' already exists.");this.states[stateKey]=new _State2.default(this,stateKey),(0,_utilities.debuglog)("StateManager: added state '"+stateKey+"'."),returnedStates.push(this.states[stateKey])}return 1===returnedStates.length?returnedStates[0]:returnedStates}catch(e){return(0,_utilities.debugError)(e),null}}},{key:"goToState",value:function(){var key=arguments.length>0&&void 0!==arguments[0]?arguments[0]:(0,_utilities.mandatory)(),reload=arguments.length>1&&void 0!==arguments[1]&&arguments[1];_lodash2.default.has(this.states,key)?(this.currentState.end(),this._currentStateKey=key,this.states[key].awake(reload)):(0,_utilities.debugError)("StateManager: Invalid state key.")}},{key:"addGuiCanvas",value:function(){try{var scene=this._parent;(0,_utilities.mustHaveConstructor)(_experimentBabylonJs2.default.Scene,scene);var canvasOptions={id:"GUI",backgroundFill:_experimentBabylonJs2.default.Canvas2D.GetSolidColorBrush(new _experimentBabylonJs2.default.Color4(0,0,0,0)),backgroundRoundRadius:0,x:0,y:0,zOrder:1},GUI=new _experimentBabylonJs2.default.ScreenSpaceCanvas2D(scene,canvasOptions);return GUI.levelVisible=!1,this.set("GUI",GUI),GUI}catch(e){return(0,_utilities.debugError)(e),null}}},{key:"tooltip",value:function(_ref){var _this=this,_ref$replace=_ref.replace,replace=void 0!==_ref$replace&&_ref$replace,_ref$position=_ref.position,position=void 0===_ref$position?null:_ref$position,_ref$size=_ref.size,size=void 0===_ref$size?null:_ref$size,_ref$spaced=_ref.spaced,spaced=void 0===_ref$spaced?null:_ref$spaced,_ref$text=_ref.text,text=void 0===_ref$text?"":_ref$text,_ref$fontName=_ref.fontName,fontName=void 0===_ref$fontName?"14pt Verdana":_ref$fontName,_ref$duration=_ref.duration,duration=void 0===_ref$duration?null:_ref$duration,_ref$event=_ref.event,event=void 0===_ref$event?new _EventData2.default(this.R.get.events_tooltipDismissed):_ref$event,_ref$background=_ref.background,background=void 0===_ref$background?null:_ref$background,_ref$fontColor=_ref.fontColor,fontColor=void 0===_ref$fontColor?null:_ref$fontColor;spaced=(0,_utilities.spreadToObject)(spaced,new _experimentBabylonJs2.default.Vector2(0,0)),null!==duration&&duration.constructor===_bluebird2.default||(duration=null!==duration&&duration.constructor===Number?(0,_utilities.delay)(duration):(new _utilities.Deferred).promise);var guiCanvas=this.get("GUI");guiCanvas.levelVisible=!0;var brownColor=[112/255,.4,98/255,.95],tooltips=this.get("tooltips",[]);tooltips.constructor===Object&&(tooltips=[tooltips]);var id=tooltips.length+1,tooltip=null;if(replace&&tooltips.length)tooltip=tooltips[tooltips.length-1];else if(tooltips.length){var _iteratorNormalCompletion=!0,_didIteratorError=!1,_iteratorError=void 0;try{for(var _step,_iterator=tooltips[Symbol.iterator]();!(_iteratorNormalCompletion=(_step=_iterator.next()).done);_iteratorNormalCompletion=!0){var temptool=_step.value;if(void 0!==temptool.box&&(temptool.box.zOrder=.01*(id-temptool.id),temptool.text.zOrder=.01*(id-temptool.id)-.001),void 0!==temptool.disposed&&temptool.disposed){temptool.box.zOrder=.001,temptool.text.zOrder=0,tooltip=temptool,background=(0,_utilities.spreadToObject)(background,new(Function.prototype.bind.apply(_experimentBabylonJs2.default.Color4,[null].concat(brownColor))));break}}}catch(err){_didIteratorError=!0,_iteratorError=err}finally{try{!_iteratorNormalCompletion&&_iterator.return&&_iterator.return()}finally{if(_didIteratorError)throw _iteratorError}}}if(null!==tooltip){tooltip.text.levelVisible=!0,tooltip.box.levelVisible=!0,tooltip.text.text=text;var tempPosition=tooltip.box.position.add((0,_utilities.sizeToVec)(tooltip.box.size).scale(.5));if(null===size?(tooltip.box.width=tooltip.text.size.width+24,tooltip.box.height=tooltip.text.size.height+24):(tooltip.box.width=size.width,tooltip.box.height=size.height),null!==background){background=(0,_utilities.spreadToObject)(background,new(Function.prototype.bind.apply(_experimentBabylonJs2.default.Color4,[null].concat(brownColor))));var brush=_experimentBabylonJs2.default.Canvas2D.GetSolidColorBrush(background);tooltip.box.fill=brush}fontColor=(0,_utilities.spreadToObject)(fontColor,new _experimentBabylonJs2.default.Color4(1,1,1,1)),tooltip.text.defaultFontColor=fontColor,position=(0,_utilities.spreadToObject)(position,tempPosition);var nextPos=position.subtract((0,_utilities.sizeToVec)(tooltip.box.size).scale(.5).add(spaced));tooltip.box.position=nextPos,tooltip.promise=duration,tooltip.event=event,tooltip.disposed=!1}else{position=(0,_utilities.spreadToObject)(position,new _experimentBabylonJs2.default.Vector2(0,0));var sizeDefault=(0,_utilities.spreadToObject)(size,new _experimentBabylonJs2.default.Size(300,300));background=(0,_utilities.spreadToObject)(background,new(Function.prototype.bind.apply(_experimentBabylonJs2.default.Color4,[null].concat(brownColor)))),fontColor=(0,_utilities.spreadToObject)(fontColor,new _experimentBabylonJs2.default.Color4(1,1,1,1));var _brush=_experimentBabylonJs2.default.Canvas2D.GetSolidColorBrush(background),tooltipBox=new _experimentBabylonJs2.default.Rectangle2D({parent:guiCanvas,id:"tooltipBox"+tooltips.length,width:sizeDefault.width,height:sizeDefault.height,fill:_brush}),tooltipText=new _experimentBabylonJs2.default.Text2D(text,{parent:tooltipBox,id:"tooltipText"+tooltips.length,marginAlignment:"h: center, v:center",defaultFontColor:fontColor,fontSuperSample:!1,fontSignedDistanceField:!0,fontName:fontName});null===size&&(tooltipBox.width=tooltipText.size.width+24,tooltipBox.height=tooltipText.size.height+24),tooltipBox.position=position.subtract((0,_utilities.sizeToVec)(tooltipBox.size).scale(.5).add(spaced)),tooltip={box:tooltipBox,text:tooltipText,promise:duration,id:id,disposed:!1,event:event},this.set("tooltips",tooltips.concat(tooltip))}return duration.then(function(){tooltip.promise===duration&&_this.hideTooltip(tooltip),event.constructor===_EventData2.default&&(event.happenedAt=_this.timeInMs,_this.addEvent(event))}),tooltip}},{key:"hideTooltip",value:function(){for(var _len2=arguments.length,tooltips=Array(_len2),_key2=0;_key2<_len2;_key2++)tooltips[_key2]=arguments[_key2];var allTooltips=this.get("tooltips",[]);0===tooltips.length&&(tooltips=allTooltips);var _iteratorNormalCompletion2=!0,_didIteratorError2=!1,_iteratorError2=void 0;try{for(var _step2,_iterator2=allTooltips[Symbol.iterator]();!(_iteratorNormalCompletion2=(_step2=_iterator2.next()).done);_iteratorNormalCompletion2=!0){var tooltip=_step2.value;-1!==tooltips.indexOf(tooltip)&&void 0!==tooltip.box&&(tooltip.box.levelVisible=!1,tooltip.disposed=!0)}}catch(err){_didIteratorError2=!0,_iteratorError2=err}finally{try{!_iteratorNormalCompletion2&&_iterator2.return&&_iterator2.return()}finally{if(_didIteratorError2)throw _iteratorError2}}}},{key:"setPauseKeyStroke",value:function(){var key=arguments.length>0&&void 0!==arguments[0]?arguments[0]:32,flag=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,addDefaultDesign=!(arguments.length>2&&void 0!==arguments[2])||arguments[2],pauseState=function(){var options=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null,state=this.state,stateManager=this.stateManager,R=this.R;return options.data.keyCode===key&&(state.freeze(),stateManager.goToState(R.get.states_pause)),"state.pauseState: resolved"},forcePause=function(){return this.state.freeze(),this.stateManager.goToState(this.R.get.states_pause),"state.forcePause: resolved"},unPause=function(){return(arguments.length>0&&void 0!==arguments[0]?arguments[0]:null).data.keyCode===key&&(null!==this.stateManager.frozenState?this.stateManager.goToState(this.stateManager.frozenState):(0,_utilities.debugError)("state.unPause: no frozen state !")),"state.unPause: resolved"};flag=null!==flag?flag:this.R.get.events.keydown;for(var stateKeys=this.stateKeys,i=0;i<stateKeys.length;i++)stateKeys[i]!==this.R.get.states_pause?(this.registerEventFunction(stateKeys[i],flag,pauseState),this.registerEventFunction(stateKeys[i],this.R.get.events_pause,forcePause)):(this.registerEventFunction(stateKeys[i],flag,unPause),this.registerEventFunction(stateKeys[i],this.R.get.events_pause,unPause));addDefaultDesign&&this.addDefaultPauseDesign()}},{key:"addDefaultPauseDesign",value:function(){if(null===_experimentBabylonJs2.default)return!1;var awakePause=function(){var options=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;try{if(void 0===this.taskObject)throw new Error("state.awakePause: taskObject is undefined");var stateManager=this.stateManager,pauseBackground2D=stateManager.get("pauseBackground2D"),canvas=this.scene.screenCanvas;if(null!==pauseBackground2D)pauseBackground2D.size=canvas.size,pauseBackground2D.levelVisible=!0;else{if(void 0===canvas)return"awakePause: initialCanvas is undefined.";var baseOptions={id:"pauseBackground2D",text:"Pause",x:0,y:0,width:canvas.width,height:canvas.height,fill:_experimentBabylonJs2.default.Canvas2D.GetSolidColorBrush(new _experimentBabylonJs2.default.Color4(.3,.3,.3,.5)),fontName:"40pt Verdana",backgroundRoundRadius:0};options=_lodash2.default.extend(baseOptions,options);var customSized=canvas.size;options.width===canvas.width&&options.height===canvas.height||(customSized=new _experimentBabylonJs2.default.Size(options.width,options.height));var canvasOptions={id:options.id,roundRadius:options.backgroundRoundRadius,fill:options.fill,parent:this.scene.screenCanvas,marginAlignment:"h:center, v: center",size:customSized,zOrder:0,children:[new _experimentBabylonJs2.default.Text2D(options.text,{fontName:options.fontName,marginAlignment:"h: center, v:top",fontSignedDistanceField:!0,zOrder:0})]},_pauseBackground2D=new _experimentBabylonJs2.default.Rectangle2D(canvasOptions);stateManager.set("pauseBackground2D",_pauseBackground2D)}return"state.awakePause: resolved"}catch(e){return(0,_utilities.debugError)(e),e}},endPause=function(){try{if(void 0===this.state)throw new Error("state.endPause: state is undefined");var stateManager=this.stateManager,pauseBackground2D=stateManager.get("pauseBackground2D");return null!==pauseBackground2D&&(pauseBackground2D.levelVisible=!1),"state.endPause: resolved"}catch(e){return(0,_utilities.debugError)(e),e}};return this.registerAwakeningFunction(this.R.get.states_pause,awakePause),this.registerEndingFunction(this.R.get.states_pause,endPause),!0}},{key:"stateWasFrozen",value:function(){var stateKey=arguments.length>0&&void 0!==arguments[0]?arguments[0]:(0,_utilities.mandatory)();this.frozenState=stateKey,this.emptyEventHeap(),this.emptyTimeTriggerEvents()}},{key:"stateWasUnfreezed",value:function(){var stateKey=arguments.length>0&&void 0!==arguments[0]?arguments[0]:(0,_utilities.mandatory)();this.frozenState!==stateKey?(0,_utilities.debugError)("StateManager.stateWasUnfreezed: stateKey does not correspond to the frozenState"):(this.newEvent(this.R.get.events_unfrozen),this.frozenState=null)}},{key:"addTimeTriggerEvent",value:function(){var event=arguments.length>0&&void 0!==arguments[0]?arguments[0]:(0,_utilities.mandatory)("event");event.constructor===_EventData2.default?event.happenedAt>this.timeInMs+40?(this._timeTriggerEvents.push(event),(0,_utilities.debuglog)("StateManager: Trigger event added to the time triggers.")):(this.addEvent(event),(0,_utilities.debugError)("StateManager.addTimeTriggerEvent: trigger event is to close to current time (<40ms). Added directly to the heap.")):(0,_utilities.debugError)("StateManager: Event is not of class EventData.")}},{key:"addEvent",value:function(){var event=arguments.length>0&&void 0!==arguments[0]?arguments[0]:(0,_utilities.mandatory)("event");event.constructor===_EventData2.default?(this._eventHeap.push(event),(0,_utilities.debuglog)("StateManager: Event added to the heap.")):(0,_utilities.debugError)("StateManager: Event is not of class EventData.")}},{key:"newEvent",value:function(){var flag=arguments.length>0&&void 0!==arguments[0]?arguments[0]:(0,_utilities.mandatory)(),time=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,data=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,belongsTo=arguments.length>3&&void 0!==arguments[3]?arguments[3]:["globalLog"];if(flag.constructor===_EventData2.default)return(0,_utilities.debuglog)("StateManager.newEvent: flag is an EventData object. Using addEvent()."),this.addEvent(flag),flag;if(belongsTo.constructor!==Array){if(belongsTo.constructor!==String)return(0,_utilities.debugError)("stateManager.newEvent: belongs to need to be either a string or an array"),null;belongsTo=[belongsTo]}else-1===belongsTo.indexOf("globalLog")&&belongsTo.push("globalLog");var eventOptions={belongsTo:belongsTo,handledAt:null,storedAt:null};if(null!==data?eventOptions.data=data:null!==time&&time.constructor===Object&&null===data&&(eventOptions.data=time,time=null),null===time){(0,_utilities.debuglog)("stateManager.newEvent: time is null, using addEvent() with this.timeInMs.");var _event=new _EventData2.default(flag,this.timeInMs,eventOptions);return this.addEvent(_event),_event}time<this.R.get.values_timestampThreshold&&(time+=this.timeInMs);var event=new _EventData2.default(flag,time,eventOptions);return this.addTimeTriggerEvent(event),event}},{key:"removeFirstEvent",value:function(){this._eventHeap.splice(0,1)}},{key:"removeEvent",value:function(event){this._eventHeap=_lodash2.default.without(this._eventHeap,event)}},{key:"getFirstEventAndRemoveFromHeap",value:function(){for(var byState=arguments.length>0&&void 0!==arguments[0]?arguments[0]:this.currentStateKey,i=0;i<this._eventHeap.length;i++){var event=this._eventHeap[i];if("any"===event.forState||event.forState===byState)return this._eventHeap.splice(i)}}},{key:"spliceEventsForState",value:function(){for(var _eventHeap,byState=arguments.length>0&&void 0!==arguments[0]?arguments[0]:this.currentStateKey,toSplice=[],i=0;i<this._eventHeap.length;i++){var event=this._eventHeap[i];"any"!==event.forState&&event.forState!==byState||toSplice.push(i)}return(_eventHeap=this._eventHeap).multisplice.apply(_eventHeap,toSplice)}},{key:"emptyEventHeap",value:function(){this._eventHeap=[]}},{key:"emptyTimeTriggerEvents",value:function(){this._timeTriggerEvents=[]}},{key:"getAllEvents",value:function(){return this._eventHeap.concat(this._timeTriggerEvents)}},{key:"stateHasFinishedHandlingEvent",value:function(event){event.data.handledAt=this.timeInMs,event.handled=!0,(0,_utilities.debuglog)("StateManager.stateHasFinishedHandlingEvent: event was handled."),this.dataManager.constructor===_DataManager2.default&&event.toStore?this.storeEvent(event):(0,_utilities.debugWarn)("StateManager.stateHasFinishedHandlingEvent: dataManager is not set, not storing event.")}},{key:"freezeEventHeap",value:function(){this.eventHeapIsFrozen=!0,this.frozenEventHeap=this._eventHeap}},{key:"unfreezeEventHeap",value:function(){var storeFrozenEvents=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];this.eventHeapIsFrozen=!1,storeFrozenEvents&&this.emptyEventHeap()}},{key:"registerEventFunction",value:function(stateKey,eventFlag){try{for(var _len3=arguments.length,handlingFunctions=Array(_len3>2?_len3-2:0),_key3=2;_key3<_len3;_key3++)handlingFunctions[_key3-2]=arguments[_key3];if(_utilities.mustBeDefined.apply(void 0,[stateKey,eventFlag].concat(handlingFunctions)),_utilities.mustHaveConstructor.apply(void 0,[Function].concat(handlingFunctions)),!_lodash2.default.has(this.states,stateKey))throw new Error("StateManager: Invalid state key '"+stateKey+"'. Create the state before adding event handling functions.");var _states$stateKey;(_states$stateKey=this.states[stateKey]).registerEventFunctions.apply(_states$stateKey,[eventFlag,!0].concat(handlingFunctions))}catch(e){(0,_utilities.debugError)(e)}}},{key:"onNext",value:function(eventFlag){for(var _currentState,_len4=arguments.length,handlingFunctions=Array(_len4>1?_len4-1:0),_key4=1;_key4<_len4;_key4++)handlingFunctions[_key4-1]=arguments[_key4];return(_currentState=this.currentState).onNext.apply(_currentState,[eventFlag].concat(handlingFunctions))}},{key:"resolveOnKey",value:function(){var _currentState2;return(_currentState2=this.currentState).resolveOnKey.apply(_currentState2,arguments)}},{key:"resolveOnClick",value:function(){var _currentState3;return(_currentState3=this.currentState).resolveOnClick.apply(_currentState3,arguments)}},{key:"registerAwakeningFunction",value:function(){var stateKey=arguments.length>0&&void 0!==arguments[0]?arguments[0]:(0,_utilities.mandatory)(),handlingFunction=arguments.length>1&&void 0!==arguments[1]?arguments[1]:(0,_utilities.mandatory)(),overwrite=arguments.length>2&&void 0!==arguments[2]&&arguments[2];_lodash2.default.has(this.states,stateKey)?this.states[stateKey].registerCycleFunctions("awakening",overwrite,handlingFunction):(0,_utilities.debugError)("StateManager: Invalid state key '"+stateKey+"'. Create the state before adding awakening handling functions.")}},{key:"registerEndingFunction",value:function(){var stateKey=arguments.length>0&&void 0!==arguments[0]?arguments[0]:(0,_utilities.mandatory)(),handlingFunction=arguments.length>1&&void 0!==arguments[1]?arguments[1]:(0,_utilities.mandatory)(),overwrite=arguments.length>2&&void 0!==arguments[2]&&arguments[2];_lodash2.default.has(this.states,stateKey)?this.states[stateKey].registerCycleFunctions("ending",overwrite,handlingFunction):(0,_utilities.debugError)("StateManager: Invalid state key '"+stateKey+"'. Create the state before adding awakening handling functions.")}},{key:"registerUpdateFunction",value:function(){var stateKey=arguments.length>0&&void 0!==arguments[0]?arguments[0]:(0,_utilities.mandatory)(),handlingFunction=arguments.length>1&&void 0!==arguments[1]?arguments[1]:(0,_utilities.mandatory)(),overwrite=arguments.length>2&&void 0!==arguments[2]&&arguments[2];_lodash2.default.has(this.states,stateKey)?(this.states[stateKey].registerCycleFunctions("udpate",overwrite,handlingFunction),(0,_utilities.debuglog)("StateManager: handling function added to awakeningFunctions array for state '"+stateKey+"'")):(0,_utilities.debugError)("StateManager: Invalid state key '"+stateKey+"'. Create the state before adding awakening handling functions.")}},{key:"registerGlobalFunction",value:function(){var func=arguments.length>0&&void 0!==arguments[0]?arguments[0]:(0,_utilities.mandatory)(),name=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;func.constructor!==Function?(0,_utilities.debugError)("StateManager.registerGlobalFunction: func is not a function"):(null===name&&(name=func.name),this.globalFunctions[name]=func)}},{key:"register",value:function(){for(var _len5=arguments.length,functions=Array(_len5),_key5=0;_key5<_len5;_key5++)functions[_key5]=arguments[_key5];for(var i=0;i<functions.length;i++)this.registerGlobalFunction(functions[i])}},{key:"callGlobalFunction",value:function(name){for(var _len6=arguments.length,args=Array(_len6>1?_len6-1:0),_key6=1;_key6<_len6;_key6++)args[_key6-1]=arguments[_key6];this.call.apply(this,[name].concat(args))}},{key:"call",value:function(name){if(void 0===name)(0,_utilities.debugError)("StateManager.call: name of the function needs to be defined.");else{if(_lodash2.default.has(this.globalFunctions,name)){for(var _len7=arguments.length,args=Array(_len7>1?_len7-1:0),_key7=1;_key7<_len7;_key7++)args[_key7-1]=arguments[_key7];return this.globalFunctions[name].bind(this.context).apply(void 0,args)}(0,_utilities.debugWarn)("StateManager.call: globals do not contain function '"+name+"'")}}},{key:"promise",value:function(name){if(void 0===name)(0,_utilities.debugError)("StateManager.promiseGlobalFunction: name is undefined.");else{if(_lodash2.default.has(this.globalFunctions,name)){for(var _len8=arguments.length,args=Array(_len8>1?_len8-1:0),_key8=1;_key8<_len8;_key8++)args[_key8-1]=arguments[_key8];return _bluebird2.default.method(this.globalFunctions[name]).bind(this.context).apply(void 0,args)}(0,_utilities.debugWarn)("StateManager.promiseGlobalFunction: globals do not contain function '"+name+"'")}}},{key:"recurseOnGlobalFunction",value:function(){var name=arguments.length>0&&void 0!==arguments[0]?arguments[0]:(0,_utilities.mandatory)(),amount=arguments.length>1&&void 0!==arguments[1]?arguments[1]:(0,_utilities.mandatory)(),_this2=this,args=arguments.length>2&&void 0!==arguments[2]?arguments[2]:[],results=arguments.length>3&&void 0!==arguments[3]?arguments[3]:[];return _lodash2.default.has(this.globalFunctions,name)?0===amount?new _bluebird2.default(function(resolve){resolve(results)}):this.promise.apply(this,[name].concat(_toConsumableArray(args))).then(function(r){return results=results.concat(r),_this2.recurseOnGlobalFunction(name,amount-1,args,results)}):((0,_utilities.debugError)("StateManager.recurseOnGlobalFunction: globals do not contain function '"+name+"'"),null)}},{key:"recurse",value:function(){var name=arguments.length>0&&void 0!==arguments[0]?arguments[0]:(0,_utilities.mandatory)(),amount=arguments.length>1&&void 0!==arguments[1]?arguments[1]:(0,_utilities.mandatory)(),args=arguments.length>2&&void 0!==arguments[2]?arguments[2]:[],results=arguments.length>3&&void 0!==arguments[3]?arguments[3]:[];this.recurseOnGlobalFunction(name,amount,args,results)}},{key:"getGlobal",value:function(){var name=arguments.length>0&&void 0!==arguments[0]?arguments[0]:(0,_utilities.mandatory)(),setDefault=arguments[1];return this.globals.hasOwnProperty(name)?this.globals[name]:void 0!==setDefault?(this.globals[name]=setDefault,this.globals[name]):((0,_utilities.debugWarn)("StateManager: globals do not contain variable '"+name+"' - and no default is given"),null)}},{key:"get",value:function(){var name=arguments.length>0&&void 0!==arguments[0]?arguments[0]:(0,_utilities.mandatory)(),setDefault=arguments[1];return this.getGlobal(name,setDefault)}},{key:"setGlobal",value:function(){var name=arguments.length>0&&void 0!==arguments[0]?arguments[0]:(0,_utilities.mandatory)(),value=arguments.length>1&&void 0!==arguments[1]?arguments[1]:(0,_utilities.mandatory)();this.globals[name]=value,(0,_utilities.debuglog)("StateManager: global '"+name+"' set to '"+value+"'")}},{key:"set",value:function(){var name=arguments.length>0&&void 0!==arguments[0]?arguments[0]:(0,_utilities.mandatory)(),value=arguments.length>1&&void 0!==arguments[1]?arguments[1]:(0,_utilities.mandatory)();this.setGlobal(name,value)}},{key:"getStateObject",value:function(key){if(_lodash2.default.has(this.states,key))return this.states[key];(0,_utilities.debugError)("StateManager: Invalid state key.")}},{key:"context",get:function(){return this._taskObject?this._taskObject.getContext(this):{taskObject:null,dataManager:this.dataManager,scene:this._parent,stateManager:this,state:this.currentState,R:this.R}}},{key:"stateKeys",get:function(){return Object.keys(this.states)}},{key:"currentStateKey",get:function(){return this._currentStateKey},set:function(key){_lodash2.default.has(this.states,key)?this.goToState(key):(0,_utilities.debugError)("StateManager: Invalid state key.")}},{key:"currentState",get:function(){return this.states[this.currentStateKey]},set:function(state){void 0!==state.key?this.currentStateKey=state.key:(0,_utilities.debugError)("StateManager: Invalid state, it has no state key defined.")}},{key:"eventHeap",get:function(){return this._eventHeap},set:function(value){(0,_utilities.debugError)("StateManager: eventHeap is readonly. Add events through the class methods.")}},{key:"firstEvent",get:function(){if(this._eventHeap.length)return this._eventHeap[0]},set:function(value){(0,_utilities.debugError)("StateManager: firstEvent is readonly.")}},{key:"time",get:function(){return this.timeInMs}},{key:"timeInSec",get:function(){return(new Date).getTime()/1e3}},{key:"timeInMs",get:function(){return(new Date).getTime()}}]),StateManager}();exports.default=StateManager},function(module,exports){function defaultSetTimout(){throw new Error("setTimeout has not been defined")}function defaultClearTimeout(){throw new Error("clearTimeout has not been defined")}function runTimeout(fun){if(cachedSetTimeout===setTimeout)return setTimeout(fun,0);if((cachedSetTimeout===defaultSetTimout||!cachedSetTimeout)&&setTimeout)return cachedSetTimeout=setTimeout,setTimeout(fun,0);try{return cachedSetTimeout(fun,0)}catch(e){try{return cachedSetTimeout.call(null,fun,0)}catch(e){return cachedSetTimeout.call(this,fun,0)}}}function runClearTimeout(marker){if(cachedClearTimeout===clearTimeout)return clearTimeout(marker);if((cachedClearTimeout===defaultClearTimeout||!cachedClearTimeout)&&clearTimeout)return cachedClearTimeout=clearTimeout,clearTimeout(marker);try{return cachedClearTimeout(marker)}catch(e){try{return cachedClearTimeout.call(null,marker)}catch(e){return cachedClearTimeout.call(this,marker)}}}function cleanUpNextTick(){draining&&currentQueue&&(draining=!1,currentQueue.length?queue=currentQueue.concat(queue):queueIndex=-1,queue.length&&drainQueue())}function drainQueue(){if(!draining){var timeout=runTimeout(cleanUpNextTick);draining=!0;for(var len=queue.length;len;){for(currentQueue=queue,queue=[];++queueIndex<len;)currentQueue&&currentQueue[queueIndex].run();queueIndex=-1,len=queue.length}currentQueue=null,draining=!1,runClearTimeout(timeout)}}function Item(fun,array){this.fun=fun,this.array=array}function noop(){}var cachedSetTimeout,cachedClearTimeout,process=module.exports={};!function(){try{cachedSetTimeout="function"==typeof setTimeout?setTimeout:defaultSetTimout}catch(e){cachedSetTimeout=defaultSetTimout}try{cachedClearTimeout="function"==typeof clearTimeout?clearTimeout:defaultClearTimeout}catch(e){cachedClearTimeout=defaultClearTimeout}}();var currentQueue,queue=[],draining=!1,queueIndex=-1;process.nextTick=function(fun){var args=new Array(arguments.length-1);if(arguments.length>1)for(var i=1;i<arguments.length;i++)args[i-1]=arguments[i];queue.push(new Item(fun,args)),1!==queue.length||draining||runTimeout(drainQueue)},Item.prototype.run=function(){this.fun.apply(null,this.array)},process.title="browser",process.browser=!0,process.env={},process.argv=[],process.version="",process.versions={},process.on=noop,process.addListener=noop,process.once=noop,process.off=noop,process.removeListener=noop,process.removeAllListeners=noop,process.emit=noop,process.prependListener=noop,process.prependOnceListener=noop,process.listeners=function(name){return[]},process.binding=function(name){throw new Error("process.binding is not supported")},process.cwd=function(){return"/"},process.chdir=function(dir){throw new Error("process.chdir is not supported")},process.umask=function(){return 0}},function(module,exports){var g;g=function(){return this}();try{g=g||Function("return this")()||(0,eval)("this")}catch(e){"object"==typeof window&&(g=window)}module.exports=g},function(module,exports){module.exports=__WEBPACK_EXTERNAL_MODULE_12__},function(module,exports){module.exports=__WEBPACK_EXTERNAL_MODULE_13__},function(module,exports,__webpack_require__){"use strict";function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}function _defineProperty(obj,key,value){return key in obj?Object.defineProperty(obj,key,{value:value,enumerable:!0,configurable:!0,writable:!0}):obj[key]=value,obj}function _classCallCheck(instance,Constructor){if(!(instance instanceof Constructor))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(exports,"__esModule",{value:!0});var _createClass=function(){function defineProperties(target,props){for(var i=0;i<props.length;i++){var descriptor=props[i];descriptor.enumerable=descriptor.enumerable||!1,descriptor.configurable=!0,"value"in descriptor&&(descriptor.writable=!0),Object.defineProperty(target,descriptor.key,descriptor)}}return function(Constructor,protoProps,staticProps){return protoProps&&defineProperties(Constructor.prototype,protoProps),staticProps&&defineProperties(Constructor,staticProps),Constructor}}(),_lodash=__webpack_require__(1),_lodash2=_interopRequireDefault(_lodash),_experimentBabylonJs=__webpack_require__(4),_experimentBabylonJs2=_interopRequireDefault(_experimentBabylonJs),_experimentBoxes=__webpack_require__(12),_bluebird=__webpack_require__(2),_bluebird2=_interopRequireDefault(_bluebird),_experimentMathjs=__webpack_require__(13),_experimentMathjs2=_interopRequireDefault(_experimentMathjs),_DataManager=__webpack_require__(5),_DataManager2=_interopRequireDefault(_DataManager),_RessourceManager=__webpack_require__(6),_RessourceManager2=_interopRequireDefault(_RessourceManager),_EventData=__webpack_require__(3),_EventData2=_interopRequireDefault(_EventData),_StateManager=__webpack_require__(9),_StateManager2=_interopRequireDefault(_StateManager),_State=__webpack_require__(7),_State2=_interopRequireDefault(_State),_utilities=__webpack_require__(0);if("undefined"!=typeof window){var scripts=document.getElementsByTagName("script");if(scripts.length){var assetsFolderFullpath=scripts[scripts.length-1].src,delimiterIndices=assetsFolderFullpath.indicesOf("/");window.assetsFolderFullpath=assetsFolderFullpath.substr(0,delimiterIndices[delimiterIndices.length-2])}else window.assetsFolderFullpath="./"}var TaskObject=function(){function TaskObject(){var target=arguments.length>0&&void 0!==arguments[0]?arguments[0]:(0,_utilities.mandatory)(),assetsFolder=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,engine=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"babylon";if(_classCallCheck(this,TaskObject),"undefined"==typeof window)return{error:"Wrong environment. ExperimentJS only works in the browser."};if(this._target=void 0!==target.length?target[0]:target,this.canvas=this._target,"babylon"!==engine)throw new Error("TaskObject.constructor: engine not supported.");this.engine=new _experimentBabylonJs2.default.Engine(this.canvas,!1,null,!1),this.height=window.innerHeight,this.width=window.innerWidth,this.babylonCanvasHeight=this.canvas.height,this.babylonCanvasWidth=this.canvas.width,this.dataManager=new _DataManager2.default(this),this.connection=null;var globalLogFields=this.dataManager.GLOBAL_LOG_FIELDS;this.dataManager.addTable("keyEvents",globalLogFields),this.dataManager.addTable("mouseEvents",globalLogFields);var taskStatusFields=["level","happenedAt"];this.dataManager.addTable("taskStatus",taskStatusFields);var statusFlagsFields=["flag","happenedAt"];this.dataManager.addTable("statusFlags",statusFlagsFields);var checkpointFields=["code","happenedAt","message"];this.dataManager.addTable("checkpoints",checkpointFields),this.ASSETS_FOLDER=assetsFolder||window.assetsFolderFullpath,this.ASSETS_FLARE_PATH=this.ASSETS_FOLDER+"/textures/flare/flare.png",this.assetsToLoad={},this.R=new _RessourceManager2.default,this.R.add({states:{active:"active",idle:"idle",pause:"pause"},folders:{assetsFolder:assetsFolder||window.assetsFolderFullpath}}),this.flags={},this.keyState=[],this.shouldShowDebug=void 0!==window.DEBUG_MODE_ONE&&window.DEBUG_MODE_ONE,this.setupGlobalEvents(),this.currentModal=null,this.parameters={},this.variables={},this.variables.shouldSeeInformation=!0,this.scenes={},this.sceneGenerators={},this.sceneGenerators.functions={},this.sceneGenerators.functionsOptions={},this.sceneGenerators.loading=TaskObject.default2dSceneGenerator,this.sceneGenerators.loadingOptions={sceneKey:"loading",shouldLoadAssets:!0},this._currentSceneKey="",this._paramBox=null,"function"==typeof _experimentBoxes.ParamBox&&(this._paramBox=new _experimentBoxes.ParamBox)}return _createClass(TaskObject,[{key:"registerSceneGenerator",value:function(){var sceneGenerator=arguments.length>0&&void 0!==arguments[0]?arguments[0]:(0,_utilities.mandatory)("sceneGenerator"),options=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},loading=arguments.length>2&&void 0!==arguments[2]&&arguments[2],key=(arguments.length>3&&void 0!==arguments[3]&&arguments[3],arguments.length>4&&void 0!==arguments[4]?arguments[4]:null);options=_lodash2.default.clone(options),key=null===key&&""!==sceneGenerator.name?sceneGenerator.name:"scene"+Object.keys(this.sceneGenerators.functions).length,loading?(this.sceneGenerators.loading=sceneGenerator,this.sceneGenerators.loadingOptions=options):(this.sceneGenerators.functions[key]=sceneGenerator,this.sceneGenerators.functionsOptions[key]=options)}},{key:"registerLoadingFunction",value:function(){var loadingSceneGenerator=arguments.length>0&&void 0!==arguments[0]?arguments[0]:(0,_utilities.mandatory)("loadingSceneGenerator"),options=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},promise=arguments.length>2&&void 0!==arguments[2]&&arguments[2];options.sceneKey="loading",this.registerSceneGenerator(loadingSceneGenerator,options,!0,promise)}},{key:"callSceneGenerator",value:function(){var _this=this,key=arguments.length>0&&void 0!==arguments[0]?arguments[0]:(0,_utilities.mandatory)(),sceneOptions=this.sceneGenerators.functionsOptions[key],generator=this.sceneGenerators.functions[key];return _bluebird2.default.method(generator.bind(this.context))(sceneOptions).then(function(scene){void 0===scene.sceneKey&&(scene.sceneKey=key),_this.scenes[scene.sceneKey]=scene})}},{key:"generateScenes",value:function(){for(var functionKeys=Object.keys(this.sceneGenerators.functions),promises=[],i=0;i<functionKeys.length;i++)promises.push(this.callSceneGenerator(functionKeys[i]));return _bluebird2.default.all(promises)}},{key:"cloneAssetsIntoScene",value:function(){var assets=arguments.length>0&&void 0!==arguments[0]?arguments[0]:(0,_utilities.mandatory)(),scene=arguments.length>1&&void 0!==arguments[1]?arguments[1]:(0,_utilities.mandatory)();assets.constructor!==_utilities.Array&&(assets=[assets]);for(var assetsArray=[],i=0;i<assets.length;i++){var clone=assets[i].clone();if(clone._scene=scene,assets[i].constructor===_experimentBabylonJs2.default.Mesh){if(clone.material&&(clone.material=clone.material.clone(),clone.material._scene=scene,clone.material.subMaterials))for(var j=0;j<clone.material.subMaterials.length;j++)clone.material.subMaterials[j]=clone.material.subMaterials[j].clone(),clone.material.subMaterials[j]._scene=scene;scene.addMesh(clone)}assetsArray.push(clone)}return assetsArray}},{key:"loadAssets",value:function(){var assetObject=arguments.length>0&&void 0!==arguments[0]?arguments[0]:(0,_utilities.mandatory)(),scene=arguments.length>1&&void 0!==arguments[1]?arguments[1]:(0,_utilities.mandatory)(),assetFolder=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"";if(assetObject.constructor!==Object)throw new Error("TaskObject.loadAssets: assetObject is not an Object");""===assetFolder&&void 0!==this.ASSETS_FOLDER&&(assetFolder=this.ASSETS_FOLDER);for(var textureFormats=["png","bmp","jpg","tiff","svg"],soundFormats=["wav","mp3","flac","aac","mp4","ogg"],assetManager=new _experimentBabylonJs2.default.AssetsManager(scene),R=this.R,binaryPromises=[],names=Object.keys(assetObject),field=void 0,type=void 0,path=void 0,i=0;i<names.length;i++)if(field=assetObject[names[i]],field.constructor===_utilities.String?(path=this.ASSETS_FOLDER+field,-1!==textureFormats.indexOf(R.getFormat(path))?type="texture":-1!==soundFormats.indexOf(R.getFormat(path))?type="sound":(console.warn("TaskObject.loadAssets: asset invalid or not implemented with shorthand string definition (use full object with path and type)"),type="invalid")):field.constructor===Object&&Object.keys(field).includes(["path","type"])?(path=this.ASSETS_FOLDER+field.path,type=field.type):(console.warn("TaskObject.loadAssets: asset invalid"),type="invalid"),"texture"===type){var assetManagerTask=assetManager.addTextureTask(names[i]+"Task",path);assetManagerTask.onSuccess=function(task){R.add({textures:_defineProperty({},this.textureName,task.texture)})}.bind({textureName:names[i]})}else if("sound"===type){var _assetManagerTask=assetManager.addBinaryFileTask(names[i]+"Task",path);_assetManagerTask.onSuccess=function(task){var isReady=new _utilities.Deferred;binaryPromises.push(isReady.promise),R.add({sounds:_defineProperty({},this.soundName,new _experimentBabylonJs2.default.Sound(this.soundName,task.data,scene,isReady.resolve))})}.bind({soundName:names[i]})}var loadDeferred=new _utilities.Deferred;return assetManager.load(),assetManager.onFinish=function(tasks){(0,_utilities.debuglog)("TaskObject.loadAssets: tasks completed",tasks),_bluebird2.default.all(binaryPromises).then(function(){return loadDeferred.resolve(tasks)})},loadDeferred.promise}},{key:"cloneAssetIntoScene",value:function(){var asset=arguments.length>0&&void 0!==arguments[0]?arguments[0]:(0,_utilities.mandatory)(),scene=arguments.length>1&&void 0!==arguments[1]?arguments[1]:(0,_utilities.mandatory)();if(asset.constructor===_utilities.Array)return this.cloneAssetsIntoScene(asset,scene);var clone=asset.clone();if(clone._scene=scene,asset.constructor===_experimentBabylonJs2.default.Mesh){if(clone.material&&(clone.material=clone.material.clone(),clone.material._scene=scene,clone.material.subMaterials))for(var i=0;i<clone.material.subMaterials.length;i++)clone.material.subMaterials[i]=clone.material.subMaterials[i].clone(),clone.material.subMaterials[i]._scene=scene;scene.addMesh(clone)}return clone}},{key:"startTask",value:function(){var _this2=this;if("undefined"==typeof window)return _bluebird2.default.resolve();window.addEventListener("resize",function(){_this2.engine.resize()});var deferred=new _utilities.Deferred,loadingOptions=this.sceneGenerators.loadingOptions,loadingScene=this.sceneGenerators.loading.bind(this.context)(loadingOptions);return loadingScene.loadingPromise.then(function(){return _this2.scenes.loading=loadingScene,_this2.currentScene=loadingScene.sceneKey,void 0!==loadingScene.loadingPromise&&loadingScene.loadingPromise.constructor===_bluebird2.default?loadingScene.loadingPromise:_bluebird2.default.resolve()}).then(function(){return _this2.dataManager.addRows("statusFlags",{flag:_this2.R.get.flags_hasLoaded,happenedAt:_this2.timeInMs}),_this2.engine.runRenderLoop(function(){_this2.scenes[_this2.currentScene].render()}),_this2.generateScenes()}).then(function(message){(0,_utilities.debuglog)(message),deferred.resolve("TaskObject.startTask: loaded and scene generated.")}),deferred.promise}},{key:"setupGlobalEvents",value:function(){var _this3=this,R=this.R;R.add({flags:{hasLoaded:"hasLoaded",sceneStarts:"scene_starts",sceneEnds:"scene_ends"},events:{mouseMove:"mouse_move",click:"mouse_click",pick:"mouse_pick",keydown:"key_down",keyup:"key_up",resize:"resize",windowFocus:"windowFocus",windowBlur:"windowBlur",pause:"pause",wasHandled:"was_handled",beingHandled:"being_handled",modalDismissed:"modalDismissed",tooltipDismissed:"tooltipDismissed"}}),window.addEventListener("keydown",function(evt){(0,_utilities.debuglog)("TaskObject: Keydown event."),(0,_utilities.debuglog)(evt),_this3.keyfunction(evt);var eventData=new _EventData2.default(R.get.events_keydown,_this3.timeInMs,{belongsTo:["globalLog","keyEvents"],handledAt:null,storedAt:null,keyCode:evt.keyCode,key:evt.key});void 0!==_this3.currentSceneObject&&void 0!==_this3.currentSceneObject.stateManager&&_this3.currentSceneObject.stateManager.addEvent(eventData)}),window.addEventListener("keyup",function(evt){_this3.keyfunction(evt)}),window.addEventListener("mousedown",function(evt){(0,_utilities.debuglog)("TaskObject: mousedown event."),(0,_utilities.debuglog)(evt);var eventData=new _EventData2.default(R.get.events_click,(new Date).getTime(),{belongsTo:["globalLog","mouseEvents"],handledAt:null,storedAt:null,clientX:evt.clientX,clientY:evt.clientY,engineX:evt.clientX*(_this3.renderSize.width/window.innerWidth),engineY:(window.innerHeight-evt.clientY)*(_this3.renderSize.height/window.innerHeight)});void 0!==_this3.currentSceneObject&&void 0!==_this3.currentSceneObject.stateManager&&_this3.currentSceneObject.stateManager.addEvent(eventData)}),window.addEventListener("resize",function(evt){(0,_utilities.debuglog)("TaskObject: resize event."),(0,_utilities.debuglog)(evt);var eventData=new _EventData2.default(R.get.events_resize,_this3.timeInMs,{belongsTo:["globalLog"],handledAt:null,storedAt:null,outerHeight:evt.target.outerHeight,outerWidth:evt.target.outerWidth});if(void 0!==_this3.currentSceneObject)try{_this3.addEventToCurrentScene(eventData)}catch(e){console.error(e)}finally{void 0!==_this3.currentSceneObject.updateContentFrame&&_this3.currentSceneObject.updateContentFrame()}});var checkFocus=function(){var event=R.get.events_windowBlur;document.hasFocus()&&(event=R.get.events_windowFocus),this.addEventToCurrentScene(new _EventData2.default(event,this.timeInMs))}.bind(this),visibilityChange=void 0;void 0!==document.hidden?visibilityChange="visibilitychange":void 0!==document.mozHidden?visibilityChange="mozvisibilitychange":void 0!==document.msHidden?visibilityChange="msvisibilitychange":void 0!==document.webkitHidden&&(visibilityChange="webkitvisibilitychange"),document.addEventListener(visibilityChange,checkFocus),window.addEventListener("focus",checkFocus),window.addEventListener("blur",checkFocus)}},{key:"keyfunction",value:function(e){this.keyState[e.keyCode]="keydown"===e.type,this.keyState[16]&&this.keyState[18]&&this.keyState[68]&&(this.keyState[68]=!1,this.keyState[18]=!1,this.toggleDebugLayer(),e.preventDefault())}},{key:"addStateManager",value:function(){var scene=arguments.length>0&&void 0!==arguments[0]?arguments[0]:(0,_utilities.mandatory)("scene");scene.stateManager=new _StateManager2.default(scene,this.dataManager)}},{key:"addEventToCurrentScene",value:function(){var eventData=arguments.length>0&&void 0!==arguments[0]?arguments[0]:(0,_utilities.mandatory)();try{if(void 0===this.currentSceneObject)throw new Error("TaskObject.addEventToCurrentScene: No current scene object");if(void 0===this.currentSceneObject.stateManager)throw new Error("TaskObject.addEventToCurrentScene: No stateManager in currentSceneObject");this.currentSceneObject.stateManager.addEvent(eventData)}catch(e){(0,_utilities.debugError)(e)}}},{key:"create2DScene",value:function(){var _this4=this,options=arguments.length>0&&void 0!==arguments[0]?arguments[0]:(0,_utilities.mandatory)(),optionsBase={sceneKey:"scene"+1e5*Math.random(),canvasBackground:new _experimentBabylonJs2.default.Color4(0,0,0,1),backgroundRoundRadius:0,clearColor:new _experimentBabylonJs2.default.Color4(0,0,0,1),width:null,height:null,canvasPercentWidth:1,canvasPercentHeight:1,minWidth:Number.NEGATIVE_INFINITY,minHeight:Number.NEGATIVE_INFINITY,maxWidth:Number.POSITIVE_INFINITY,maxHeight:Number.POSITIVE_INFINITY};options=_lodash2.default.extend(optionsBase,options);var getCanvasDimensions=function(){var noNull=!(arguments.length>0&&void 0!==arguments[0])||arguments[0],size=null,width=null,height=null,pWidth=(_this4.renderSize.width*options.canvasPercentWidth).boundTo(options.minWidth,options.maxWidth),pHeight=(_this4.renderSize.height*options.canvasPercentHeight).boundTo(options.minWidth,options.maxHeight),x=null,y=null;return options.width?width=options.width:1!==options.canvasPercentWidth&&(width=pWidth),options.height?height=options.height:1!==options.canvasPercentHeight&&(height=pHeight),(null!==height||null!==width||noNull)&&(size=new _experimentBabylonJs2.default.Size(null!==width?width:pWidth,null!==height?height:pHeight),x=_this4.renderSize.width/2-_this4.renderSize.width*options.canvasPercentWidth/2,y=_this4.renderSize.height/2-_this4.renderSize.height*options.canvasPercentHeight/2),{size:size,x:x,y:y}},_getCanvasDimensions=getCanvasDimensions(),customSized=_getCanvasDimensions.size,scene=new _experimentBabylonJs2.default.Scene(this.engine);scene.sceneKey=options.sceneKey,scene.parentTaskObject=this,this.addStateManager(scene),scene.clearColor=options.clearColor;var camera=new _experimentBabylonJs2.default.ArcRotateCamera("Camera",0,Math.PI/2,12,_experimentBabylonJs2.default.Vector3.Zero(),scene),canvasOptions={id:"ScreenCanvas",backgroundFill:_experimentBabylonJs2.default.Canvas2D.GetSolidColorBrush(options.clearColor),fill:_experimentBabylonJs2.default.Canvas2D.GetSolidColorBrush(options.clearColor),zOrder:1},canvas=new _experimentBabylonJs2.default.ScreenSpaceCanvas2D(scene,canvasOptions);canvasOptions={id:"initialCanvas",parent:canvas,roundRadius:options.backgroundRoundRadius,borderThickness:0,fill:_experimentBabylonJs2.default.Canvas2D.GetSolidColorBrush(options.canvasBackground),marginAlignment:"h: center, v: center",size:customSized,zOrder:1};var initialCanvas=new _experimentBabylonJs2.default.Rectangle2D(canvasOptions);scene.screenCanvas=canvas,scene.initialCanvas=initialCanvas,scene.initialCamera=camera,scene.initialCanvas.lastResize=this.timeInMs,scene.initialGui=scene.stateManager.addGuiCanvas(),void 0!==window.DEBUG_MODE_ONE&&window.DEBUG_MODE_ONE;var updateContentFrame=function(){var _this5=this;customSized&&(this.initialCanvas.resizeAt=this.parentTaskObject.timeInMs+1e3,(0,_utilities.delay)(1e3).then(function(){if(_this5.parentTaskObject.timeInMs-_this5.initialCanvas.lastResize>100&&_this5.initialCanvas.resizeAt<_this5.parentTaskObject.timeInMs){_this5.initialCanvas.lastResize=_this5.parentTaskObject.timeInMs;var _getCanvasDimensions2=getCanvasDimensions(),_customSized=_getCanvasDimensions2.size;if((0,_utilities.debugWarn)("scene.updateContentFrame: window has been resized ",_customSized),_this5.initialCanvas.size=_customSized,void 0!==_this5.onResize&&null!==_this5.onResize){_this5.onResize.constructor===Function&&(_this5.onResize=[_this5.onResize]);var context=_this5.parentTaskObject.context,_iteratorNormalCompletion=!0,_didIteratorError=!1,_iteratorError=void 0;try{for(var _step,_iterator=_this5.onResize[Symbol.iterator]();!(_iteratorNormalCompletion=(_step=_iterator.next()).done);_iteratorNormalCompletion=!0){var f=_step.value;f.constructor===Function&&f.bind(context)()}}catch(err){_didIteratorError=!0,_iteratorError=err}finally{try{!_iteratorNormalCompletion&&_iterator.return&&_iterator.return()}finally{if(_didIteratorError)throw _iteratorError}}}}}))};return scene.updateContentFrame=updateContentFrame,scene.onResize=null,scene.registerBeforeRender(function(){scene.stateManager.update()}),scene}},{key:"setConnection",value:function(){var _this6=this,variables=arguments.length>0&&void 0!==arguments[0]?arguments[0]:(0,_utilities.mandatory)();if(!this.dataManager)throw new Error("StateManager.setCheckpoint: no dataManager");return this.dataManager.setConnection(variables).then(function(connection){return _this6.connection=connection,connection}).catch(function(error){(0,_utilities.debugError)(error)})}},{key:"setCheckpoint",value:function(){var code=arguments.length>0&&void 0!==arguments[0]?arguments[0]:(0,_utilities.mandatory)(),message=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"";if(!this.dataManager)throw new Error("StateManager.setCheckpoint: no dataManager");return this.dataManager.addRows("checkpoints",{code:code,happenedAt:this.timeInMs,message:message})}},{key:"getCheckpoint",value:function(){if(!this.dataManager)throw new Error("StateManager.getCheckpoint: no dataManager");return this.dataManager.query("getCheckpoint",{},this.connection)}},{key:"getContext",value:function(object){var scene=void 0!==this.currentSceneObject?this.currentSceneObject:null,stateManager=null!==scene&&void 0!==scene.stateManager?scene.stateManager:null,state=null!==stateManager&&void 0!==stateManager.currentState?this.currentSceneObject.stateManager.currentState:null,baseContext={taskObject:this,dataManager:void 0!==this.dataManager?this.dataManager:null,scene:scene,stateManager:stateManager,state:state,connection:this.connection,R:this.R};if(void 0===object)return baseContext;var extendWith={};switch(object.constructor){case _experimentBabylonJs2.default.Scene:extendWith={scene:object,stateManager:object.stateManager,state:object.stateManager.currentState};break;case _StateManager2.default:extendWith={scene:object._parent,stateManager:object,state:object.currentState};break;case _State2.default:extendWith={scene:object._parent,stateManager:object._stateManager,state:object};break;default:return(0,_utilities.debugWarn)("TaskObject.getContext: object is not of valid class. Returning taskObject context."),baseContext}return _lodash2.default.extend(baseContext,extendWith)}},{key:"toggleDebugLayer",value:function(){var scene=this.currentSceneObject;this.shouldShowDebug=!this.shouldShowDebug,void 0!==scene?this.shouldShowDebug?(this.scenes[this._currentSceneKey].debugLayer.show(),void 0!==this.scenes[this._currentSceneKey].initialCanvas&&this.scenes[this._currentSceneKey].initialCanvas.createCanvasProfileInfoCanvas()):(this.scenes[this._currentSceneKey].debugLayer.hide(),void 0!==this.scenes[this._currentSceneKey].initialCanvas&&null!==this.scenes[this._currentSceneKey].initialCanvas._profilingCanvas&&(this.scenes[this._currentSceneKey].initialCanvas._profilingCanvas.dispose(),this.scenes[this._currentSceneKey].initialCanvas._profilingCanvas=null)):console.error("taskObject.toggleDebugLayer: currentSceneObject is undefined")}},{key:"modal",value:function(_ref){var _ref$type=_ref.type,type=void 0===_ref$type?"centralLarge":_ref$type,_ref$title=_ref.title,title=void 0===_ref$title?"":_ref$title,_ref$content=_ref.content,content=void 0===_ref$content?"":_ref$content,_ref$event=_ref.event,event=void 0===_ref$event?new _EventData2.default(this.R.get.events_modalDismissed):_ref$event;this.dismissModal(),this.currentModal={data:{type:type,title:title,content:content,event:event}};var deferred=new _utilities.Deferred;this.currentModal.deferred=deferred;var modalBox=new _experimentBoxes.SmartModal(type,function(){event.constructor===_EventData2.default&&null!==this.stateManager&&(event.happenedAt=this.stateManager.timeInMs,this.stateManager.addEvent(event)),this.taskObject.currentModal.deferred.resolve("Modal closed."),this.taskObject.currentModal=null}.bind(this.context));return modalBox.title=title,modalBox.content=content,this.currentModal.modalBox=modalBox,deferred.promise}},{key:"dismissModal",value:function(){null!==this.currentModal&&(0,_utilities.hasConstructor)(_experimentBoxes.SmartModal,this.currentModal.modalBox)&&(this.currentModal.modalBox.callThenDestroy(),this.currentModal=null)}},{key:"animateFloat",value:function(object,property,from,to){var keys=[{frame:0,value:from},{frame:100,value:to}],animation=new _experimentBabylonJs2.default.Animation("animation",property,100,_experimentBabylonJs2.default.Animation.ANIMATIONTYPE_FLOAT,_experimentBabylonJs2.default.Animation.ANIMATIONLOOPMODE_CONSTANT);animation.setKeys(keys),this.currentSceneObject.stopAnimation(object),object.animations.push(animation),object._scene.beginAnimation(object,0,100,!1,1,function(){})}},{key:"animateVector3",value:function(object,property,from,to){var frameTotal=arguments.length>4&&void 0!==arguments[4]?arguments[4]:24,keys=[{frame:0,value:from},{frame:frameTotal,value:to}],animation=new _experimentBabylonJs2.default.Animation("animation",property,24,_experimentBabylonJs2.default.Animation.ANIMATIONTYPE_VECTOR3,_experimentBabylonJs2.default.Animation.ANIMATIONLOOPMODE_CONSTANT);animation.setKeys(keys),this.currentSceneObject.stopAnimation(object),object.animations.push(animation)}},{key:"animateColor3",value:function(object,property,from,to){var keys=[{frame:0,value:from},{frame:24,value:to}],animation=new _experimentBabylonJs2.default.Animation("animation",property,12,_experimentBabylonJs2.default.Animation.ANIMATIONTYPE_COLOR3,_experimentBabylonJs2.default.Animation.ANIMATIONLOOPMODE_CONSTANT);animation.setKeys(keys),object._scene.stopAnimation(object),object.animations.push(animation)}},{key:"animateMainCameraRotation",value:function(toAlpha,toBeta,scene){scene=this.scenes[this.currentScene];var animCamAlpha=new _experimentBabylonJs2.default.Animation("animCam","alpha",60,_experimentBabylonJs2.default.Animation.ANIMATIONTYPE_FLOAT,_experimentBabylonJs2.default.Animation.ANIMATIONLOOPMODE_CONSTANT),camera=scene.activeCamera,keysAlpha=[];if(TaskObject.overPI(camera.alpha,toAlpha)){keysAlpha.push({frame:0,value:camera.alpha}),console.log(camera.alpha),console.log(toAlpha);var firstStop=-Math.PI,secondStop=Math.PI;camera.alpha>0&&(firstStop=Math.PI,secondStop=-Math.PI),keysAlpha.push({frame:50,value:firstStop}),keysAlpha.push({frame:51,value:secondStop}),keysAlpha.push({frame:100,value:toAlpha})}else keysAlpha.push({frame:0,value:camera.alpha}),keysAlpha.push({frame:100,value:toAlpha});var animCamBeta=new _experimentBabylonJs2.default.Animation("animCam","beta",60,_experimentBabylonJs2.default.Animation.ANIMATIONTYPE_FLOAT,_experimentBabylonJs2.default.Animation.ANIMATIONLOOPMODE_CONSTANT),keysBeta=[];keysBeta.push({frame:0,value:camera.beta}),keysBeta.push({frame:100,value:toBeta}),animCamAlpha.setKeys(keysAlpha),animCamBeta.setKeys(keysBeta),camera.animations.push(animCamAlpha),camera.animations.push(animCamBeta),scene.beginAnimation(camera,0,100,!1,1,function(){})}},{key:"addParticuleSystemTo",value:function(){var mesh=arguments.length>0&&void 0!==arguments[0]?arguments[0]:(0,_utilities.mandatory)(),options=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};if(void 0===mesh._scene)throw new Error("addParticuleSystemTo: mesh _scene is undefined.");var scene=mesh._scene,optionsBase={name:"particle"+mesh.name,capacity:2e3,texture:this.ASSETS_FLARE_PATH,minEmitBox:null,maxEmitBox:null,color1:new _experimentBabylonJs2.default.Color4(.7,.8,1,1),color2:new _experimentBabylonJs2.default.Color4(.2,.5,1,1),colorDead:new _experimentBabylonJs2.default.Color4(0,0,.2,0),minSize:.1,maxSize:.5,minLifeTime:.3,maxLifeTime:.8,emitRate:150,blendMode:_experimentBabylonJs2.default.ParticleSystem.BLENDMODE_ONEONE,gravity:new _experimentBabylonJs2.default.Vector3(0,9.81,0),direction1:new _experimentBabylonJs2.default.Vector3(-5,-1,3),direction2:new _experimentBabylonJs2.default.Vector3(5,1,-3),minAngularSpeed:0,maxAngularSpeed:2*Math.PI,minEmitPower:.1,maxEmitPower:.1,updateSpeed:.01,startIt:!1};options=_lodash2.default.extend(optionsBase,options);var particleSystem=new _experimentBabylonJs2.default.ParticleSystem("particles",options.capacity,scene);return particleSystem.particleTexture=new _experimentBabylonJs2.default.Texture(options.texture,scene),particleSystem.emitter=mesh,null!==options.minEmitBox&&(particleSystem.minEmitBox=options.minEmitBox),null!==options.maxEmitBox&&(particleSystem.maxEmitBox=options.maxEmitBox),particleSystem.color1=options.color1,particleSystem.color2=options.color2,particleSystem.colorDead=options.colorDead,particleSystem.minSize=options.minSize,particleSystem.maxSize=options.maxSize,particleSystem.minLifeTime=options.minLifeTime,particleSystem.maxLifeTime=options.maxLifeTime,particleSystem.emitRate=options.emitRate,particleSystem.blendMode=options.blendMode,particleSystem.gravity=options.gravity,particleSystem.direction1=options.direction1,particleSystem.direction2=options.direction2,particleSystem.minAngularSpeed=options.minAngularSpeed,particleSystem.maxAngularSpeed=options.maxAngularSpeed,particleSystem.minEmitPower=options.minEmitPower,particleSystem.maxEmitPower=options.maxEmitPower,particleSystem.updateSpeed=options.updateSpeed,options.startIt&&particleSystem.start(),particleSystem}},{key:"context",get:function(){return this.getContext()}},{key:"currentScene",get:function(){return this._currentSceneKey},set:function(sceneKey){-1!==Object.keys(this.scenes).indexOf(sceneKey)?(this._currentSceneKey&&(this.scenes[this._currentSceneKey].stateManager.goToState(this.R.get.states_idle),void 0!==window.DEBUG_MODE_ONE&&!0===window.DEBUG_MODE_ONE&&(this.scenes[this._currentSceneKey].debugLayer.hide(),void 0!==this.scenes[this._currentSceneKey].initialCanvas&&this.scenes[this._currentSceneKey].initialCanvas._profilingCanvas)),this._currentSceneKey=sceneKey,this.scenes[sceneKey].stateManager.goToState(this.R.get.states_active),void 0!==window.DEBUG_MODE_ONE&&!0===window.DEBUG_MODE_ONE&&this.shouldShowDebug&&(this.scenes[sceneKey].debugLayer.show(),this.scenes[sceneKey].initialCanvas),(0,_utilities.debuglog)("TaskObject.currentScene: changed to "+sceneKey)):null===sceneKey||""===sceneKey?this._currentSceneKey="":console.error("TaskObject.currentScene: Invalid sceneKey.")}},{key:"currentSceneObject",get:function(){return this.scenes[this._currentSceneKey]},set:function(sceneObject){if(!_lodash2.default.has(sceneObject,"sceneKey"))throw new Error("Specified scene has no sceneKey");this.currentScene=sceneObject.sceneKey}},{key:"time",get:function(){return this.timeInMs}},{key:"timeInSec",get:function(){return(new Date).getTime()/1e3}},{key:"timeInMs",get:function(){return(new Date).getTime()}},{key:"paramBox",get:function(){return this._paramBox},set:function(paramBox){this._paramBox&&this._paramBox.delete(),this._paramBox=paramBox}},{key:"renderSize",get:function(){return new _experimentBabylonJs2.default.Size(this.engine.getRenderWidth(),this.engine.getRenderHeight())},set:function(){var size=arguments.length>0&&void 0!==arguments[0]?arguments[0]:(0,_utilities.mandatory)();switch(size.constructor){case _utilities.String:this.canvas.width=size,this.canvas.height=size;break;case _experimentBabylonJs2.default.Size:this.canvas.width=size.width+"px",this.canvas.height=size.height+"px";break;case _utilities.Array:if(2!==size.length)throw new Error("TaskObject.renderSize: set with invalid size array, array lenght has to be === 2.");this.canvas.width=size[0],this.canvas.height=size[1];break;default:throw new Error("TaskObject.renderSize: set with invalid size array, array lenght has to be === 2.")}}}],[{key:"default2dSceneGenerator",value:function(options){var taskObject=this.taskObject,optionsBase={canvasBackground:new _experimentBabylonJs2.default.Color4(1,1,1,1),backgroundRoundRadius:0,clearColor:new _experimentBabylonJs2.default.Color4(1,1,1,1),canvasPercentWidth:1,canvasPercentHeight:1,mode:"central",level:null,shouldLoadAssets:!1};options=_lodash2.default.extend(optionsBase,options);var scene=taskObject.create2DScene(options),assetObject={logo:{path:"/assets/experiment-js.svg",type:"texture"}};return options.shouldLoadAssets&&(assetObject=_lodash2.default.extend(assetObject,taskObject.assetsToLoad)),scene.loadingPromise=taskObject.loadAssets(assetObject,scene).then(function(){var canvas=scene.initialCanvas,texture=taskObject.R.get.textures_logo;texture.hasAlpha=!0;var height=_experimentMathjs2.default.max(.05*taskObject.renderSize.height,45);new _experimentBabylonJs2.default.Sprite2D(texture,{parent:canvas,id:"logo",marginAlignment:"h: center, v:center",size:new _experimentBabylonJs2.default.Size(3e3*height/730,height),origin:_experimentBabylonJs2.default.Vector2.Zero()})}),scene}},{key:"borderPI",value:function(radians){var offset=Math.PI;return(radians+=offset)-Math.sign(radians)*Math.floor(Math.abs(radians)/(2*Math.PI))*(2*Math.PI)-offset}},{key:"checkForCloserSignedAngle",value:function(baseAngle,checkedAngle){checkedAngle=TaskObject.borderPI(checkedAngle),console.log(checkedAngle),console.log("baseAngle:"+baseAngle);var sign=Math.sign(checkedAngle);0===checkedAngle&&(sign=Math.sign(baseAngle));var signedAngle=checkedAngle-sign*(2*Math.PI);return console.log("signedAngle:"+signedAngle),Math.abs(baseAngle-checkedAngle)<=Math.abs(baseAngle-signedAngle)?checkedAngle:signedAngle}},{key:"overPI",value:function(angleA,angleB){return Math.abs(angleA-angleB)>Math.PI}},{key:"fadeOut",value:function(sound){var _ref2=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},_ref2$currentVolume=_ref2.currentVolume,currentVolume=void 0===_ref2$currentVolume?null:_ref2$currentVolume,_ref2$step=_ref2.step,step=void 0===_ref2$step?.02:_ref2$step,_ref2$threshold=_ref2.threshold,threshold=void 0===_ref2$threshold?.02:_ref2$threshold,_ref2$delayInMs=_ref2.delayInMs,delayInMs=void 0===_ref2$delayInMs?50:_ref2$delayInMs,_ref2$pause=_ref2.pause,pause=void 0!==_ref2$pause&&_ref2$pause;(0,_utilities.mustHaveConstructor)(_experimentBabylonJs2.default.Sound,sound),null===currentVolume&&(currentVolume=sound.getVolume()),(0,_utilities.mustHaveConstructor)(Number,currentVolume,step,threshold),currentVolume=currentVolume.boundTo(0,1),step=step.boundTo(0,1);var decrement=step*currentVolume;decrement<step/10&&(decrement=step/10),currentVolume-=decrement,currentVolume>threshold?((0,_utilities.debuglog)("fadeOut.currentVolume:"+currentVolume),sound.setVolume(currentVolume),(0,_utilities.delay)(delayInMs).then(function(){return TaskObject.fadeOut(sound,{currentVolume:currentVolume,step:step,threshold:threshold,delayInMs:delayInMs,pause:pause})})):pause?((0,_utilities.debuglog)("fadeOut:  pause"),sound.pause()):((0,_utilities.debuglog)("fadeOut:  stop"),sound.stop())}},{key:"fillArray",value:function(value,len){for(var a=[],i=1;i<=len;i++)a.push(value);return a}},{key:"sphericalToEuclidian",value:function(r,inclination,azimuth){var z=r*Math.sin(inclination)*Math.cos(azimuth),x=r*Math.sin(inclination)*Math.sin(azimuth),y=r*Math.cos(inclination);return new _experimentBabylonJs2.default.Vector3(x,y,z)}},{key:"getRandomArbitrary",value:function(min,max){return Math.random()*(max-min)+min}},{key:"getRandomElement",value:function(){var array=arguments.length>0&&void 0!==arguments[0]?arguments[0]:(0,_utilities.mandatory)();if(array.constructor===_utilities.Array)return array[Math.round(TaskObject.getRandomArbitrary(0,array.length-1))];throw new Error("TaskObject: argument is not of type array.")}},{key:"currentScene",get:function(){}},{key:"currentSceneObject",get:function(){}},{key:"paramBox",get:function(){}},{key:"renderSize",get:function(){}}]),TaskObject}();exports.default=TaskObject},function(module,exports,__webpack_require__){"use strict";function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}function _classCallCheck(instance,Constructor){if(!(instance instanceof Constructor))throw new TypeError("Cannot call a class as a function")}function _possibleConstructorReturn(self,call){if(!self)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!call||"object"!=typeof call&&"function"!=typeof call?self:call}function _inherits(subClass,superClass){if("function"!=typeof superClass&&null!==superClass)throw new TypeError("Super expression must either be null or a function, not "+typeof superClass);subClass.prototype=Object.create(superClass&&superClass.prototype,{constructor:{value:subClass,enumerable:!1,writable:!0,configurable:!0}}),superClass&&(Object.setPrototypeOf?Object.setPrototypeOf(subClass,superClass):subClass.__proto__=superClass)}Object.defineProperty(exports,"__esModule",{value:!0});var _createClass=function(){function defineProperties(target,props){for(var i=0;i<props.length;i++){var descriptor=props[i];descriptor.enumerable=descriptor.enumerable||!1,descriptor.configurable=!0,"value"in descriptor&&(descriptor.writable=!0),Object.defineProperty(target,descriptor.key,descriptor)}}return function(Constructor,protoProps,staticProps){return protoProps&&defineProperties(Constructor.prototype,protoProps),staticProps&&defineProperties(Constructor,staticProps),Constructor}}(),_lodash=__webpack_require__(1),_lodash2=_interopRequireDefault(_lodash),_experimentBabylonJs=__webpack_require__(4),_experimentBabylonJs2=_interopRequireDefault(_experimentBabylonJs),_utilities=__webpack_require__(0),Loader=function(_BABYLON$Rectangle2D){function Loader(options){_classCallCheck(this,Loader);var baseOptions={id:"loader",parent:null,roundRadius:0,size:new _experimentBabylonJs2.default.Size(20,20),borderThickness:1,border:_experimentBabylonJs2.default.Canvas2D.GetSolidColorBrush(new _experimentBabylonJs2.default.Color4(1,1,1,1)),fill:null,marginAlignment:"h: center, v: center",zOrder:.01,value:0,type:"multiSequencial",centered:!0};options=_lodash2.default.extend(baseOptions,options);var _this=_possibleConstructorReturn(this,(Loader.__proto__||Object.getPrototypeOf(Loader)).call(this,options));if(_this.options=options,"anticlock"===_this.options.type){var borderThickness=options.borderThickness+2,fill=_experimentBabylonJs2.default.Canvas2D.GetSolidColorBrush(new _experimentBabylonJs2.default.Color4(0,0,0,1)),masks={};masks.bottom=new _experimentBabylonJs2.default.Rectangle2D({parent:_this,id:"loaderMaskBottom",marginAlignment:"h: center, v: center",size:new _experimentBabylonJs2.default.Size(options.size.width,borderThickness),fill:fill,zOrder:.001}),masks.right=new _experimentBabylonJs2.default.Rectangle2D({parent:_this,id:"loaderMaskRight",marginAlignment:"h: center, v: center",size:new _experimentBabylonJs2.default.Size(borderThickness,options.size.height),fill:fill,zOrder:.002}),masks.top=new _experimentBabylonJs2.default.Rectangle2D({parent:_this,id:"loaderMaskTop",marginAlignment:"h: center, v: center",size:new _experimentBabylonJs2.default.Size(options.size.width,borderThickness),fill:fill,zOrder:.003}),masks.left=new _experimentBabylonJs2.default.Rectangle2D({parent:_this,id:"loaderMaskLeft",marginAlignment:"h: center, v: center",size:new _experimentBabylonJs2.default.Size(borderThickness,options.size.height),fill:fill,zOrder:.004}),_this.masks=masks}else _this.borderThickness=0,_this.fill=null,_this.drawRectangles();return _this._value=options.value,_this.lastUpdatedValue=_this._value,_this.update(),_this}return _inherits(Loader,_BABYLON$Rectangle2D),_createClass(Loader,[{key:"update",value:function(){"anticlock"===this.options.type?this.updateMasks():this.updateRectangles()}},{key:"updateRectangles",value:function(){if("multi"===this.options.type){this.value<this.lastUpdatedValue&&this.drawRectangles(),this.lastUpdatedValue=this.value;var fullWeight=Math.floor(this.value/4),residual=this.value%4,residualBottom=residual>0?1:0,residualTop=residual>2?1:0,residualLeft=residual>1?1:0;this.rectangles.bottom.width=(fullWeight+residualBottom)*(this.size.width/25),this.rectangles.left.height=(fullWeight+residualLeft)*(this.size.height/25),this.rectangles.right.height=fullWeight*(this.size.height/25),this.rectangles.top.width=(fullWeight+residualTop)*(this.size.width/25)}else"multiSequencial"===this.options.type&&(this.value<this.lastUpdatedValue&&this.drawRectangles(),this.lastUpdatedValue=this.value,this.rectangles.bottom.width=this.value.boundTo(0,25)*(this.size.width/25),this.rectangles.left.height=(this.value-25).boundTo(0,25)*(this.size.height/25),this.rectangles.right.height=(this.value-50).boundTo(0,25)*(this.size.height/25),this.rectangles.top.width=(this.value-75).boundTo(0,25)*(this.size.width/25))}},{key:"drawRectangles",value:function(){if((0,_utilities.hasConstructor)(Object,this.rectangles)&&this.rectangles.hasOwnProperty("bottom")&&(0,_utilities.hasConstructor)(_experimentBabylonJs2.default.Rectangle2D,this.rectangles.bottom))for(var rectangle in this.rectangles)this.rectangles.hasOwnProperty(rectangle)&&"function"==typeof this.rectangles[rectangle].dispose&&this.rectangles[rectangle].dispose();this.rectangles={};var borderThickness=this.options.borderThickness,fill=this.options.border;this.rectangles.bottom=new _experimentBabylonJs2.default.Rectangle2D({parent:this,id:"loaderRectangleBottom",marginAlignment:this.options.centered?"h: center, v: center":"h: left, v: bottom",size:new _experimentBabylonJs2.default.Size(0,borderThickness),fill:fill,zOrder:.001}),this.rectangles.right=new _experimentBabylonJs2.default.Rectangle2D({parent:this,id:"loaderRectangleRight",marginAlignment:this.options.centered?"h: center, v: center":"h: right, v: top",size:new _experimentBabylonJs2.default.Size(borderThickness,0),fill:fill,zOrder:.002}),this.rectangles.top=new _experimentBabylonJs2.default.Rectangle2D({parent:this,id:"loaderRectangleTop",marginAlignment:this.options.centered?"h: center, v: center":"h: right, v: top",size:new _experimentBabylonJs2.default.Size(0,borderThickness),fill:fill,zOrder:.003}),this.rectangles.left=new _experimentBabylonJs2.default.Rectangle2D({parent:this,id:"loaderRectangleLeft",marginAlignment:this.options.centered?"h: center, v: center":"h: left, v: bottom",size:new _experimentBabylonJs2.default.Size(borderThickness,0),fill:fill,zOrder:.004}),this.options.centered&&(_lodash2.default.extend(this.rectangles.left.margin,{rightPixels:this.size.width/2-borderThickness/2}),_lodash2.default.extend(this.rectangles.right.margin,{leftPixels:this.size.width/2-borderThickness/2}),_lodash2.default.extend(this.rectangles.top.margin,{bottomPixels:this.size.height/2-borderThickness/2}),_lodash2.default.extend(this.rectangles.bottom.margin,{topPixels:this.size.height/2-borderThickness/2}))}},{key:"updateMasks",value:function(){if("anticlock"===this.options.type){var value=this.value;if(value<25){this.masks.bottom.width=(25-value)*(this.size.width/25);var offset=this.size.width-this.masks.bottom.width;this.masks.bottom.margin.rightPixels=0,this.masks.bottom.margin.leftPixels=offset/2,this.masks.bottom.margin.topPixels=this.size.height/2-this.borderThickness/2,this.masks.bottom.margin.bottomPixels=0,this.masks.bottom.levelVisible=!0}else this.masks.bottom.levelVisible=!1;if(value<50){var height=value>=25?(50-value)*(this.size.height/25):this.size.height;this.masks.right.height=height;var _offset=this.size.height-height;this.masks.right.margin.rightPixels=0,this.masks.right.margin.leftPixels=this.size.width/2-this.borderThickness/2,this.masks.right.margin.topPixels=0,this.masks.right.margin.bottomPixels=_offset/2,this.masks.right.levelVisible=!0}else this.masks.right.levelVisible=!1;if(value<75){var width=value>=50?(75-value)*(this.size.width/25):this.size.width;this.masks.top.width=width;var _offset2=this.size.width-width+this.borderThickness;this.masks.top.margin.rightPixels=_offset2/2,this.masks.top.margin.leftPixels=0,this.masks.top.margin.topPixels=0,this.masks.top.margin.bottomPixels=this.size.height/2-this.borderThickness/2,this.masks.top.levelVisible=!0}else this.masks.top.levelVisible=!1;if(value<100){var _height=value>=75?(100-value)*(this.size.height/25):this.size.height;this.masks.left.height=_height;var _offset3=this.size.height-_height+this.borderThickness;this.masks.left.margin.rightPixels=this.size.width/2-this.borderThickness/2,this.masks.left.margin.leftPixels=0,this.masks.left.margin.topPixels=_offset3/2,this.masks.left.margin.bottomPixels=0,this.masks.left.levelVisible=!0}else this.masks.left.levelVisible=!1}}},{key:"value",set:function(){var val=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0;(0,_utilities.hasConstructor)(_utilities.Number,val)?(val=val.boundTo(0,100),this._value=val,this.update()):(0,_utilities.debugError)("Loader.value: invalid value")},get:function(){return this._value}}]),Loader}(_experimentBabylonJs2.default.Rectangle2D);exports.default=Loader},function(module,exports,__webpack_require__){"use strict";function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}Object.defineProperty(exports,"__esModule",{value:!0}),exports.getQueryString=exports.Loader=exports.preloadImages=exports.hasConstructor=exports.scaleSize=exports.sizeToVec=exports.spreadToObject=exports.noop=exports.debugError=exports.debugWarn=exports.debuglog=exports.mandatory=exports.mustBeDefined=exports.mustHaveConstructor=exports.looksLikeAPromise=exports.delay=exports.jitter=exports.recurse=exports.Deferred=exports.rep=exports.samplePermutation=exports.matrix=exports.getRow=exports.rowSum=exports.diag=exports.Set=exports.Number=exports.String=exports.Array=exports.RessourceManager=exports.DataManager=exports.EventData=exports.State=exports.StateManager=exports.TaskObject=void 0;var _TaskObject=__webpack_require__(14),_TaskObject2=_interopRequireDefault(_TaskObject),_StateManager=__webpack_require__(9),_StateManager2=_interopRequireDefault(_StateManager),_State=__webpack_require__(7),_State2=_interopRequireDefault(_State),_EventData=__webpack_require__(3),_EventData2=_interopRequireDefault(_EventData),_DataManager=__webpack_require__(5),_DataManager2=_interopRequireDefault(_DataManager),_RessourceManager=__webpack_require__(6),_RessourceManager2=_interopRequireDefault(_RessourceManager),_Loader=__webpack_require__(15),_Loader2=_interopRequireDefault(_Loader),_utilities=__webpack_require__(0);"undefined"!=typeof window&&(window.TaskObject=_TaskObject2.default,window.StateManager=_StateManager2.default,window.State=_State2.default,window.EventData=_EventData2.default,window.DataManager=_DataManager2.default,window.RessourceManager=_RessourceManager2.default,window.jitter=_utilities.jitter,window.delay=_utilities.delay,window.Deferred=_utilities.Deferred),exports.TaskObject=_TaskObject2.default,exports.StateManager=_StateManager2.default,exports.State=_State2.default,exports.EventData=_EventData2.default,exports.DataManager=_DataManager2.default,exports.RessourceManager=_RessourceManager2.default,exports.Array=_utilities.Array,exports.String=_utilities.String,exports.Number=_utilities.Number,exports.Set=_utilities.Set,exports.diag=_utilities.diag,exports.rowSum=_utilities.rowSum,exports.getRow=_utilities.getRow,exports.matrix=_utilities.matrix,exports.samplePermutation=_utilities.samplePermutation,exports.rep=_utilities.rep,exports.Deferred=_utilities.Deferred,exports.recurse=_utilities.recurse,exports.jitter=_utilities.jitter,exports.delay=_utilities.delay,exports.looksLikeAPromise=_utilities.looksLikeAPromise,exports.mustHaveConstructor=_utilities.mustHaveConstructor,exports.mustBeDefined=_utilities.mustBeDefined,exports.mandatory=_utilities.mandatory,exports.debuglog=_utilities.debuglog,exports.debugWarn=_utilities.debugWarn,exports.debugError=_utilities.debugError,exports.noop=_utilities.noop,exports.spreadToObject=_utilities.spreadToObject,exports.sizeToVec=_utilities.sizeToVec,exports.scaleSize=_utilities.scaleSize,exports.hasConstructor=_utilities.hasConstructor,exports.preloadImages=_utilities.preloadImages,exports.Loader=_Loader2.default,exports.getQueryString=_utilities.getQueryString},function(module,exports,__webpack_require__){"use strict";Object.defineProperty(exports,"__esModule",{value:!0});exports.DEBUG_MODE_ON=!0},function(module,exports,__webpack_require__){var require,require;!function(f){module.exports=f()}(function(){return function e(t,n,r){function s(o,u){if(!n[o]){if(!t[o]){var a="function"==typeof require&&require;if(!u&&a)return require(o,!0);if(i)return i(o,!0);var f=new Error("Cannot find module '"+o+"'");throw f.code="MODULE_NOT_FOUND",f}var l=n[o]={exports:{}};t[o][0].call(l.exports,function(e){var n=t[o][1][e];return s(n||e)},l,l.exports,e,t,n,r)}return n[o].exports}for(var i="function"==typeof require&&require,o=0;o<r.length;o++)s(r[o]);return s}({1:[function(require,module,exports){"use strict";function deprecated(name){return function(){throw new Error("Function "+name+" is deprecated and cannot be used.")}}var loader=require("./js-yaml/loader"),dumper=require("./js-yaml/dumper");module.exports.Type=require("./js-yaml/type"),module.exports.Schema=require("./js-yaml/schema"),module.exports.FAILSAFE_SCHEMA=require("./js-yaml/schema/failsafe"),module.exports.JSON_SCHEMA=require("./js-yaml/schema/json"),module.exports.CORE_SCHEMA=require("./js-yaml/schema/core"),module.exports.DEFAULT_SAFE_SCHEMA=require("./js-yaml/schema/default_safe"),module.exports.DEFAULT_FULL_SCHEMA=require("./js-yaml/schema/default_full"),module.exports.load=loader.load,module.exports.loadAll=loader.loadAll,module.exports.safeLoad=loader.safeLoad,module.exports.safeLoadAll=loader.safeLoadAll,module.exports.dump=dumper.dump,module.exports.safeDump=dumper.safeDump,module.exports.YAMLException=require("./js-yaml/exception"),module.exports.MINIMAL_SCHEMA=require("./js-yaml/schema/failsafe"),module.exports.SAFE_SCHEMA=require("./js-yaml/schema/default_safe"),module.exports.DEFAULT_SCHEMA=require("./js-yaml/schema/default_full"),module.exports.scan=deprecated("scan"),module.exports.parse=deprecated("parse"),module.exports.compose=deprecated("compose"),module.exports.addConstructor=deprecated("addConstructor")},{"./js-yaml/dumper":3,"./js-yaml/exception":4,"./js-yaml/loader":5,"./js-yaml/schema":7,"./js-yaml/schema/core":8,"./js-yaml/schema/default_full":9,"./js-yaml/schema/default_safe":10,"./js-yaml/schema/failsafe":11,"./js-yaml/schema/json":12,"./js-yaml/type":13}],2:[function(require,module,exports){"use strict";function isNothing(subject){return void 0===subject||null===subject}function isObject(subject){return"object"==typeof subject&&null!==subject}function toArray(sequence){return Array.isArray(sequence)?sequence:isNothing(sequence)?[]:[sequence]}function extend(target,source){var index,length,key,sourceKeys;if(source)for(sourceKeys=Object.keys(source),index=0,length=sourceKeys.length;index<length;index+=1)key=sourceKeys[index],target[key]=source[key];return target}function repeat(string,count){var cycle,result="";for(cycle=0;cycle<count;cycle+=1)result+=string;return result}function isNegativeZero(number){return 0===number&&Number.NEGATIVE_INFINITY===1/number}module.exports.isNothing=isNothing,module.exports.isObject=isObject,module.exports.toArray=toArray,module.exports.repeat=repeat,module.exports.isNegativeZero=isNegativeZero,module.exports.extend=extend},{}],3:[function(require,module,exports){"use strict";function compileStyleMap(schema,map){var result,keys,index,length,tag,style,type;if(null===map)return{};for(result={},keys=Object.keys(map),index=0,length=keys.length;index<length;index+=1)tag=keys[index],style=String(map[tag]),"!!"===tag.slice(0,2)&&(tag="tag:yaml.org,2002:"+tag.slice(2)),type=schema.compiledTypeMap.fallback[tag],type&&_hasOwnProperty.call(type.styleAliases,style)&&(style=type.styleAliases[style]),result[tag]=style;return result}function encodeHex(character){var string,handle,length;if(string=character.toString(16).toUpperCase(),character<=255)handle="x",length=2;else if(character<=65535)handle="u",length=4;else{if(!(character<=4294967295))throw new YAMLException("code point within a string may not be greater than 0xFFFFFFFF");handle="U",length=8}return"\\"+handle+common.repeat("0",length-string.length)+string}function State(options){this.schema=options.schema||DEFAULT_FULL_SCHEMA,this.indent=Math.max(1,options.indent||2),this.skipInvalid=options.skipInvalid||!1,this.flowLevel=common.isNothing(options.flowLevel)?-1:options.flowLevel,this.styleMap=compileStyleMap(this.schema,options.styles||null),this.sortKeys=options.sortKeys||!1,this.lineWidth=options.lineWidth||80,this.noRefs=options.noRefs||!1,this.noCompatMode=options.noCompatMode||!1,this.implicitTypes=this.schema.compiledImplicit,this.explicitTypes=this.schema.compiledExplicit,this.tag=null,this.result="",this.duplicates=[],this.usedDuplicates=null}function indentString(string,spaces){for(var line,ind=common.repeat(" ",spaces),position=0,next=-1,result="",length=string.length;position<length;)next=string.indexOf("\n",position),-1===next?(line=string.slice(position),position=length):(line=string.slice(position,next+1),position=next+1),line.length&&"\n"!==line&&(result+=ind),result+=line;return result}function generateNextLine(state,level){return"\n"+common.repeat(" ",state.indent*level)}function testImplicitResolving(state,str){var index,length,type;for(index=0,length=state.implicitTypes.length;index<length;index+=1)if(type=state.implicitTypes[index],type.resolve(str))return!0;return!1}function isWhitespace(c){return c===CHAR_SPACE||c===CHAR_TAB}function isPrintable(c){return 32<=c&&c<=126||161<=c&&c<=55295&&8232!==c&&8233!==c||57344<=c&&c<=65533&&65279!==c||65536<=c&&c<=1114111}function isPlainSafe(c){return isPrintable(c)&&65279!==c&&c!==CHAR_COMMA&&c!==CHAR_LEFT_SQUARE_BRACKET&&c!==CHAR_RIGHT_SQUARE_BRACKET&&c!==CHAR_LEFT_CURLY_BRACKET&&c!==CHAR_RIGHT_CURLY_BRACKET&&c!==CHAR_COLON&&c!==CHAR_SHARP}function isPlainSafeFirst(c){return isPrintable(c)&&65279!==c&&!isWhitespace(c)&&c!==CHAR_MINUS&&c!==CHAR_QUESTION&&c!==CHAR_COLON&&c!==CHAR_COMMA&&c!==CHAR_LEFT_SQUARE_BRACKET&&c!==CHAR_RIGHT_SQUARE_BRACKET&&c!==CHAR_LEFT_CURLY_BRACKET&&c!==CHAR_RIGHT_CURLY_BRACKET&&c!==CHAR_SHARP&&c!==CHAR_AMPERSAND&&c!==CHAR_ASTERISK&&c!==CHAR_EXCLAMATION&&c!==CHAR_VERTICAL_LINE&&c!==CHAR_GREATER_THAN&&c!==CHAR_SINGLE_QUOTE&&c!==CHAR_DOUBLE_QUOTE&&c!==CHAR_PERCENT&&c!==CHAR_COMMERCIAL_AT&&c!==CHAR_GRAVE_ACCENT}function chooseScalarStyle(string,singleLineOnly,indentPerLevel,lineWidth,testAmbiguousType){var i,char,hasLineBreak=!1,hasFoldableLine=!1,shouldTrackWidth=-1!==lineWidth,previousLineBreak=-1,plain=isPlainSafeFirst(string.charCodeAt(0))&&!isWhitespace(string.charCodeAt(string.length-1));if(singleLineOnly)for(i=0;i<string.length;i++){if(char=string.charCodeAt(i),!isPrintable(char))return STYLE_DOUBLE;plain=plain&&isPlainSafe(char)}else{for(i=0;i<string.length;i++){if((char=string.charCodeAt(i))===CHAR_LINE_FEED)hasLineBreak=!0,shouldTrackWidth&&(hasFoldableLine=hasFoldableLine||i-previousLineBreak-1>lineWidth&&" "!==string[previousLineBreak+1],previousLineBreak=i);else if(!isPrintable(char))return STYLE_DOUBLE;plain=plain&&isPlainSafe(char)}hasFoldableLine=hasFoldableLine||shouldTrackWidth&&i-previousLineBreak-1>lineWidth&&" "!==string[previousLineBreak+1]}return hasLineBreak||hasFoldableLine?" "===string[0]&&indentPerLevel>9?STYLE_DOUBLE:hasFoldableLine?STYLE_FOLDED:STYLE_LITERAL:plain&&!testAmbiguousType(string)?STYLE_PLAIN:STYLE_SINGLE}function writeScalar(state,string,level,iskey){state.dump=function(){function testAmbiguity(string){return testImplicitResolving(state,string)}if(0===string.length)return"''";if(!state.noCompatMode&&-1!==DEPRECATED_BOOLEANS_SYNTAX.indexOf(string))return"'"+string+"'";var indent=state.indent*Math.max(1,level),lineWidth=-1===state.lineWidth?-1:Math.max(Math.min(state.lineWidth,40),state.lineWidth-indent),singleLineOnly=iskey||state.flowLevel>-1&&level>=state.flowLevel;switch(chooseScalarStyle(string,singleLineOnly,state.indent,lineWidth,testAmbiguity)){case STYLE_PLAIN:return string;case STYLE_SINGLE:return"'"+string.replace(/'/g,"''")+"'";case STYLE_LITERAL:return"|"+blockHeader(string,state.indent)+dropEndingNewline(indentString(string,indent));case STYLE_FOLDED:return">"+blockHeader(string,state.indent)+dropEndingNewline(indentString(foldString(string,lineWidth),indent));case STYLE_DOUBLE:return'"'+escapeString(string)+'"';default:throw new YAMLException("impossible error: invalid scalar style")}}()}function blockHeader(string,indentPerLevel){var indentIndicator=" "===string[0]?String(indentPerLevel):"",clip="\n"===string[string.length-1];return indentIndicator+(!clip||"\n"!==string[string.length-2]&&"\n"!==string?clip?"":"-":"+")+"\n"}function dropEndingNewline(string){return"\n"===string[string.length-1]?string.slice(0,-1):string}function foldString(string,width){for(var moreIndented,match,lineRe=/(\n+)([^\n]*)/g,result=function(){var nextLF=string.indexOf("\n");return nextLF=-1!==nextLF?nextLF:string.length,lineRe.lastIndex=nextLF,foldLine(string.slice(0,nextLF),width)}(),prevMoreIndented="\n"===string[0]||" "===string[0];match=lineRe.exec(string);){var prefix=match[1],line=match[2];moreIndented=" "===line[0],result+=prefix+(prevMoreIndented||moreIndented||""===line?"":"\n")+foldLine(line,width),prevMoreIndented=moreIndented}return result}function foldLine(line,width){if(""===line||" "===line[0])return line;for(var match,end,breakRe=/ [^ ]/g,start=0,curr=0,next=0,result="";match=breakRe.exec(line);)next=match.index,next-start>width&&(end=curr>start?curr:next,result+="\n"+line.slice(start,end),start=end+1),curr=next;return result+="\n",line.length-start>width&&curr>start?result+=line.slice(start,curr)+"\n"+line.slice(curr+1):result+=line.slice(start),result.slice(1)}function escapeString(string){for(var char,escapeSeq,result="",i=0;i<string.length;i++)char=string.charCodeAt(i),escapeSeq=ESCAPE_SEQUENCES[char],result+=!escapeSeq&&isPrintable(char)?string[i]:escapeSeq||encodeHex(char);return result}function writeFlowSequence(state,level,object){var index,length,_result="",_tag=state.tag;for(index=0,length=object.length;index<length;index+=1)writeNode(state,level,object[index],!1,!1)&&(0!==index&&(_result+=", "),_result+=state.dump);state.tag=_tag,state.dump="["+_result+"]"}function writeBlockSequence(state,level,object,compact){var index,length,_result="",_tag=state.tag;for(index=0,length=object.length;index<length;index+=1)writeNode(state,level+1,object[index],!0,!0)&&(compact&&0===index||(_result+=generateNextLine(state,level)),state.dump&&CHAR_LINE_FEED===state.dump.charCodeAt(0)?_result+="-":_result+="- ",_result+=state.dump);state.tag=_tag,state.dump=_result||"[]"}function writeFlowMapping(state,level,object){var index,length,objectKey,objectValue,pairBuffer,_result="",_tag=state.tag,objectKeyList=Object.keys(object);for(index=0,length=objectKeyList.length;index<length;index+=1)pairBuffer="",0!==index&&(pairBuffer+=", "),objectKey=objectKeyList[index],objectValue=object[objectKey],writeNode(state,level,objectKey,!1,!1)&&(state.dump.length>1024&&(pairBuffer+="? "),pairBuffer+=state.dump+": ",writeNode(state,level,objectValue,!1,!1)&&(pairBuffer+=state.dump,_result+=pairBuffer));state.tag=_tag,state.dump="{"+_result+"}"}function writeBlockMapping(state,level,object,compact){var index,length,objectKey,objectValue,explicitPair,pairBuffer,_result="",_tag=state.tag,objectKeyList=Object.keys(object);if(!0===state.sortKeys)objectKeyList.sort();else if("function"==typeof state.sortKeys)objectKeyList.sort(state.sortKeys);else if(state.sortKeys)throw new YAMLException("sortKeys must be a boolean or a function");for(index=0,length=objectKeyList.length;index<length;index+=1)pairBuffer="",compact&&0===index||(pairBuffer+=generateNextLine(state,level)),objectKey=objectKeyList[index],objectValue=object[objectKey],writeNode(state,level+1,objectKey,!0,!0,!0)&&(explicitPair=null!==state.tag&&"?"!==state.tag||state.dump&&state.dump.length>1024,explicitPair&&(state.dump&&CHAR_LINE_FEED===state.dump.charCodeAt(0)?pairBuffer+="?":pairBuffer+="? "),pairBuffer+=state.dump,explicitPair&&(pairBuffer+=generateNextLine(state,level)),writeNode(state,level+1,objectValue,!0,explicitPair)&&(state.dump&&CHAR_LINE_FEED===state.dump.charCodeAt(0)?pairBuffer+=":":pairBuffer+=": ",pairBuffer+=state.dump,_result+=pairBuffer));state.tag=_tag,state.dump=_result||"{}"}function detectType(state,object,explicit){var _result,typeList,index,length,type,style;for(typeList=explicit?state.explicitTypes:state.implicitTypes,index=0,length=typeList.length;index<length;index+=1)if(type=typeList[index],(type.instanceOf||type.predicate)&&(!type.instanceOf||"object"==typeof object&&object instanceof type.instanceOf)&&(!type.predicate||type.predicate(object))){if(state.tag=explicit?type.tag:"?",type.represent){if(style=state.styleMap[type.tag]||type.defaultStyle,"[object Function]"===_toString.call(type.represent))_result=type.represent(object,style);else{if(!_hasOwnProperty.call(type.represent,style))throw new YAMLException("!<"+type.tag+'> tag resolver accepts not "'+style+'" style');_result=type.represent[style](object,style)}state.dump=_result}return!0}return!1}function writeNode(state,level,object,block,compact,iskey){state.tag=null,state.dump=object,detectType(state,object,!1)||detectType(state,object,!0);var type=_toString.call(state.dump);block&&(block=state.flowLevel<0||state.flowLevel>level);var duplicateIndex,duplicate,objectOrArray="[object Object]"===type||"[object Array]"===type;if(objectOrArray&&(duplicateIndex=state.duplicates.indexOf(object),duplicate=-1!==duplicateIndex),(null!==state.tag&&"?"!==state.tag||duplicate||2!==state.indent&&level>0)&&(compact=!1),duplicate&&state.usedDuplicates[duplicateIndex])state.dump="*ref_"+duplicateIndex;else{if(objectOrArray&&duplicate&&!state.usedDuplicates[duplicateIndex]&&(state.usedDuplicates[duplicateIndex]=!0),"[object Object]"===type)block&&0!==Object.keys(state.dump).length?(writeBlockMapping(state,level,state.dump,compact),duplicate&&(state.dump="&ref_"+duplicateIndex+state.dump)):(writeFlowMapping(state,level,state.dump),duplicate&&(state.dump="&ref_"+duplicateIndex+" "+state.dump));else if("[object Array]"===type)block&&0!==state.dump.length?(writeBlockSequence(state,level,state.dump,compact),duplicate&&(state.dump="&ref_"+duplicateIndex+state.dump)):(writeFlowSequence(state,level,state.dump),duplicate&&(state.dump="&ref_"+duplicateIndex+" "+state.dump));else{if("[object String]"!==type){if(state.skipInvalid)return!1;throw new YAMLException("unacceptable kind of an object to dump "+type)}"?"!==state.tag&&writeScalar(state,state.dump,level,iskey)}null!==state.tag&&"?"!==state.tag&&(state.dump="!<"+state.tag+"> "+state.dump)}return!0}function getDuplicateReferences(object,state){var index,length,objects=[],duplicatesIndexes=[];for(inspectNode(object,objects,duplicatesIndexes),index=0,length=duplicatesIndexes.length;index<length;index+=1)state.duplicates.push(objects[duplicatesIndexes[index]]);state.usedDuplicates=new Array(length)}function inspectNode(object,objects,duplicatesIndexes){var objectKeyList,index,length;if(null!==object&&"object"==typeof object)if(-1!==(index=objects.indexOf(object)))-1===duplicatesIndexes.indexOf(index)&&duplicatesIndexes.push(index);else if(objects.push(object),Array.isArray(object))for(index=0,length=object.length;index<length;index+=1)inspectNode(object[index],objects,duplicatesIndexes);else for(objectKeyList=Object.keys(object),index=0,length=objectKeyList.length;index<length;index+=1)inspectNode(object[objectKeyList[index]],objects,duplicatesIndexes)}function dump(input,options){options=options||{};var state=new State(options);return state.noRefs||getDuplicateReferences(input,state),writeNode(state,0,input,!0,!0)?state.dump+"\n":""}function safeDump(input,options){return dump(input,common.extend({schema:DEFAULT_SAFE_SCHEMA},options))}var common=require("./common"),YAMLException=require("./exception"),DEFAULT_FULL_SCHEMA=require("./schema/default_full"),DEFAULT_SAFE_SCHEMA=require("./schema/default_safe"),_toString=Object.prototype.toString,_hasOwnProperty=Object.prototype.hasOwnProperty,CHAR_TAB=9,CHAR_LINE_FEED=10,CHAR_SPACE=32,CHAR_EXCLAMATION=33,CHAR_DOUBLE_QUOTE=34,CHAR_SHARP=35,CHAR_PERCENT=37,CHAR_AMPERSAND=38,CHAR_SINGLE_QUOTE=39,CHAR_ASTERISK=42,CHAR_COMMA=44,CHAR_MINUS=45,CHAR_COLON=58,CHAR_GREATER_THAN=62,CHAR_QUESTION=63,CHAR_COMMERCIAL_AT=64,CHAR_LEFT_SQUARE_BRACKET=91,CHAR_RIGHT_SQUARE_BRACKET=93,CHAR_GRAVE_ACCENT=96,CHAR_LEFT_CURLY_BRACKET=123,CHAR_VERTICAL_LINE=124,CHAR_RIGHT_CURLY_BRACKET=125,ESCAPE_SEQUENCES={};ESCAPE_SEQUENCES[0]="\\0",ESCAPE_SEQUENCES[7]="\\a",ESCAPE_SEQUENCES[8]="\\b",ESCAPE_SEQUENCES[9]="\\t",ESCAPE_SEQUENCES[10]="\\n",ESCAPE_SEQUENCES[11]="\\v",ESCAPE_SEQUENCES[12]="\\f",ESCAPE_SEQUENCES[13]="\\r",ESCAPE_SEQUENCES[27]="\\e",ESCAPE_SEQUENCES[34]='\\"',ESCAPE_SEQUENCES[92]="\\\\",ESCAPE_SEQUENCES[133]="\\N",ESCAPE_SEQUENCES[160]="\\_",ESCAPE_SEQUENCES[8232]="\\L",ESCAPE_SEQUENCES[8233]="\\P";var DEPRECATED_BOOLEANS_SYNTAX=["y","Y","yes","Yes","YES","on","On","ON","n","N","no","No","NO","off","Off","OFF"],STYLE_PLAIN=1,STYLE_SINGLE=2,STYLE_LITERAL=3,STYLE_FOLDED=4,STYLE_DOUBLE=5;module.exports.dump=dump,module.exports.safeDump=safeDump},{"./common":2,"./exception":4,"./schema/default_full":9,"./schema/default_safe":10}],4:[function(require,module,exports){"use strict";function YAMLException(reason,mark){Error.call(this),Error.captureStackTrace?Error.captureStackTrace(this,this.constructor):this.stack=(new Error).stack||"",this.name="YAMLException",this.reason=reason,this.mark=mark,this.message=(this.reason||"(unknown reason)")+(this.mark?" "+this.mark.toString():"")}YAMLException.prototype=Object.create(Error.prototype),YAMLException.prototype.constructor=YAMLException,YAMLException.prototype.toString=function(compact){var result=this.name+": ";return result+=this.reason||"(unknown reason)",!compact&&this.mark&&(result+=" "+this.mark.toString()),result},module.exports=YAMLException},{}],5:[function(require,module,exports){"use strict";function is_EOL(c){return 10===c||13===c}function is_WHITE_SPACE(c){return 9===c||32===c}function is_WS_OR_EOL(c){return 9===c||32===c||10===c||13===c}function is_FLOW_INDICATOR(c){return 44===c||91===c||93===c||123===c||125===c}function fromHexCode(c){var lc;return 48<=c&&c<=57?c-48:(lc=32|c,97<=lc&&lc<=102?lc-97+10:-1)}function escapedHexLen(c){return 120===c?2:117===c?4:85===c?8:0}function fromDecimalCode(c){return 48<=c&&c<=57?c-48:-1}function simpleEscapeSequence(c){return 48===c?"\0":97===c?"":98===c?"\b":116===c?"\t":9===c?"\t":110===c?"\n":118===c?"\v":102===c?"\f":114===c?"\r":101===c?"":32===c?" ":34===c?'"':47===c?"/":92===c?"\\":78===c?"":95===c?"":76===c?"\u2028":80===c?"\u2029":""}function charFromCodepoint(c){return c<=65535?String.fromCharCode(c):String.fromCharCode(55296+(c-65536>>10),56320+(c-65536&1023))}function State(input,options){this.input=input,this.filename=options.filename||null,this.schema=options.schema||DEFAULT_FULL_SCHEMA,this.onWarning=options.onWarning||null,this.legacy=options.legacy||!1,this.json=options.json||!1,this.listener=options.listener||null,this.implicitTypes=this.schema.compiledImplicit,this.typeMap=this.schema.compiledTypeMap,this.length=input.length,this.position=0,this.line=0,this.lineStart=0,this.lineIndent=0,this.documents=[]}function generateError(state,message){return new YAMLException(message,new Mark(state.filename,state.input,state.position,state.line,state.position-state.lineStart))}function throwError(state,message){throw generateError(state,message)}function throwWarning(state,message){state.onWarning&&state.onWarning.call(null,generateError(state,message))}function captureSegment(state,start,end,checkJson){var _position,_length,_character,_result;if(start<end){if(_result=state.input.slice(start,end),checkJson)for(_position=0,_length=_result.length;_position<_length;_position+=1)9===(_character=_result.charCodeAt(_position))||32<=_character&&_character<=1114111||throwError(state,"expected valid JSON character");else PATTERN_NON_PRINTABLE.test(_result)&&throwError(state,"the stream contains non-printable characters");state.result+=_result}}function mergeMappings(state,destination,source,overridableKeys){var sourceKeys,key,index,quantity;for(common.isObject(source)||throwError(state,"cannot merge mappings; the provided source object is unacceptable"),sourceKeys=Object.keys(source),index=0,quantity=sourceKeys.length;index<quantity;index+=1)key=sourceKeys[index],_hasOwnProperty.call(destination,key)||(destination[key]=source[key],overridableKeys[key]=!0)}function storeMappingPair(state,_result,overridableKeys,keyTag,keyNode,valueNode,startLine,startPos){var index,quantity;if(keyNode=String(keyNode),null===_result&&(_result={}),"tag:yaml.org,2002:merge"===keyTag)if(Array.isArray(valueNode))for(index=0,quantity=valueNode.length;index<quantity;index+=1)mergeMappings(state,_result,valueNode[index],overridableKeys);else mergeMappings(state,_result,valueNode,overridableKeys);else state.json||_hasOwnProperty.call(overridableKeys,keyNode)||!_hasOwnProperty.call(_result,keyNode)||(state.line=startLine||state.line,state.position=startPos||state.position,throwError(state,"duplicated mapping key")),_result[keyNode]=valueNode,delete overridableKeys[keyNode];return _result}function readLineBreak(state){var ch;ch=state.input.charCodeAt(state.position),10===ch?state.position++:13===ch?(state.position++,10===state.input.charCodeAt(state.position)&&state.position++):throwError(state,"a line break is expected"),state.line+=1,state.lineStart=state.position}function skipSeparationSpace(state,allowComments,checkIndent){for(var lineBreaks=0,ch=state.input.charCodeAt(state.position);0!==ch;){for(;is_WHITE_SPACE(ch);)ch=state.input.charCodeAt(++state.position);if(allowComments&&35===ch)do{ch=state.input.charCodeAt(++state.position)}while(10!==ch&&13!==ch&&0!==ch);if(!is_EOL(ch))break;for(readLineBreak(state),ch=state.input.charCodeAt(state.position),lineBreaks++,state.lineIndent=0;32===ch;)state.lineIndent++,ch=state.input.charCodeAt(++state.position)}return-1!==checkIndent&&0!==lineBreaks&&state.lineIndent<checkIndent&&throwWarning(state,"deficient indentation"),lineBreaks}function testDocumentSeparator(state){var ch,_position=state.position;return!(45!==(ch=state.input.charCodeAt(_position))&&46!==ch||ch!==state.input.charCodeAt(_position+1)||ch!==state.input.charCodeAt(_position+2)||(_position+=3,0!==(ch=state.input.charCodeAt(_position))&&!is_WS_OR_EOL(ch)))}function writeFoldedLines(state,count){1===count?state.result+=" ":count>1&&(state.result+=common.repeat("\n",count-1))}function readPlainScalar(state,nodeIndent,withinFlowCollection){var preceding,following,captureStart,captureEnd,hasPendingContent,_line,_lineStart,_lineIndent,ch,_kind=state.kind,_result=state.result;if(ch=state.input.charCodeAt(state.position),is_WS_OR_EOL(ch)||is_FLOW_INDICATOR(ch)||35===ch||38===ch||42===ch||33===ch||124===ch||62===ch||39===ch||34===ch||37===ch||64===ch||96===ch)return!1;if((63===ch||45===ch)&&(following=state.input.charCodeAt(state.position+1),is_WS_OR_EOL(following)||withinFlowCollection&&is_FLOW_INDICATOR(following)))return!1;for(state.kind="scalar",state.result="",captureStart=captureEnd=state.position,hasPendingContent=!1;0!==ch;){if(58===ch){if(following=state.input.charCodeAt(state.position+1),is_WS_OR_EOL(following)||withinFlowCollection&&is_FLOW_INDICATOR(following))break}else if(35===ch){if(preceding=state.input.charCodeAt(state.position-1),is_WS_OR_EOL(preceding))break}else{if(state.position===state.lineStart&&testDocumentSeparator(state)||withinFlowCollection&&is_FLOW_INDICATOR(ch))break;if(is_EOL(ch)){if(_line=state.line,_lineStart=state.lineStart,_lineIndent=state.lineIndent,skipSeparationSpace(state,!1,-1),state.lineIndent>=nodeIndent){hasPendingContent=!0,ch=state.input.charCodeAt(state.position);continue}state.position=captureEnd,state.line=_line,state.lineStart=_lineStart,state.lineIndent=_lineIndent;break}}hasPendingContent&&(captureSegment(state,captureStart,captureEnd,!1),writeFoldedLines(state,state.line-_line),captureStart=captureEnd=state.position,hasPendingContent=!1),is_WHITE_SPACE(ch)||(captureEnd=state.position+1),ch=state.input.charCodeAt(++state.position)}return captureSegment(state,captureStart,captureEnd,!1),!!state.result||(state.kind=_kind,state.result=_result,!1)}function readSingleQuotedScalar(state,nodeIndent){var ch,captureStart,captureEnd;if(39!==(ch=state.input.charCodeAt(state.position)))return!1;for(state.kind="scalar",state.result="",state.position++,captureStart=captureEnd=state.position;0!==(ch=state.input.charCodeAt(state.position));)if(39===ch){if(captureSegment(state,captureStart,state.position,!0),39!==(ch=state.input.charCodeAt(++state.position)))return!0;captureStart=state.position,state.position++,captureEnd=state.position}else is_EOL(ch)?(captureSegment(state,captureStart,captureEnd,!0),writeFoldedLines(state,skipSeparationSpace(state,!1,nodeIndent)),captureStart=captureEnd=state.position):state.position===state.lineStart&&testDocumentSeparator(state)?throwError(state,"unexpected end of the document within a single quoted scalar"):(state.position++,captureEnd=state.position);throwError(state,"unexpected end of the stream within a single quoted scalar")}function readDoubleQuotedScalar(state,nodeIndent){var captureStart,captureEnd,hexLength,hexResult,tmp,ch;if(34!==(ch=state.input.charCodeAt(state.position)))return!1;for(state.kind="scalar",state.result="",state.position++,captureStart=captureEnd=state.position;0!==(ch=state.input.charCodeAt(state.position));){if(34===ch)return captureSegment(state,captureStart,state.position,!0),state.position++,!0;if(92===ch){if(captureSegment(state,captureStart,state.position,!0),ch=state.input.charCodeAt(++state.position),is_EOL(ch))skipSeparationSpace(state,!1,nodeIndent);else if(ch<256&&simpleEscapeCheck[ch])state.result+=simpleEscapeMap[ch],state.position++;else if((tmp=escapedHexLen(ch))>0){for(hexLength=tmp,hexResult=0;hexLength>0;hexLength--)ch=state.input.charCodeAt(++state.position),(tmp=fromHexCode(ch))>=0?hexResult=(hexResult<<4)+tmp:throwError(state,"expected hexadecimal character");state.result+=charFromCodepoint(hexResult),state.position++}else throwError(state,"unknown escape sequence");captureStart=captureEnd=state.position}else is_EOL(ch)?(captureSegment(state,captureStart,captureEnd,!0),writeFoldedLines(state,skipSeparationSpace(state,!1,nodeIndent)),captureStart=captureEnd=state.position):state.position===state.lineStart&&testDocumentSeparator(state)?throwError(state,"unexpected end of the document within a double quoted scalar"):(state.position++,captureEnd=state.position)}throwError(state,"unexpected end of the stream within a double quoted scalar")}function readFlowCollection(state,nodeIndent){var _line,_result,following,terminator,isPair,isExplicitPair,isMapping,keyNode,keyTag,valueNode,ch,readNext=!0,_tag=state.tag,_anchor=state.anchor,overridableKeys={};if(91===(ch=state.input.charCodeAt(state.position)))terminator=93,isMapping=!1,_result=[];else{if(123!==ch)return!1;terminator=125,isMapping=!0,_result={}}for(null!==state.anchor&&(state.anchorMap[state.anchor]=_result),ch=state.input.charCodeAt(++state.position);0!==ch;){if(skipSeparationSpace(state,!0,nodeIndent),(ch=state.input.charCodeAt(state.position))===terminator)return state.position++,state.tag=_tag,state.anchor=_anchor,state.kind=isMapping?"mapping":"sequence",state.result=_result,!0;readNext||throwError(state,"missed comma between flow collection entries"),keyTag=keyNode=valueNode=null,isPair=isExplicitPair=!1,63===ch&&(following=state.input.charCodeAt(state.position+1),is_WS_OR_EOL(following)&&(isPair=isExplicitPair=!0,state.position++,skipSeparationSpace(state,!0,nodeIndent))),_line=state.line,composeNode(state,nodeIndent,CONTEXT_FLOW_IN,!1,!0),keyTag=state.tag,keyNode=state.result,skipSeparationSpace(state,!0,nodeIndent),ch=state.input.charCodeAt(state.position),!isExplicitPair&&state.line!==_line||58!==ch||(isPair=!0,ch=state.input.charCodeAt(++state.position),skipSeparationSpace(state,!0,nodeIndent),composeNode(state,nodeIndent,CONTEXT_FLOW_IN,!1,!0),valueNode=state.result),isMapping?storeMappingPair(state,_result,overridableKeys,keyTag,keyNode,valueNode):isPair?_result.push(storeMappingPair(state,null,overridableKeys,keyTag,keyNode,valueNode)):_result.push(keyNode),skipSeparationSpace(state,!0,nodeIndent),ch=state.input.charCodeAt(state.position),44===ch?(readNext=!0,ch=state.input.charCodeAt(++state.position)):readNext=!1}throwError(state,"unexpected end of the stream within a flow collection")}function readBlockScalar(state,nodeIndent){var captureStart,folding,tmp,ch,chomping=CHOMPING_CLIP,didReadContent=!1,detectedIndent=!1,textIndent=nodeIndent,emptyLines=0,atMoreIndented=!1;if(124===(ch=state.input.charCodeAt(state.position)))folding=!1;else{if(62!==ch)return!1;folding=!0}for(state.kind="scalar",state.result="";0!==ch;)if(43===(ch=state.input.charCodeAt(++state.position))||45===ch)CHOMPING_CLIP===chomping?chomping=43===ch?CHOMPING_KEEP:CHOMPING_STRIP:throwError(state,"repeat of a chomping mode identifier");else{if(!((tmp=fromDecimalCode(ch))>=0))break;0===tmp?throwError(state,"bad explicit indentation width of a block scalar; it cannot be less than one"):detectedIndent?throwError(state,"repeat of an indentation width identifier"):(textIndent=nodeIndent+tmp-1,detectedIndent=!0)}if(is_WHITE_SPACE(ch)){do{ch=state.input.charCodeAt(++state.position)}while(is_WHITE_SPACE(ch));if(35===ch)do{ch=state.input.charCodeAt(++state.position)}while(!is_EOL(ch)&&0!==ch)}for(;0!==ch;){for(readLineBreak(state),state.lineIndent=0,ch=state.input.charCodeAt(state.position);(!detectedIndent||state.lineIndent<textIndent)&&32===ch;)state.lineIndent++,ch=state.input.charCodeAt(++state.position);if(!detectedIndent&&state.lineIndent>textIndent&&(textIndent=state.lineIndent),is_EOL(ch))emptyLines++;else{if(state.lineIndent<textIndent){chomping===CHOMPING_KEEP?state.result+=common.repeat("\n",didReadContent?1+emptyLines:emptyLines):chomping===CHOMPING_CLIP&&didReadContent&&(state.result+="\n");break}for(folding?is_WHITE_SPACE(ch)?(atMoreIndented=!0,state.result+=common.repeat("\n",didReadContent?1+emptyLines:emptyLines)):atMoreIndented?(atMoreIndented=!1,state.result+=common.repeat("\n",emptyLines+1)):0===emptyLines?didReadContent&&(state.result+=" "):state.result+=common.repeat("\n",emptyLines):state.result+=common.repeat("\n",didReadContent?1+emptyLines:emptyLines),didReadContent=!0,detectedIndent=!0,emptyLines=0,captureStart=state.position;!is_EOL(ch)&&0!==ch;)ch=state.input.charCodeAt(++state.position);captureSegment(state,captureStart,state.position,!1)}}return!0}function readBlockSequence(state,nodeIndent){var _line,following,ch,_tag=state.tag,_anchor=state.anchor,_result=[],detected=!1;for(null!==state.anchor&&(state.anchorMap[state.anchor]=_result),ch=state.input.charCodeAt(state.position);0!==ch&&45===ch&&(following=state.input.charCodeAt(state.position+1),is_WS_OR_EOL(following));)if(detected=!0,state.position++,skipSeparationSpace(state,!0,-1)&&state.lineIndent<=nodeIndent)_result.push(null),ch=state.input.charCodeAt(state.position);else if(_line=state.line,composeNode(state,nodeIndent,CONTEXT_BLOCK_IN,!1,!0),_result.push(state.result),skipSeparationSpace(state,!0,-1),ch=state.input.charCodeAt(state.position),(state.line===_line||state.lineIndent>nodeIndent)&&0!==ch)throwError(state,"bad indentation of a sequence entry");else if(state.lineIndent<nodeIndent)break;return!!detected&&(state.tag=_tag,state.anchor=_anchor,state.kind="sequence",state.result=_result,!0)}function readBlockMapping(state,nodeIndent,flowIndent){var following,allowCompact,_line,_pos,ch,_tag=state.tag,_anchor=state.anchor,_result={},overridableKeys={},keyTag=null,keyNode=null,valueNode=null,atExplicitKey=!1,detected=!1;for(null!==state.anchor&&(state.anchorMap[state.anchor]=_result),ch=state.input.charCodeAt(state.position);0!==ch;){if(following=state.input.charCodeAt(state.position+1),_line=state.line,_pos=state.position,63!==ch&&58!==ch||!is_WS_OR_EOL(following)){if(!composeNode(state,flowIndent,CONTEXT_FLOW_OUT,!1,!0))break;if(state.line===_line){for(ch=state.input.charCodeAt(state.position);is_WHITE_SPACE(ch);)ch=state.input.charCodeAt(++state.position);if(58===ch)ch=state.input.charCodeAt(++state.position),is_WS_OR_EOL(ch)||throwError(state,"a whitespace character is expected after the key-value separator within a block mapping"),atExplicitKey&&(storeMappingPair(state,_result,overridableKeys,keyTag,keyNode,null),keyTag=keyNode=valueNode=null),detected=!0,atExplicitKey=!1,allowCompact=!1,keyTag=state.tag,keyNode=state.result;else{if(!detected)return state.tag=_tag,state.anchor=_anchor,!0;throwError(state,"can not read an implicit mapping pair; a colon is missed")}}else{if(!detected)return state.tag=_tag,state.anchor=_anchor,!0;throwError(state,"can not read a block mapping entry; a multiline key may not be an implicit key")}}else 63===ch?(atExplicitKey&&(storeMappingPair(state,_result,overridableKeys,keyTag,keyNode,null),keyTag=keyNode=valueNode=null),detected=!0,atExplicitKey=!0,allowCompact=!0):atExplicitKey?(atExplicitKey=!1,allowCompact=!0):throwError(state,"incomplete explicit mapping pair; a key node is missed"),state.position+=1,ch=following;if((state.line===_line||state.lineIndent>nodeIndent)&&(composeNode(state,nodeIndent,CONTEXT_BLOCK_OUT,!0,allowCompact)&&(atExplicitKey?keyNode=state.result:valueNode=state.result),atExplicitKey||(storeMappingPair(state,_result,overridableKeys,keyTag,keyNode,valueNode,_line,_pos),keyTag=keyNode=valueNode=null),skipSeparationSpace(state,!0,-1),ch=state.input.charCodeAt(state.position)),state.lineIndent>nodeIndent&&0!==ch)throwError(state,"bad indentation of a mapping entry");else if(state.lineIndent<nodeIndent)break}return atExplicitKey&&storeMappingPair(state,_result,overridableKeys,keyTag,keyNode,null),detected&&(state.tag=_tag,state.anchor=_anchor,state.kind="mapping",state.result=_result),detected}function readTagProperty(state){var _position,tagHandle,tagName,ch,isVerbatim=!1,isNamed=!1;if(33!==(ch=state.input.charCodeAt(state.position)))return!1;if(null!==state.tag&&throwError(state,"duplication of a tag property"),ch=state.input.charCodeAt(++state.position),60===ch?(isVerbatim=!0,ch=state.input.charCodeAt(++state.position)):33===ch?(isNamed=!0,tagHandle="!!",ch=state.input.charCodeAt(++state.position)):tagHandle="!",_position=state.position,isVerbatim){do{ch=state.input.charCodeAt(++state.position)}while(0!==ch&&62!==ch);state.position<state.length?(tagName=state.input.slice(_position,state.position),ch=state.input.charCodeAt(++state.position)):throwError(state,"unexpected end of the stream within a verbatim tag")}else{for(;0!==ch&&!is_WS_OR_EOL(ch);)33===ch&&(isNamed?throwError(state,"tag suffix cannot contain exclamation marks"):(tagHandle=state.input.slice(_position-1,state.position+1),PATTERN_TAG_HANDLE.test(tagHandle)||throwError(state,"named tag handle cannot contain such characters"),isNamed=!0,_position=state.position+1)),ch=state.input.charCodeAt(++state.position);tagName=state.input.slice(_position,state.position),PATTERN_FLOW_INDICATORS.test(tagName)&&throwError(state,"tag suffix cannot contain flow indicator characters")}return tagName&&!PATTERN_TAG_URI.test(tagName)&&throwError(state,"tag name cannot contain such characters: "+tagName),isVerbatim?state.tag=tagName:_hasOwnProperty.call(state.tagMap,tagHandle)?state.tag=state.tagMap[tagHandle]+tagName:"!"===tagHandle?state.tag="!"+tagName:"!!"===tagHandle?state.tag="tag:yaml.org,2002:"+tagName:throwError(state,'undeclared tag handle "'+tagHandle+'"'),!0}function readAnchorProperty(state){var _position,ch;if(38!==(ch=state.input.charCodeAt(state.position)))return!1;for(null!==state.anchor&&throwError(state,"duplication of an anchor property"),ch=state.input.charCodeAt(++state.position),_position=state.position;0!==ch&&!is_WS_OR_EOL(ch)&&!is_FLOW_INDICATOR(ch);)ch=state.input.charCodeAt(++state.position);return state.position===_position&&throwError(state,"name of an anchor node must contain at least one character"),state.anchor=state.input.slice(_position,state.position),!0}function readAlias(state){var _position,alias,ch;if(42!==(ch=state.input.charCodeAt(state.position)))return!1;for(ch=state.input.charCodeAt(++state.position),_position=state.position;0!==ch&&!is_WS_OR_EOL(ch)&&!is_FLOW_INDICATOR(ch);)ch=state.input.charCodeAt(++state.position);return state.position===_position&&throwError(state,"name of an alias node must contain at least one character"),alias=state.input.slice(_position,state.position),state.anchorMap.hasOwnProperty(alias)||throwError(state,'unidentified alias "'+alias+'"'),state.result=state.anchorMap[alias],skipSeparationSpace(state,!0,-1),!0}function composeNode(state,parentIndent,nodeContext,allowToSeek,allowCompact){var allowBlockStyles,allowBlockScalars,allowBlockCollections,typeIndex,typeQuantity,type,flowIndent,blockIndent,indentStatus=1,atNewLine=!1,hasContent=!1;if(null!==state.listener&&state.listener("open",state),state.tag=null,state.anchor=null,state.kind=null,state.result=null,allowBlockStyles=allowBlockScalars=allowBlockCollections=CONTEXT_BLOCK_OUT===nodeContext||CONTEXT_BLOCK_IN===nodeContext,allowToSeek&&skipSeparationSpace(state,!0,-1)&&(atNewLine=!0,state.lineIndent>parentIndent?indentStatus=1:state.lineIndent===parentIndent?indentStatus=0:state.lineIndent<parentIndent&&(indentStatus=-1)),1===indentStatus)for(;readTagProperty(state)||readAnchorProperty(state);)skipSeparationSpace(state,!0,-1)?(atNewLine=!0,allowBlockCollections=allowBlockStyles,state.lineIndent>parentIndent?indentStatus=1:state.lineIndent===parentIndent?indentStatus=0:state.lineIndent<parentIndent&&(indentStatus=-1)):allowBlockCollections=!1;if(allowBlockCollections&&(allowBlockCollections=atNewLine||allowCompact),1!==indentStatus&&CONTEXT_BLOCK_OUT!==nodeContext||(flowIndent=CONTEXT_FLOW_IN===nodeContext||CONTEXT_FLOW_OUT===nodeContext?parentIndent:parentIndent+1,blockIndent=state.position-state.lineStart,1===indentStatus?allowBlockCollections&&(readBlockSequence(state,blockIndent)||readBlockMapping(state,blockIndent,flowIndent))||readFlowCollection(state,flowIndent)?hasContent=!0:(allowBlockScalars&&readBlockScalar(state,flowIndent)||readSingleQuotedScalar(state,flowIndent)||readDoubleQuotedScalar(state,flowIndent)?hasContent=!0:readAlias(state)?(hasContent=!0,null===state.tag&&null===state.anchor||throwError(state,"alias node should not have any properties")):readPlainScalar(state,flowIndent,CONTEXT_FLOW_IN===nodeContext)&&(hasContent=!0,null===state.tag&&(state.tag="?")),null!==state.anchor&&(state.anchorMap[state.anchor]=state.result)):0===indentStatus&&(hasContent=allowBlockCollections&&readBlockSequence(state,blockIndent))),null!==state.tag&&"!"!==state.tag)if("?"===state.tag){for(typeIndex=0,typeQuantity=state.implicitTypes.length;typeIndex<typeQuantity;typeIndex+=1)if(type=state.implicitTypes[typeIndex],type.resolve(state.result)){state.result=type.construct(state.result),state.tag=type.tag,null!==state.anchor&&(state.anchorMap[state.anchor]=state.result);break}}else _hasOwnProperty.call(state.typeMap[state.kind||"fallback"],state.tag)?(type=state.typeMap[state.kind||"fallback"][state.tag],null!==state.result&&type.kind!==state.kind&&throwError(state,"unacceptable node kind for !<"+state.tag+'> tag; it should be "'+type.kind+'", not "'+state.kind+'"'),type.resolve(state.result)?(state.result=type.construct(state.result),null!==state.anchor&&(state.anchorMap[state.anchor]=state.result)):throwError(state,"cannot resolve a node with !<"+state.tag+"> explicit tag")):throwError(state,"unknown tag !<"+state.tag+">");return null!==state.listener&&state.listener("close",state),null!==state.tag||null!==state.anchor||hasContent}function readDocument(state){var _position,directiveName,directiveArgs,ch,documentStart=state.position,hasDirectives=!1;for(state.version=null,state.checkLineBreaks=state.legacy,state.tagMap={},state.anchorMap={};0!==(ch=state.input.charCodeAt(state.position))&&(skipSeparationSpace(state,!0,-1),ch=state.input.charCodeAt(state.position),!(state.lineIndent>0||37!==ch));){for(hasDirectives=!0,ch=state.input.charCodeAt(++state.position),_position=state.position;0!==ch&&!is_WS_OR_EOL(ch);)ch=state.input.charCodeAt(++state.position);for(directiveName=state.input.slice(_position,state.position),directiveArgs=[],directiveName.length<1&&throwError(state,"directive name must not be less than one character in length");0!==ch;){for(;is_WHITE_SPACE(ch);)ch=state.input.charCodeAt(++state.position);if(35===ch){do{ch=state.input.charCodeAt(++state.position)}while(0!==ch&&!is_EOL(ch));break}if(is_EOL(ch))break;for(_position=state.position;0!==ch&&!is_WS_OR_EOL(ch);)ch=state.input.charCodeAt(++state.position);directiveArgs.push(state.input.slice(_position,state.position))}0!==ch&&readLineBreak(state),_hasOwnProperty.call(directiveHandlers,directiveName)?directiveHandlers[directiveName](state,directiveName,directiveArgs):throwWarning(state,'unknown document directive "'+directiveName+'"')}if(skipSeparationSpace(state,!0,-1),0===state.lineIndent&&45===state.input.charCodeAt(state.position)&&45===state.input.charCodeAt(state.position+1)&&45===state.input.charCodeAt(state.position+2)?(state.position+=3,skipSeparationSpace(state,!0,-1)):hasDirectives&&throwError(state,"directives end mark is expected"),composeNode(state,state.lineIndent-1,CONTEXT_BLOCK_OUT,!1,!0),skipSeparationSpace(state,!0,-1),state.checkLineBreaks&&PATTERN_NON_ASCII_LINE_BREAKS.test(state.input.slice(documentStart,state.position))&&throwWarning(state,"non-ASCII line breaks are interpreted as content"),state.documents.push(state.result),state.position===state.lineStart&&testDocumentSeparator(state))return void(46===state.input.charCodeAt(state.position)&&(state.position+=3,skipSeparationSpace(state,!0,-1)));state.position<state.length-1&&throwError(state,"end of the stream or a document separator is expected")}function loadDocuments(input,options){input=String(input),options=options||{},0!==input.length&&(10!==input.charCodeAt(input.length-1)&&13!==input.charCodeAt(input.length-1)&&(input+="\n"),65279===input.charCodeAt(0)&&(input=input.slice(1)));var state=new State(input,options);for(state.input+="\0";32===state.input.charCodeAt(state.position);)state.lineIndent+=1,state.position+=1;for(;state.position<state.length-1;)readDocument(state);return state.documents}function loadAll(input,iterator,options){var index,length,documents=loadDocuments(input,options);for(index=0,length=documents.length;index<length;index+=1)iterator(documents[index])}function load(input,options){var documents=loadDocuments(input,options);if(0!==documents.length){if(1===documents.length)return documents[0];throw new YAMLException("expected a single document in the stream, but found more")}}function safeLoadAll(input,output,options){loadAll(input,output,common.extend({schema:DEFAULT_SAFE_SCHEMA},options))}function safeLoad(input,options){return load(input,common.extend({schema:DEFAULT_SAFE_SCHEMA},options))}for(var common=require("./common"),YAMLException=require("./exception"),Mark=require("./mark"),DEFAULT_SAFE_SCHEMA=require("./schema/default_safe"),DEFAULT_FULL_SCHEMA=require("./schema/default_full"),_hasOwnProperty=Object.prototype.hasOwnProperty,CONTEXT_FLOW_IN=1,CONTEXT_FLOW_OUT=2,CONTEXT_BLOCK_IN=3,CONTEXT_BLOCK_OUT=4,CHOMPING_CLIP=1,CHOMPING_STRIP=2,CHOMPING_KEEP=3,PATTERN_NON_PRINTABLE=/[\x00-\x08\x0B\x0C\x0E-\x1F\x7F-\x84\x86-\x9F\uFFFE\uFFFF]|[\uD800-\uDBFF](?![\uDC00-\uDFFF])|(?:[^\uD800-\uDBFF]|^)[\uDC00-\uDFFF]/,PATTERN_NON_ASCII_LINE_BREAKS=/[\x85\u2028\u2029]/,PATTERN_FLOW_INDICATORS=/[,\[\]\{\}]/,PATTERN_TAG_HANDLE=/^(?:!|!!|![a-z\-]+!)$/i,PATTERN_TAG_URI=/^(?:!|[^,\[\]\{\}])(?:%[0-9a-f]{2}|[0-9a-z\-#;\/\?:@&=\+\$,_\.!~\*'\(\)\[\]])*$/i,simpleEscapeCheck=new Array(256),simpleEscapeMap=new Array(256),i=0;i<256;i++)simpleEscapeCheck[i]=simpleEscapeSequence(i)?1:0,simpleEscapeMap[i]=simpleEscapeSequence(i);var directiveHandlers={YAML:function(state,name,args){var match,major,minor;null!==state.version&&throwError(state,"duplication of %YAML directive"),1!==args.length&&throwError(state,"YAML directive accepts exactly one argument"),match=/^([0-9]+)\.([0-9]+)$/.exec(args[0]),null===match&&throwError(state,"ill-formed argument of the YAML directive"),major=parseInt(match[1],10),minor=parseInt(match[2],10),1!==major&&throwError(state,"unacceptable YAML version of the document"),state.version=args[0],state.checkLineBreaks=minor<2,1!==minor&&2!==minor&&throwWarning(state,"unsupported YAML version of the document")},TAG:function(state,name,args){var handle,prefix;2!==args.length&&throwError(state,"TAG directive accepts exactly two arguments"),handle=args[0],prefix=args[1],PATTERN_TAG_HANDLE.test(handle)||throwError(state,"ill-formed tag handle (first argument) of the TAG directive"),_hasOwnProperty.call(state.tagMap,handle)&&throwError(state,'there is a previously declared suffix for "'+handle+'" tag handle'),PATTERN_TAG_URI.test(prefix)||throwError(state,"ill-formed tag prefix (second argument) of the TAG directive"),state.tagMap[handle]=prefix}};module.exports.loadAll=loadAll,module.exports.load=load,module.exports.safeLoadAll=safeLoadAll,module.exports.safeLoad=safeLoad},{"./common":2,"./exception":4,"./mark":6,"./schema/default_full":9,"./schema/default_safe":10}],6:[function(require,module,exports){"use strict";function Mark(name,buffer,position,line,column){this.name=name,this.buffer=buffer,this.position=position,this.line=line,this.column=column}var common=require("./common");Mark.prototype.getSnippet=function(indent,maxLength){var head,start,tail,end,snippet;if(!this.buffer)return null;for(indent=indent||4,maxLength=maxLength||75,head="",start=this.position;start>0&&-1==="\0\r\n\u2028\u2029".indexOf(this.buffer.charAt(start-1));)if(start-=1,this.position-start>maxLength/2-1){head=" ... ",start+=5;break}for(tail="",end=this.position;end<this.buffer.length&&-1==="\0\r\n\u2028\u2029".indexOf(this.buffer.charAt(end));)if((end+=1)-this.position>maxLength/2-1){tail=" ... ",end-=5;break}return snippet=this.buffer.slice(start,end),common.repeat(" ",indent)+head+snippet+tail+"\n"+common.repeat(" ",indent+this.position-start+head.length)+"^"},Mark.prototype.toString=function(compact){var snippet,where="";return this.name&&(where+='in "'+this.name+'" '),where+="at line "+(this.line+1)+", column "+(this.column+1),compact||(snippet=this.getSnippet())&&(where+=":\n"+snippet),where},module.exports=Mark},{"./common":2}],7:[function(require,module,exports){"use strict";function compileList(schema,name,result){var exclude=[];return schema.include.forEach(function(includedSchema){result=compileList(includedSchema,name,result)}),schema[name].forEach(function(currentType){result.forEach(function(previousType,previousIndex){previousType.tag===currentType.tag&&previousType.kind===currentType.kind&&exclude.push(previousIndex)}),result.push(currentType)}),result.filter(function(type,index){return-1===exclude.indexOf(index)})}function compileMap(){function collectType(type){result[type.kind][type.tag]=result.fallback[type.tag]=type}var index,length,result={scalar:{},sequence:{},mapping:{},fallback:{}};for(index=0,length=arguments.length;index<length;index+=1)arguments[index].forEach(collectType);return result}function Schema(definition){this.include=definition.include||[],this.implicit=definition.implicit||[],this.explicit=definition.explicit||[],this.implicit.forEach(function(type){if(type.loadKind&&"scalar"!==type.loadKind)throw new YAMLException("There is a non-scalar type in the implicit list of a schema. Implicit resolving of such types is not supported.")}),this.compiledImplicit=compileList(this,"implicit",[]),this.compiledExplicit=compileList(this,"explicit",[]),this.compiledTypeMap=compileMap(this.compiledImplicit,this.compiledExplicit)}var common=require("./common"),YAMLException=require("./exception"),Type=require("./type");Schema.DEFAULT=null,Schema.create=function(){var schemas,types;switch(arguments.length){case 1:schemas=Schema.DEFAULT,types=arguments[0];break;case 2:schemas=arguments[0],types=arguments[1];break;default:throw new YAMLException("Wrong number of arguments for Schema.create function")}if(schemas=common.toArray(schemas),types=common.toArray(types),!schemas.every(function(schema){return schema instanceof Schema}))throw new YAMLException("Specified list of super schemas (or a single Schema object) contains a non-Schema object.");if(!types.every(function(type){return type instanceof Type}))throw new YAMLException("Specified list of YAML types (or a single Type object) contains a non-Type object.");return new Schema({include:schemas,explicit:types})},module.exports=Schema},{"./common":2,"./exception":4,"./type":13}],8:[function(require,module,exports){"use strict";var Schema=require("../schema");module.exports=new Schema({include:[require("./json")]})},{"../schema":7,"./json":12}],9:[function(require,module,exports){"use strict";var Schema=require("../schema");module.exports=Schema.DEFAULT=new Schema({include:[require("./default_safe")],explicit:[require("../type/js/undefined"),require("../type/js/regexp"),require("../type/js/function")]})},{"../schema":7,"../type/js/function":18,"../type/js/regexp":19,"../type/js/undefined":20,"./default_safe":10}],10:[function(require,module,exports){"use strict";var Schema=require("../schema");module.exports=new Schema({include:[require("./core")],implicit:[require("../type/timestamp"),require("../type/merge")],explicit:[require("../type/binary"),require("../type/omap"),require("../type/pairs"),require("../type/set")]})},{"../schema":7,"../type/binary":14,"../type/merge":22,"../type/omap":24,"../type/pairs":25,"../type/set":27,"../type/timestamp":29,"./core":8}],11:[function(require,module,exports){"use strict";var Schema=require("../schema");module.exports=new Schema({explicit:[require("../type/str"),require("../type/seq"),require("../type/map")]})},{"../schema":7,"../type/map":21,"../type/seq":26,"../type/str":28}],12:[function(require,module,exports){"use strict";var Schema=require("../schema");module.exports=new Schema({include:[require("./failsafe")],implicit:[require("../type/null"),require("../type/bool"),require("../type/int"),require("../type/float")]})},{"../schema":7,"../type/bool":15,"../type/float":16,"../type/int":17,"../type/null":23,"./failsafe":11}],13:[function(require,module,exports){"use strict";function compileStyleAliases(map){var result={};return null!==map&&Object.keys(map).forEach(function(style){map[style].forEach(function(alias){result[String(alias)]=style})}),result}function Type(tag,options){if(options=options||{},Object.keys(options).forEach(function(name){if(-1===TYPE_CONSTRUCTOR_OPTIONS.indexOf(name))throw new YAMLException('Unknown option "'+name+'" is met in definition of "'+tag+'" YAML type.')}),this.tag=tag,this.kind=options.kind||null,this.resolve=options.resolve||function(){return!0},this.construct=options.construct||function(data){return data},this.instanceOf=options.instanceOf||null,this.predicate=options.predicate||null,this.represent=options.represent||null,this.defaultStyle=options.defaultStyle||null,this.styleAliases=compileStyleAliases(options.styleAliases||null),-1===YAML_NODE_KINDS.indexOf(this.kind))throw new YAMLException('Unknown kind "'+this.kind+'" is specified for "'+tag+'" YAML type.')}var YAMLException=require("./exception"),TYPE_CONSTRUCTOR_OPTIONS=["kind","resolve","construct","instanceOf","predicate","represent","defaultStyle","styleAliases"],YAML_NODE_KINDS=["scalar","sequence","mapping"];module.exports=Type},{"./exception":4}],14:[function(require,module,exports){"use strict";function resolveYamlBinary(data){if(null===data)return!1;var code,idx,bitlen=0,max=data.length,map=BASE64_MAP;for(idx=0;idx<max;idx++)if(!((code=map.indexOf(data.charAt(idx)))>64)){if(code<0)return!1;bitlen+=6}return bitlen%8==0}function constructYamlBinary(data){var idx,tailbits,input=data.replace(/[\r\n=]/g,""),max=input.length,map=BASE64_MAP,bits=0,result=[];for(idx=0;idx<max;idx++)idx%4==0&&idx&&(result.push(bits>>16&255),result.push(bits>>8&255),result.push(255&bits)),bits=bits<<6|map.indexOf(input.charAt(idx));return tailbits=max%4*6,0===tailbits?(result.push(bits>>16&255),result.push(bits>>8&255),result.push(255&bits)):18===tailbits?(result.push(bits>>10&255),result.push(bits>>2&255)):12===tailbits&&result.push(bits>>4&255),NodeBuffer?NodeBuffer.from?NodeBuffer.from(result):new NodeBuffer(result):result}function representYamlBinary(object){var idx,tail,result="",bits=0,max=object.length,map=BASE64_MAP;for(idx=0;idx<max;idx++)idx%3==0&&idx&&(result+=map[bits>>18&63],result+=map[bits>>12&63],result+=map[bits>>6&63],result+=map[63&bits]),bits=(bits<<8)+object[idx];return tail=max%3,0===tail?(result+=map[bits>>18&63],result+=map[bits>>12&63],result+=map[bits>>6&63],result+=map[63&bits]):2===tail?(result+=map[bits>>10&63],result+=map[bits>>4&63],result+=map[bits<<2&63],result+=map[64]):1===tail&&(result+=map[bits>>2&63],result+=map[bits<<4&63],result+=map[64],result+=map[64]),result}function isBinary(object){return NodeBuffer&&NodeBuffer.isBuffer(object)}var NodeBuffer;try{NodeBuffer=require("buffer").Buffer}catch(__){}var Type=require("../type"),BASE64_MAP="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=\n\r";module.exports=new Type("tag:yaml.org,2002:binary",{kind:"scalar",resolve:resolveYamlBinary,construct:constructYamlBinary,predicate:isBinary,represent:representYamlBinary})},{"../type":13}],15:[function(require,module,exports){"use strict";function resolveYamlBoolean(data){if(null===data)return!1;var max=data.length;return 4===max&&("true"===data||"True"===data||"TRUE"===data)||5===max&&("false"===data||"False"===data||"FALSE"===data)}function constructYamlBoolean(data){return"true"===data||"True"===data||"TRUE"===data}function isBoolean(object){return"[object Boolean]"===Object.prototype.toString.call(object)}var Type=require("../type");module.exports=new Type("tag:yaml.org,2002:bool",{kind:"scalar",resolve:resolveYamlBoolean,construct:constructYamlBoolean,predicate:isBoolean,represent:{lowercase:function(object){return object?"true":"false"},uppercase:function(object){return object?"TRUE":"FALSE"},camelcase:function(object){return object?"True":"False"}},defaultStyle:"lowercase"})},{"../type":13}],16:[function(require,module,exports){"use strict";function resolveYamlFloat(data){return null!==data&&!(!YAML_FLOAT_PATTERN.test(data)||"_"===data[data.length-1])}function constructYamlFloat(data){var value,sign,base,digits;return value=data.replace(/_/g,"").toLowerCase(),sign="-"===value[0]?-1:1,digits=[],"+-".indexOf(value[0])>=0&&(value=value.slice(1)),".inf"===value?1===sign?Number.POSITIVE_INFINITY:Number.NEGATIVE_INFINITY:".nan"===value?NaN:value.indexOf(":")>=0?(value.split(":").forEach(function(v){digits.unshift(parseFloat(v,10))}),value=0,base=1,digits.forEach(function(d){value+=d*base,base*=60}),sign*value):sign*parseFloat(value,10)}function representYamlFloat(object,style){var res;if(isNaN(object))switch(style){case"lowercase":return".nan";case"uppercase":return".NAN";case"camelcase":return".NaN"}else if(Number.POSITIVE_INFINITY===object)switch(style){case"lowercase":return".inf";case"uppercase":return".INF";case"camelcase":return".Inf"}else if(Number.NEGATIVE_INFINITY===object)switch(style){case"lowercase":return"-.inf";case"uppercase":return"-.INF";case"camelcase":return"-.Inf"}else if(common.isNegativeZero(object))return"-0.0";return res=object.toString(10),SCIENTIFIC_WITHOUT_DOT.test(res)?res.replace("e",".e"):res}function isFloat(object){return"[object Number]"===Object.prototype.toString.call(object)&&(object%1!=0||common.isNegativeZero(object))}var common=require("../common"),Type=require("../type"),YAML_FLOAT_PATTERN=new RegExp("^(?:[-+]?(?:0|[1-9][0-9_]*)(?:\\.[0-9_]*)?(?:[eE][-+]?[0-9]+)?|\\.[0-9_]+(?:[eE][-+]?[0-9]+)?|[-+]?[0-9][0-9_]*(?::[0-5]?[0-9])+\\.[0-9_]*|[-+]?\\.(?:inf|Inf|INF)|\\.(?:nan|NaN|NAN))$"),SCIENTIFIC_WITHOUT_DOT=/^[-+]?[0-9]+e/;module.exports=new Type("tag:yaml.org,2002:float",{kind:"scalar",resolve:resolveYamlFloat,construct:constructYamlFloat,predicate:isFloat,represent:representYamlFloat,defaultStyle:"lowercase"})},{"../common":2,"../type":13}],17:[function(require,module,exports){"use strict";function isHexCode(c){return 48<=c&&c<=57||65<=c&&c<=70||97<=c&&c<=102}function isOctCode(c){return 48<=c&&c<=55}function isDecCode(c){return 48<=c&&c<=57}function resolveYamlInteger(data){if(null===data)return!1;var ch,max=data.length,index=0,hasDigits=!1;if(!max)return!1;if(ch=data[index],"-"!==ch&&"+"!==ch||(ch=data[++index]),"0"===ch){if(index+1===max)return!0;if("b"===(ch=data[++index])){for(index++;index<max;index++)if("_"!==(ch=data[index])){if("0"!==ch&&"1"!==ch)return!1;hasDigits=!0}return hasDigits&&"_"!==ch}if("x"===ch){for(index++;index<max;index++)if("_"!==(ch=data[index])){if(!isHexCode(data.charCodeAt(index)))return!1;hasDigits=!0}return hasDigits&&"_"!==ch}for(;index<max;index++)if("_"!==(ch=data[index])){if(!isOctCode(data.charCodeAt(index)))return!1;hasDigits=!0}return hasDigits&&"_"!==ch}if("_"===ch)return!1;for(;index<max;index++)if("_"!==(ch=data[index])){if(":"===ch)break;if(!isDecCode(data.charCodeAt(index)))return!1;hasDigits=!0}return!(!hasDigits||"_"===ch)&&(":"!==ch||/^(:[0-5]?[0-9])+$/.test(data.slice(index)))}function constructYamlInteger(data){var ch,base,value=data,sign=1,digits=[];return-1!==value.indexOf("_")&&(value=value.replace(/_/g,"")),ch=value[0],"-"!==ch&&"+"!==ch||("-"===ch&&(sign=-1),value=value.slice(1),ch=value[0]),"0"===value?0:"0"===ch?"b"===value[1]?sign*parseInt(value.slice(2),2):"x"===value[1]?sign*parseInt(value,16):sign*parseInt(value,8):-1!==value.indexOf(":")?(value.split(":").forEach(function(v){digits.unshift(parseInt(v,10))}),value=0,base=1,digits.forEach(function(d){value+=d*base,base*=60}),sign*value):sign*parseInt(value,10)}function isInteger(object){return"[object Number]"===Object.prototype.toString.call(object)&&object%1==0&&!common.isNegativeZero(object)}var common=require("../common"),Type=require("../type");module.exports=new Type("tag:yaml.org,2002:int",{kind:"scalar",resolve:resolveYamlInteger,construct:constructYamlInteger,predicate:isInteger,represent:{binary:function(object){return"0b"+object.toString(2)},octal:function(object){return"0"+object.toString(8)},decimal:function(object){return object.toString(10)},hexadecimal:function(object){return"0x"+object.toString(16).toUpperCase()}},defaultStyle:"decimal",styleAliases:{binary:[2,"bin"],octal:[8,"oct"],decimal:[10,"dec"],hexadecimal:[16,"hex"]}})},{"../common":2,"../type":13}],18:[function(require,module,exports){"use strict";function resolveJavascriptFunction(data){if(null===data)return!1;try{var source="("+data+")",ast=esprima.parse(source,{range:!0});return"Program"===ast.type&&1===ast.body.length&&"ExpressionStatement"===ast.body[0].type&&"FunctionExpression"===ast.body[0].expression.type}catch(err){return!1}}function constructJavascriptFunction(data){var body,source="("+data+")",ast=esprima.parse(source,{range:!0}),params=[];if("Program"!==ast.type||1!==ast.body.length||"ExpressionStatement"!==ast.body[0].type||"FunctionExpression"!==ast.body[0].expression.type)throw new Error("Failed to resolve function");return ast.body[0].expression.params.forEach(function(param){params.push(param.name)}),body=ast.body[0].expression.body.range,new Function(params,source.slice(body[0]+1,body[1]-1))}function representJavascriptFunction(object){return object.toString()}function isFunction(object){return"[object Function]"===Object.prototype.toString.call(object)}var esprima;try{esprima=require("esprima")}catch(_){"undefined"!=typeof window&&(esprima=window.esprima)}var Type=require("../../type");module.exports=new Type("tag:yaml.org,2002:js/function",{kind:"scalar",resolve:resolveJavascriptFunction,construct:constructJavascriptFunction,predicate:isFunction,represent:representJavascriptFunction})},{"../../type":13}],19:[function(require,module,exports){"use strict";function resolveJavascriptRegExp(data){if(null===data)return!1;if(0===data.length)return!1;var regexp=data,tail=/\/([gim]*)$/.exec(data),modifiers="";if("/"===regexp[0]){if(tail&&(modifiers=tail[1]),modifiers.length>3)return!1;if("/"!==regexp[regexp.length-modifiers.length-1])return!1}return!0}function constructJavascriptRegExp(data){var regexp=data,tail=/\/([gim]*)$/.exec(data),modifiers="";return"/"===regexp[0]&&(tail&&(modifiers=tail[1]),regexp=regexp.slice(1,regexp.length-modifiers.length-1)),new RegExp(regexp,modifiers)}function representJavascriptRegExp(object){var result="/"+object.source+"/";return object.global&&(result+="g"),object.multiline&&(result+="m"),object.ignoreCase&&(result+="i"),result}function isRegExp(object){return"[object RegExp]"===Object.prototype.toString.call(object)}var Type=require("../../type");module.exports=new Type("tag:yaml.org,2002:js/regexp",{kind:"scalar",resolve:resolveJavascriptRegExp,construct:constructJavascriptRegExp,predicate:isRegExp,represent:representJavascriptRegExp})},{"../../type":13}],20:[function(require,module,exports){"use strict";function resolveJavascriptUndefined(){return!0}function constructJavascriptUndefined(){}function representJavascriptUndefined(){return""}function isUndefined(object){return void 0===object}var Type=require("../../type");module.exports=new Type("tag:yaml.org,2002:js/undefined",{kind:"scalar",resolve:resolveJavascriptUndefined,construct:constructJavascriptUndefined,predicate:isUndefined,represent:representJavascriptUndefined})},{"../../type":13}],21:[function(require,module,exports){"use strict";var Type=require("../type");module.exports=new Type("tag:yaml.org,2002:map",{kind:"mapping",construct:function(data){return null!==data?data:{}}})},{"../type":13}],22:[function(require,module,exports){"use strict";function resolveYamlMerge(data){return"<<"===data||null===data}var Type=require("../type");module.exports=new Type("tag:yaml.org,2002:merge",{kind:"scalar",resolve:resolveYamlMerge})},{"../type":13}],23:[function(require,module,exports){"use strict";function resolveYamlNull(data){if(null===data)return!0;var max=data.length;return 1===max&&"~"===data||4===max&&("null"===data||"Null"===data||"NULL"===data)}function constructYamlNull(){return null}function isNull(object){return null===object}var Type=require("../type");module.exports=new Type("tag:yaml.org,2002:null",{kind:"scalar",resolve:resolveYamlNull,construct:constructYamlNull,predicate:isNull,represent:{canonical:function(){return"~"},lowercase:function(){return"null"},uppercase:function(){return"NULL"},camelcase:function(){return"Null"}},defaultStyle:"lowercase"})},{"../type":13}],24:[function(require,module,exports){"use strict";function resolveYamlOmap(data){if(null===data)return!0;var index,length,pair,pairKey,pairHasKey,objectKeys=[],object=data;for(index=0,length=object.length;index<length;index+=1){if(pair=object[index],pairHasKey=!1,"[object Object]"!==_toString.call(pair))return!1;for(pairKey in pair)if(_hasOwnProperty.call(pair,pairKey)){if(pairHasKey)return!1;pairHasKey=!0}if(!pairHasKey)return!1;if(-1!==objectKeys.indexOf(pairKey))return!1;objectKeys.push(pairKey)}return!0}function constructYamlOmap(data){return null!==data?data:[]}var Type=require("../type"),_hasOwnProperty=Object.prototype.hasOwnProperty,_toString=Object.prototype.toString;module.exports=new Type("tag:yaml.org,2002:omap",{kind:"sequence",resolve:resolveYamlOmap,construct:constructYamlOmap})},{"../type":13}],25:[function(require,module,exports){"use strict";function resolveYamlPairs(data){if(null===data)return!0;var index,length,pair,keys,result,object=data;for(result=new Array(object.length),index=0,length=object.length;index<length;index+=1){if(pair=object[index],"[object Object]"!==_toString.call(pair))return!1;if(keys=Object.keys(pair),1!==keys.length)return!1;result[index]=[keys[0],pair[keys[0]]]}return!0}function constructYamlPairs(data){if(null===data)return[];var index,length,pair,keys,result,object=data;for(result=new Array(object.length),index=0,length=object.length;index<length;index+=1)pair=object[index],keys=Object.keys(pair),result[index]=[keys[0],pair[keys[0]]];return result}var Type=require("../type"),_toString=Object.prototype.toString;module.exports=new Type("tag:yaml.org,2002:pairs",{kind:"sequence",resolve:resolveYamlPairs,construct:constructYamlPairs})},{"../type":13}],26:[function(require,module,exports){"use strict";var Type=require("../type");module.exports=new Type("tag:yaml.org,2002:seq",{kind:"sequence",construct:function(data){return null!==data?data:[]}})},{"../type":13}],27:[function(require,module,exports){"use strict";function resolveYamlSet(data){if(null===data)return!0;var key,object=data;for(key in object)if(_hasOwnProperty.call(object,key)&&null!==object[key])return!1;return!0}function constructYamlSet(data){return null!==data?data:{}}var Type=require("../type"),_hasOwnProperty=Object.prototype.hasOwnProperty;module.exports=new Type("tag:yaml.org,2002:set",{kind:"mapping",resolve:resolveYamlSet,construct:constructYamlSet})},{"../type":13}],28:[function(require,module,exports){"use strict";var Type=require("../type");module.exports=new Type("tag:yaml.org,2002:str",{kind:"scalar",construct:function(data){return null!==data?data:""}})},{"../type":13}],29:[function(require,module,exports){"use strict";function resolveYamlTimestamp(data){return null!==data&&(null!==YAML_DATE_REGEXP.exec(data)||null!==YAML_TIMESTAMP_REGEXP.exec(data))}function constructYamlTimestamp(data){var match,year,month,day,hour,minute,second,tz_hour,tz_minute,date,fraction=0,delta=null;if(match=YAML_DATE_REGEXP.exec(data),null===match&&(match=YAML_TIMESTAMP_REGEXP.exec(data)),null===match)throw new Error("Date resolve error");if(year=+match[1],month=+match[2]-1,day=+match[3],!match[4])return new Date(Date.UTC(year,month,day));if(hour=+match[4],minute=+match[5],second=+match[6],match[7]){for(fraction=match[7].slice(0,3);fraction.length<3;)fraction+="0";fraction=+fraction}return match[9]&&(tz_hour=+match[10],tz_minute=+(match[11]||0),delta=6e4*(60*tz_hour+tz_minute),"-"===match[9]&&(delta=-delta)),date=new Date(Date.UTC(year,month,day,hour,minute,second,fraction)),delta&&date.setTime(date.getTime()-delta),date}function representYamlTimestamp(object){return object.toISOString()}var Type=require("../type"),YAML_DATE_REGEXP=new RegExp("^([0-9][0-9][0-9][0-9])-([0-9][0-9])-([0-9][0-9])$"),YAML_TIMESTAMP_REGEXP=new RegExp("^([0-9][0-9][0-9][0-9])-([0-9][0-9]?)-([0-9][0-9]?)(?:[Tt]|[ \\t]+)([0-9][0-9]?):([0-9][0-9]):([0-9][0-9])(?:\\.([0-9]*))?(?:[ \\t]*(Z|([-+])([0-9][0-9]?)(?::([0-9][0-9]))?))?$");module.exports=new Type("tag:yaml.org,2002:timestamp",{kind:"scalar",resolve:resolveYamlTimestamp,construct:constructYamlTimestamp,instanceOf:Date,represent:representYamlTimestamp})},{"../type":13}],"/":[function(require,module,exports){"use strict";var yaml=require("./lib/js-yaml.js");module.exports=yaml},{"./lib/js-yaml.js":1}]},{},[])("/")})},function(module,exports,__webpack_require__){(function(global,process){!function(global,undefined){"use strict";function setImmediate(callback){"function"!=typeof callback&&(callback=new Function(""+callback));for(var args=new Array(arguments.length-1),i=0;i<args.length;i++)args[i]=arguments[i+1];var task={callback:callback,args:args};return tasksByHandle[nextHandle]=task,registerImmediate(nextHandle),nextHandle++}function clearImmediate(handle){delete tasksByHandle[handle]}function run(task){var callback=task.callback,args=task.args;switch(args.length){case 0:callback();break;case 1:callback(args[0]);break;case 2:callback(args[0],args[1]);break;case 3:callback(args[0],args[1],args[2]);break;default:callback.apply(undefined,args)}}function runIfPresent(handle){if(currentlyRunningATask)setTimeout(runIfPresent,0,handle);else{var task=tasksByHandle[handle];if(task){currentlyRunningATask=!0;try{run(task)}finally{clearImmediate(handle),currentlyRunningATask=!1}}}}if(!global.setImmediate){var registerImmediate,nextHandle=1,tasksByHandle={},currentlyRunningATask=!1,doc=global.document,attachTo=Object.getPrototypeOf&&Object.getPrototypeOf(global);attachTo=attachTo&&attachTo.setTimeout?attachTo:global,"[object process]"==={}.toString.call(global.process)?function(){registerImmediate=function(handle){process.nextTick(function(){runIfPresent(handle)})}}():function(){if(global.postMessage&&!global.importScripts){var postMessageIsAsynchronous=!0,oldOnMessage=global.onmessage;return global.onmessage=function(){postMessageIsAsynchronous=!1},global.postMessage("","*"),global.onmessage=oldOnMessage,postMessageIsAsynchronous}}()?function(){var messagePrefix="setImmediate$"+Math.random()+"$",onGlobalMessage=function(event){event.source===global&&"string"==typeof event.data&&0===event.data.indexOf(messagePrefix)&&runIfPresent(+event.data.slice(messagePrefix.length))};global.addEventListener?global.addEventListener("message",onGlobalMessage,!1):global.attachEvent("onmessage",onGlobalMessage),registerImmediate=function(handle){global.postMessage(messagePrefix+handle,"*")}}():global.MessageChannel?function(){var channel=new MessageChannel;channel.port1.onmessage=function(event){runIfPresent(event.data)},registerImmediate=function(handle){channel.port2.postMessage(handle)}}():doc&&"onreadystatechange"in doc.createElement("script")?function(){var html=doc.documentElement;registerImmediate=function(handle){var script=doc.createElement("script");script.onreadystatechange=function(){runIfPresent(handle),script.onreadystatechange=null,html.removeChild(script),script=null},html.appendChild(script)}}():function(){registerImmediate=function(handle){setTimeout(runIfPresent,0,handle)}}(),attachTo.setImmediate=setImmediate,attachTo.clearImmediate=clearImmediate}}("undefined"==typeof self?void 0===global?this:global:self)}).call(exports,__webpack_require__(11),__webpack_require__(10))},function(module,exports,__webpack_require__){function Timeout(id,clearFn){this._id=id,this._clearFn=clearFn}var apply=Function.prototype.apply;exports.setTimeout=function(){return new Timeout(apply.call(setTimeout,window,arguments),clearTimeout)},exports.setInterval=function(){return new Timeout(apply.call(setInterval,window,arguments),clearInterval)},exports.clearTimeout=exports.clearInterval=function(timeout){timeout&&timeout.close()},Timeout.prototype.unref=Timeout.prototype.ref=function(){},Timeout.prototype.close=function(){this._clearFn.call(window,this._id)},exports.enroll=function(item,msecs){clearTimeout(item._idleTimeoutId),item._idleTimeout=msecs},exports.unenroll=function(item){clearTimeout(item._idleTimeoutId),item._idleTimeout=-1},exports._unrefActive=exports.active=function(item){clearTimeout(item._idleTimeoutId);var msecs=item._idleTimeout;msecs>=0&&(item._idleTimeoutId=setTimeout(function(){item._onTimeout&&item._onTimeout()},msecs))},__webpack_require__(19),exports.setImmediate=setImmediate,exports.clearImmediate=clearImmediate}])});