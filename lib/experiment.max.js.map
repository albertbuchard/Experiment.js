{"version":3,"sources":["webpack:///webpack/universalModuleDefinition","webpack:///webpack/bootstrap 8ebeeccef5afc7137d4f","webpack:///./src/framework/utilities.js","webpack:///external \"lodash\"","webpack:///./src/framework/EventData.js","webpack:///./src/framework/DataManager.js","webpack:///./src/framework/RessourceManager.js","webpack:///./src/framework/State.js","webpack:///./src/framework/StateManager.js","webpack:///./src/config.js","webpack:///external \"experiment-babylon-js\"","webpack:///./src/framework/TaskObject.js","webpack:///./~/process/browser.js","webpack:///external \"experiment-boxes\"","webpack:///external \"experiment-mathjs\"","webpack:///external \"jquery\"","webpack:///./builder.js"],"names":["noop","debuglog","console","log","bind","debugWarn","warn","debugError","error","mandatory","param","Error","mustBeDefined","args","i","length","mustHaveConstructor","constructorObject","allHaveConstructor","looksLikeAPromise","o","then","catch","delay","ms","Promise","resolve","setTimeout","jitter","min","max","randomDuration","random","recurse","promiseGenerator","amount","target","concatOnArray","next","apply","r","concat","Deferred","reject","promise","Object","freeze","rep","content","count","result","samplePermutation","sequence","repetition","n","constructor","Array","copy","slice","permutation","add","index","Math","floor","splice","matrix","rows","cols","fill","matrixObject","j","getRow","rowIndex","size","row","subset","range","rowSum","rowSumArray","push","sum","diag","setTo","diagonalValues","String","prototype","indicesOf","needle","haystack","indices","substr","hasNeighbouringRepeat","previousElement","toCsv","lineArray","forEach","array","line","join","csvContent","uniqueValues","u","a","hasOwnProperty","Number","minValue","NaN","maxValue","getXY","x","xyArray","y","average","type","isNaN","windowAverages","endIndex","windowArray","bins","position","undefined","total","integrate","cumulativeArray","equals","value","resultVector","l","ntrue","resultSum","nEquals","exclude","values","addit","includes","indexOf","EventData","flag","timeStamp","data","happenedAt","handled","stored","baseData","belongsTo","handledAt","storedAt","extend","DataManager","parent","subjectID","_parent","_subjectID","automaticID","VALUE_FOR_NA","FLAG_EVENT_NOFLAG","dataTables","globalLogFields","addTable","restURL","isNode","module","exports","name","fields","has","id","isValidRows","columnNamesRows","keys","columnNamesDataTableWithoutId","without","generateIds","nrows","numberOfIds","startId","emptyTable","columnNamesDataTable","previousLenght","newLenght","dataArray","JSON","stringify","_globalLog","globalLog","_customNextID","RessourceManager","defaultLanguage","currentLanguage","overwrite","useAjax","filepaths","addFiles","concatFilepaths","files","promises","isOfValidFormat","getFormat","path","loaded","validated","added","raw","loadFile","all","fileIndex","deffered","thisObject","ajax","url","response","parseRaw","e","file","parser","arg","parse","csv","toObjects","window","DOMParser","parseFromString","ActiveXObject","async","loadXML","processParsed","addDataFamilly","familly","toAdd","toLowerCase","object","oldOverwrite","addByName","filepath","lastIndexOf","validFormats","ressourceManager","currentFamillies","famillies","mergingFamillies","variable","lookFor","extended","deep","toString","call","merge","obj","prop","Proxy","get","pathString","split","lookForLanguage","lookForFamilly","lookForVariable","couldSwapForVariable","State","stateManager","stateKey","_stateManager","_dataManager","_eventFunctions","_awakeningFunctions","_endingFunctions","_updateFunctions","_frozenEvents","_frozenAt","FREEZE_DELAY","unfreeze","sceneKey","calledFunctions","method","context","nextEvent","eventHeap","getFirstEventAndRemoveFromHeap","handleEvent","event","hasEventFunction","eventFunctions","functionName","eventClone","cloneDeep","handlingFunction","stateHasFinishedHandlingEvent","timeInMs","getAllEvents","stateWasFrozen","frozenEvents","addTimeTriggerEvent","addEvent","stateWasUnfreezed","eventFlag","handlingFunctions","Function","cycle","arrayName","registerEventFunctions","registerCycleFunctions","getGlobal","setGlobal","_taskObject","getContext","taskObject","dataManager","scene","state","R","StateManager","parentTaskObject","_eventHeap","_timeTriggerEvents","errorLog","states","idle","pause","active","timestampThreshold","states_idle","states_active","states_pause","_currentStateKey","frozenState","globals","globalFunctions","currentState","update","storedInErrorLog","addRows","storeInErrorLog","returnedStates","stateKeys","key","end","awake","addDefaultDesign","pauseState","options","keyCode","goToState","unPause","events","keydown","registerEventFunction","addDefaultPauseDesign","awakePause","pauseBackground2D","elements2D","canvas","opacity","baseOptions","text","width","height","Canvas2D","GetSolidColorBrush","Color4","fontName","Rectangle2D","roundRadius","children","Text2D","marginVAlignment","marginHAlignment","set","endPause","dispose","registerAwakeningFunction","registerEndingFunction","emptyEventHeap","emptyTimeTriggerEvents","time","eventOptions","values_timestampThreshold","firstEvent","removeFirstEvent","storeEvent","eventHeapIsFrozen","frozenEventHeap","storeFrozenEvents","func","functions","registerGlobalFunction","results","recurseOnGlobalFunction","currentStateKey","Date","getTime","DEBUG_MODE_ON","scripts","document","getElementsByTagName","assetsFolderFullpath","src","delimiterIndices","TaskObject","assetsFolder","loadingSceneGenerator","engine","_target","Engine","innerHeight","innerWidth","babylonCanvasHeight","babylonCanvasWidth","taskStatusFields","statusFlagsFields","ASSETS_FOLDER","ASSETS_FLARE_PATH","folders","flags","keyState","shouldShowDebug","setupGlobalEvents","_currentModal","MODAL_INTRODUCTION","parameters","variables","shouldSeeInformation","scenes","sceneGenerators","functionsOptions","_currentSceneKey","_paramBox","sceneGenerator","loading","clone","loadingOptions","registerSceneGenerator","sceneOptions","generator","functionKeys","callSceneGenerator","assets","assetsArray","_scene","Mesh","material","subMaterials","addMesh","assetObject","assetFolder","textureFormats","assetManager","AssetsManager","names","field","assetManagerTask","addTextureTask","onSuccess","task","textures","textureName","texture","loadDeferred","load","onFinish","tasks","asset","cloneAssetsIntoScene","process","addEventListener","resize","deferred","loadingScene","loadingPromise","currentScene","flags_hasLoaded","runRenderLoop","render","generateScenes","message","hasLoaded","sceneStarts","sceneEnds","mouseMove","click","pick","keyup","wasHandled","beingHandled","evt","keyfunction","eventData","events_keydown","currentSceneObject","events_click","clientX","clientY","engineX","renderSize","engineY","events_resize","outerHeight","outerWidth","addEventToCurrentScene","updateContentFrame","dCode","shiftCode","altCode","toggleDebugLayer","preventDefault","optionsBase","canvasBackground","backgroundRoundRadius","clearColor","canvasPercentWidth","canvasPercentHeight","Scene","addStateManager","camera","ArcRotateCamera","PI","Vector3","Zero","ScreenSpaceCanvas2D","backgroundFill","Size","zOrder","initialCanvas","initialCamera","createCanvasProfileInfoCanvas","registerBeforeRender","baseContext","extendWith","debugLayer","show","hide","_profilingCanvas","modalData","modalBox","infoModalDismissed","title","infoModal","modalAction","removeInfoModal","property","from","to","frame","animation","Animation","ANIMATIONTYPE_FLOAT","ANIMATIONLOOPMODE_CONSTANT","setKeys","stopAnimation","animations","beginAnimation","frameTotal","ANIMATIONTYPE_VECTOR3","ANIMATIONTYPE_COLOR3","toAlpha","toBeta","animCamAlpha","activeCamera","keysAlpha","overPI","alpha","firstStop","secondStop","animCamBeta","keysBeta","beta","mesh","capacity","minEmitBox","maxEmitBox","color1","color2","colorDead","minSize","maxSize","minLifeTime","maxLifeTime","emitRate","blendMode","ParticleSystem","BLENDMODE_ONEONE","gravity","direction1","direction2","minAngularSpeed","maxAngularSpeed","minEmitPower","maxEmitPower","updateSpeed","startIt","particleSystem","particleTexture","Texture","emitter","start","sceneObject","paramBox","delete","getRenderWidth","getRenderHeight","radians","offset","sign","abs","baseAngle","checkedAngle","borderPI","signedAngle","currentAngleArc","signedAngleArc","angleA","angleB","len","inclination","azimuth","z","sin","cos","round","getRandomArbitrary"],"mappings":"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ACA;AACA;AACA;AACA;AACA;AACA,KAAK;AACL;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA,uBAAuB,sBAAsB;AAC7C;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,qBAAqB;AACrB;;AAEA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;;AAEA,2BAA2B;AAC3B;AACA;AACA;AACA,4BAA4B,UAAU;;;;;;;ACnLtC,gD;;;;;;ACAA,gD;;;;;;ACAA,gD;;;;;;;;;;;;;;ACcC;;;;AACA;;;;AACA;;;;AACA;;;;AACA;;;;AACA;;;;AAEA;;;;AAwBD;AACC,IAAI,OAAOjL,MAAP,KAAkB,WAAtB,EAAmC;AACjCA,SAAOiL,UAAP;AACAjL,SAAO0F,YAAP;AACA1F,SAAOsC,KAAP;AACAtC,SAAOnF,SAAP;AACAmF,SAAOvE,WAAP;AACAuE,SAAOjC,gBAAP;AACAiC,SAAO/L,MAAP;AACA+L,SAAOpM,KAAP;AACAoM,SAAOjL,QAAP;AACD,C,CAxDF;;;;;;;;;;;;;AAaC;QA+CCkW,U;QACAvF,Y;QACApD,K;QACAzH,S;QACAY,W;QACAsC,gB;QACAlI,K;QACA4B,M;QACAH,I;QACAJ,M;QACAN,M;QACAN,M;QACAd,iB;QACAJ,G;QACAL,Q;QACAT,O;QACAL,M;QACAL,K;QACAJ,iB;QACAH,mB;QACAJ,a;QACAH,S;QACAR,Q;QACAI,S;QACAE,U;QACAP,I","file":"experiment.max.js","sourcesContent":["(function webpackUniversalModuleDefinition(root, factory) {\n\tif(typeof exports === 'object' && typeof module === 'object')\n\t\tmodule.exports = factory(require(\"lodash\"), require(\"experiment-babylon-js\"), require(\"experiment-boxes\"), require(\"experiment-mathjs\"), require(\"jquery\"));\n\telse if(typeof define === 'function' && define.amd)\n\t\tdefine(\"experiment\", [\"lodash\", \"experiment-babylon-js\", \"experiment-boxes\", \"experiment-mathjs\", \"jquery\"], factory);\n\telse if(typeof exports === 'object')\n\t\texports[\"experiment\"] = factory(require(\"lodash\"), require(\"experiment-babylon-js\"), require(\"experiment-boxes\"), require(\"experiment-mathjs\"), require(\"jquery\"));\n\telse\n\t\troot[\"experiment\"] = factory(root[\"lodash\"], root[\"experiment-babylon-js\"], root[\"experiment-boxes\"], root[\"experiment-mathjs\"], root[\"jquery\"]);\n})(this, function(__WEBPACK_EXTERNAL_MODULE_1__, __WEBPACK_EXTERNAL_MODULE_8__, __WEBPACK_EXTERNAL_MODULE_11__, __WEBPACK_EXTERNAL_MODULE_12__, __WEBPACK_EXTERNAL_MODULE_13__) {\nreturn \n\n\n// WEBPACK FOOTER //\n// webpack/universalModuleDefinition"," \t// The module cache\n \tvar installedModules = {};\n\n \t// The require function\n \tfunction __webpack_require__(moduleId) {\n\n \t\t// Check if module is in cache\n \t\tif(installedModules[moduleId])\n \t\t\treturn installedModules[moduleId].exports;\n\n \t\t// Create a new module (and put it into the cache)\n \t\tvar module = installedModules[moduleId] = {\n \t\t\ti: moduleId,\n \t\t\tl: false,\n \t\t\texports: {}\n \t\t};\n\n \t\t// Execute the module function\n \t\tmodules[moduleId].call(module.exports, module, module.exports, __webpack_require__);\n\n \t\t// Flag the module as loaded\n \t\tmodule.l = true;\n\n \t\t// Return the exports of the module\n \t\treturn module.exports;\n \t}\n\n\n \t// expose the modules object (__webpack_modules__)\n \t__webpack_require__.m = modules;\n\n \t// expose the module cache\n \t__webpack_require__.c = installedModules;\n\n \t// identity function for calling harmony imports with the correct context\n \t__webpack_require__.i = function(value) { return value; };\n\n \t// define getter function for harmony exports\n \t__webpack_require__.d = function(exports, name, getter) {\n \t\tif(!__webpack_require__.o(exports, name)) {\n \t\t\tObject.defineProperty(exports, name, {\n \t\t\t\tconfigurable: false,\n \t\t\t\tenumerable: true,\n \t\t\t\tget: getter\n \t\t\t});\n \t\t}\n \t};\n\n \t// getDefaultExport function for compatibility with non-harmony modules\n \t__webpack_require__.n = function(module) {\n \t\tvar getter = module && module.__esModule ?\n \t\t\tfunction getDefault() { return module['default']; } :\n \t\t\tfunction getModuleExports() { return module; };\n \t\t__webpack_require__.d(getter, 'a', getter);\n \t\treturn getter;\n \t};\n\n \t// Object.prototype.hasOwnProperty.call\n \t__webpack_require__.o = function(object, property) { return Object.prototype.hasOwnProperty.call(object, property); };\n\n \t// __webpack_public_path__\n \t__webpack_require__.p = \"\";\n\n \t// Load entry module and return exports\n \treturn __webpack_require__(__webpack_require__.s = 14);\n\n\n\n// WEBPACK FOOTER //\n// webpack/bootstrap 8ebeeccef5afc7137d4f","/**\n * This file should contain utility functions that are independant of the task.\n *\n *\n */\n\nimport _ from 'lodash'\nimport math from 'experiment-mathjs'\n\nimport { DEBUG_MODE_ON } from '../config'\n\n/**\n * noop - just your friendly empty function\n *\n * @returns {undefined}\n */\nfunction noop() {}\n\n\n/**\n * Debug functions\n */\nconst debuglog = DEBUG_MODE_ON ? console.log.bind(console) : noop\nconst debugWarn = DEBUG_MODE_ON ? console.warn.bind(console) : noop\nconst debugError = DEBUG_MODE_ON ? console.error.bind(console) : noop\n\n/**\n * Allows to return an error for missing parameters.\n * @param  {String} param Optional string to add after the error.\n */\nfunction mandatory(param = '') {\n  throw new Error(`Missing parameter ${param}`)\n}\n\n/**\n * Checks the type of all given parameters, return an error if one is undefined.\n * @param  {...object} args List of arguments to checks\n * @return {bool}      true if all arguments are defined\n */\n\nfunction mustBeDefined(...args) {\n  for (let i = 0; i < args.length; i++) {\n    if (typeof args[i] === 'undefined') {\n      throw new Error(`Argument ${i} is undefined.`)\n    }\n  }\n\n  return true\n}\n\n/**\n * Checks the constructor of all given parameters, return an error if one is not as specified.\n * @param  {object} constructorObject constructor\n * @param  {...object} args         list of arguments to check\n * @return {bool}                   true if all arguments have specified constructorObject as constructor\n */\n\nfunction mustHaveConstructor(constructorObject, ...args) {\n  if (args.allHaveConstructor(constructorObject) === false) {\n    throw new Error('Wrong constructor in arguments.')\n  }\n\n  return true\n}\n\n/**\n * Returns true if o looks like a promise. From the es-promisify package.\n * https://github.com/digitaldesignlabs/es6-promisify/\n * @param  {object} o Object to test\n * @return {bool}   True if looks like a promise, false otherwise\n */\nfunction looksLikeAPromise(o) {\n  return o && typeof o.then === 'function' && typeof o.catch === 'function'\n}\n\n\n/**\n * From http://www.datchley.name/promise-patterns-anti-patterns/\n * @param  {int} ms delay in ms\n * @return {promise} promise which will resolve in delay ms\n */\nfunction delay(ms) {\n  return new Promise((resolve) => {\n    setTimeout(resolve, ms)\n  })\n}\n\n/**\n * @param  {int} min min delay in ms\n * @param  {int} max max delay in ms\n * @return {promise} promise which will resolve in delay ms\n */\nfunction jitter(min = mandatory(), max = mandatory()) {\n  return new Promise((resolve) => {\n    const randomDuration = _.random(min, max)\n    setTimeout(resolve, randomDuration)\n  })\n}\n\n/**\n * Recurse on a given promise chain\n * @param  {Promise} promise Promise to recurse on\n * @param  {numeric} amount  amount of time to recurse\n * @return {Promise}         Promise\n */\nfunction recurse(promiseGenerator = mandatory(),\n  amount = mandatory(),\n  target = this, args = [],\n  concatOnArray = []) {\n  // Base case - just return the promisified result\n  if (amount === 0) {\n    return new Promise((resolve) => {\n      resolve(concatOnArray)\n    })\n  }\n\n\n  const next = promiseGenerator.apply(target, args).then((r) => {\n    concatOnArray = concatOnArray.concat(r)\n    return (recurse(promiseGenerator, amount - 1, target, args, concatOnArray))\n  })\n\n  return next\n}\n\n/**\n * Compatible helper to replace the now defunc Promise.defer()\n * @method Deferred\n */\nfunction Deferred() {\n  // update 062115 for typeof\n  // if (typeof (Promise) !== 'undefined' && Promise.defer) {\n  //   //need import of Promise.jsm for example: Cu.import('resource:/gree/modules/Promise.jsm');\n  //   return Promise.defer();\n  // } else if (typeof (PromiseUtils) != 'undefined' && PromiseUtils.defer) {\n  //   //need import of PromiseUtils.jsm for example: Cu.import('resource:/gree/modules/PromiseUtils.jsm');\n  //   return PromiseUtils.defer();\n  // } else {\n  /* A method to resolve the associated Promise with the value passed.\n   * If the promise is already settled it does nothing.\n   *\n   * @param {anything} value : This value is used to resolve the promise\n   * If the value is a Promise then the associated promise assumes the state\n   * of Promise passed as value.\n   */\n  this.resolve = null\n\n  /* A method to reject the assocaited Promise with the value passed.\n   * If the promise is already settled it does nothing.\n   *\n   * @param {anything} reason: The reason for the rejection of the Promise.\n   * Generally its an Error object. If however a Promise is passed, then the Promise\n   * itself will be the reason for rejection no matter the state of the Promise.\n   */\n  this.reject = null\n\n  /* A newly created Pomise object.\n   * Initially in pending state.\n   */\n  this.promise = new Promise((resolve, reject) => {\n    this.resolve = resolve\n    this.reject = reject\n  })\n  Object.freeze(this)\n  // }\n}\n\n/**\n * From http://stackoverflow.com/questions/3751520/how-to-generate-sequence-of-numbers-chars-in-javascript\n * TODO Pull request math js\n * @param  {object} content Repeated sequence\n * @param  {int} count   Number of time the sequence must be repeat\n * @return {array}       Array with repeated sequence\n */\nfunction rep(content = mandatory(), count = mandatory()) {\n  let result = []\n  if (typeof (content) === 'function') {\n    for (let i = 0; i < count; i++) {\n      result = result.concat(content(i))\n    }\n  } else {\n    for (let i = 0; i < count; i++) {\n      result = result.concat(content)\n    }\n  }\n  return result\n}\n\nfunction samplePermutation(sequence = mandatory(), repetition = false, n = null) {\n  if (sequence.constructor !== Array) {\n    throw new Error('samplePermutation: sequence needs to be an array.')\n  }\n\n  if (n === null) {\n    n = sequence.length\n  }\n\n  const copy = sequence.slice(0)\n  let permutation = []\n  let add\n  while ((repetition && (permutation.length < n)) || ((!repetition) && (copy.length))) {\n    const index = Math.floor(Math.random() * copy.length)\n    if (repetition) {\n      add = copy[index]\n    } else {\n      add = copy.splice(index, 1)\n    }\n    permutation = permutation.concat(add)\n  }\n\n  return (permutation)\n}\n\n/* =============== Personalized Matrix Functions =============== */\nfunction matrix(rows = mandatory(), cols = mandatory(), fill = 0) {\n  const matrixObject = []\n\n  for (let i = 0; i < rows; i++) {\n    matrixObject[i] = []\n    for (let j = 0; j < cols; j++) {\n      matrixObject[i][j] = fill\n    }\n  }\n\n  return (matrixObject)\n}\n\nfunction getRow(matrixObject = mandatory(), rowIndex = mandatory()) {\n  matrixObject = math.matrix(matrixObject)\n  const size = (matrixObject.size())[0]\n  const row = math.subset(matrixObject, math.index(rowIndex, math.range(0, size)))\n\n  return (row)\n}\n\nfunction rowSum(matrixObject = mandatory(), rows = null) {\n  matrixObject = math.matrix(matrixObject)\n  const size = (matrixObject.size())[0]\n  if (rows === null) {\n    rows = math.range(0, size - 1)\n  }\n  if (rows.constructor !== Array) {\n    rows = [rows]\n  }\n\n  const rowSumArray = []\n  for (let i = 0; i < rows.length; i++) {\n    rowSumArray.push(math.sum(getRow(matrixObject, rows[i])))\n  }\n\n  return (rowSumArray)\n}\n\n// set or get the diagonal of a matrix\nfunction diag(matrixObject = mandatory(), setTo = null): Array {\n  const rows = matrixObject.length\n  // const cols = matrixObject[0].length\n\n  const diagonalValues = []\n\n  for (let i = 0; i < rows; i++) {\n    if (setTo) {\n      matrixObject[i][i] = setTo\n    }\n    diagonalValues.push(matrixObject[i][i])\n  }\n\n  return ([diagonalValues, matrixObject])\n}\n\n/* =============== String functions =============== */\n\n/**\n * Find all the positions of a needle in a haystack string\n * @param  {string} needle   string to find\n * @param  {string} haystack string to scan\n * @return {Array}  Either -1 if no match is found or an array containing the indicies\n */\nString.prototype.indicesOf = function indicesOf(needle = mandatory()): Array<number> | -1 {\n  const haystack = this\n  const indices = []\n  for (let i = 0; i < haystack.length; i++) {\n    if ((haystack.substr(i, needle.length)) === needle) {\n      indices.push(i)\n    }\n  }\n\n  if (indices.length) {\n    return (indices)\n  }\n  return (-1)\n}\n\n/* =============== Array prototype overload =============== */\nArray.prototype.hasNeighbouringRepeat = function hasNeighbouringRepeat() {\n  let previousElement = null\n  for (let i = 0; i < this.length; i++) {\n    if (previousElement === this[i]) {\n      return true\n    }\n    previousElement = this[i]\n  }\n  return false\n}\n\nArray.prototype.toCsv = function toCsv() {\n  const lineArray = []\n  this.forEach((array, index) => {\n    const line = array.join(',')\n    lineArray.push(index === 0 ?\n      `data:text/csv;charset=utf-8,${line}` :\n      line)\n  })\n  const csvContent = lineArray.join('\\n')\n\n  return (csvContent)\n}\n\nArray.prototype.uniqueValues = function uniqueValues() {\n  const u = {}\n  const a = []\n\n  for (let i = 0; i < this.length; i++) {\n    if (!u.hasOwnProperty(this[i])) {\n      a.push(this[i])\n      u[this[i]] = 1\n    }\n  }\n  return a\n}\n\nArray.prototype.min = function min() {\n  const u = this.uniqueValues()\n\n  if (u.allHaveConstructor(Number)) {\n    let minValue = u[0]\n    for (let i = 0; i < u.length; i++) {\n      if (u[i] < minValue) { minValue = u[i] }\n    }\n    return minValue\n  }\n  return NaN\n}\n\nArray.prototype.max = function max() {\n  const u = this.uniqueValues()\n\n  if (u.allHaveConstructor(Number)) {\n    let maxValue = u[0]\n    for (let i = 0; i < u.length; i++) {\n      if (u[i] > maxValue) { maxValue = u[i] }\n    }\n    return maxValue\n  }\n  return NaN\n}\n\n/**\n * Return an array of objects with x and y property. Y is taken as the values of the array, and x is either the index if null, or the values of the specified array.\n * @param  {?array} x X values, if null, the index is taken as x\n * @return {array}   Array of x and y [{x: x[i], y: this[i]},...]\n */\nArray.prototype.getXY = function getXY(x = null): Array {\n  if (x !== null) {\n    if (x.constructor !== Array) {\n      throw new Error('Array.getXY: x needs to be an array.')\n    }\n\n    if (x.length !== this.length) {\n      throw new Error('Array.getXY: x needs to be of the same length as array')\n    }\n  } else {\n    debuglog('Array.getXY: x === null, x will be taken as the index of each value.')\n  }\n\n  const xyArray = []\n  for (let i = 0; i < this.length; i++) {\n    if (x !== null) {\n      xyArray.push({\n        x: x[i],\n        y: this[i],\n      })\n    } else {\n      xyArray.push({\n        x: i,\n        y: this[i],\n      })\n    }\n  }\n\n  return (xyArray)\n}\n\nArray.prototype.average = function average(type = 'global', size = 5): ?Number {\n  if (type === 'global') {\n    const sum = this.sum()\n    if (!isNaN(sum)) {\n      return (sum / this.length)\n    }\n  } else if (type === 'sliding') {\n    const windowAverages = []\n    for (let i = 0; i < this.length; i++) {\n      let endIndex = i + size\n      if (endIndex > this.length) {\n        endIndex = this.length\n      }\n      const windowArray = this.slice(i, endIndex)\n\n      const sum = windowArray.sum()\n      if (!isNaN(sum)) {\n        windowAverages.push(sum / windowArray.length)\n      }\n    }\n    return (windowAverages)\n  } else if (type === 'bins') {\n    const bins = []\n    let position = 0\n    while (position < this.length) {\n      const endIndex = position + size\n      if (endIndex > this.length) {\n        break\n      }\n\n      const windowArray = this.slice(position, endIndex)\n\n      const sum = windowArray.sum()\n      if (!isNaN(sum)) {\n        bins.push(sum / windowArray.length)\n      }\n\n      position = endIndex\n    }\n\n    return (bins)\n  }\n\n  return undefined\n}\n\nArray.prototype.sum = function sum() {\n  let total = 0\n  for (let i = 0; i < this.length; i++) {\n    if (isNaN(this[i])) {\n      return (NaN)\n    }\n    total += this[i]\n  }\n  return (total)\n}\n\nArray.prototype.integrate = function integrate() {\n  let sum = 0\n  const cumulativeArray = []\n  for (let i = 0; i < this.length; i++) {\n    if (isNaN(this[i])) {\n      return (NaN)\n    }\n\n    sum += this[i]\n    cumulativeArray.push(sum)\n  }\n  return (cumulativeArray)\n}\n\nArray.prototype.equals = function equals(value) {\n  const resultVector = []\n  let result = null\n  for (let i = 0, l = this.length; i < l; ++i) {\n    result = (this[i] === value)\n    resultVector.push(result)\n  }\n  return resultVector\n}\n\nArray.prototype.ntrue = function ntrue() {\n  let resultSum = 0\n  let result = null\n  for (let i = 0, l = this.length; i < l; ++i) {\n    result = (this[i] === true) ?\n      1 :\n      0\n    resultSum += result\n  }\n  return resultSum\n}\n\nArray.prototype.nEquals = function nEquals(value) {\n  return this.equals(value).ntrue()\n}\n\nArray.prototype.indicesOf = function indicesOf(value) {\n  const resultVector = []\n  for (let i = 0, l = this.length; i < l; i++) {\n    if (this[i] === value) {\n      resultVector.push(i)\n    }\n  }\n  return resultVector\n}\n\nArray.prototype.exclude = function exclude(values) {\n  // returns an array without exluded values\n  const resultVector = []\n  for (let i = 0, l = this.length; i < l; ++i) {\n    let addit = true\n    for (let j = 0; j < values.length; ++j) {\n      if (this[i] === values[j]) {\n        addit = false\n      }\n    }\n    if (addit) {\n      resultVector.push(this[i])\n    }\n  }\n  return resultVector\n}\n\nArray.prototype.allHaveConstructor = function allHaveConstructor(constructorObject) {\n  for (let i = 0; i < this.length; i++) {\n    if (this[i].constructor !== constructorObject) {\n      return false\n    }\n  }\n  return true\n}\n\nArray.prototype.includes = function includes(array) {\n  // returns a bool wether all value of specified array are in current array\n  for (let i = 0; i < array.length; i++) {\n    if (this.indexOf(array[i]) === -1) { return false }\n  }\n  return true\n}\n\nexport {\n  Array,\n  String,\n  diag,\n  rowSum,\n  getRow,\n  matrix,\n  samplePermutation,\n  rep,\n  Deferred,\n  recurse,\n  jitter,\n  delay,\n  looksLikeAPromise,\n  mustHaveConstructor,\n  mustBeDefined,\n  mandatory,\n  debuglog,\n  debugWarn,\n  debugError,\n  noop,\n}\n\n\n\n// WEBPACK FOOTER //\n// ./src/framework/utilities.js","module.exports = __WEBPACK_EXTERNAL_MODULE_1__;\n\n\n//////////////////\n// WEBPACK FOOTER\n// external \"lodash\"\n// module id = 1\n// module chunks = 0","/** @module EventData */\nimport _ from 'lodash'\nimport { mandatory } from './utilities'\n\n/** Class storing all types of event to be handled by a StateManager*/\nexport default class EventData {\n  /**\n   * Maybe make a class out of this...\n   * @param {string} flag      flag describing the input type\n   * @param {number} timeStamp real time of input\n   */\n  constructor(flag = mandatory('flag'), timeStamp = mandatory('timeStamp'), data = null) {\n    this.flag = flag\n    this.happenedAt = timeStamp\n\n    /**\n     * Wether the event was already handled by the state handleEvent function.\n     * @type {Boolean}\n     */\n    this.handled = false\n\n    /**\n     * Wether event data was stored by the stateManager storeInformation function.\n     * @type {Boolean}\n     */\n    this.stored = false\n\n    const baseData = {\n      belongsTo: 'globalLog', // could be an array of strings\n      handledAt: null,\n      storedAt: null,\n    }\n\n    this.data = _.extend(baseData, data)\n  }\n}\n\n\n\n// WEBPACK FOOTER //\n// ./src/framework/EventData.js","import _ from 'lodash'\nimport {\n  Array,\n  String,\n  mandatory,\n  debuglog,\n  debugError,\n} from './utilities'\n\n/* Handles your data and logs for you */\nexport default class DataManager {\n  /**\n   * DataManager handle data tables and a general log of event. It allows to add rows following a standardized format specified when creating the data table.\n   * IDs can be generated automatically (automaticID = true by default) if not specified. And the DataManager has methods to export to different format as well\n   * as handling REST api calls, or node-webkit permanent storage capabilities when using NW.js or Electron.\n   * @param  {object} parent    Parent object\n   * @param  {[type]} subjectID [description]\n   * @return {[type]}           [description]\n   */\n  constructor(parent = mandatory(), subjectID = null) {\n    /**\n     * DataManager parent object.\n     * @type {object}\n     */\n    this._parent = parent\n\n    /**\n     * ID of the subject as defined in the parent subjectID public variable.\n     * @type {string}\n     */\n    if (subjectID) {\n      this._subjectID = subjectID\n    }\n\n    /**\n     * Determine if the data managershould create ID on its own for the added data.\n     * @type {Boolean}\n     */\n    this.automaticID = true\n\n    /* --- Constants --- */\n\n    /**\n     * Value to replace NA in the exported data\n     * @type {?number}\n     * @const\n     */\n    this.VALUE_FOR_NA = null\n\n    this.FLAG_EVENT_NOFLAG = 'EVENT_UNFLAGGED'\n\n    /* --- Data tables --- */\n    /**\n     * Object containing all the data tables\n     * @type {Object}\n     */\n    this.dataTables = {}\n\n    /**\n     * dataTables.globalLog is the default data table that stores all events of the task with this format:\n     * * id : string\n     * * flag : string\n     * * happenedAt : timeStamp\n     * * data : object\n     * @private\n     */\n    const globalLogFields = ['id', 'flag', 'happenedAt', 'data'] // in data object add \"handledAt\", \"storedAt\",\n    this.addTable('globalLog', globalLogFields)\n\n    /* --- REST API --- */\n    /**\n     * URL of the page to which data is sent to be stored.\n     * Note: Login credentials can't be managed with frontend javascript and security should be integrated with the backend.\n     * @type {string}\n     */\n    this.restURL = null\n\n    /** Determines wether the current environment is Node or the Browser */\n    this.isNode = false\n    if (typeof module !== 'undefined' && module.exports) {\n      this.isNode = true\n    }\n  }\n\n  /* ======== Data tables function ======== */\n  /**\n   * [addTable description]\n   * @param {[type]} name   [description]\n   * @param {[type]} fields [description]\n   */\n  addTable(name = mandatory(), fields = mandatory()) {\n    if (_.has(this.dataTables, name)) {\n      throw new Error(`DataManager: Data table with name '${name}' already exists`)\n    }\n\n    /* --- Create the dataTable object and define the fields --- */\n    this.dataTables[name] = {}\n    for (let i = 0; i < fields.length; i++) {\n      this.dataTables[name][fields[i]] = []\n    }\n\n    if (_.indexOf(fields, 'id') === -1) {\n      this.dataTables[name].id = []\n    }\n  }\n\n  /**\n   * Checks if a table of specified name already exist in the dataTables object\n   * @param  {string}  name name of the datatable\n   * @return {Boolean}\n   */\n  hasTable(name = mandatory()) {\n    if (_.has(this.dataTables, name)) {\n      return (true)\n    }\n    return (false)\n  }\n\n  /**\n   * Adds a row to the specified data table. Can generate automatically ids if not present in the rows\n   * @param {string} name name of the dataTable\n   * @param {object} rows Object containing a property for each column of the specified data table. Those can be array but all must have the same length (adding the same number of rows for each columns of data).\n   */\n  addRows(name = mandatory(), rows = mandatory()) {\n    if (this.isValidRows(name, rows)) {\n      const columnNamesRows = _.keys(rows)\n      const columnNamesDataTableWithoutId = _.without(_.keys(this.dataTables[name]), 'id')\n\n      if ((_.indexOf(columnNamesRows, 'id') === -1) && (this.automaticID)) {\n        this.dataTables[name].id = this.dataTables[name].id.concat(this.generateIds(name, rows[columnNamesRows[0].length]))\n      }\n\n      for (let i = 0; i < columnNamesDataTableWithoutId.length; i++) {\n        this.dataTables[name][columnNamesDataTableWithoutId[i]] = this.dataTables[name][columnNamesDataTableWithoutId[i]].concat(rows[columnNamesDataTableWithoutId[i]])\n      }\n\n      const nrows = (typeof rows.length === 'undefined') ? 1 : rows.length\n      debuglog(`DataManager: added ${nrows} rows to ${name} data table.`)\n    } else {\n      throw new Error('DataManager: Row is of invalid format.')\n    }\n  }\n\n  /**\n   * Generate an array of new Ids for the selected data table\n   * @param  {string} name        Data table name\n   * @param  {Number} numberOfIds Number of Ids to generate\n   * @return {array}             Range of ids\n   */\n  generateIds(name = mandatory(), numberOfIds = 1) {\n    if (!(_.has(this.dataTables, name))) {\n      throw new Error(`DataManager: Data table with name '${name}' does not exists`)\n    }\n\n    if (!(_.has(this.dataTables[name], 'id'))) {\n      throw new Error(`DataManager: Data table with name '${name}' does not have an 'id' field`)\n    }\n\n    let startId = 0\n    if (this.dataTables[name].id.length !== 0) {\n      startId = _.max(this.dataTables[name].id) + 1\n    }\n\n    return (_.range(startId, startId + numberOfIds))\n  }\n\n  /**\n   * Generate an object with properties for each columns of the specified data table. The object properties are defined as empty array.\n   * Useful function to prepare adequate rows to add to the data.\n   * @param  {string} name Name of the model data table.\n   * @return {object}      Empty data table row\n   */\n  getEmptyRow(name = mandatory()) {\n    if (!(_.has(this.dataTables, name))) {\n      throw new Error(`DataManager: Data table with name '${name}' does not exists`)\n    }\n\n    const emptyTable = {}\n    const columnNamesDataTable = _.keys(this.dataTables[name])\n\n    for (let i = 0; i < columnNamesDataTable.length; i++) {\n      emptyTable[columnNamesDataTable[i]] = []\n    }\n\n    return (emptyTable)\n  }\n\n  /**\n   * Checks if the given rows follow the same structure as the selected datatable.\n   * @param  {string}  name Key of the datatable in the dataTables object\n   * @param  {object}  rows Object containing on or several rows for each columns.\n   * @return {Boolean}\n   */\n  isValidRows(name = mandatory(), rows = mandatory()) {\n    if (!(_.has(this.dataTables, name))) {\n      throw new Error(`DataManager: Data table with name '${name}' does not exists`)\n    }\n\n    if (typeof rows !== 'object') {\n      return (false)\n    }\n\n    const columnNamesDataTable = _.keys(this.dataTables[name])\n    const columnNamesRows = _.keys(rows)\n    let previousLenght = null\n    for (let i = 0; i < columnNamesDataTable.length; i++) {\n      if (_.indexOf(columnNamesRows, columnNamesDataTable[i]) !== -1) {\n        if (rows[columnNamesDataTable[i]].constructor === Array) {\n          if (previousLenght === null) {\n            previousLenght = rows[columnNamesDataTable[i]].length\n          } else {\n            const newLenght = rows[columnNamesDataTable[i]].length\n            if (previousLenght !== newLenght) {\n              /* at least 2 columns do not have the same number of rows */\n              return (false)\n            }\n          }\n        } else if (previousLenght !== null) {\n          return (false)\n        }\n      } else if ((columnNamesDataTable[i] !== 'id') && (!this.automaticID)) {\n        /* check if the column it did not find was the id column - if automaticID is set to true row is still valid */\n        debugError(`DataManager: Invalid row, does not contain column ${columnNamesDataTable[i]} of dataTable${name}`)\n        return (false)\n      }\n    }\n\n    // add check for variable tpe inside the columns\n\n    return (true)\n  }\n\n  /* ======== Export formats ======== */\n  toCsv(name = mandatory()) {\n    if (!(_.has(this.dataTables, name))) {\n      throw new Error(`DataManager: Data table with name '${name}' does not exists`)\n    }\n\n    const columnNamesDataTable = _.keys(this.dataTables[name])\n\n    const lineArray = []\n    for (let i = 0; i < columnNamesDataTable[0].length; i++) {\n      const row = []\n      for (let j = 0; j < columnNamesDataTable.length; j++) {\n        row.push(columnNamesDataTable[j][i])\n      }\n      const line = row.join(',')\n      lineArray.push(i === 0 ? `data:text/csv;charset=utf-8,${line}` : line)\n    }\n\n    const csvContent = lineArray.join('\\n')\n\n    return (csvContent)\n  }\n\n  toDataArray(name = mandatory()) {\n    if (!(_.has(this.dataTables, name))) {\n      throw new Error(`DataManager: Data table with name '${name}' does not exists`)\n    }\n\n    const columnNamesDataTable = _.keys(this.dataTables[name])\n\n    const dataArray = []\n    for (let i = 0; i < columnNamesDataTable.length; i++) {\n      dataArray.push(columnNamesDataTable[i])\n    }\n\n    return (dataArray)\n  }\n\n  toJSON(name = null) {\n    if (name) {\n      if (!(_.has(this.dataTables, name))) {\n        throw new Error(`DataManager: Data table with name '${name}' does not exists`)\n      }\n\n      JSON.stringify(this.dataTables[name])\n    } else {\n      JSON.stringify(this.dataTables)\n    }\n  }\n\n  saveData() {\n    /* Check if context is node-webkit (native app) */\n    if (typeof require === 'function') {\n      /* node-webkit can be used */\n      // https://github.com/nwjs/nw.js/wiki/Save-persistent-data-in-app\n      try {\n        // require('nwjs-osx-menu')(window)\n      } catch (error) {\n        debugError(error)\n      }\n    } else if (this.restURL) {\n        // $.ajax();\n    }\n  }\n\n  /* ======== Getters and setters ======== */\n\n\n  /** The complete log since the creation of the DataManager  */\n  get globalLog() {\n    return (this._globalLog)\n  }\n\n  set globalLog(value) { // eslint-disable-line\n    // readonly\n  }\n\n  /** Integer value of the next id for the global log */\n  get nextLogId() {\n    if (this.globalLog.id.length > 0) {\n      return (_.max(this.globalLog.id) + 1)\n    }\n    return (0)\n  }\n\n\n  set nextLogId(value) {\n    if (value.constructor === String) {\n      this._customNextID = value // TODO to implement\n      console.log(`DataManager: next event 'id' will be ${value}`)\n    } else {\n      throw new Error('DataManager: id should be a string.')\n    }\n  }\n\n}\n\n\n\n// WEBPACK FOOTER //\n// ./src/framework/DataManager.js","/** @module RessourceManager */\nimport $ from 'jquery'\nimport { mandatory, debugError, Deferred } from './utilities'\n\n/* JS Class for ressource management */\nexport default class RessourceManager {\n  /**\n   * RessourceManager - class which allows to load text file in different allowed\n   * format, convert it to javascript objects accessible by proxy allowing for\n   * easy localization and debuging.\n   *\n   * @constructor\n   * @param {...string} filepaths iterable of strings of file paths to load\n   *\n   * @return {RessourceManager}\n   */\n  constructor(...filepaths) {\n    /* --- Set language --- */\n    this.defaultLanguage = 'en'\n    this.currentLanguage = this.defaultLanguage\n\n    /* --- Initialize data --- */\n    this.data = {}\n\n    /* --- Custom parameters --- */\n\n    /**\n     * overwrite - determines default behavior when adding an already existing\n     * variables\n     *\n     * @type {Boolean}\n     */\n    this.overwrite = true\n\n    /**\n     * useAjax - If set to false, files will not be loaded and data can only be added in code\n     * using addDataFamilly, or by directly modifying this.data object.\n     * Useful to make sure local app do not try to use ajax without a server.\n     *\n     * @type {Boolean}\n     */\n    this.useAjax = true\n\n\n    /* --- Register sprecified file paths --- */\n    this.addFiles(filepaths)\n  }\n\n  /* === File management === */\n\n  /**\n   * addFiles - Add all the files listed, then calls for each the load functions\n   * and store it in a promise array.\n   * Returns a Promise.all() that is resolves when all files are loaded, parsed\n   * and stored.\n   *\n   * @param {...string} filepaths iterable of file paths\n   *\n   * @returns {Promise} Promise that will resolve when all files are loaded and\n   *                    processed\n   */\n  addFiles(...filepaths) {\n    if (this.useAjax === false) {\n      throw new Error(\"RessourceManager.addFiles: useAjax set to false - can't add files over the network\")\n    }\n\n    const concatFilepaths = [].concat(...filepaths)\n\n    this.files = []\n    const promises = []\n    for (let i = 0; i < concatFilepaths.length; i++) {\n      if (this.isOfValidFormat(concatFilepaths[i])) {\n        this.files[i] = {}\n        this.files[i].type = this.getFormat(concatFilepaths[i])\n        this.files[i].path = concatFilepaths[i]\n        this.files[i].loaded = false // once the raw string is uncovered\n        this.files[i].validated = false // once data is parse from the raw string\n        this.files[i].added = false // once the parsed data is organized in this.data\n        this.files[i].raw = false\n        this.files[i].data = null\n        promises.push(this.loadFile(i))\n      } else {\n        console.warn(`RessourceManager.addFiles: invalid type for ${concatFilepaths[i]}`)\n      }\n    }\n\n    return Promise.all(promises)\n  }\n\n\n  /**\n   * loadFile - Performs an jQuery ajax call to get the file at specified index\n   * in this.files[fileIndex]. Then call this.parseRaw() on the result.\n   * Returns a promise.\n   *\n   * @param {number} fileIndex Index in the files array\n   *\n   * @returns {Promise} Will resolve when file processed\n   */\n  loadFile(fileIndex = mandatory()) {\n    const deffered = new Deferred()\n\n    if (typeof this.files[fileIndex] === 'undefined') {\n      return deffered.reject('RessourceManager.loadFile: files[fileIndex] is not defined')\n    }\n\n    const thisObject = this\n    $.ajax({\n      type: 'GET',\n      url: this.files[fileIndex].path,\n    })\n      .then((response) => {\n        thisObject.files[fileIndex].loaded = true\n        thisObject.files[fileIndex].raw = response\n\n        try {\n          thisObject.parseRaw(fileIndex)\n        } catch (e) {\n          deffered.reject(e)\n        } finally {\n          deffered.resolve(`RessourceManager.loadFile: ${thisObject.files[fileIndex].path} parsed`)\n        }\n      })\n\n    return deffered.promise\n  }\n\n  parseRaw(fileIndex = mandatory()) {\n    if (typeof this.files[fileIndex] === 'undefined') {\n      throw new Error('RessourceManager.parseRaw: files[fileIndex] is not defined')\n    }\n\n    const file = this.files[fileIndex]\n\n    if (file.raw === null) {\n      throw new Error('RessourceManager.parseRaw: file.raw is null or not validated')\n    }\n    let parser\n    let arg = null\n    switch (file.type) {\n      case 'json':\n      // read json\n        parser = JSON.parse\n        break\n      case 'csv':\n      // read csv\n        parser = $.csv.toObjects\n        break\n      case 'xml':\n      // read xml\n        if (window.DOMParser) {\n          parser = new DOMParser()\n          parser = parser.parseFromString\n          arg = 'text/xml'\n        } else {\n          // Internet Explorer\n          parser = new window.ActiveXObject('Microsoft.XMLDOM')\n          parser.async = false\n          parser = parser.loadXML\n        }\n        break\n      default:\n        throw new Error('RessourceManager.parseRaw: file.type is null or not validated')\n    }\n\n    try {\n      if (arg) {\n        file.data = parser(file.raw, arg)\n      } else {\n        file.data = parser(file.raw)\n      }\n    } catch (e) {\n      file.validated = false\n      file.data = null\n      throw new Error(e)\n    } finally {\n      // file has been correctly parsed and stored in object format\n      file.validated = true\n\n      // when a file is parsed, merge the new data\n      this.processParsed()\n    }\n  }\n\n  processParsed() {\n    // first level are data famillies e.g strings, constants, ids, flags etc...\n    for (let i = 0; i < this.files.length; i++) {\n      if ((this.files[i].validated !== false) && (this.files[i].data) && (!this.files[i].added)) {\n        const data = this.files[i].data\n        const keys = Object.keys(data)\n        for (let j = 0; j < keys.length; j++) {\n          this.addDataFamilly(keys[j], data[keys[j]])\n        }\n\n        this.files[i].added = true\n      }\n    }\n  }\n\n\n  /**\n   * addDataFamilly - adds the familly if does not exist to the data set, then\n   * extend it with the data.\n   *\n   * @param {String}  familly          Familly name\n   * @param {Object}  data             Each property of this object is a variable\n   *                                   name\n   * @param {Boolean} [overwrite=null] If overwrite is set to true, new values\n   *                                   overwrites old one, if false only new\n   *                                   variables are kept.\n   *\n   * @returns {undefined}\n   */\n  addDataFamilly(familly = mandatory(), data = mandatory(), overwrite = null) {\n    let toAdd = data\n    let id\n    if (data.constructor !== Object) { // If the data is not an object: organize by type\n      id = familly\n      familly = `${data.constructor.name.toLowerCase()}s`\n      toAdd = {\n        [id]: data,\n      }\n    }\n\n    if (typeof this.data[familly] === 'undefined') {\n      this.data[familly] = {}\n    }\n\n    if (overwrite === null) {\n      overwrite = this.overwrite\n    }\n\n    if (overwrite) {\n      this.data[familly] = this.extend(this.data[familly], toAdd)\n    } else {\n      this.data[familly] = this.extend(toAdd, this.data[familly])\n    }\n  }\n\n\n  /**\n   * getNextId - Returns the lenght of the specified familly\n   *\n   * @param {string} familly\n   *\n   * @returns {number} 0 if the familly does not exist, the total number of keys otherwise.\n   */\n  getNextId(familly = mandatory()) {\n    if (this.data.hasOwnProperty(familly)) {\n      return Object.keys(this.data[familly]).length\n    }\n    return 0\n  }\n\n\n  /**\n   * add - Parse and add the object to the data.\n   *\n   * @param {Object}  object  Object with either variables at the root\n   * e.g {variable: \"example\"} or with familly name at the root e.g\n   * {familly : { variable: \"example\"}}\n   * @param {Boolean} [overwrite=null]  If overwrite is set to true,\n   * new values overwrites old one, if false only new variables are kept.\n   *\n   * @returns {undefined}\n   */\n  add(object = mandatory(), overwrite = null) {\n    if (object.constructor !== Object) {\n      throw new Error('RessourceManager.add: cannot add data from a non object')\n    }\n    const oldOverwrite = this.overwrite\n    if (overwrite === null) {\n      overwrite = oldOverwrite\n    } else {\n      this.overwrite = overwrite\n    }\n\n    const keys = Object.keys(object)\n    for (let i = 0; i < keys.length; i++) {\n      if (object[keys[i]].constructor === Object) {\n        this.addDataFamilly(keys[i], object[keys[i]])\n      } else if (object[keys[i]].constructor === Array) {\n        this.addByName(keys[i], object[keys[i]], 'arrays')\n      } else {\n        this.addByName(keys[i], object[keys[i]])\n      }\n    }\n\n    this.overwrite = oldOverwrite\n  }\n\n\n  /**\n   * addByName - Add a single variable to the data with specified name and value,\n   * in the specified familly. If no familly is specified, using strings.\n   *\n   * @param {string} name              Variable name\n   * @param {object} value             Variable value\n   * @param {string} [familly=strings] Familly name\n   * @param {null}   [overwrite=null]  If overwrite is set to true,new values\n   *                                   overwrites old one, if false only new\n   *                                   variables are kept.\n   *\n   * @returns {undefined}\n   */\n  addByName(name = mandatory(), value = mandatory(), familly = 'strings', overwrite = null) {\n    if (typeof this.data[familly] === 'undefined') {\n      this.data[familly] = {}\n    }\n\n    if (overwrite === null) {\n      overwrite = this.overwrite\n    }\n\n    if (!(this.data[familly].hasOwnProperty(name)) || overwrite) {\n      console.warn(`RessourceManager.addByName: already a ressource named ${name} - Overwriting it.`)\n      this.data[familly][name] = value\n    }\n  }\n\n  /**\n   * getFormat - Returns the extension of the file in filepath or an empty string\n   * if no etension is found\n   *\n   * @param {string} filepath\n   *\n   * @returns {string}\n   */\n  getFormat(filepath = mandatory()) {\n    // fancy way of making sure we substr(index) with\n    // index >>> filepath.lenght if no . is found\n    // from http://stackoverflow.com/questions/190852/how-can-i-get-file-extensions-with-javascript/1203361#1203361\n    return filepath.substr((~-filepath.lastIndexOf('.') >>> 0) + 2) // eslint-disable-line\n  }\n\n  isOfValidFormat(filepath = mandatory()) {\n    const validFormats = ['json', 'csv', 'xml']\n    if (validFormats.indexOf(this.getFormat(filepath)) !== -1) {\n      return true\n    }\n    return false\n  }\n\n  /**\n   * mergeWith - Merge current data with another RessourceManager. Duplicated\n   * keys gets overwritten by those of the other RessourceManager.\n   *\n   * @param {RessourceManager} ressourceManager Another RessourceManager to merge\n   *\n   */\n  mergeWith(ressourceManager = mandatory()) {\n    if (ressourceManager.constructor !== RessourceManager) {\n      throw new Error('RessourceManager.mergeWith: specified ressourceManager is not of class RessourceManager.')\n    }\n\n    const currentFamillies = this.famillies\n    const mergingFamillies = ressourceManager.famillies\n\n    for (let i = 0; i < mergingFamillies.length; i++) {\n      if (currentFamillies.indexOf(mergingFamillies[i]) === -1) {\n        this.data[mergingFamillies[i]] = ressourceManager.data[mergingFamillies[i]]\n      } else {\n        this.data[mergingFamillies[i]] = this.extend(this.data[mergingFamillies[i]], ressourceManager.data[mergingFamillies[i]])\n      }\n    }\n  }\n\n\n  /**\n   * lookFor - Looks for a variable name in all the famillies\n   *\n   * @param {string} variable variable to look for\n   *\n   * @returns {?object} data[familly][variable] if found, or undefined\n   */\n  lookFor(...variable) {\n    let result\n    if (variable.length === 1) {\n      if (this.data.hasOwnProperty(variable)) {\n        result = this.data[variable]\n      } else {\n        const famillies = this.famillies\n        for (let i = 0; i < famillies.length; i++) {\n          if (this.data[famillies[i]].hasOwnProperty(variable)) {\n            result = this.data[famillies[i]][variable]\n            break\n          }\n        }\n      }\n    } else if (variable.length > 1) {\n      result = {}\n      for (let i = 0; i < variable.length; i++) {\n        result[variable[i]] = this.lookFor(variable[i])\n      }\n    }\n\n    return result\n  }\n\n\n  /**\n   * Pass in the objects to merge as arguments.\n   * For a deep extend, set the first argument to `true`.\n   * Adapted from JQuery haters :\n   * https://gomakethings.com/vanilla-javascript-version-of-jquery-extend/\n   *\n   * @param {array} args list of objects to extend. If first arguemnt is true, a deep\n   * copy is performed.\n   *\n   * @returns {type} Description\n   */\n  extend(...args) {\n    // Variables\n    const extended = {}\n    let deep = false\n    let i = 0\n    const length = args.length\n\n    // Check if a deep merge\n    if (Object.prototype.toString.call(args[0]) === '[object Boolean]') {\n      deep = args[0]\n      i += 1\n    }\n\n    // Merge the object into the extended object\n    const merge = function (obj) {\n      for (const prop in obj) {\n        if (Object.prototype.hasOwnProperty.call(obj, prop)) {\n          // If deep merge and property is an object, merge properties\n          if (deep && Object.prototype.toString.call(obj[prop]) === '[object Object]') {\n            extended[prop] = this.extend(true, extended[prop], obj[prop])\n          } else {\n            extended[prop] = obj[prop]\n          }\n        }\n      }\n    }\n\n    // Loop through each object and conduct a merge\n    for (; i < length; i++) {\n      const obj = args[i]\n      merge(obj)\n    }\n\n    return extended\n  }\n\n\n  /**\n   * famillies - Description\n   *\n   * @returns {type} Description\n   */\n  get famillies() {\n    return Object.keys(this.data)\n  }\n\n  get has() {\n    return new Proxy(this, {\n      get(target, pathString) {\n        if (typeof target.get[pathString] === 'undefined') {\n          return false\n        }\n        return true\n      },\n    })\n  }\n\n  get get() {\n    return new Proxy(this, {\n      get(target, pathString) {\n        const path = pathString.split('_')\n        const famillies = target.famillies\n        let lookForLanguage = target.currentLanguage\n        let lookForFamilly = 'strings'\n        let lookForVariable\n        let couldSwapForVariable = false\n        for (let i = 0; i < path.length; i++) {\n          if (famillies.indexOf(path[i]) !== -1) {\n            lookForFamilly = path[i]\n            couldSwapForVariable = true\n          } else if (path[i].length === 2) {\n            lookForLanguage = path[i]\n          } else {\n            if (typeof lookForVariable !== 'undefined') {\n              console.error(`RessourceManager.get: at least two possible variable names into path: ${lookForVariable} and ${path[i]}`)\n              return undefined\n            }\n            lookForVariable = path[i]\n          }\n        }\n\n        if (typeof lookForVariable === 'undefined') {\n          if (couldSwapForVariable) {\n            lookForVariable = lookForFamilly\n          } else {\n            debugError(`RessourceManager.get: no variable name found in ${pathString}`)\n            return undefined\n          }\n        }\n\n        let result\n        if ((target.data.hasOwnProperty(lookForFamilly)) && (target.data[lookForFamilly].hasOwnProperty(lookForVariable))) {\n          result = target.data[lookForFamilly][lookForVariable]\n        } else {\n          result = target.lookFor(lookForVariable)\n          if (typeof result === 'undefined') {\n            console.error(`RessourceManager.get: no ressource for path ${lookForFamilly}.${lookForVariable}`)\n            return undefined\n          }\n        }\n\n        if (result.constructor !== Object) {\n          return result\n        } else if (result.hasOwnProperty(lookForLanguage)) {\n          return result[lookForLanguage]\n        } else if (result.hasOwnProperty(target.currentLanguage)) {\n          console.warn(`RessourceManager.get: no valid language, defaulting to ${target.currentLanguage}`)\n          return result[target.currentLanguage]\n        }\n        console.warn('RessourceManager.get: no localization language found, returning the whole object')\n        return result\n      },\n\n    })\n  }\n\n\n}\n\n\n\n// WEBPACK FOOTER //\n// ./src/framework/RessourceManager.js","\n/** @module State */\nimport _ from 'lodash'\nimport EventData from './EventData'\nimport { mandatory, debuglog, debugWarn, debugError, mustBeDefined, mustHaveConstructor } from './utilities'\n\n/* State object has a specific way to handle input and update objects */\nexport default class State {\n\n\n  /**\n   * @constructor\n   * @param {object} [stateManager]\n   * @param {string} [stateKey]\n   */\n  constructor(stateManager = mandatory(), stateKey = mandatory()) {\n    this._stateManager = stateManager\n    this._parent = stateManager._parent\n    this._dataManager = stateManager._dataManager\n\n    this.stateKey = stateKey\n\n    /**\n     * Object in which properties names are handling function to be called for specific events.\n     * The key of those properties are the event flags. Handling functions should return a Promise.\n     * @type {Object}\n     */\n    this._eventFunctions = {}\n\n    /**\n     * Array of handling function to be called when the state awaken, just after state change.\n     * This is where redrawing should go. Handling functions should return a Promise.\n     * @type {Array}\n     * @private\n     */\n    this._awakeningFunctions = []\n\n    /**\n     * Array of handling functions to be called when the state is dismissed, just before the state change.\n     * Handling functions should return a Promise.\n     * @type {Array}\n     * @private\n     */\n    this._endingFunctions = []\n\n    /**\n     * Array of functions that are to be called upon each updates.\n     * Those functions should return a Promise.\n     * @type {Array}\n     */\n    this._updateFunctions = []\n\n    /**\n     * Array of stored timed event in case of state freezing\n     * @type {Array}\n     */\n    this._frozenEvents = []\n\n    /**\n     * Timestamp of frozen time. Value is null if the state is not frozen.\n     * @type {int}\n     */\n    this._frozenAt = null\n\n    /**\n     * Constant. When unfreezing if the time difference etween happenedAt and the current timeInMs is less than\n     * this value, the event is directly added to the event heap. Else it is treated as a tigger event.\n     * @type {Number}\n     */\n    this.FREEZE_DELAY = 50\n  }\n\n  /* ======== Class Methods ======== */\n\n  /* === Lifecycle hook functions === */\n\n  /**\n   * Function called at state awakening.\n   * All functions of the _awakeningFunctions array will be called, they must return a Promise.\n   */\n  awake() {\n    /* --- If state was frozen unfreeze it but do not re-awake --- */\n    if (this._frozenAt !== null) {\n      this.unfreeze()\n    } else {\n      if (typeof this._parent.sceneKey !== 'undefined') { debuglog(`${this.stateKey} of scene ${this._parent.sceneKey} awaken.`) }\n\n      const calledFunctions = []\n      for (let i = 0; i < this._awakeningFunctions.length; i++) {\n        calledFunctions[i] = Promise.method(this._awakeningFunctions[i].bind(this.context))\n      }\n\n      Promise.all(calledFunctions).then(() => {\n        /* Promise ran as expected, returned data */\n        debuglog('State: Awakening functions completed as expected.', calledFunctions)\n      }).catch((error) => {\n        /* an error occured */\n        debugError(error)\n      })\n    }\n  }\n\n  /**\n   * Function called when state ends, just before state change.\n   * All functions of the _endingFunctions array will be called, they must return a Promise.\n   */\n  end() {\n    const calledFunctions = []\n    for (let i = 0; i < this._endingFunctions.length; i++) {\n      calledFunctions[i] = Promise.method(this._endingFunctions[i].bind(this.context))\n    }\n\n    Promise.all(calledFunctions).then((data) => {\n      /* Promise ran as expected, returned data */\n      debuglog('State: Ending functions completed as expected.', calledFunctions)\n      debuglog(`${this.stateKey} ended.`)\n      return data\n    }).catch((error) => {\n      /* an error occured */\n      debugError(error)\n      return null\n    })\n  }\n\n  update() {\n    if (this._frozenAt === null) {\n      let nextEvent\n      while (this._stateManager.eventHeap.length) {\n        nextEvent = this._stateManager.getFirstEventAndRemoveFromHeap()\n        debuglog(`State: first event is ${nextEvent.flag}`)\n\n        this.handleEvent(nextEvent)\n      }\n\n      // if (typeof this._updateFunctions !== 'undefined') {\n      //\n      // }\n    }\n\n    // debuglog(this.stateKey + \" updated.\");\n  }\n\n  /* === Event based functions === */\n\n  handleEvent(event) {\n    // for each input flag have a specific function ready - that can be customizable\n    // rename input with Event ?\n    // make a promise and chain it with .then(stateHasFinishedHandlingEvent())\n    if (this.hasEventFunction(event.flag)) {\n      /* Promise allow for assynchronous handling of events */\n      const eventFunctions = this._eventFunctions[event.flag]\n      if (eventFunctions.constructor === Array) {\n        for (let i = 0; i < eventFunctions.length; i++) {\n          Promise.method(eventFunctions[i].bind(this.context))(event)\n            .then(function (functionName, data) {\n              /* Promise ran as expected, returned data */\n              debuglog(data)\n              const eventClone = _.cloneDeep(event)\n              eventClone.data.handlingFunction = functionName\n              this._stateManager.stateHasFinishedHandlingEvent(eventClone)\n            }.bind(this, eventFunctions[i].name))\n            .catch((error) => {\n              /* an error occured */\n              debugError(error)\n            })\n        }\n      } else {\n        Promise.method(eventFunctions.bind(this.context))\n          .then(function (functionName, data) {\n            /* Promise ran as expected, returned data */\n            debuglog(data)\n            const eventClone = _.cloneDeep(event)\n            eventClone.data.handlingFunction = functionName\n            this._stateManager.stateHasFinishedHandlingEvent(eventClone)\n          }.bind(this, eventFunctions.name))\n          .catch((error) => {\n            /* an error occured */\n            debugError(error)\n          })\n      }\n    } else {\n      this._stateManager.stateHasFinishedHandlingEvent(event)\n      debuglog(`State: Event '${event.flag}' not handled by state '${this.stateKey}'`)\n    }\n  }\n\n  freeze() {\n    const stateManager = this._stateManager\n\n    this._frozenAt = stateManager.timeInMs\n    this._frozenEvents = stateManager.getAllEvents()\n    debugWarn(this._frozenEvents)\n    stateManager.stateWasFrozen(this.stateKey) // TODO: make sure only one state can be frozen ? or add multiple frozen thingy\n  }\n\n  unfreeze() {\n    if (this._frozenAt === null) {\n      debugWarn('State.unfreeze: state was not frozen')\n      return\n    }\n\n    const stateManager = this._stateManager\n    const frozenEvents = this._frozenEvents\n\n    for (let i = 0; i < frozenEvents.length; i++) {\n      if (frozenEvents[i].constructor === EventData) {\n        frozenEvents[i].happenedAt += stateManager.timeInMs - this._frozenAt\n        if ((frozenEvents[i].happenedAt - stateManager.timeInMs) > this.FREEZE_DELAY) {\n          stateManager.addTimeTriggerEvent(frozenEvents[i])\n          console.log('timetrigger')\n          debugWarn(frozenEvents[i])\n        } else {\n          stateManager.addEvent(frozenEvents[i])\n          console.log('added event')\n          debugWarn(frozenEvents[i])\n        }\n      }\n    }\n\n    this._frozenAt = null\n    this._frozenEvents = []\n    stateManager.stateWasUnfreezed(this.stateKey) // TODO: make sure only one state can be frozen ? or add multiple frozen thingy\n  }\n\n  /* = Main functions = */\n  // TODO Use Promise.method\n  // TODO Change all _eventFunctions to arrays\n  registerEventFunctions(eventFlag, overwrite, ...handlingFunctions) {\n    mustBeDefined(eventFlag, overwrite, ...handlingFunctions)\n    mustHaveConstructor(Function, ...handlingFunctions)\n\n    // checks if functions should be stacked in an array for this flag\n    if (this.hasEventFunction(eventFlag)) {\n      if (this._eventFunctions[eventFlag].constructor === Array) {\n        // push the handlingFunction to the array of _eventFunctions[eventFlag]\n        this._eventFunctions[eventFlag] = this._eventFunctions[eventFlag].concat(handlingFunctions)\n        debuglog(`State ${this.stateKey}: several handling functions - handling function pushed to the array of event functions on event '${eventFlag}'`)\n      } else {\n        // creates array of event function\n        this._eventFunctions[eventFlag] = [this._eventFunctions[eventFlag]].concat(handlingFunctions)\n        debuglog(`State ${this.stateKey}: several handling functions - array created for handling functions for state on event '${eventFlag}'`)\n      }\n    } else {\n      this._eventFunctions[eventFlag] = handlingFunctions\n      debuglog(`State ${this.stateKey}: handling function added to state '${this.stateKey}' for event '${eventFlag}'`)\n    }\n  }\n\n  registerCycleFunctions(cycle, overwrite, ...handlingFunctions) {\n    mustBeDefined(cycle, overwrite, ...handlingFunctions)\n    mustHaveConstructor(Function, ...handlingFunctions)\n\n    let arrayName\n    switch (cycle) {\n      case 'awakening':\n        arrayName = '_awakeningFunctions'\n        break\n      case 'ending':\n        arrayName = '_endingFunctions'\n        break\n      case 'update':\n        arrayName = '_updateFunctions'\n        break\n      default:\n        throw new Error('State.registerCycleFunctions: Invalid cycle parameter.')\n    }\n\n    if (overwrite) {\n      this[arrayName] = handlingFunctions\n      debuglog(`State ${this.stateKey}: handling function overwrited ${arrayName}`)\n    } else {\n      this[arrayName] = this[arrayName].concat(handlingFunctions)\n      debuglog(`State ${this.stateKey}: handling function added to ${arrayName} array for state '${this.stateKey}'`)\n    }\n  }\n\n  /* = Short handle = */\n\n  /**\n   * Short hand function that adds several events using the handlingFunctions name as handle.\n   * @param [...function] handlingFunctions\n   */\n  addHandledEvents(...handlingFunctions) {\n    mustBeDefined(...handlingFunctions)\n    mustHaveConstructor(Function, ...handlingFunctions)\n\n    for (let i = 0; i < handlingFunctions.length; i++) {\n      this.registerEventFunctions(handlingFunctions[i].name, true, handlingFunctions[i])\n    }\n  }\n\n  addEventFunctions(eventFlag, ...handlingFunctions) {\n    mustBeDefined(eventFlag, ...handlingFunctions)\n    mustHaveConstructor(Function, ...handlingFunctions)\n    this.registerEventFunctions(eventFlag, false, ...handlingFunctions)\n  }\n\n  overwriteEventFunctions(eventFlag, ...handlingFunctions) {\n    mustBeDefined(eventFlag, ...handlingFunctions)\n    mustHaveConstructor(Function, ...handlingFunctions)\n    this.registerEventFunctions(eventFlag, true, ...handlingFunctions)\n  }\n\n  addAwakeningFunctions(...handlingFunctions) {\n    mustBeDefined(...handlingFunctions)\n    mustHaveConstructor(Function, ...handlingFunctions)\n\n    this.registerCycleFunctions('awakening', false, ...handlingFunctions)\n  }\n\n  overwriteAwakeningFunctions(...handlingFunctions) {\n    mustBeDefined(...handlingFunctions)\n    mustHaveConstructor(Function, ...handlingFunctions)\n\n    this.registerCycleFunctions('awakening', true, ...handlingFunctions)\n  }\n\n  overwriteEndingFunction(...handlingFunctions) {\n    mustBeDefined(...handlingFunctions)\n    mustHaveConstructor(Function, ...handlingFunctions)\n\n    this.registerCycleFunctions('ending', true, ...handlingFunctions)\n  }\n\n  addEndingFunctions(...handlingFunctions) {\n    mustBeDefined(...handlingFunctions)\n    mustHaveConstructor(Function, ...handlingFunctions)\n\n    this.registerCycleFunctions('ending', false, ...handlingFunctions)\n  }\n\n  overwriteUpdateFunctions(...handlingFunctions) {\n    mustBeDefined(...handlingFunctions)\n    mustHaveConstructor(Function, ...handlingFunctions)\n\n    this.registerCycleFunctions('udpate', false, ...handlingFunctions)\n  }\n\n  addUpdateFunctions(...handlingFunctions) {\n    mustBeDefined(...handlingFunctions)\n    mustHaveConstructor(Function, ...handlingFunctions)\n\n    this.registerCycleFunctions('udpate', false, ...handlingFunctions)\n  }\n\n\n  hasEventFunction(eventFlag = mandatory()) {\n    return (_.has(this._eventFunctions, eventFlag))\n  }\n\n\n  /* ======= Getters / Setters ======= */\n  /* === Globals getter / setter === */\n  getGlobal(name = mandatory()) {\n    return (this._stateManager.getGlobal(name))\n  }\n\n  setGlobal(name = mandatory(), value = mandatory()) {\n    return (this._stateManager.setGlobal(name, value))\n  }\n\n  get context() {\n    if (this._stateManager._taskObject) {\n      return (this._stateManager._taskObject.getContext(this))\n    }\n    return ({\n      taskObject: null,\n      dataManager: this._stateManager._dataManager,\n      scene: this._parent, // TODO Force the ._parent to be the .scene ?\n      stateManager: this._stateManager,\n      state: this,\n      R: this._stateManager.R,\n    })\n  }\n\n}\n\n\n\n// WEBPACK FOOTER //\n// ./src/framework/State.js","\n/** @module StateManager */\nimport _ from 'lodash'\nimport { BABYLON } from 'experiment-babylon-js'\n\nimport RessourceManager from './RessourceManager'\nimport State from './State'\nimport DataManager from './DataManager'\nimport EventData from './EventData'\nimport { mandatory, debuglog, debugWarn, debugError, mustBeDefined, mustHaveConstructor } from './utilities'\n\n/**\n * Manage lifecycle and variables through State objects.\n * Can dispatch information to the DataManager.\n * TODO check documentation style for es6 modules\n */\nexport default class StateManager {\n\n  /**\n   * @constructor\n   * @param  {object} parent       Parent  object\n   * @param  {DataManager} dataManager The task dataManager\n   */\n  constructor(parent = mandatory('parent'), dataManager = null) {\n    this._parent = parent\n    this._dataManager = dataManager\n\n    /* --- Look for taskObject and setup RessourceManager accordingly --- */\n    if (typeof parent.parentTaskObject !== 'undefined') {\n      this._taskObject = parent.parentTaskObject\n      this.R = this._taskObject.R\n    } else {\n      this.R = new RessourceManager()\n    }\n\n    const R = this.R\n\n    /**\n     * Array of Data\n     * @type {Array}\n     */\n    this._eventHeap = []\n\n    /**\n     * Stores temporary time triggered event. The update() function checks at each frame if the event should be triggered.\n     * @type {Array}\n     */\n    this._timeTriggerEvents = []\n\n    //\n    // Notes :\n    // 1- should we handle events assynchronously... what is the best way to implement it ?\n    // 2- event related to the awakening or ending of states should not go in the event heap, probably due to redraawing that might lag.\n    //\n\n    this.errorLog = []\n\n    this.R.add({\n      states: {\n        idle: 'idle',\n        pause: 'pause',\n        active: 'active',\n      },\n      values: {\n        timestampThreshold: 10e7,\n      },\n    }, false)\n\n    /*  Hash table of state objects */\n    this.states = {\n      idle: new State(this, R.get.states_idle),\n      active: new State(this, R.get.states_active),\n      pause: new State(this, R.get.states_pause),\n    }\n\n    this._currentStateKey = R.get.states_idle\n\n    /**\n     * Statekey of the current frozenState. If null, no state were frozen.\n     * @type {string}\n     */\n    this.frozenState = null\n\n    /**\n     * Holds variables that needs to be passed from one state to the next.\n     * @type {Object}\n     */\n    this.globals = {}\n\n    this.globalFunctions = {}\n  }\n\n  /* ======== Class methods ======== */\n  update() {\n    /* --- Checks if some _timeTriggerEvents should be added to the heap --- */\n    for (let i = 0; i < this._timeTriggerEvents.length; i++) {\n      if (this.timeInMs >= this._timeTriggerEvents[i].happenedAt) {\n        this._timeTriggerEvents[i].happenedAt = this.timeInMs // correct for fps delay\n        this.addEvent(this._timeTriggerEvents[i])\n        this._timeTriggerEvents.splice(i)\n      }\n    }\n\n    /* --- Update the state --- */\n    this.currentState.update()\n  }\n\n  storeEvent(event = mandatory()) {\n    if (this._dataManager.constructor !== DataManager) {\n      throw new Error('storeEvent: dataManager is not set, cannot store event.')\n    }\n\n    if (!event.handled) {\n      debuglog(event)\n      throw new Error('StateManager: cannot store an event that was not handled.')\n    }\n\n    if (event.stored) {\n      debuglog(event)\n      throw new Error('StateManager: Event already stored')\n    }\n\n    event.storedInErrorLog = false\n    for (let i = 0; i < event.data.belongsTo.length; i++) {\n      try {\n        event.data.storedAt = this.timeInMs\n        event.stored = true\n\n        this._dataManager.addRows(event.data.belongsTo[i], event)\n\n        debuglog('StateManager: storing event.')\n        debuglog(event)\n      } catch (error) {\n        console.log(`StateManager: Could not store data in ${event.data.belongsTo[i]} dataTable. Data was stored in the errorLog. DataManager error was: ${error}`)\n        this.storeInErrorLog(event)\n      }\n    }\n  }\n\n  storeData(data = mandatory()) {\n    if (this._dataManager.constructor !== DataManager) {\n      throw new Error('StateManager.storeData: dataManager is not set, cannot store event.')\n    }\n\n    if (!(_.has(data, 'belongsTo'))) {\n      debuglog(data)\n      throw new Error('StateManager: data needs a belongsTo property in order to store it in the dataManager.')\n    }\n\n    data.storedInErrorLog = false\n    for (let i = 0; i < data.belongsTo.length; i++) {\n      try {\n        this._dataManager.addRows(data.belongsTo[i], data)\n      } catch (error) {\n        console.error(`StateManager: Could not store data in ${data.belongsTo[i]} dataTable. Data was stored in the errorLog. DataManager error was: ${error}`)\n        this.storeInErrorLog(data)\n      }\n    }\n  }\n\n  storeInErrorLog(data = mandatory()) {\n    if (data.storedInErrorLog === false) {\n      data.storedInErrorLog = true\n      this.errorLog = this.errorLog.concat(data)\n      debuglog('StateManager: data stored in the errorLog.')\n    } else {\n      debugWarn('StateManager: data already stored in errorLog. Did not store it again.')\n    }\n  }\n\n  /* === State management === */\n\n  /**\n   * Adds a new state with specified stateKey.\n   * If a list of several states is specified, the function returns an array.\n   *\n   * @param {...string} stateKeys list of additional state\n   */\n  addState(...stateKeys) {\n    const returnedStates = []\n    let stateKey\n    for (let i = 0; i < stateKeys.length; i++) {\n      stateKey = stateKeys[i]\n\n      if (stateKey.constructor !== String) {\n        throw new Error('StateManager: stateKey must be a string.')\n      }\n\n      if (_.has(this.states, stateKey)) {\n        throw new Error(`StateManager: a state with a similar stateKey '${stateKey}' already exists.`)\n      }\n\n      this.states[stateKey] = new State(this, stateKey)\n\n      debuglog(`StateManager: added state '${stateKey}'.`)\n\n      returnedStates.push(this.states[stateKey])\n    }\n\n    return (returnedStates.length === 1) ? returnedStates[0] : returnedStates\n  }\n\n  /* === State change === */\n  goToState(key = mandatory()) {\n    if (_.has(this.states, key)) {\n      this.currentState.end()\n\n      this._currentStateKey = key\n      this.states[key].awake()\n    } else {\n      throw new Error('StateManager: Invalid state key.')\n    }\n  }\n\n  /* === Pause State === */\n\n  /**\n   * Funtion to set the PAUSE mode for all states. Default uses spacebar keydown event from this._parent.\n   * @param {Number} key  keyCode of the the pause button, default to 32 (spacebar)\n   * @param {string} flag event flag, defaults to this._parent.FLAG_EVENTS_INPUT_KEYDOWN\n   */\n  setPauseKeyStroke(key = 32, flag = null, addDefaultDesign = true) {\n    const pauseState = function (options = null) {\n      if (typeof this.state === 'undefined') {\n        throw new Error('state.pauseState: state is undefined')\n      }\n      const state = this.state\n      const stateManager = this.stateManager\n      const R = this.R\n\n      if (options.data.keyCode === key) {\n        state.freeze() // key function\n        stateManager.goToState(R.get.states_pause)\n      }\n\n      return ('state.pauseState: resolved')\n    }\n\n    const unPause = function (options = null) {\n      if (typeof this.stateManager === 'undefined') { // TODO Discuss wether it is a good idea to check the context\n        throw new Error('state.unPause: state is undefined')\n      }\n\n\n      if (options.data.keyCode === key) {\n        if (this.stateManager.frozenState !== null) {\n          this.stateManager.goToState(this.stateManager.frozenState)\n        } else {\n          throw new Error('state.unPause: no frozen state !')\n        }\n      }\n\n      return ('state.unPause: resolved')\n    }\n\n    flag = (flag !== null) ? flag : this.R.get.events.keydown\n\n    const stateKeys = this.stateKeys\n    for (let i = 0; i < stateKeys.length; i++) {\n      if (stateKeys[i] !== this.R.get.states_pause) {\n        // by default only one pause handling function per state\n        this.registerEventFunction(stateKeys[i], flag, pauseState)\n      } else {\n        this.registerEventFunction(stateKeys[i], flag, unPause)\n      }\n    }\n\n    if (addDefaultDesign) {\n      this.addDefaultPauseDesign()\n    }\n  }\n\n  /**\n   * Function that adds a basic pause design with background overlay and a large \"PAUSE\" text top center.\n   * Uses babylon Rectangle2D and text2d\n   */\n  addDefaultPauseDesign() {\n    if (BABYLON === null) {\n      return false\n    }\n\n    const awakePause = function (options = null) {\n      if (typeof this.taskObject === 'undefined') {\n        throw new Error('state.awakePause: taskObject is undefined')\n      }\n      const stateManager = this.stateManager\n\n      let pauseBackground2D = stateManager.get('pauseBackground2D')\n      const elements2D = stateManager.get('elements2D')\n      const canvas = elements2D.canvas\n\n      if (pauseBackground2D !== null) {\n        pauseBackground2D.opacity = 1\n      } else {\n        // draw a rect2d of canvas size with background opacity 0.5\n        // draw a large text2d \"PAUSE\" inside\n        const baseOptions = {\n          id: 'pauseBackground2D',\n          text: 'Pause',\n          x: 0,\n          y: 0,\n          width: canvas.width,\n          height: canvas.height,\n          fill: BABYLON.Canvas2D.GetSolidColorBrush(new BABYLON.Color4(0.3, 0.3, 0.3, 0.5)),\n          fontName: '60pt Verdana',\n        }\n\n        options = _.extend(baseOptions, options)\n\n        // var canvas = elements2D.canvas;\n\n        // create button and add to canvas\n        pauseBackground2D = new BABYLON.Rectangle2D({\n          parent: canvas,\n          id: options.id,\n          x: options.x,\n          y: options.y,\n          width: options.width,\n          height: options.height,\n          fill: options.fill,\n          roundRadius: 0,\n          children: [\n            new BABYLON.Text2D(options.text, {\n              fontName: options.fontName,\n              marginVAlignment: 'v: top',\n              marginHAlignment: 3,\n            }),\n          ],\n        })\n\n        stateManager.set('pauseBackground2D', pauseBackground2D) // TODO Make those string part of R.\n      }\n\n      return ('state.awakePause: resolved')\n    }\n\n    const endPause = function () {\n      if (typeof this.state === 'undefined') {\n        throw new Error('state.endPause: state is undefined')\n      }\n      const stateManager = this.stateManager\n      const pauseBackground2D = stateManager.get('pauseBackground2D')\n\n      if (pauseBackground2D !== null) {\n        pauseBackground2D.dispose()\n        stateManager.set('pauseBackground2D', null)\n      }\n\n      return ('state.endPause: resolved')\n    }\n    this.registerAwakeningFunction(this.R.get.states_pause, awakePause)\n    this.registerEndingFunction(this.R.get.states_pause, endPause)\n\n    return true\n  }\n\n  stateWasFrozen(stateKey = mandatory()) {\n    this.frozenState = stateKey\n\n    // when frezing a state - events are not processed by the next state\n    this.emptyEventHeap()\n    this.emptyTimeTriggerEvents()\n  }\n\n  stateWasUnfreezed(stateKey = mandatory()) {\n    if (this.frozenState !== stateKey) {\n      throw new Error('StateManager.stateWasUnfreezed: stateKey does not correspond to the frozenState')\n    }\n\n    this.frozenState = null\n  }\n\n  /* === Time event === */\n  addTimeTriggerEvent(event = mandatory('event')) {\n    if (event.constructor === EventData) {\n      if (event.happenedAt > this.timeInMs + 40) {\n        this._timeTriggerEvents.push(event)\n        debuglog('StateManager: Trigger event added to the time triggers.')\n      } else {\n        this.addEvent(event)\n        debugError('StateManager.addTimeTriggerEvent: trigger event is to close to current time (<40ms). Added directly to the heap.')\n      }\n    } else {\n      debugError('StateManager: Event is not of class EventData.')\n    }\n  }\n\n  /* === Event heap methods === */\n  addEvent(event = mandatory('event')) {\n    if (event.constructor === EventData) {\n      this._eventHeap.push(event)\n      debuglog('StateManager: Event added to the heap.')\n    } else {\n      debugError('StateManager: Event is not of class EventData.')\n    }\n  }\n\n  newEvent(flag = mandatory(), time = null, data = null, belongsTo = ['globalLog']) {\n    // check that the user did not use newEvent as addEvent\n    if (flag.constructor === EventData) {\n      debuglog('StateManager.newEvent: flag is an EventData object. Using addEvent().')\n      this.addEvent(flag)\n      return flag\n    }\n\n    // checks if the user gave a non array to belongsTo\n    if (belongsTo.constructor !== Array) {\n      if (belongsTo.constructor === String) {\n        belongsTo = [belongsTo]\n      } else {\n        throw new Error('stateManager.newEvent: belongs to need to be either a string or an array')\n      }\n    } else if (belongsTo.indexOf('globalLog') === -1) {\n        // add the missing globalLog to belongsTo\n      belongsTo.push('globalLog')\n    }\n\n    const eventOptions = {\n      belongsTo,\n      handledAt: null,\n      storedAt: null,\n    }\n    if (data !== null) {\n      eventOptions.data = data\n    }\n\n    /* --- Not a time triggered event --- */\n    if (time === null) {\n      debuglog('stateManager.newEvent: time is null, using addEvent() with this.timeInMs.')\n      const event = new EventData(flag, this.timeInMs, eventOptions)\n      this.addEvent(event)\n      return event\n    }\n\n    /* --- Time triggered event --- */\n    // check if time is a duration or a timestamp - TODO set max duration somewhere\n    if (time < this.R.get.values_timestampThreshold) {\n      // time is a duration\n      time += this.timeInMs\n    }\n\n    const event = new EventData(flag, time, eventOptions)\n    this.addTimeTriggerEvent(event)\n    return event\n  }\n\n  removeFirstEvent() {\n    this._eventHeap.splice(0, 1)\n  }\n\n  removeEvent(event) {\n    this._eventHeap = _.without(this._eventHeap, event)\n  }\n\n  getFirstEventAndRemoveFromHeap() {\n    const event = this.firstEvent\n    this.removeFirstEvent()\n\n    return (event)\n  }\n\n  emptyEventHeap() {\n    this._eventHeap = []\n  }\n\n  emptyTimeTriggerEvents() {\n    this._timeTriggerEvents = []\n  }\n\n  getAllEvents() {\n    return (this._eventHeap.concat(this._timeTriggerEvents))\n  }\n\n  /**\n   * Called by the state once it has finished handling an event. This function calls the storeEvent function.\n   * @param  {event} event Handled event\n   */\n  stateHasFinishedHandlingEvent(event) {\n    event.data.handledAt = this.timeInMs\n    event.handled = true\n\n    debuglog('StateManager.stateHasFinishedHandlingEvent: event was handled.')\n    debuglog(event)\n\n    if (this._dataManager.constructor === DataManager) {\n      this.storeEvent(event)\n    } else {\n      debugWarn('StateManager.stateHasFinishedHandlingEvent: dataManager is not set, not storing event.')\n    }\n  }\n\n  freezeEventHeap() {\n    this.eventHeapIsFrozen = true\n    this.frozenEventHeap = this._eventHeap\n    // freeze the heap for certain event that need to be processed afterwards in series\n    // TODO elements should not be deleted... maybe have firstNonFrozenEvent(); and a property of events if they are frozen or not\n  }\n\n  unfreezeEventHeap(storeFrozenEvents = true) {\n    this.eventHeapIsFrozen = false\n\n    if (storeFrozenEvents) {\n      /* Reset event heap and store all frozen events in the globalLog */\n      // const tempEvents = this._eventHeap TODO what was that for again ?\n      this.emptyEventHeap()\n    } else {\n      // unfreeze events so they can be processed\n    }\n  }\n\n  /* === State event functions === */\n\n  /**\n   * Registers a new event function for the specified event flag in the specified state. This function will be called in the handleEvent\n   * function of the state if it is the active state. The function should return a Promise.\n   * @param  {string} stateKey         key of state in which to add the new function\n   * @param  {string} eventFlag        event for which the function should be called\n   * @param  {function} handlingFunction Function that should return a Promise.\n   */\n  registerEventFunction(stateKey, eventFlag, ...handlingFunctions) {\n    mustBeDefined(stateKey, eventFlag, ...handlingFunctions)\n    mustHaveConstructor(Function, ...handlingFunctions)\n\n    if (_.has(this.states, stateKey)) {\n      this.states[stateKey].registerEventFunctions(eventFlag, true, ...handlingFunctions) // TODO Handle overwrite better ?\n    } else {\n      throw new Error(`StateManager: Invalid state key '${stateKey}'. Create the state before adding event handling functions.`)\n    }\n  }\n\n  /**\n   * Adds a function to the awakening function array in the state object. Those function must return a promise.\n   * @param  {[type]} stateKey         [description]\n   * @param  {[type]} handlingFunction [description]\n   * @return {[type]}                  [description]\n   */\n  registerAwakeningFunction(stateKey = mandatory(), handlingFunction = mandatory(), overwrite = false) {\n    if (_.has(this.states, stateKey)) {\n      this.states[stateKey].registerCycleFunctions('awakening', overwrite, handlingFunction)\n    } else {\n      throw new Error(`StateManager: Invalid state key '${stateKey}'. Create the state before adding awakening handling functions.`)\n    }\n  }\n\n  registerEndingFunction(stateKey = mandatory(), handlingFunction = mandatory(), overwrite = false) {\n    if (_.has(this.states, stateKey)) {\n      this.states[stateKey].registerCycleFunctions('ending', overwrite, handlingFunction)\n    } else {\n      throw new Error(`StateManager: Invalid state key '${stateKey}'. Create the state before adding awakening handling functions.`)\n    }\n  }\n\n  registerUpdateFunction(stateKey = mandatory(), handlingFunction = mandatory(), overwrite = false) {\n    if (_.has(this.states, stateKey)) {\n      this.states[stateKey].registerCycleFunctions('udpate', overwrite, handlingFunction)\n      debuglog(`StateManager: handling function added to awakeningFunctions array for state '${stateKey}'`)\n    } else {\n      throw new Error(`StateManager: Invalid state key '${stateKey}'. Create the state before adding awakening handling functions.`)\n    }\n  }\n\n  /* === Globals === */\n  /**\n   * Stores a function into the globalFunctions array of the stateManager. Those function must return a promise.\n   * Storing function in the stateManager should be reserved to functions that are to be reused across states, and in general access global variables.\n   * @param  {string} name            function's name\n   * @param  {function} promiseFunction function should return a promise\n   */\n  registerGlobalFunction(func = mandatory(), name = null) {\n    if (func.constructor !== Function) {\n      throw new Error('StateManager.registerGlobalFunction: func is not a function')\n    }\n    // TODO checks that it works\n    // var promiseFunction = looksLikeAPromise(func) ? func : Promise.method(func); Do no promisify here - give user the choice\n    if (name === null) { name = func.name }\n\n    this.globalFunctions[name] = func\n  }\n\n  /**\n   * Shorthand for registerGlobalFunction\n   * @param  {string} name            function's name\n   * @param  {function} promiseFunction\n   */\n  register(...functions) {\n    for (let i = 0; i < functions.length; i++) {\n      this.registerGlobalFunction(functions[i])\n    }\n  }\n\n  // TODO get rid of this function use only call\n  callGlobalFunction(name, ...args) {\n    this.call(name, ...args)\n  }\n\n  /**\n   * Shorthand for callGlobalFunction\n   * @param  {string} name    Function's name\n   * @param  {...object} args Optional arguments iterable\n   * @return {promise}\n   */\n  call(name, ...args) {\n    mustBeDefined(name)\n\n    if (typeof name === 'undefined') {\n      throw new Error('StateManager.call: name of the function needs to be defined.')\n    }\n    if (_.has(this.globalFunctions, name)) {\n      return (this.globalFunctions[name].bind(this.context)(...args))\n    }\n    debugWarn(`StateManager.call: globals do not contain function '${name}'`)\n    return undefined\n  }\n\n  promise(name, ...args) {\n    mustBeDefined(name)\n\n    if (typeof name === 'undefined') {\n      throw new Error('StateManager.promiseGlobalFunction: name is undefined.')\n    }\n\n    if (_.has(this.globalFunctions, name)) {\n      return (Promise.method(this.globalFunctions[name]).bind(this.context)(...args))\n    }\n\n    debugWarn(`StateManager.promiseGlobalFunction: globals do not contain function '${name}'`)\n    return undefined\n  }\n\n  /**\n   * Recurse on a given registered function, returns a promise resolving to the concatenated results.\n   * @param  {string} name    Name of the function already registered in the stateManager\n   * @param  {numeric} amount The amount of time we should recurse\n   * @param  {Object} options Optional, object to specify as options of the registered function\n   * @param  {Array}  results Optional, where to store the results.\n   * @return {Promise}        Promise resolving to the filed results array.\n   */\n  recurseOnGlobalFunction(name = mandatory(), amount = mandatory(), args = [], results = []) {\n    if (!_.has(this.globalFunctions, name)) {\n      throw new Error(`StateManager.recurseOnGlobalFunction: globals do not contain function '${name}'`)\n    }\n\n    // Base case - just return the promisified result\n    if (amount === 0) {\n      return new Promise((resolve) => {\n        resolve(results)\n      })\n    }\n\n\n    const next = this.promise(name, ...args).then((r) => {\n      results = results.concat(r)\n      return (this.recurseOnGlobalFunction(name, amount - 1, args, results))\n    })\n\n    return next\n  }\n\n  /**\n   * Shorthand for recurseOnGlobalFunction.\n   * @param  {string} name    Name of the function already registered in the stateManager\n   * @param  {numeric} amount The amount of time we should recurse\n   * @param  {args} args Optional, array of arguments to pass to the promise\n   * @param  {Array}  results Optional, where to store the results.\n   * @return {Promise}        Promise resolving to the filed results array.\n   */\n  recurse(name = mandatory(), amount = mandatory(), args = [], results = []) {\n    this.recurseOnGlobalFunction(name, amount, args, results)\n  }\n\n  /**\n   * Return a stored global or null if it does not exist.\n   * @param  {string} name String name of the variable\n   * @return {?*}\n   */\n  getGlobal(name = mandatory()) {\n    if (_.has(this.globals, name)) {\n      return (this.globals[name])\n    }\n    debugWarn(`StateManager: globals do not contain variable '${name}'`)\n    return (null)\n  }\n\n  get(name = mandatory()) {\n    return (this.getGlobal(name))\n  }\n\n  /**\n   * Stores a global variable. Beware if storing objects (stored by reference, any modification outside of the statemanager will affect the stored variable).\n   * Maybe a _.cloneDeep would be better... lets think about it for a while.\n   * @param {string} name  Name of the variable\n   * @param {*} value Variable\n   */\n  setGlobal(name = mandatory(), value = mandatory()) {\n    this.globals[name] = value\n    debuglog(`StateManager: global '${name}' set to '${value}'`)\n  }\n\n  set(name = mandatory(), value = mandatory()) {\n    this.setGlobal(name, value)\n  }\n\n  getStateObject(key) {\n    if (_.has(this.states, key)) {\n      return (this.states[key])\n    }\n    throw new Error('StateManager: Invalid state key.')\n  }\n\n  /* ======== Getters and Setters ======== */\n\n  // TODO Redo documentation of those functions\n  // static get context() {}\n  // static get currentStateKey() {}\n  // static get currentState() {}\n  // static get eventHeap() {}\n  // static get firstEvent() {}\n  // static get time() {}\n  // static get timeInSec() {}\n  // static get timeInMs() {}\n\n  /**\n   * Returns a summary object containing the taskObject, dataManager, ressourceManager\n   * as well as current scene, stateManager, and state.\n   * Used as a a context accros the library when calling state functions (with .bind(context))\n   */\n  get context() {\n    if (this._taskObject) {\n      return (this._taskObject.getContext(this))\n    }\n    return ({\n      taskObject: null,\n      dataManager: this._dataManager,\n      scene: this._parent, // TODO Force the ._parent to be the .scene ?\n      stateManager: this,\n      state: this.currentState,\n      R: this.R,\n    })\n  }\n\n  get stateKeys() {\n    return (Object.keys(this.states))\n  }\n\n  get currentStateKey() {\n    return (this._currentStateKey)\n  }\n\n  set currentStateKey(key) {\n    if (_.has(this.states, key)) {\n      this.goToState(key)\n    } else {\n      throw new Error('StateManager: Invalid state key.')\n    }\n  }\n\n  get currentState() {\n    return this.states[this.currentStateKey]\n  }\n\n  set currentState(state) {\n    if (typeof state.key !== 'undefined') {\n      this.currentStateKey = state.key\n    } else {\n      throw new Error('StateManager: Invalid state, it has no state key defined.')\n    }\n  }\n\n  get eventHeap() {\n    return (this._eventHeap)\n  }\n\n  set eventHeap(value) { // eslint-disable-line\n    throw new Error('StateManager: eventHeap is readonly. Add events through the class methods.')\n  }\n\n  get firstEvent() {\n    if (this._eventHeap.length) {\n      return (this._eventHeap[0])\n    }\n    return undefined\n  }\n\n  set firstEvent(value) {\n    // TODO not implemented -- maybe somekind of bruteforce to have an important input be treated first\n    throw new Error('StateManager: firstEvent is readonly.')\n  }\n\n  /* === Time functions === */\n\n  get time() {\n    return (this.timeInMs)\n  }\n\n  get timeInSec() {\n    return (new Date().getTime() / 1000)\n  }\n\n  get timeInMs() {\n    return (new Date().getTime())\n  }\n\n}\n\n\n\n// WEBPACK FOOTER //\n// ./src/framework/StateManager.js","const DEBUG_MODE_ON = true\n\nexport { DEBUG_MODE_ON }\n\n\n\n// WEBPACK FOOTER //\n// ./src/config.js","module.exports = __WEBPACK_EXTERNAL_MODULE_8__;\n\n\n//////////////////\n// WEBPACK FOOTER\n// external \"experiment-babylon-js\"\n// module id = 8\n// module chunks = 0","/**\n * Boiler Plate For Cognitive Tasks JS\n *\n *\n * author: Albert Buchard 2016\n *\n * REQUIRE ECMA2016 / JQUERY / MATHJS / BABYLON\n */\n\n/* =============== Set-up =============== */\nimport _ from 'lodash'\nimport { BABYLON } from 'experiment-babylon-js'\nimport { ParamBox, SmartModal } from 'experiment-boxes'\n\nimport DataManager from './DataManager'\nimport RessourceManager from './RessourceManager'\nimport EventData from './EventData'\nimport StateManager from './StateManager'\nimport State from './State'\n\nimport {\n  Array,\n  String,\n  Deferred,\n  mandatory,\n  debuglog,\n  debugWarn,\n} from './utilities'\nimport { DEBUG_MODE_ON } from '../config'\n\n\nif (typeof window !== 'undefined') {\n  /* === Get the absolute path of the library === */\n  const scripts = document.getElementsByTagName('script')\n  if (scripts.length) {\n    const assetsFolderFullpath = scripts[scripts.length - 1].src\n    const delimiterIndices = assetsFolderFullpath.indicesOf('/')\n    window.assetsFolderFullpath = assetsFolderFullpath.substr(0, delimiterIndices[delimiterIndices.length - 2])\n  } else {\n    window.assetsFolderFullpath = './'\n  }\n}\n\n/** Class handling graphic engine interface and lifecycle of the task */\nexport default class TaskObject {\n  /**\n   * class constructor : initialize the task\n   * @param  {Object} target element where the task will be contained\n   * @return {TaskObject}\n   */\n  constructor(target = mandatory(),\n    assetsFolder = null,\n    loadingSceneGenerator = null,\n    engine = 'babylon') {\n    if (typeof window !== 'undefined') { // TODO should it fail more gracefully ?\n      return { error: 'Wrong environment. ExperimentJS only works in the browser.' }\n    }\n    /* --- Constants --- */\n    // this.constants = {};\n\n    /* --- Store canvas information --- */\n    this._target = target\n    this.canvas = target.get(0)\n\n    /* --- Setup engine --- */\n    if (engine === 'babylon') {\n      // Start BabylonJS engine\n      this.engine = new BABYLON.Engine(this.canvas, false, null, false)\n    } else {\n      throw new Error('TaskObject.constructor: engine not supported.')\n    }\n\n    /* --- Size values --- */\n    this.height = window.innerHeight\n    this.width = window.innerWidth\n    this.babylonCanvasHeight = this.canvas.height\n    this.babylonCanvasWidth = this.canvas.width\n\n    /**\n     * Task DataManager\n     * @type {DataManager}\n     */\n    this.dataManager = new DataManager(this)\n\n    /* --- Add global mouse and keyboard event tables --- */\n    const globalLogFields = ['id', 'flag', 'happenedAt', 'data']\n\n    // globalLogs is the default data table of the dataManager,\n    // adding specific data table for mouse and key events\n    this.dataManager.addTable('keyEvents', globalLogFields)\n    this.dataManager.addTable('mouseEvents', globalLogFields)\n\n    /* --- Add task status table --- */\n    const taskStatusFields = ['level', 'happenedAt']\n    this.dataManager.addTable('taskStatus', taskStatusFields)\n\n    /* --- Add raised flags --- */\n    const statusFlagsFields = ['flag', 'happenedAt']\n    this.dataManager.addTable('statusFlags', statusFlagsFields)\n\n    /* --- Assets --- */\n    /**\n     * Path to assets folder\n     * @type {String}\n     */\n    if (assetsFolder) {\n      this.ASSETS_FOLDER = assetsFolder\n    } else {\n      this.ASSETS_FOLDER = window.assetsFolderFullpath\n    }\n\n    this.ASSETS_FLARE_PATH = `${this.ASSETS_FOLDER}/textures/flare/flare.png`\n\n    /**\n     * Object to store global task assets after loading or creation\n     * @type {Object}\n     */\n    // this.assets = {};\n\n    this.R = new RessourceManager()\n    this.R.add({\n      states: {\n        active: 'active',\n        idle: 'idle',\n        pause: 'pause',\n      },\n      folders: {\n        assetsFolder: assetsFolder || window.assetsFolderFullpath,\n      },\n    })\n\n\n    /* --- Set-up events --- */\n    this.flags = {}\n    this.keyState = [] // holds state of keys being stroked indexed by event.keyCode\n    this.shouldShowDebug = typeof DEBUG_MODE_ON !== 'undefined' ? DEBUG_MODE_ON : false\n    this.setupGlobalEvents()\n\n    /* --- Modals --- */\n    this._currentModal = this.MODAL_INTRODUCTION\n\n    /* --- Task parameters --- */\n    this.parameters = {}\n\n    /* --- Task level variables --- */\n    this.variables = {}\n    this.variables.shouldSeeInformation = true\n\n    /* --- Scenes --- */\n    this.scenes = {}\n    this.sceneGenerators = {}\n    this.sceneGenerators.functions = {}\n    this.sceneGenerators.functionsOptions = {}\n\n    this._currentSceneKey = ''\n\n    /* --- ParamBox setup --- */\n    this._paramBox = null\n\n    /* if ParamBox library is loaded - create one */\n    if (typeof ParamBox === 'function') {\n      this._paramBox = new ParamBox()\n    }\n  }\n\n  /* ======== Scene generators ======== */\n  /*\n  newScene(key = mandatory()) {\n    // TODO create a child object holding scene keys, scene generators and babylon scenes\n  }\n\n  registerSceneGenerators(...sceneGeneratorObjects) {\n    // TODO\n  }\n  */\n\n  registerSceneGenerator(sceneGenerator = mandatory('sceneGenerator'), options = {}, loading = false, promise = false, key = null) {\n    // option base\n    options = _.clone(options)\n\n    if ((key === null) && (sceneGenerator.name !== '')) {\n      key = sceneGenerator.name\n    } else {\n      key = `scene${Object.keys(this.sceneGenerators.functions).length}`\n    }\n\n    if (loading) {\n      this.sceneGenerators.loading = sceneGenerator\n      this.sceneGenerators.loadingOptions = options\n    } else {\n      this.sceneGenerators.functions[key] = sceneGenerator\n      this.sceneGenerators.functionsOptions[key] = options\n    }\n  }\n\n  registerLoadingFunction(loadingSceneGenerator = mandatory('loadingSceneGenerator'), options = {}, promise = false) {\n    /* --- Force sceneKey to be loading --- */\n    options.sceneKey = 'loading'\n\n    this.registerSceneGenerator(\n      loadingSceneGenerator,\n      options,\n      true,\n      promise,\n    )\n  }\n\n  callSceneGenerator(key = mandatory()) {\n    const sceneOptions = this.sceneGenerators.functionsOptions[key]\n    const generator = this.sceneGenerators.functions[key]\n\n    const promise = Promise.method(generator.bind(this.context))(sceneOptions)\n      .then((scene) => {\n        if (typeof scene.sceneKey === 'undefined') {\n          scene.sceneKey = key\n        }\n\n        this.scenes[scene.sceneKey] = scene\n      })\n\n    return promise\n  }\n\n  generateScenes() {\n    const functionKeys = Object.keys(this.sceneGenerators.functions)\n    const promises = []\n    for (let i = 0; i < functionKeys.length; i++) {\n      promises.push(this.callSceneGenerator(functionKeys[i]))\n    }\n\n    return Promise.all(promises)\n  }\n\n  cloneAssetsIntoScene(assets = mandatory(), scene = mandatory()) {\n    if (assets.constructor !== Array) {\n      assets = [assets]\n    }\n\n    const assetsArray = []\n    for (let i = 0; i < assets.length; i++) {\n      const clone = assets[i].clone()\n      clone._scene = scene\n\n      if (assets[i].constructor === BABYLON.Mesh) {\n        if (clone.material) {\n          clone.material = clone.material.clone()\n          clone.material._scene = scene\n          if (clone.material.subMaterials) {\n            for (let j = 0; j < clone.material.subMaterials.length; j++) {\n              clone.material.subMaterials[j] = clone.material.subMaterials[j].clone()\n              clone.material.subMaterials[j]._scene = scene\n            }\n          }\n        }\n        scene.addMesh(clone)\n      }\n\n      assetsArray.push(clone)\n    }\n\n    return assetsArray\n  }\n\n  loadAssets(assetObject = mandatory(), scene = mandatory(), assetFolder = '') {\n    if (assetObject.constructor !== Object) {\n      throw new Error('TaskObject.loadAssets: assetObject is not an Object')\n    }\n\n    if ((assetFolder === '') && (typeof this.ASSETS_FOLDER !== 'undefined')) {\n      assetFolder = this.ASSETS_FOLDER\n    }\n\n    const textureFormats = ['png', 'bmp', 'jpg', 'tiff']\n\n    const assetManager = new BABYLON.AssetsManager(scene)\n    const R = this.R\n\n    const names = Object.keys(assetObject)\n    let field\n    let type\n    let path\n    for (let i = 0; i < names.length; i++) {\n      field = assetObject[names[i]]\n\n      if (field.constructor === String) {\n        path = this.ASSETS_FOLDER + field\n\n        if (textureFormats.indexOf(R.getFormat(path)) !== -1) {\n          type = 'texture'\n        } else {\n          console.warn('TaskObject.loadAssets: asset invalid or not implement with shorthand function')\n          type = 'invalid'\n        }\n      } else if ((field.constructor === Object) && (Object.keys(field).includes(['path', 'type']))) {\n        path = this.ASSETS_FOLDER + field.path\n        type = field.type\n      } else {\n        console.warn('TaskObject.loadAssets: asset invalid or not implement with shorthand function')\n        type = 'invalid'\n      }\n\n      if (type === 'texture') {\n        const assetManagerTask = assetManager.addTextureTask(`${names[i]}Task`, path)\n        assetManagerTask.onSuccess = function (task) {\n          R.add({\n            textures: {\n              [this.textureName]: task.texture,\n            },\n          })\n        }.bind({\n          textureName: names[i],\n        })\n      }\n    }\n\n    /* --- Create a Deferred promise that will resolve after loading is complete --- */\n    const loadDeferred = new Deferred()\n\n    assetManager.load()\n    assetManager.onFinish = function onFinish(tasks) {\n      debuglog('TaskObject.loadAssets: tasks completed', tasks)\n      loadDeferred.resolve(scene)\n    }\n\n    return loadDeferred.promise\n  }\n\n  cloneAssetIntoScene(asset = mandatory(), scene = mandatory()) {\n    // TODO: Merge with cloneAssetsIntoScene\n    if (asset.constructor === Array) {\n      return this.cloneAssetsIntoScene(asset, scene)\n    }\n\n    const clone = asset.clone()\n    clone._scene = scene\n\n    if (asset.constructor === BABYLON.Mesh) {\n      if (clone.material) {\n        clone.material = clone.material.clone()\n        clone.material._scene = scene\n        if (clone.material.subMaterials) {\n          for (let i = 0; i < clone.material.subMaterials.length; i++) {\n            clone.material.subMaterials[i] = clone.material.subMaterials[i].clone()\n            clone.material.subMaterials[i]._scene = scene\n          }\n        }\n      }\n      scene.addMesh(clone)\n    }\n\n    return clone\n  }\n\n  /* ======== Class Methods ======== */\n  /* ======== Lifecycle Methods ======== */\n  /**\n   * Creates the game engine object and loads the scenes.\n   */\n  startTask() {\n    if ((typeof window === 'undefined') || (typeof process !== 'undefined')) {\n      return Promise.resolve()\n    }\n\n    window.addEventListener('resize', () => {\n      this.engine.resize()\n    })\n\n    const deferred = new Deferred()\n    /* --- Create a loading scene in order to load assets --- */\n    const loadingOptions = this.sceneGenerators.loadingOptions\n    const loadingScene = (this.sceneGenerators.loading.bind(this.context))(loadingOptions)\n    loadingScene.loadingPromise.then(() => {\n        /* --- Store the scene in the TaskObject --- */\n      this.scenes.loading = loadingScene\n\n        /* --- Set the currentScene to the loading scene that has finished loading --- */\n      this.currentScene = loadingScene.sceneKey\n\n      if ((typeof loadingScene.loadingPromise !== 'undefined') && (loadingScene.loadingPromise.constructor === Promise)) {\n        return loadingScene.loadingPromise\n      }\n      return Promise.resolve()\n    })\n      .then(() => {\n        /* --- Set the loaded flag --- */\n        this.dataManager.addRows('statusFlags', {\n          flag: this.R.get.flags_hasLoaded,\n          happenedAt: this.timeInMs,\n        })\n\n        /* --- Start the render loop --- */\n        this.engine.runRenderLoop(() => {\n          this.scenes[this.currentScene].render()\n        })\n\n        /* --- Now that assets are loaded we generate the task scenes --- */\n        return this.generateScenes()\n      })\n      .then((message) => {\n        debuglog(message)\n        deferred.resolve('TaskObject.startTask: loaded and scene generated.')\n      })\n\n    return deferred.promise\n  }\n\n  /* ======== Babylon Setup ======== */\n  /* === Global events === */\n  setupGlobalEvents() {\n    // TODO: Put every flag in the ressourceManager\n    /* --- Lifecycle flags --- */\n    const R = this.R\n    R.add({\n      flags: { // TODO think about how to order those strings so not mess everything up and keep it understandable\n        hasLoaded: 'hasLoaded',\n        sceneStarts: 'scene_starts',\n        sceneEnds: 'scene_ends',\n      },\n      events: {\n        mouseMove: 'mouse_move',\n        click: 'mouse_click',\n        pick: 'mouse_pick',\n        keydown: 'key_down',\n        keyup: 'key_up',\n        resize: 'resize',\n        pause: 'pause',\n        wasHandled: 'was_handled',\n        beingHandled: 'being_handled',\n      },\n    })\n\n    /* Add keyboard listener */\n    window.addEventListener('keydown', (evt) => {\n      debuglog('TaskObject: Keydown event.')\n      debuglog(evt)\n\n      // call taskObject keyfunction handler\n      this.keyfunction(evt)\n\n      // store keydown event\n      const eventData = new EventData(\n        R.get.events_keydown,\n        this.timeInMs, {\n          belongsTo: ['globalLog', 'keyEvents'],\n          handledAt: null,\n          storedAt: null,\n          keyCode: evt.keyCode,\n        },\n      )\n\n      // TODO add event to current scene should be a method\n      if (typeof this.currentSceneObject !== 'undefined') {\n        if (typeof this.currentSceneObject.stateManager !== 'undefined') {\n          this.currentSceneObject.stateManager.addEvent(eventData)\n        }\n      }\n    })\n\n    // update the keystates when keyup but do not store event\n    // TODO think if usefull to store keyup\n    window.addEventListener('keyup', (evt) => {\n      this.keyfunction(evt)\n    })\n\n    /* window.addEventListener(\"mousemove\", function(evt) {\n      debuglog(\"TaskObject: mousemove event.\");\n      debuglog(evt);\n\n      var eventData = new EventData(thisObject.FLAG_EVENTS_INPUT_MOUSEMOVE, thisObject.timeInMs, {\n        belongsTo: [\"globalLog\", \"mouseEvents\"],\n        handledAt: null,\n        storedAt: null,\n        clientX: evt.clientX,\n        clientY: evt.clientY\n      }); //make an static EventData from dom event?\n\n      if (typeof thisObject.currentSceneObject !== \"undefined\") {\n        if (typeof thisObject.currentSceneObject.stateManager !== \"undefined\") {\n          thisObject.currentSceneObject.stateManager.addEvent(eventData);\n        }\n      }\n\n    });*/\n    window.addEventListener('mousedown', (evt) => {\n      debuglog('TaskObject: mousedown event.')\n      debuglog(evt)\n\n      const eventData = new EventData(\n        R.get.events_click,\n        new Date().getTime(), {\n          belongsTo: ['globalLog', 'mouseEvents'],\n          handledAt: null,\n          storedAt: null,\n          clientX: evt.clientX,\n          clientY: evt.clientY,\n          engineX: evt.clientX *\n            (this.renderSize.width / window.innerWidth),\n          engineY: (window.innerHeight - evt.clientY) *\n            (this.renderSize.height / window.innerHeight),\n        },\n      )\n\n      // make an static EventData from dom event?\n      if (typeof this.currentSceneObject !== 'undefined') {\n        if (typeof this.currentSceneObject.stateManager !== 'undefined') {\n          this.currentSceneObject.stateManager.addEvent(eventData)\n        }\n      }\n    })\n\n\n    window.addEventListener('resize', (evt) => {\n      debuglog('TaskObject: resize event.')\n      debuglog(evt)\n\n      const eventData = new EventData(\n        R.get.events_resize,\n        this.timeInMs, {\n          belongsTo: ['globalLog'],\n          handledAt: null,\n          storedAt: null,\n          outerHeight: evt.target.outerHeight,\n          outerWidth: evt.target.outerWidth,\n        },\n      )\n\n      // if a current scene exists pass it down the stateManager\n      // and look for a resize handler updateContentFrame\n      if (typeof this.currentSceneObject !== 'undefined') {\n        try {\n          this.addEventToCurrentScene(eventData)\n        } catch (e) {\n          console.error(e)\n        } finally {\n          if (typeof this.currentSceneObject.updateContentFrame !== 'undefined') {\n            this.currentSceneObject.updateContentFrame()\n          }\n        }\n      }\n    })\n  }\n\n  keyfunction(e) {\n    const dCode = 68\n    const shiftCode = 16\n    const altCode = 18 // TODO check if it is the same on all platforms\n\n    // check if shift + P hotkeys were stroke and toggle visibility if so\n    this.keyState[e.keyCode] = e.type === 'keydown'\n\n    // hide and show debug layer\n    if (this.keyState[shiftCode] && this.keyState[altCode] && this.keyState[dCode]) {\n      // 16 == Shift - 68 == D -- 18 Alt\n      // make sure to reset D value in case keyup event is ignored (keep shift true for rapid toggle)\n      this.keyState[dCode] = false\n      this.keyState[altCode] = false\n\n      // toggle debug visibility\n      this.toggleDebugLayer()\n\n      // prevent default action if any\n      e.preventDefault()\n    }\n  }\n\n  addStateManager(scene = mandatory('scene')) {\n    scene.stateManager = new StateManager(scene, this.dataManager)\n  }\n\n  // TODO create a familly of hooks that call functions forthe curent scene, like this one\n  addEventToCurrentScene(eventData = mandatory()) {\n    // checks that there is a current scene\n    if (typeof this.currentSceneObject !== 'undefined') {\n      // checks that the scene has a stateManager\n      if (typeof this.currentSceneObject.stateManager !== 'undefined') {\n        // adds the event\n        this.currentSceneObject.stateManager.addEvent(eventData)\n      } else {\n        throw new Error('TaskObject.addEventToCurrentScene: No stateManager in currentSceneObject')\n      }\n    } else {\n      // else return an error message\n      throw new Error('TaskObject.addEventToCurrentScene: No current scene object')\n    }\n  }\n\n  create2DScene(options = mandatory()) {\n    /*\n      Babylon Scene objects are enriched in experiment-js with:\n        * sceneKey\n        * parentTaskObject\n        * stateManager\n        * dataManager\n        * initialCanvas\n        * initialCamera\n        * updateContentFrame\n      Importantly - The registerBeforeRender() lifecycle function calls the update function of the stateManager\n     */\n\n    const optionsBase = {\n      sceneKey: `scene${Math.random() * 100000}`,\n      canvasBackground: new BABYLON.Color4(0, 0, 0, 1),\n      backgroundRoundRadius: 50,\n      clearColor: new BABYLON.Color4(0, 0, 0, 1),\n      canvasPercentWidth: 0.8,\n      canvasPercentHeight: 1,\n    }\n\n    options = _.extend(optionsBase, options)\n\n    const scene = new BABYLON.Scene(this.engine)\n\n    /**\n     * Holds the scenekey inside the scene object.\n     * @type {string}\n     */\n    scene.sceneKey = options.sceneKey\n\n    /**\n     * Reference to the parent taskObject\n     * @type {TaskObject}\n     */\n    scene.parentTaskObject = this\n\n    /* --- Add a stateManager --- */\n    this.addStateManager(scene)\n\n    /* --- Set background --- */\n    scene.clearColor = options.clearColor\n\n    const camera = new BABYLON.ArcRotateCamera('Camera', 0, Math.PI / 2, 12, BABYLON.Vector3.Zero(), scene)\n\n    const canvas = new BABYLON.ScreenSpaceCanvas2D(scene, {\n      id: 'ScreenCanvas',\n      backgroundFill: BABYLON.Canvas2D.GetSolidColorBrush(options.canvasBackground),\n      backgroundRoundRadius: options.backgroundRoundRadius,\n      fill: BABYLON.Canvas2D.GetSolidColorBrush(options.canvasBackground),\n      x: (this.renderSize.width / 2) - ((this.renderSize.width * options.canvasPercentWidth) / 2),\n      y: (this.renderSize.height / 2) - ((this.renderSize.height * options.canvasPercentHeight) / 2),\n      size: new BABYLON.Size(this.renderSize.width * options.canvasPercentWidth, this.renderSize.height * options.canvasPercentHeight),\n      zOrder: 1,\n      // cachingStrategy: BABYLON.Canvas2D.CACHESTRATEGY_CANVAS\n    })\n\n    /* Set the added canvas and camera to known fields in the scene*/\n    scene.initialCanvas = canvas\n    scene.initialCamera = camera\n\n    /* ======= Debug mode ======= */\n    if ((typeof DEBUG_MODE_ON !== 'undefined') && (DEBUG_MODE_ON === true)) {\n      canvas.createCanvasProfileInfoCanvas()\n    }\n\n    /* ======== Scene Lifecycle ======== */\n\n    /* --- Resize handler --- */\n    const updateContentFrame = function () {\n      this.initialCanvas.x = (this.parentTaskObject.renderSize.width / 2) - (this.initialCanvas.size.width / 2)\n      this.initialCanvas.y = (this.parentTaskObject.renderSize.height / 2) - (this.initialCanvas.size.height / 2)\n    }\n\n    scene.updateContentFrame = updateContentFrame\n\n    /* Scene update */\n    scene.registerBeforeRender(() => {\n      scene.stateManager.update()\n    })\n\n    return (scene)\n  }\n\n  /* ======= Context ======= */\n  getContext(object) {\n    const scene = (typeof this.currentSceneObject !== 'undefined') ? this.currentSceneObject : null\n    const stateManager = ((scene !== null) && (typeof scene.stateManager !== 'undefined')) ? scene.stateManager : null\n    const state = ((stateManager !== null) && (typeof stateManager.currentState !== 'undefined')) ? this.currentSceneObject.stateManager.currentState : null\n\n    const baseContext = {\n      taskObject: this,\n      dataManager: (typeof this.dataManager !== 'undefined') ? this.dataManager : null,\n      scene,\n      stateManager,\n      state,\n      R: this.R,\n    }\n\n    if (typeof object === 'undefined') {\n      return (baseContext)\n    }\n    let extendWith = {}\n    switch (object.constructor) {\n      case BABYLON.Scene:\n        extendWith = {\n          scene: object,\n          stateManager: object.stateManager,\n          state: object.stateManager.currentState,\n        }\n        break\n      case StateManager:\n        extendWith = {\n          scene: object._parent,\n          stateManager: object,\n          state: object.currentState,\n        }\n        break\n      case State:\n        extendWith = {\n          scene: object._parent,\n          stateManager: object._stateManager,\n          state: object,\n        }\n        break\n      default:\n        debugWarn('TaskObject.getContext: object is not of valid class. Returning taskObject context.')\n        return (baseContext)\n    }\n\n    return (_.extend(baseContext, extendWith))\n  }\n\n  get context() {\n    return this.getContext()\n  }\n\n  /* =============== Getters and Setters =============== */\n  /* ======== Property definitions for JSDOC ======== */\n  /**\n   * Key string of the current scene - should not be null but an empty string on startup\n   * @return {string} sceneKey in the scenes object\n   */\n  static get currentScene() { /**/ }\n\n  /**\n   * The current babylon scene object\n   * @return {BABYLON.Scene}\n   */\n  static get currentSceneObject() { /**/ }\n\n  /**\n   * ParamBox object linked to the task object.\n   * @return {ParamBox}\n   */\n  static get paramBox() { /**/ }\n\n  static get renderSize() { /**/ }\n\n  /* ======== Getter/Setter definitions ======== */\n  get currentScene() {\n    return this._currentSceneKey\n  }\n\n  set currentScene(sceneKey) {\n    if (Object.keys(this.scenes).indexOf(sceneKey) !== -1) {\n      this.scenes[sceneKey].stateManager.goToState(this.R.get.states_active)\n\n      /* ======= Debug mode ======= */\n      if ((typeof DEBUG_MODE_ON !== 'undefined') && (DEBUG_MODE_ON === true) && (this.shouldShowDebug)) {\n        this.scenes[sceneKey].debugLayer.show()\n\n        if (typeof this.scenes[sceneKey].initialCanvas !== 'undefined') {\n          this.scenes[sceneKey].initialCanvas.createCanvasProfileInfoCanvas()\n        }\n      }\n\n      if (this._currentSceneKey) {\n        this.scenes[this._currentSceneKey].stateManager.goToState(this.R.get.states_idle)\n\n        /* ======= Debug mode ======= */\n        if ((typeof DEBUG_MODE_ON !== 'undefined') && (DEBUG_MODE_ON === true)) {\n          this.scenes[this._currentSceneKey].debugLayer.hide()\n\n          if ((typeof this.scenes[this._currentSceneKey].initialCanvas !== 'undefined') && (this.scenes[this._currentSceneKey].initialCanvas._profilingCanvas !== null)) {\n            this.scenes[this._currentSceneKey].initialCanvas._profilingCanvas.dispose()\n            this.scenes[this._currentSceneKey].initialCanvas._profilingCanvas = null\n          }\n        }\n      }\n\n      this._currentSceneKey = sceneKey\n\n      debuglog(`TaskObject.currentScene: changed to ${sceneKey}`)\n    } else if (sceneKey === null || sceneKey === '') {\n      this._currentSceneKey = ''\n    } else {\n      console.error('TaskObject.currentScene: Invalid sceneKey.')\n    }\n  }\n\n  toggleDebugLayer() {\n    const scene = this.currentSceneObject\n    this.shouldShowDebug = !this.shouldShowDebug\n\n    if (typeof scene !== 'undefined') {\n      if (this.shouldShowDebug) {\n        this.scenes[this._currentSceneKey].debugLayer.show()\n\n        if (typeof this.scenes[this._currentSceneKey].initialCanvas !== 'undefined') {\n          this.scenes[this._currentSceneKey].initialCanvas.createCanvasProfileInfoCanvas()\n        }\n      } else {\n        this.scenes[this._currentSceneKey].debugLayer.hide()\n\n        if ((typeof this.scenes[this._currentSceneKey].initialCanvas !== 'undefined') && (this.scenes[this._currentSceneKey].initialCanvas._profilingCanvas !== null)) {\n          this.scenes[this._currentSceneKey].initialCanvas._profilingCanvas.dispose()\n          this.scenes[this._currentSceneKey].initialCanvas._profilingCanvas = null\n        }\n      }\n    } else {\n      console.error('taskObject.toggleDebugLayer: currentSceneObject is undefined')\n    }\n  }\n\n  get currentSceneObject() {\n    return this.scenes[this._currentSceneKey]\n  }\n\n  set currentSceneObject(sceneObject) {\n    if (_.has(sceneObject, 'sceneKey')) {\n      this.currentScene = sceneObject.sceneKey\n    } else {\n      throw new Error('Specified scene has no sceneKey')\n    }\n  }\n\n  get time() {\n    return this.timeInMs\n  }\n\n  get timeInSec() {\n    return new Date().getTime() / 1000\n  }\n\n  get timeInMs() {\n    return new Date().getTime()\n  }\n\n  get paramBox() {\n    return this._paramBox\n  }\n\n  set paramBox(paramBox) {\n    if (this._paramBox) {\n      this._paramBox.delete()\n    }\n    this._paramBox = paramBox\n  }\n\n  get renderSize() {\n    return new BABYLON.Size(\n      this.engine.getRenderWidth(),\n      this.engine.getRenderHeight(),\n    )\n  }\n\n  set renderSize(size = mandatory()) {\n    switch (size.constructor) {\n      case String:\n        this.canvas.width = size\n        this.canvas.height = size\n        break\n      case BABYLON.Size:\n        this.canvas.width = `${size.width}px`\n        this.canvas.height = `${size.height}px`\n        break\n      case Array:\n        if (size.length === 2) {\n          this.canvas.width = size[0]\n          this.canvas.height = size[1]\n        } else {\n          throw new Error(\n          'TaskObject.renderSize: set with invalid size array, array lenght has to be === 2.',\n        )\n        }\n        break\n      default:\n        throw new Error(\n        'TaskObject.renderSize: set with invalid size array, array lenght has to be === 2.',\n      )\n    }\n  }\n\n  /* =============== Utility Functions =============== */\n  /* ======== Modal Methods ======== */\n  /**\n   * Creates a new information modal with specified data.\n   * @param  {Array}\n   */\n  newInfoModal(modalData = mandatory()) {\n    this._currentModal = modalData\n    const thisObject = this\n    const modalBox = new SmartModal('centralSmall', () => {\n      thisObject.infoModalDismissed()\n    })\n    modalBox.title = modalData[0]\n    modalBox.content = modalData[1]\n\n    this.infoModal = modalBox\n  }\n\n  /**\n   * Function called when infoModal are dismissed. It checks if an action is necessary and execute it. It then destroys the infoModal.\n   */\n  infoModalDismissed() {\n    if (this._currentModal) {\n      // replace by keyed object for comprehension\n      const modalAction = this._currentModal[2]\n      switch (modalAction[0]) {\n        case 'MDASTARTTASK':\n        /**\n         * Start the task\n         */\n          modalAction[1]()\n          break\n        default:\n          throw new Error('infoModalDismissed: Action unknown')\n      }\n    } else {\n      throw new Error('infoModal not defined')\n    }\n\n    this.removeInfoModal()\n  }\n\n  removeInfoModal() {\n    if (this.infoModal) {\n      switch (this.infoModal.constructor.name) {\n        case 'SmartModal':\n        // might do something specific ?\n          break\n        default:\n          throw new Error('Invalid infoModal type')\n      }\n    } else {\n      throw new Error(\"Can't remove InfoModal, infoModal not set\")\n    }\n\n    this.infoModal = null\n    this._currentModal = null\n  }\n\n  /* === Animation helpers === */\n  animateFloat(object, property, from, to) {\n    const keys = [{\n      frame: 0,\n      value: from,\n    }, {\n      frame: 100,\n      value: to,\n    }]\n\n    const animation = new BABYLON.Animation(\n      'animation',\n      property,\n      100,\n      BABYLON.Animation.ANIMATIONTYPE_FLOAT,\n      BABYLON.Animation.ANIMATIONLOOPMODE_CONSTANT,\n    )\n    animation.setKeys(keys)\n\n    this.currentSceneObject.stopAnimation(object)\n    object.animations.push(animation)\n    object._scene.beginAnimation(object, 0, 100, false, 1, () => {})\n  }\n\n  animateVector3(object, property, from, to, frameTotal = 24) {\n    const keys = [{\n      frame: 0,\n      value: from,\n    }, {\n      frame: frameTotal,\n      value: to,\n    }]\n\n    const animation = new BABYLON.Animation(\n      'animation',\n      property,\n      24,\n      BABYLON.Animation.ANIMATIONTYPE_VECTOR3,\n      BABYLON.Animation.ANIMATIONLOOPMODE_CONSTANT,\n    )\n    animation.setKeys(keys)\n\n    this.currentSceneObject.stopAnimation(object)\n\n    object.animations.push(animation)\n  }\n\n  animateColor3(object, property, from, to) {\n    const keys = [{\n      frame: 0,\n      value: from,\n    }, {\n      frame: 24,\n      value: to,\n    }]\n\n    const animation = new BABYLON.Animation(\n      'animation',\n      property,\n      12,\n      BABYLON.Animation.ANIMATIONTYPE_COLOR3,\n      BABYLON.Animation.ANIMATIONLOOPMODE_CONSTANT,\n    )\n    animation.setKeys(keys)\n\n    object._scene.stopAnimation(object)\n\n    object.animations.push(animation)\n  }\n\n  animateMainCameraRotation(toAlpha, toBeta, scene) {\n    // Alpha is the rotation angle around Y axis = azimuth\n    // Beta is the rotation angle around X axis = inclinaison\n    scene = this.scenes[this.currentScene]\n    const animCamAlpha = new BABYLON.Animation(\n      'animCam',\n      'alpha',\n      60,\n      BABYLON.Animation.ANIMATIONTYPE_FLOAT,\n      BABYLON.Animation.ANIMATIONLOOPMODE_CONSTANT,\n    )\n    const camera = scene.activeCamera\n    const keysAlpha = []\n\n    if (TaskObject.overPI(camera.alpha, toAlpha)) {\n      keysAlpha.push({\n        frame: 0,\n        value: camera.alpha,\n      })\n\n      console.log(camera.alpha)\n      console.log(toAlpha)\n\n      let firstStop = -Math.PI\n      let secondStop = Math.PI\n\n      if (camera.alpha > 0) {\n        firstStop = Math.PI\n        secondStop = -Math.PI\n      }\n\n      keysAlpha.push({\n        frame: 50,\n        value: firstStop,\n      })\n      keysAlpha.push({\n        frame: 51,\n        value: secondStop,\n      })\n      keysAlpha.push({\n        frame: 100,\n        value: toAlpha,\n      })\n    } else {\n      keysAlpha.push({\n        frame: 0,\n        value: camera.alpha,\n      })\n      keysAlpha.push({\n        frame: 100,\n        value: toAlpha,\n      })\n    }\n\n    const animCamBeta = new BABYLON.Animation(\n      'animCam',\n      'beta',\n      60,\n      BABYLON.Animation.ANIMATIONTYPE_FLOAT,\n      BABYLON.Animation.ANIMATIONLOOPMODE_CONSTANT,\n    )\n\n    const keysBeta = []\n    keysBeta.push({\n      frame: 0,\n      value: camera.beta,\n    })\n    keysBeta.push({\n      frame: 100,\n      value: toBeta,\n    })\n\n    animCamAlpha.setKeys(keysAlpha)\n    animCamBeta.setKeys(keysBeta)\n\n    camera.animations.push(animCamAlpha)\n    camera.animations.push(animCamBeta)\n\n    scene.beginAnimation(camera, 0, 100, false, 1, () => {})\n  }\n\n  /* === Particule system === */\n  /**\n   * Add a custom particule system to the specified mesh.\n   * @param {BABYLON.Mesh} mesh    Mesh on which to add the particule system\n   * @param {Object} options Option object, default properties are as follows :\n   *                         name: \"particle\" + mesh.name,\n   *                         capacity: 2000,\n   *                         texture: this.ASSETS_FLARE_PATH,\n   *                         minEmitBox: null,\n   *                         maxEmitBox: null,\n   *                         color1: new BABYLON.Color4(0.7, 0.8, 1.0, 1.0),\n   *                         color2: new BABYLON.Color4(0.2, 0.5, 1.0, 1.0),\n   *                         colorDead: new BABYLON.Color4(0, 0, 0.2, 0.0),\n   *                         minSize: 0.1,\n   *                         maxSize: 0.5,\n   *                         minLifeTime: 0.3,\n   *                         maxLifeTime: 0.8,\n   *                         emitRate: 150,\n   *                         blendMode: BABYLON.ParticleSystem.BLENDMODE_ONEONE,\n   *                         gravity: new BABYLON.Vector3(0, 9.81, 0), //upwards\n   *                         direction1: new BABYLON.Vector3(-5, -1, 3),\n   *                         direction2: new BABYLON.Vector3(5, 1, -3),\n   *                         minAngularSpeed: 0,\n   *                         maxAngularSpeed: 2 * Math.PI,\n   *                         minEmitPower: 0.1,\n   *                         maxEmitPower: 0.1,\n   *                         updateSpeed: 0.01,\n   *                         startIt: false\n   */\n  addParticuleSystemTo(mesh = mandatory(), options = {}) {\n    if (typeof mesh._scene === 'undefined') {\n      throw new Error('addParticuleSystemTo: mesh _scene is undefined.')\n    }\n\n    const scene = mesh._scene\n\n    // option base\n    const optionsBase = {\n      name: `particle${mesh.name}`,\n      capacity: 2000,\n      texture: this.ASSETS_FLARE_PATH,\n      minEmitBox: null,\n      maxEmitBox: null,\n      color1: new BABYLON.Color4(0.7, 0.8, 1, 1),\n      color2: new BABYLON.Color4(0.2, 0.5, 1, 1),\n      colorDead: new BABYLON.Color4(0, 0, 0.2, 0),\n      minSize: 0.1,\n      maxSize: 0.5,\n      minLifeTime: 0.3,\n      maxLifeTime: 0.8,\n      emitRate: 150,\n      blendMode: BABYLON.ParticleSystem.BLENDMODE_ONEONE,\n      gravity: new BABYLON.Vector3(0, 9.81, 0),\n      // upwards\n      direction1: new BABYLON.Vector3(-5, -1, 3),\n      direction2: new BABYLON.Vector3(5, 1, -3),\n      minAngularSpeed: 0,\n      maxAngularSpeed: 2 * Math.PI,\n      minEmitPower: 0.1,\n      maxEmitPower: 0.1,\n      updateSpeed: 0.01,\n      startIt: false,\n    }\n\n    // extend base options with specified options\n    options = _.extend(optionsBase, options)\n\n    // Create a particle system\n    const particleSystem = new BABYLON.ParticleSystem(\n      'particles',\n      options.capacity,\n      scene,\n    )\n\n    // Texture of each particle\n    particleSystem.particleTexture = new BABYLON.Texture(\n      options.texture,\n      scene,\n    )\n\n    // Where the particles come from\n    particleSystem.emitter = mesh\n    // the starting object, the emitter\n    if (options.minEmitBox !== null) {\n      particleSystem.minEmitBox = options.minEmitBox // Starting all from\n    }\n\n    if (options.maxEmitBox !== null) {\n      particleSystem.maxEmitBox = options.maxEmitBox // To...\n    }\n\n    // Colors of all particles\n    particleSystem.color1 = options.color1\n    particleSystem.color2 = options.color2\n    particleSystem.colorDead = options.colorDead\n\n    // Size of each particle (random between...\n    particleSystem.minSize = options.minSize\n    particleSystem.maxSize = options.maxSize\n\n    // Life time of each particle (random between...\n    particleSystem.minLifeTime = options.minLifeTime\n    particleSystem.maxLifeTime = options.maxLifeTime\n\n    // Emission rate\n    particleSystem.emitRate = options.emitRate\n\n    // Blend mode : BLENDMODE_ONEONE, or BLENDMODE_STANDARD\n    particleSystem.blendMode = options.blendMode\n\n    // Set the gravity of all particles\n    particleSystem.gravity = options.gravity\n\n    // Direction of each particle after it has been emitted\n    particleSystem.direction1 = options.direction1\n    particleSystem.direction2 = options.direction2\n\n    // Angular speed, in radians\n    particleSystem.minAngularSpeed = options.minAngularSpeed\n    particleSystem.maxAngularSpeed = options.maxAngularSpeed\n\n    // Speed\n    particleSystem.minEmitPower = options.minEmitPower\n    particleSystem.maxEmitPower = options.maxEmitPower\n    particleSystem.updateSpeed = options.updateSpeed\n\n    // Start the particle system\n    if (options.startIt) {\n      particleSystem.start()\n    }\n\n    return particleSystem\n  }\n\n  /* ======== Static functions ======== */\n  /* === Angle functions === */\n  static borderPI(radians) {\n    const offset = Math.PI\n    radians += offset\n    const sign = Math.sign(radians)\n    return radians -\n      (sign * Math.floor(Math.abs(radians) / (2 * Math.PI)) * (2 * Math.PI)) -\n      offset\n  }\n\n  static checkForCloserSignedAngle(baseAngle, checkedAngle) {\n    checkedAngle = TaskObject.borderPI(checkedAngle)\n    console.log(checkedAngle)\n    console.log(`baseAngle:${baseAngle}`)\n    let sign = Math.sign(checkedAngle)\n\n    if (checkedAngle === 0) {\n      sign = Math.sign(baseAngle)\n    }\n    const signedAngle = checkedAngle - (sign * (2 * Math.PI))\n    console.log(`signedAngle:${signedAngle}`)\n    const currentAngleArc = Math.abs(baseAngle - checkedAngle)\n    const signedAngleArc = Math.abs(baseAngle - signedAngle)\n\n    return currentAngleArc <= signedAngleArc ? checkedAngle : signedAngle\n  }\n\n  static overPI(angleA, angleB) {\n    return Math.abs(angleA - angleB) > Math.PI\n  }\n\n  /**\n   * Returns an array filled with len elements of value\n   * @param  {object} value any value\n   * @param  {number} len   number of element repeated\n   * @return {array}\n   */\n  static fillArray(value, len) {\n    const a = []\n    for (let i = 1; i <= len; i++) {\n      a.push(value)\n    }\n    return a\n  }\n\n  /**\n   * Transform spherical coordinate to euclidian coordinate taking y as the height axis and z the depth axis.\n   * Inclination is calculated from the y axis and azimuth from the z axis. Supposing both system have the same origin.\n   * https://en.wikipedia.org/wiki/Spherical_coordinate_system\n   * @param  {number} r           radius\n   * @param  {number} inclination inclination from y in radian\n   * @param  {number} azimuth     Azimuthal angle\n   * @return {BABYLON.Vector3}    Euclidian coordinate\n   */\n  static sphericalToEuclidian(r, inclination, azimuth) {\n    const z = r * Math.sin(inclination) * Math.cos(azimuth)\n    const x = r * Math.sin(inclination) * Math.sin(azimuth)\n    const y = r * Math.cos(inclination)\n\n    return new BABYLON.Vector3(x, y, z)\n  }\n\n  /**\n   * Get random number between min and max.\n   * @param  {Number} min\n   * @param  {Number} max\n   * @return {Number}\n   */\n  static getRandomArbitrary(min, max) {\n    return ((Math.random() * (max - min)) + min)\n  }\n\n  static getRandomElement(array = mandatory()) {\n    if (array.constructor === Array) {\n      return array[Math.round(\n        TaskObject.getRandomArbitrary(0, array.length - 1),\n      )]\n    }\n    throw new Error('TaskObject: argument is not of type array.')\n  }\n}\n\n\n\n// WEBPACK FOOTER //\n// ./src/framework/TaskObject.js","// shim for using process in browser\nvar process = module.exports = {};\n\n// cached from whatever global is present so that test runners that stub it\n// don't break things.  But we need to wrap it in a try catch in case it is\n// wrapped in strict mode code which doesn't define any globals.  It's inside a\n// function because try/catches deoptimize in certain engines.\n\nvar cachedSetTimeout;\nvar cachedClearTimeout;\n\nfunction defaultSetTimout() {\n    throw new Error('setTimeout has not been defined');\n}\nfunction defaultClearTimeout () {\n    throw new Error('clearTimeout has not been defined');\n}\n(function () {\n    try {\n        if (typeof setTimeout === 'function') {\n            cachedSetTimeout = setTimeout;\n        } else {\n            cachedSetTimeout = defaultSetTimout;\n        }\n    } catch (e) {\n        cachedSetTimeout = defaultSetTimout;\n    }\n    try {\n        if (typeof clearTimeout === 'function') {\n            cachedClearTimeout = clearTimeout;\n        } else {\n            cachedClearTimeout = defaultClearTimeout;\n        }\n    } catch (e) {\n        cachedClearTimeout = defaultClearTimeout;\n    }\n} ())\nfunction runTimeout(fun) {\n    if (cachedSetTimeout === setTimeout) {\n        //normal enviroments in sane situations\n        return setTimeout(fun, 0);\n    }\n    // if setTimeout wasn't available but was latter defined\n    if ((cachedSetTimeout === defaultSetTimout || !cachedSetTimeout) && setTimeout) {\n        cachedSetTimeout = setTimeout;\n        return setTimeout(fun, 0);\n    }\n    try {\n        // when when somebody has screwed with setTimeout but no I.E. maddness\n        return cachedSetTimeout(fun, 0);\n    } catch(e){\n        try {\n            // When we are in I.E. but the script has been evaled so I.E. doesn't trust the global object when called normally\n            return cachedSetTimeout.call(null, fun, 0);\n        } catch(e){\n            // same as above but when it's a version of I.E. that must have the global object for 'this', hopfully our context correct otherwise it will throw a global error\n            return cachedSetTimeout.call(this, fun, 0);\n        }\n    }\n\n\n}\nfunction runClearTimeout(marker) {\n    if (cachedClearTimeout === clearTimeout) {\n        //normal enviroments in sane situations\n        return clearTimeout(marker);\n    }\n    // if clearTimeout wasn't available but was latter defined\n    if ((cachedClearTimeout === defaultClearTimeout || !cachedClearTimeout) && clearTimeout) {\n        cachedClearTimeout = clearTimeout;\n        return clearTimeout(marker);\n    }\n    try {\n        // when when somebody has screwed with setTimeout but no I.E. maddness\n        return cachedClearTimeout(marker);\n    } catch (e){\n        try {\n            // When we are in I.E. but the script has been evaled so I.E. doesn't  trust the global object when called normally\n            return cachedClearTimeout.call(null, marker);\n        } catch (e){\n            // same as above but when it's a version of I.E. that must have the global object for 'this', hopfully our context correct otherwise it will throw a global error.\n            // Some versions of I.E. have different rules for clearTimeout vs setTimeout\n            return cachedClearTimeout.call(this, marker);\n        }\n    }\n\n\n\n}\nvar queue = [];\nvar draining = false;\nvar currentQueue;\nvar queueIndex = -1;\n\nfunction cleanUpNextTick() {\n    if (!draining || !currentQueue) {\n        return;\n    }\n    draining = false;\n    if (currentQueue.length) {\n        queue = currentQueue.concat(queue);\n    } else {\n        queueIndex = -1;\n    }\n    if (queue.length) {\n        drainQueue();\n    }\n}\n\nfunction drainQueue() {\n    if (draining) {\n        return;\n    }\n    var timeout = runTimeout(cleanUpNextTick);\n    draining = true;\n\n    var len = queue.length;\n    while(len) {\n        currentQueue = queue;\n        queue = [];\n        while (++queueIndex < len) {\n            if (currentQueue) {\n                currentQueue[queueIndex].run();\n            }\n        }\n        queueIndex = -1;\n        len = queue.length;\n    }\n    currentQueue = null;\n    draining = false;\n    runClearTimeout(timeout);\n}\n\nprocess.nextTick = function (fun) {\n    var args = new Array(arguments.length - 1);\n    if (arguments.length > 1) {\n        for (var i = 1; i < arguments.length; i++) {\n            args[i - 1] = arguments[i];\n        }\n    }\n    queue.push(new Item(fun, args));\n    if (queue.length === 1 && !draining) {\n        runTimeout(drainQueue);\n    }\n};\n\n// v8 likes predictible objects\nfunction Item(fun, array) {\n    this.fun = fun;\n    this.array = array;\n}\nItem.prototype.run = function () {\n    this.fun.apply(null, this.array);\n};\nprocess.title = 'browser';\nprocess.browser = true;\nprocess.env = {};\nprocess.argv = [];\nprocess.version = ''; // empty string to avoid regexp issues\nprocess.versions = {};\n\nfunction noop() {}\n\nprocess.on = noop;\nprocess.addListener = noop;\nprocess.once = noop;\nprocess.off = noop;\nprocess.removeListener = noop;\nprocess.removeAllListeners = noop;\nprocess.emit = noop;\n\nprocess.binding = function (name) {\n    throw new Error('process.binding is not supported');\n};\n\nprocess.cwd = function () { return '/' };\nprocess.chdir = function (dir) {\n    throw new Error('process.chdir is not supported');\n};\nprocess.umask = function() { return 0; };\n\n\n\n//////////////////\n// WEBPACK FOOTER\n// ./~/process/browser.js\n// module id = 10\n// module chunks = 0","module.exports = __WEBPACK_EXTERNAL_MODULE_11__;\n\n\n//////////////////\n// WEBPACK FOOTER\n// external \"experiment-boxes\"\n// module id = 11\n// module chunks = 0","module.exports = __WEBPACK_EXTERNAL_MODULE_12__;\n\n\n//////////////////\n// WEBPACK FOOTER\n// external \"experiment-mathjs\"\n// module id = 12\n// module chunks = 0","module.exports = __WEBPACK_EXTERNAL_MODULE_13__;\n\n\n//////////////////\n// WEBPACK FOOTER\n// external \"jquery\"\n// module id = 13\n// module chunks = 0","/**\n * Experiment.js\n * Created. 2016\n *\n * Experiment.js toolbox.\n *\n * Authors. Albert Buchard\n *\n * Requires: lodash, BABYLON.js, mathjs, jQuery\n *\n * LICENSE Apache-2\n */\n\n /* --- Import the framwork --- */\n import TaskObject from './src/framework/TaskObject'\n import StateManager from './src/framework/StateManager'\n import State from './src/framework/State'\n import EventData from './src/framework/EventData'\n import DataManager from './src/framework/DataManager'\n import RessourceManager from './src/framework/RessourceManager'\n\n import {\n   Array,\n   String,\n   diag,\n   rowSum,\n   getRow,\n   matrix,\n   samplePermutation,\n   rep,\n   Deferred,\n   recurse,\n   jitter,\n   delay,\n   looksLikeAPromise,\n   mustHaveConstructor,\n   mustBeDefined,\n   mandatory,\n   debuglog,\n   debugWarn,\n   debugError,\n   noop,\n } from './src/framework/utilities'\n\n\n/* add it to the global space in case user want to import in a script tag */\n if (typeof window !== 'undefined') {\n   window.TaskObject = TaskObject\n   window.StateManager = StateManager\n   window.State = State\n   window.EventData = EventData\n   window.DataManager = DataManager\n   window.RessourceManager = RessourceManager\n   window.jitter = jitter\n   window.delay = delay\n   window.Deferred = Deferred\n }\n\n\n export {\n  TaskObject,\n  StateManager,\n  State,\n  EventData,\n  DataManager,\n  RessourceManager,\n  Array,\n  String,\n  diag,\n  rowSum,\n  getRow,\n  matrix,\n  samplePermutation,\n  rep,\n  Deferred,\n  recurse,\n  jitter,\n  delay,\n  looksLikeAPromise,\n  mustHaveConstructor,\n  mustBeDefined,\n  mandatory,\n  debuglog,\n  debugWarn,\n  debugError,\n  noop,\n}\n\n\n\n// WEBPACK FOOTER //\n// ./builder.js"],"sourceRoot":""}