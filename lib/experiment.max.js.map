{"version":3,"sources":["webpack:///webpack/universalModuleDefinition","webpack:///webpack/bootstrap fd66b5b8422506a602d7","webpack:///./src/framework/utilities.js","webpack:///./~/bluebird/js/browser/bluebird.js","webpack:///external {\"commonjs\":\"lodash\",\"commonjs2\":\"lodash\",\"amd\":\"lodash\",\"root\":\"_\"}","webpack:///./src/framework/EventData.js","webpack:///./src/framework/DataManager.js","webpack:///./src/framework/RessourceManager.js","webpack:///./src/framework/State.js","webpack:///./src/framework/StateManager.js","webpack:///./~/process/browser.js","webpack:///(webpack)/buildin/global.js","webpack:///external {\"commonjs\":\"experiment-babylon-js\",\"commonjs2\":\"experiment-babylon-js\",\"amd\":\"experiment-babylon-js\",\"root\":\"BABYLON\"}","webpack:///external {\"commonjs\":\"experiment-mathjs\",\"commonjs2\":\"experiment-mathjs\",\"amd\":\"experiment-mathjs\",\"root\":\"math\"}","webpack:///external {\"commonjs\":\"jQuery\",\"commonjs2\":\"jQuery\",\"amd\":\"jQuery\",\"root\":\"jQuery\"}","webpack:///./src/framework/TaskObject.js","webpack:///./builder.js","webpack:///./src/config.js","webpack:///./~/setimmediate/setImmediate.js","webpack:///./~/timers-browserify/main.js","webpack:///external {\"commonjs\":\"experiment-boxes\",\"commonjs2\":\"experiment-boxes\",\"amd\":\"experiment-boxes\",\"root\":\"experimentBoxes\"}"],"names":["config","warnings","longStackTraces","cancellation","monitoring","noop","debuglog","console","log","bind","debugWarn","warn","debugError","error","mandatory","param","Error","mustBeDefined","args","i","length","spreadToObject","object","defaultValue","TargetClass","constructor","Array","mustHaveConstructor","constructorObject","allHaveConstructor","hasConstructor","looksLikeAPromise","o","then","catch","delay","ms","resolve","setTimeout","jitter","min","max","randomDuration","random","recurse","promiseGenerator","amount","target","concatOnArray","next","apply","r","concat","Deferred","reject","resolved","rejected","status","promise","data","e","String","rep","content","count","result","samplePermutation","sequence","repetition","n","copy","slice","permutation","add","index","Math","floor","splice","preloadImages","imgArray","promiseArray","images","image","deferred","img","Image","src","push","onload","all","matrix","rows","cols","fill","matrixObject","j","getRow","rowIndex","size","row","subset","range","rowSum","rowSumArray","sum","diag","setTo","diagonalValues","sizeToVec","BABYLON","Size","Vector2","width","height","scaleSize","scale","floatScale","parseFloat","isNaN","Number","prototype","boundTo","indicesOf","needle","haystack","indices","substr","hasNeighbouringRepeat","previousElement","toCsv","lineArray","forEach","array","line","join","csvContent","uniqueValues","u","a","hasOwnProperty","minValue","NaN","maxValue","multisplice","sort","b","spliced","getXY","x","xyArray","y","average","type","windowAverages","endIndex","windowArray","bins","position","undefined","total","integrate","cumulativeArray","equals","value","resultVector","l","ntrue","resultSum","nEquals","exclude","values","addit","includes","Set","indexOf","Object","defineProperty","observe","attribute","lookForValue","rate","checkForValue","enumerable","isSuperset","elem","has","union","setB","sample","repeat","from","unite","intersection","intersect","remove","difference","delete","EventData","flag","happenedAt","timeInMs","BASE_DATA_FIELDS","belongsTo","handledAt","storedAt","extend","forState","handled","stored","dataKeys","keys","JSON","stringify","specificData","Date","getTime","DataManager","parent","subjectID","_parent","_subjectID","automaticID","VALUE_FOR_NA","FLAG_EVENT_NOFLAG","logs","dataTables","tablesLastIndex","toPush","waitForPush","GLOBAL_LOG_FIELDS","addTable","INTERFACE_REST","INTERFACE_GRAPHQL","INTERFACE_WEBSOCKET","QUERY_LOGIN","QUERY_ADD","QUERY_GET_CHECKPOINT","QUERY_SET_CHECKPOINT","MAX_NUMBER_OF_RETRY","useLocalStorageCredentials","connections","addRate","isNode","module","exports","name","fields","id","tableNames","toDataObject","isValidRows","columnNamesRows","columnNamesDataTableWithoutId","generateIds","field","firstField","nrows","prepareToPush","numberOfIds","startId","emptyTable","columnNamesDataTable","previousLenght","newLenght","dataObject","numRows","dataArray","format","hasTable","toDataArray","restURL","connection","variables","login","userId","password","interface","credentials","query","ajax","url","endpoint","contentType","done","local","fail","xhr","json","responseJSON","message","shouldLog","variable","localStorage","parse","names","table","returned","dataTable","fieldNames","lastIndex","getStagedData","defaultVariables","checkpoint","QUERY_CHECKPOINT","_globalLog","globalLog","_customNextID","RessourceManager","defaultLanguage","currentLanguage","overwrite","useAjax","filepaths","addFiles","concatFilepaths","files","promises","isOfValidFormat","getFormat","path","loaded","validated","added","raw","loadFile","fileIndex","deffered","thisObject","crossDomain","textStatus","jqXHR","parseRaw","file","parser","arg","csv","toObjects","window","DOMParser","parseFromString","ActiveXObject","async","loadXML","processParsed","addDataFamilly","familly","toAdd","toLowerCase","oldOverwrite","addByName","filepath","lastIndexOf","validFormats","ressourceManager","currentFamillies","famillies","mergingFamillies","lookFor","extended","deep","toString","call","merge","obj","prop","Proxy","get","pathString","split","lookForLanguage","lookForFamilly","lookForVariable","couldSwapForVariable","State","stateManager","stateKey","_stateManager","_dataManager","_eventFunctions","_awakeningFunctions","_endingFunctions","_updateFunctions","_frozenEvents","_frozenAt","FREEZE_DELAY","reload","stateWasUnfreezed","unfreeze","sceneKey","calledFunctions","method","context","_eventHeap","nextEvent","events","spliceEventsForState","handleEvent","event","hasEventFunction","eventFunctions","functionName","eventClone","cloneDeep","handlingFunction","stateHasFinishedHandlingEvent","getAllEvents","stateWasFrozen","frozenEvents","addTimeTriggerEvent","addEvent","eventFlag","handlingFunctions","Function","cycle","arrayName","registerEventFunctions","registerCycleFunctions","getGlobal","setGlobal","_taskObject","getContext","taskObject","dataManager","scene","state","R","StateManager","parentTaskObject","_timeTriggerEvents","errorLog","states","idle","pause","active","timestampThreshold","states_idle","states_active","states_pause","_currentStateKey","frozenState","globals","globalFunctions","currentState","update","storedInErrorLog","addRows","formatted","storeInErrorLog","returnedStates","stateKeys","key","end","awake","Scene","canvasOptions","backgroundFill","Canvas2D","GetSolidColorBrush","Color4","backgroundRoundRadius","zOrder","GUI","ScreenSpaceCanvas2D","levelVisible","set","spaced","text","fontName","duration","background","fontColor","guiCanvas","tooltip","sizeDefault","brownColor","fontSuperSample","fontSignedDistanceField","brush","tooltipBox","Rectangle2D","tooltipText","Text2D","marginAlignment","defaultFontColor","subtract","box","tempPosition","nextPos","currentTooltip","hideTooltip","addDefaultDesign","pauseState","options","keyCode","freeze","goToState","forcePause","unPause","keydown","registerEventFunction","events_pause","addDefaultPauseDesign","awakePause","pauseBackground2D","canvas","screenCanvas","baseOptions","customSized","roundRadius","children","endPause","registerAwakeningFunction","registerEndingFunction","emptyEventHeap","emptyTimeTriggerEvents","time","eventOptions","values_timestampThreshold","without","byState","currentStateKey","toSplice","storeEvent","eventHeapIsFrozen","frozenEventHeap","storeFrozenEvents","func","functions","registerGlobalFunction","results","recurseOnGlobalFunction","setDefault","scripts","document","getElementsByTagName","assetsFolderFullpath","delimiterIndices","TaskObject","assetsFolder","engine","_target","Engine","innerHeight","innerWidth","babylonCanvasHeight","babylonCanvasWidth","globalLogFields","taskStatusFields","statusFlagsFields","checkpointFields","ASSETS_FOLDER","ASSETS_FLARE_PATH","assetsToLoad","folders","flags","keyState","shouldShowDebug","DEBUG_MODE_ONE","setupGlobalEvents","currentModal","parameters","shouldSeeInformation","scenes","sceneGenerators","functionsOptions","loading","default2dSceneGenerator","loadingOptions","shouldLoadAssets","_currentSceneKey","_paramBox","sceneGenerator","clone","loadingSceneGenerator","registerSceneGenerator","sceneOptions","generator","functionKeys","callSceneGenerator","assets","assetsArray","_scene","Mesh","material","subMaterials","addMesh","assetObject","assetFolder","textureFormats","soundFormats","assetManager","AssetsManager","binaryPromises","assetManagerTask","addTextureTask","onSuccess","task","textures","textureName","texture","addBinaryFileTask","isReady","sounds","soundName","Sound","loadDeferred","load","onFinish","tasks","asset","cloneAssetsIntoScene","addEventListener","resize","loadingScene","loadingPromise","currentScene","flags_hasLoaded","runRenderLoop","render","generateScenes","hasLoaded","sceneStarts","sceneEnds","mouseMove","click","pick","keyup","wasHandled","beingHandled","modalDismissed","evt","keyfunction","eventData","events_keydown","currentSceneObject","events_click","clientX","clientY","engineX","renderSize","engineY","events_resize","outerHeight","outerWidth","addEventToCurrentScene","updateContentFrame","dCode","shiftCode","altCode","toggleDebugLayer","preventDefault","optionsBase","canvasBackground","clearColor","canvasPercentWidth","canvasPercentHeight","minWidth","NEGATIVE_INFINITY","minHeight","maxWidth","POSITIVE_INFINITY","maxHeight","getCanvasDimensions","noNull","pWidth","pHeight","addStateManager","camera","ArcRotateCamera","PI","Vector3","Zero","borderThickness","initialCanvas","initialCamera","initialGui","addGuiCanvas","resizeAt","onResize","f","registerBeforeRender","setConnection","code","baseContext","extendWith","debugLayer","show","createCanvasProfileInfoCanvas","hide","_profilingCanvas","dispose","title","events_modalDismissed","modalBox","dismissed","property","to","frame","animation","Animation","ANIMATIONTYPE_FLOAT","ANIMATIONLOOPMODE_CONSTANT","setKeys","stopAnimation","animations","beginAnimation","frameTotal","ANIMATIONTYPE_VECTOR3","ANIMATIONTYPE_COLOR3","toAlpha","toBeta","animCamAlpha","activeCamera","keysAlpha","overPI","alpha","firstStop","secondStop","animCamBeta","keysBeta","beta","mesh","capacity","minEmitBox","maxEmitBox","color1","color2","colorDead","minSize","maxSize","minLifeTime","maxLifeTime","emitRate","blendMode","ParticleSystem","BLENDMODE_ONEONE","gravity","direction1","direction2","minAngularSpeed","maxAngularSpeed","minEmitPower","maxEmitPower","updateSpeed","startIt","particleSystem","particleTexture","Texture","emitter","start","sceneObject","paramBox","getRenderWidth","getRenderHeight","mode","level","create2DScene","logo","loadAssets","textures_logo","hasAlpha","Sprite2D","origin","radians","offset","sign","abs","baseAngle","checkedAngle","borderPI","signedAngle","currentAngleArc","signedAngleArc","angleA","angleB","sound","currentVolume","step","threshold","delayInMs","getVolume","decrement","setVolume","fadeOut","stop","len","inclination","azimuth","z","sin","cos","round","getRandomArbitrary","DEBUG_MODE_ON"],"mappings":"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BAAkB,EAAE,YAAY;AACrC;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;;;AAGA;AACA;AACA;AACA;AACA;AACA,KAAK;AACL;AACA;AACA;;AAEA;AACA;AACA;AACA,0BAA0B,WAAW;AACrC;AACA;AACA;AACA;AACA,SAAS;AACT,KAAK;AACL;AACA;AACA,SAAS;AACT,KAAK;AACL;AACA;AACA;;AAEA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA,CAAC;AACD;AACA;AACA;AACA,SAAS;AACT;AACA;AACA;AACA,iBAAiB;AACjB,aAAa;AACb;AACA;;AAEA;AACA;AACA;AACA,SAAS;AACT;AACA;AACA,aAAa;AACb;AACA;;AAEA;AACA;AACA;AACA,SAAS;AACT;AACA;AACA,aAAa;AACb;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;;AAEA,CAAC,EAAE,yCAAyC;AAC5C;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,KAAK;AACL;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA,KAAK;AACL;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;AACA;;AAEA,CAAC,GAAG;AACJ;AACA;AACA;AACA;AACA,SAAS,yCAAyC;AAClD;AACA;AACA;AACA;AACA;AACA;;AAEA,CAAC,EAAE,eAAe;AAClB;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA,8BAA8B;AAC9B;AACA,kCAAkC;AAClC,4CAA4C;AAC5C,yBAAyB;AACzB,uDAAuD;AACvD,gEAAgE;AAChE,yEAAyE;AACzE,gDAAgD;AAChD;AACA,2DAA2D;AAC3D,aAAa;AACb,UAAU;AACV;AACA;;AAEA;AACA;AACA,qBAAqB;AACrB,gCAAgC;AAChC;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,2BAA2B,SAAS;AACpC;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,SAAS;AACT;AACA;AACA,KAAK;AACL;AACA;AACA;AACA;AACA;;AAEA,CAAC,EAAE,YAAY;AACf;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA,aAAa;AACb;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA,aAAa;AACb;AACA;AACA;AACA,SAAS;AACT;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA,KAAK;AACL;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA,uBAAuB,6BAA6B;AACpD;AACA;AACA,KAAK;AACL;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,SAAS;AACT;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;;AAEA,CAAC,EAAE,YAAY;AACf;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA,sCAAsC,sBAAsB;AAC5D;;AAEA;AACA;AACA;AACA;AACA;AACA,aAAa;AACb;AACA;AACA;AACA,iBAAiB;AACjB;AACA;AACA,aAAa;AACb;AACA,+BAA+B,iBAAiB;AAChD;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;;AAEA,CAAC,EAAE,uBAAuB;AAC1B;AACA;AACA;AACA;;AAEA;AACA;AACA,4CAA4C;AAC5C;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA,CAAC,GAAG;AACJ;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;;AAEA;AACA;;AAEA;AACA;;AAEA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,iBAAiB;AACjB;AACA;AACA,SAAS;AACT;AACA;AACA;AACA;AACA;AACA,iBAAiB;AACjB;AACA;AACA;AACA,SAAS;AACT;AACA,oEAAoE;AACpE;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,KAAK;AACL;AACA;AACA;AACA,CAAC;;AAED;AACA;AACA;AACA;AACA;AACA,KAAK;AACL;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,CAAC;;AAED;AACA,YAAY;AACZ;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,gBAAgB;AAChB,KAAK;AACL;AACA,gBAAgB;AAChB,KAAK;AACL;AACA,gBAAgB;AAChB,KAAK;AACL;AACA;;AAEA;AACA;AACA;AACA;AACA,KAAK;AACL;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA,KAAK;AACL;AACA;AACA;;AAEA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA,SAAS;AACT;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,SAAS;AACT;AACA;AACA;AACA;AACA;AACA;;AAEA,6BAA6B,cAAc;;AAE3C;AACA;AACA;AACA;AACA,KAAK;AACL;AACA;AACA;AACA;AACA,qDAAqD,EAAE;AACvD;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,SAAS;AACT,KAAK;AACL;AACA;AACA;;AAEA;AACA;;AAEA;AACA;AACA;AACA;AACA,SAAS;AACT;AACA;AACA,KAAK;AACL;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA,aAAa;AACb;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,SAAS;AACT;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA,0CAA0C,QAAQ;AAClD;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA,+BAA+B,uBAAuB;;AAEtD;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA,KAAK;AACL;AACA,KAAK;AACL;AACA;AACA;;AAEA;AACA;AACA;AACA;;AAEA;AACA,mBAAmB,uBAAuB;AAC1C;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA,mBAAmB,mBAAmB;AACtC;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA,mBAAmB,mBAAmB;AACtC;AACA;AACA;AACA;;AAEA,qCAAqC,QAAQ;AAC7C;AACA;AACA;AACA;AACA;;AAEA,yCAAyC,QAAQ;AACjD;AACA;AACA;AACA;AACA,aAAa;AACb;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA,mBAAmB,kBAAkB;AACrC;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA,mBAAmB,kBAAkB;AACrC;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA,SAAS;AACT;AACA;AACA;AACA;AACA,SAAS;AACT;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,aAAa;AACb;AACA;AACA;AACA,KAAK;AACL;AACA;;AAEA;AACA;AACA;AACA;AACA,KAAK;AACL;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA,KAAK;AACL;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;;AAEA,+BAA+B,cAAc;AAC7C;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,mBAAmB,4BAA4B;AAC/C;AACA;AACA;AACA;AACA;AACA;AACA;AACA,mBAAmB,2BAA2B;AAC9C;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;;AAEA,gCAAgC,oBAAoB;AACpD;AACA;AACA;AACA;AACA,4BAA4B,QAAQ;AACpC;AACA;AACA;AACA;AACA;AACA,mBAAmB,YAAY;AAC/B;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA,aAAa;AACb;AACA;AACA;AACA;AACA,+BAA+B,QAAQ;AACvC;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA,SAAS,mBAAmB;AAC5B;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,iBAAiB,mBAAmB;AACpC,sBAAsB,mBAAmB;AACzC;AACA;AACA;;AAEA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;;AAEA,CAAC;;AAED;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,KAAK;AACL;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;;AAEA;;AAEA;AACA;AACA;AACA,KAAK;AACL;AACA;AACA,KAAK;AACL;AACA;AACA,KAAK;AACL;AACA;AACA,KAAK;AACL;AACA;AACA,KAAK;AACL;AACA;AACA,KAAK;AACL;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA,CAAC,EAAE,0BAA0B;AAC7B;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA,yCAAyC,aAAa;AACtD;;AAEA;AACA;AACA;AACA,wCAAwC,eAAe;AACvD;;AAEA;AACA;AACA;AACA,4CAA4C,eAAe;AAC3D,KAAK;AACL;AACA,kCAAkC;AAClC;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA,6CAA6C,aAAa;AAC1D,KAAK;AACL;AACA;AACA,kCAAkC;AAClC;AACA;AACA;AACA;;AAEA,CAAC,GAAG;AACJ;AACA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;AACA;;AAEA;AACA;;;AAGA,CAAC,GAAG;AACJ;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,SAAS;AACT;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,CAAC;AACD;AACA;AACA;;AAEA;AACA;;AAEA,eAAe,oBAAoB;AACnC;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA,CAAC;AACD;AACA;AACA;AACA;AACA;AACA;AACA;AACA,mBAAmB,iBAAiB;AACpC;AACA;AACA,uBAAuB,kBAAkB;AACzC;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA,KAAK;AACL;AACA;;AAEA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,KAAK;AACL;AACA;AACA;AACA;AACA;AACA,KAAK;AACL;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA,CAAC,EAAE,uBAAuB;AAC1B;AACA;AACA;AACA,CAAC;;AAED;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,CAAC;AACD,gBAAgB;AAChB,gBAAgB;AAChB,kBAAkB;;AAElB;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA,gBAAgB;AAChB;;AAEA;AACA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA,CAAC,GAAG;AACJ;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;AACA;;AAEA,CAAC,GAAG;AACJ;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA,SAAS;AACT;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,SAAS;AACT;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,qBAAqB;AACrB;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA,KAAK;AACL;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;;;AAGA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,KAAK;AACL;AACA;AACA,mBAAmB,aAAa;AAChC;AACA;AACA;AACA,aAAa;AACb;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;;AAEA;AACA;;AAEA,CAAC,EAAE,+BAA+B;AAClC;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA,mBAAmB,0BAA0B;AAC7C;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA,SAAS;AACT;AACA;AACA,KAAK;AACL;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,KAAK;AACL;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA,SAAS;AACT;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA,SAAS;AACT;AACA;AACA,KAAK;AACL;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,SAAS;AACT;AACA;AACA;AACA,SAAS;AACT;AACA;AACA;AACA,SAAS;AACT;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA,CAAC,EAAE,0BAA0B;AAC7B;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA,yBAAyB;AACzB,kCAAkC;AAClC,0CAA0C;AAC1C;AACA;;AAEA;AACA;AACA,yBAAyB;AACzB,oCAAoC;AACpC;AACA;;AAEA;AACA;AACA,uBAAuB,kBAAkB;AACzC;AACA;AACA,sDAAsD;AACtD,2CAA2C;AAC3C;AACA,uCAAuC;AACvC,iDAAiD;AACjD,qCAAqC;AACrC,iBAAiB;AACjB;AACA,SAAS;AACT;AACA;;;AAGA,yEAAyE;AACzE,yBAAyB;AACzB,oCAAoC;AACpC;AACA,6BAA6B;AAC7B,wCAAwC;AACxC,6BAA6B;AAC7B,aAAa;AACb;AACA,mEAAmE;AACnE,uCAAuC;AACvC,kEAAkE;AAClE,sCAAsC;AACtC,uCAAuC;AACvC,0DAA0D;AAC1D,iBAAiB,OAAO;AACxB,kDAAkD;AAClD,iBAAiB;AACjB,cAAc;AACd;AACA,sEAAsE;AACtE,qCAAqC;AACrC,yCAAyC;AACzC,2CAA2C;AAC3C,wEAAwE;AACxE,qBAAqB,OAAO;AAC5B,oDAAoD;AACpD,qBAAqB;AACrB;AACA,iBAAiB;AACjB,cAAc;AACd;AACA,+DAA+D;AAC/D;AACA,cAAc;AACd;AACA,6BAA6B;AAC7B,SAAS,qCAAqC;AAC9C;;AAEA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;;AAEA,mBAAmB,OAAO;AAC1B;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA,+BAA+B,UAAU;AACzC;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,yBAAyB;AACzB;AACA;AACA,yBAAyB;AACzB;AACA,yBAAyB;AACzB;AACA;AACA,qBAAqB;AACrB;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;;AAEA,CAAC,EAAE,YAAY;AACf;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;;AAEA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,KAAK;AACL;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,aAAa;AACb;AACA,aAAa;AACb;AACA;AACA,aAAa;AACb;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,SAAS;AACT;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA,mBAAmB,SAAS;AAC5B;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,SAAS;AACT;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;;;AAGA;;AAEA,CAAC,EAAE,YAAY;AACf;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,KAAK;AACL;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA,KAAK;AACL;AACA;AACA;AACA;;AAEA,CAAC,EAAE,YAAY;AACf;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,uBAAuB,iBAAiB;AACxC;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,SAAS;AACT;AACA,SAAS;AACT;AACA;AACA;AACA;AACA;AACA;;AAEA;;AAEA,CAAC,EAAE,qCAAqC;AACxC;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA,CAAC,EAAE,YAAY;AACf;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,CAAC;AACD;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA,uCAAuC,aAAa;AACpD;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA,mBAAmB,aAAa;AAChC;AACA;AACA;AACA,aAAa;AACb;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,KAAK;AACL;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;;AAEA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,aAAa;AACb;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA,SAAS;AACT;AACA;AACA;AACA,SAAS;AACT;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,SAAS;AACT,KAAK;AACL;AACA;;AAEA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA,KAAK;AACL;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;;AAEA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,KAAK;AACL;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;;AAEA;;AAEA;;AAEA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA,uBAAuB,SAAS;AAChC;AACA;AACA;AACA;AACA;AACA,KAAK;AACL;AACA,KAAK;AACL;AACA,KAAK;AACL;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,KAAK;AACL;AACA,KAAK;AACL;AACA;;AAEA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,SAAS;AACT;AACA;AACA,KAAK;AACL;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA,KAAK;AACL;AACA,KAAK;AACL;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA,SAAS;AACT;AACA,SAAS;AACT;AACA,SAAS;AACT;AACA,SAAS;AACT;AACA;AACA,KAAK;AACL;AACA;AACA,SAAS;AACT;AACA;AACA;AACA,KAAK;AACL;AACA;AACA;AACA,aAAa;AACb;AACA;AACA;AACA,KAAK;AACL;AACA;AACA;AACA,SAAS;AACT;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,SAAS;AACT;AACA;AACA,KAAK;AACL;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA,SAAS;AACT;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA,KAAK;AACL;AACA;AACA;;AAEA;AACA,mBAAmB,SAAS;AAC5B;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA,mBAAmB,SAAS;AAC5B;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA,SAAS;AACT;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA,KAAK;AACL;AACA;AACA;;AAEA,0BAA0B;AAC1B,yBAAyB;;AAEzB;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA,mC;AACA,6C;AACA,+B;AACA,sC;AACA,uC;AACA,qC;AACA,4B;AACA,6B;AACA,K;AACA;AACA;AACA,eAAe,KAAK,E;AACpB,eAAe,KAAK,E;AACpB,eAAe,KAAK,E;AACpB,iB;AACA,0BAA0B,E;AAC1B,yB;AACA,qB;AACA,qC;AACA,8D;AACA,mB;;AAEA;;AAEA,CAAC,EAAE,0gBAA0gB;AAC7gB;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,SAAS;AACT;AACA,SAAS;AACT;AACA,SAAS;AACT;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,mBAAmB,SAAS;AAC5B;;AAEA;AACA;AACA;AACA,SAAS;AACT;AACA;;AAEA;AACA;AACA;AACA;AACA,SAAS;AACT;AACA;AACA;AACA,aAAa;AACb;AACA,aAAa;AACb;AACA,aAAa;AACb;AACA;AACA,SAAS;AACT;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA,KAAK;AACL,uBAAuB,mBAAmB;AAC1C;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;;AAEA,CAAC,EAAE,YAAY;AACf;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,0BAA0B;AAC1B;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA,mBAAmB,gBAAgB;AACnC;AACA;AACA;AACA,2BAA2B,gBAAgB;AAC3C;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA,mBAAmB,iBAAiB;AACpC;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA,wCAAwC,UAAU;AAClD;AACA;AACA,wCAAwC,QAAQ;AAChD;AACA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA,+CAA+C,MAAM,YAAY,OAAO;AACxE,SAAS;AACT;AACA,oCAAoC,MAAM,YAAY,OAAO;AAC7D,mDAAmD,MAAM,YAAY,OAAO;AAC5E;AACA,8BAA8B,MAAM;AACpC;;AAEA;AACA;AACA,uBAAuB,0BAA0B;AACjD;AACA;AACA;;AAEA;AACA;AACA,0CAA0C;AAC1C,sBAAsB;AACtB,2BAA2B,SAAS,OAAO;AAC3C,sCAAsC;AACtC,aAAa;AACb,+BAA+B;AAC/B;AACA,kBAAkB;AAClB;AACA,oEAAoE;AACpE,wEAAwE;AACxE;AACA;;AAEA;AACA;AACA;AACA,6BAA6B;AAC7B,yCAAyC;AACzC,yBAAyB;AACzB,uCAAuC;AACvC,gDAAgD;AAChD,yCAAyC;AACzC,0EAA0E;AAC1E,oBAAoB;AACpB,uDAAuD;AACvD,yBAAyB;AACzB;AACA,aAAa;AACb,mCAAmC;AACnC,6EAA6E;AAC7E,aAAa;AACb,wEAAwE;AACxE,2BAA2B;AAC3B,UAAU;AACV,0DAA0D;AAC1D,mBAAmB;AACnB;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA,mCAAmC,aAAa;AAChD;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,SAAS;AACT;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;AACA;;AAEA,yCAAyC,SAAS;AAClD;AACA;AACA;AACA;AACA;AACA;AACA,SAAS;AACT;AACA;AACA;AACA,aAAa;AACb;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA,mBAAmB,iBAAiB;AACpC;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;;;AAGA,CAAC,EAAE,0CAA0C;AAC7C;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,CAAC;;AAED;AACA;AACA;AACA,mBAAmB,YAAY;AAC/B;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA,KAAK;AACL;AACA;AACA;AACA,uBAAuB,SAAS;AAChC;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,SAAS;AACT;AACA;AACA,gDAAgD,SAAS;AACzD;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA,KAAK;AACL;AACA;AACA,KAAK;AACL;AACA;;AAEA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;AACA;;AAEA,CAAC,EAAE,uBAAuB;AAC1B;AACA;AACA,mBAAmB,SAAS;AAC5B;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;;AAEA,CAAC,GAAG;AACJ;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA,KAAK;AACL;;AAEA;AACA;;AAEA;AACA;AACA,KAAK;AACL;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA,0CAA0C,SAAS;AACnD;;AAEA;AACA;AACA;;AAEA;AACA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;;AAEA,CAAC,EAAE,YAAY;AACf;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,KAAK;AACL;AACA,KAAK;AACL;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;;AAEA;;AAEA;AACA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,KAAK;AACL;AACA;AACA;;AAEA;;AAEA;AACA,cAAc,YAAY;AAC1B;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;AACA,KAAK;AACL;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,KAAK;AACL;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,KAAK;AACL;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA,CAAC,EAAE,YAAY;AACf;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,gCAAgC,qCAAqC;AACrE,gCAAgC,mCAAmC;AACnE,CAAC;AACD;AACA;AACA;AACA;AACA;AACA,CAAC;AACD;AACA;AACA;AACA;AACA;AACA,oBAAoB;AACpB;AACA;AACA;AACA;AACA;AACA,SAAS;AACT;;AAEA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA,aAAa;AACb;AACA;AACA;AACA,KAAK;AACL,CAAC;AACD;AACA;AACA;AACA,CAAC;AACD;AACA;AACA;AACA,CAAC;AACD;AACA;AACA;;AAEA,CAAC,EAAE,YAAY;AACf;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;;AAEA,CAAC,EAAE,YAAY;AACf;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;;AAGA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA,SAAS;AACT;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA,mCAAmC,yBAAyB;AAC5D;AACA;AACA;AACA;AACA;AACA;AACA,SAAS;AACT;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;;AAEA,CAAC,EAAE,0BAA0B;AAC7B;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;AACA;;AAEA;AACA;;AAEA,CAAC,GAAG;AACJ;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,SAAS;AACT;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;AACA,KAAK;AACL;AACA;AACA;AACA;;AAEA,gBAAgB;AAChB;AACA;AACA;AACA,KAAK;AACL;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;;AAEA,CAAC,EAAE,YAAY;AACf;AACA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;;AAEA,kCAAkC,uCAAuC;AACzE;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,KAAK;AACL;AACA,wCAAwC,gBAAgB,EAAE;AAC1D;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA,SAAS;AACT;AACA;AACA,KAAK;AACL;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA,KAAK;;AAEL;AACA;AACA;AACA;AACA;AACA,KAAK;AACL;AACA;AACA;;AAEA;AACA;;AAEA;;AAEA,CAAC,EAAE,YAAY;AACf;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA,8BAA8B,SAAS;AACvC;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,iBAAiB;AACjB;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA,uBAAuB,SAAS;AAChC;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,SAAS;AACT;AACA;AACA;AACA;AACA,uBAAuB,SAAS;AAChC;AACA;AACA;AACA;AACA;AACA,aAAa;AACb;AACA;AACA;AACA;AACA;AACA;AACA,qBAAqB;AACrB;AACA;AACA;AACA;;AAEA;AACA,uBAAuB,+BAA+B;AACtD;AACA;;AAEA;AACA;AACA,+BAA+B,wBAAwB;AACvD;AACA;AACA;AACA;AACA,qBAAqB;AACrB;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,aAAa;;AAEb;AACA;AACA;AACA,SAAS;AACT;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;;AAEA;;AAEA,CAAC,EAAE,0BAA0B;AAC7B;AACA;AACA;;AAEA,gBAAgB;AAChB;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA,KAAK;AACL;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA,oBAAoB;;AAEpB;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;;AAGA;AACA;AACA;;AAEA;;AAEA;AACA;AACA;AACA;;AAEA;AACA;;AAEA;AACA;;AAEA;AACA;AACA;AACA;AACA,eAAe,SAAS;AACxB;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA,KAAK;AACL,iBAAiB;AACjB;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA,uBAAuB,+BAA+B;AACtD;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,iBAAiB;AACjB;AACA;AACA,+BAA+B,iBAAiB;AAChD;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,KAAK;AACL,wBAAwB;AACxB;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA,iBAAiB;AACjB,mCAAmC,+BAA+B;AAClE;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA,CAAC;;AAED;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA,KAAK;AACL;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;;AAEA;AACA;AACA,kBAAkB,WAAW;AAC7B;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA,KAAK;AACL;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA,iBAAiB;AACjB,wBAAwB;AACxB;AACA,KAAK;AACL;AACA;AACA;AACA;AACA;AACA,CAAC;;AAED;AACA,aAAa;AACb;;AAEA;AACA;AACA,mBAAmB,iBAAiB;AACpC;AACA;AACA;AACA;AACA,aAAa;AACb;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA,KAAK;AACL;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA,SAAS;AACT;AACA;AACA;AACA;AACA;;AAEA;AACA;;AAEA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;AACA,kDAAkD;AAClD,kBAAkB;AAClB;AACA;AACA,SAAS;AACT;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,CAAC;;AAED;;AAEA,KAAK,kBAAkB,EAAE,YAAY;AACrC;;AAEA,CAAC,EAAE,WAAW,EAAE,GAAG;AACnB,CAAC,EAAE,qBAAqB,uDAAuD,yDAAyD,sDAAsD,yDAAyD,mDAAmD,0D;;;;;;;ACl/K1S,+C;;;;;;;;;;;;;qjBCAA;;;AACA;;;;AACA;;;;;;AAEA;IACqBuH,S;AACnB;;;;;;;AAOA,uBAAoF;AAAA,QAAxEC,IAAwE,uEAAjE,0BAAU,MAAV,CAAiE;AAAA,QAA9CC,UAA8C,uEAAjCF,UAAUG,QAAuB;AAAA,QAAb7I,IAAa,uEAAN,IAAM;;AAAA;;AAAE;AACpF,SAAK2I,IAAL,GAAYA,IAAZ;;AAEA;AACA,SAAKG,gBAAL,GAAwB;AACtBC,iBAAW,CAAC,WAAD,CADW,EACI;AAC1BC,iBAAW,IAFW;AAGtBC,gBAAU;AAHY,KAAxB;;AAOA,QAAIL,WAAW9K,WAAX,KAA2BsJ,MAA/B,EAAuC;AACrC;AACA,UAAIpH,SAAS,IAAb,EAAmB;AACjB,aAAK4I,UAAL,GAAkBF,UAAUG,QAA5B;AACA,aAAK7I,IAAL,GAAY,iBAAEkJ,MAAF,CAAS,KAAKJ,gBAAd,EAAgCF,UAAhC,CAAZ;AACD,OAHD,MAGO;AACL,cAAM,IAAIvL,KAAJ,CAAU,6DAAV,CAAN;AACD;AACF,KARD,MAQO;AACL,WAAKuL,UAAL,GAAkBA,UAAlB;AACA,WAAK5I,IAAL,GAAY,iBAAEkJ,MAAF,CAAS,KAAKJ,gBAAd,EAAgC9I,IAAhC,CAAZ;AACD;;AAGD,SAAKmJ,QAAL,GAAgB,KAAhB;AACA,QAAI,KAAKnJ,IAAL,CAAUgF,cAAV,CAAyB,UAAzB,CAAJ,EAA0C;AACxC,WAAKmE,QAAL,GAAgB,KAAKnJ,IAAL,CAAUmJ,QAA1B;AACD;;AAGD;;;;AAIA,SAAKC,OAAL,GAAe,KAAf;;AAEA;;;;AAIA,SAAKC,MAAL,GAAc,KAAd;AACD;;;;wBAMkB;AACjB,UAAMC,WAAWlC,OAAOmC,IAAP,CAAY,KAAKvJ,IAAjB,CAAjB;AACA,UAAMM,SAAS,EAAf;AACA,WAAK,IAAI9C,IAAI,CAAb,EAAgBA,IAAI8L,SAAS7L,MAA7B,EAAqCD,GAArC,EAA0C;AACxC8C,eAAOgJ,SAAS9L,CAAT,CAAP,IAAsB,KAAKwC,IAAL,CAAUsJ,SAAS9L,CAAT,CAAV,CAAtB;AACD;AACD,aAAO8C,MAAP;AACD;;;wBAEe;AACd,aAAO;AACLqI,cAAM,KAAKA,IADN;AAELQ,kBAAU,KAAKA,QAFV;AAGLP,oBAAY,KAAKA,UAHZ;AAILI,mBAAW,KAAKhJ,IAAL,CAAUgJ,SAJhB;AAKLC,kBAAU,KAAKjJ,IAAL,CAAUiJ,QALf;AAMLjJ,cAAMwJ,KAAKC,SAAL,CAAe,KAAKC,YAApB;AAND,OAAP;AAQD;;;wBAtBqB;AACpB,aAAO,IAAIC,IAAJ,GAAWC,OAAX,EAAP;AACD;;;;;;kBAtDkBlB,S;;;;;;;;;;;;;;;;;ACLrB;;;;AACA;;;;AACA;;;;AACA;;;;;;AAUA;IACqBmB,W;AACnB;;;;;;;;AAQA,yBAAoD;AAAA,QAAxCC,MAAwC,uEAA/B,2BAA+B;AAAA,QAAlBC,SAAkB,uEAAN,IAAM;;AAAA;;AAClD;;;;AAIA,SAAKC,OAAL,GAAeF,MAAf;;AAEA;;;;AAIA,QAAIC,SAAJ,EAAe;AACb,WAAKE,UAAL,GAAkBF,SAAlB;AACD;;AAED;;;;AAIA,SAAKG,WAAL,GAAmB,IAAnB;;AAEA;;AAEA;;;;;AAKA,SAAKC,YAAL,GAAoB,IAApB;;AAEA,SAAKC,iBAAL,GAAyB,iBAAzB;;AAEA;;AAEA;;;;;AAKA,SAAKC,IAAL,GAAY,EAAZ;;AAEA;AACA;;;;AAIA,SAAKC,UAAL,GAAkB,EAAlB;;AAGA,SAAKC,eAAL,GAAuB,EAAvB;;AAEA;;;AAGA,SAAKC,MAAL,GAAc,IAAItD,GAAJ,EAAd;;AAEA;AACA,SAAKuD,WAAL,GAAmB,KAAnB;;AAEA;;;;;;;;AAQA,SAAKC,iBAAL,GAAyB,CAAC,IAAD,EAAO,MAAP,EAAe,UAAf,EAA2B,YAA3B,EAAyC,WAAzC,EAAsD,MAAtD,CAAzB,CAnEkD,CAmEqC;AACvF,SAAKC,QAAL,CAAc,WAAd,EAA2B,KAAKD,iBAAhC;;AAEA;AACA,SAAKE,cAAL,GAAsB,MAAtB;AACA,SAAKC,iBAAL,GAAyB,SAAzB;AACA,SAAKC,mBAAL,GAA2B,WAA3B;AACA,SAAKC,WAAL,GAAmB,OAAnB;AACA,SAAKC,SAAL,GAAiB,KAAjB;AACA,SAAKC,oBAAL,GAA4B,gBAA5B;AACA,SAAKC,oBAAL,GAA4B,eAA5B;AACA,SAAKC,mBAAL,GAA2B,CAA3B;;AAEA;;;;;AAKA,SAAKC,0BAAL,GAAkC,IAAlC;;AAEA;;;;;;;;;AASA,SAAKC,WAAL,GAAmB,EAAnB;;AAEA,SAAKC,OAAL,GAAe,IAAf;;AAEA;AACA,SAAKC,MAAL,GAAc,KAAd;AACA,QAAI,OAAOC,MAAP,KAAkB,WAAlB,IAAiCA,OAAOC,OAA5C,EAAqD;AACnD,WAAKF,MAAL,GAAc,IAAd;AACD;AACF;;AAED;;;;;0BACyC;AAAA,UAArCvL,IAAqC,uEAA9B,2BAA8B;AAAA,UAAjB0L,IAAiB,uEAAV,QAAU;;AACvC,UAAI,CAAC,KAAKrB,IAAL,CAAUrF,cAAV,CAAyB0G,IAAzB,CAAL,EAAqC;AACnC,aAAKrB,IAAL,CAAUqB,IAAV,IAAkB,EAAlB;AACD;;AAED,WAAKrB,IAAL,CAAUqB,IAAV,EAAgB9J,IAAhB,CAAqB5B,IAArB;AACD;;AAED;AACA;;;;;;;;+BAKmD;AAAA,UAA1C0L,IAA0C,uEAAnC,2BAAmC;AAAA,UAAtBC,MAAsB,uEAAb,2BAAa;;AACjD,UAAI;AACF,YAAI,iBAAE7D,GAAF,CAAM,KAAKwC,UAAX,EAAuBoB,IAAvB,CAAJ,EAAkC;AAChC,gBAAM,IAAIrO,KAAJ,mDAAyDqO,IAAzD,uBAAN;AACD;;AAED;AACA,aAAKpB,UAAL,CAAgBoB,IAAhB,IAAwB,EAAxB;AACA,aAAK,IAAIlO,IAAI,CAAb,EAAgBA,IAAImO,OAAOlO,MAA3B,EAAmCD,GAAnC,EAAwC;AACtC,eAAK8M,UAAL,CAAgBoB,IAAhB,EAAsBC,OAAOnO,CAAP,CAAtB,IAAmC,EAAnC;AACD;;AAED,YAAI,iBAAE2J,OAAF,CAAUwE,MAAV,EAAkB,IAAlB,MAA4B,CAAC,CAAjC,EAAoC;AAClC,eAAKrB,UAAL,CAAgBoB,IAAhB,EAAsBE,EAAtB,GAA2B,EAA3B;AACD;AACF,OAdD,CAcE,OAAO3L,CAAP,EAAU;AACV,mCAAWA,CAAX;AACD;AACF;;AAED;;;;;;;;+BAK6B;AAAA,UAApByL,IAAoB,uEAAb,2BAAa;;AAC3B,UAAI,iBAAE5D,GAAF,CAAM,KAAKwC,UAAX,EAAuBoB,IAAvB,CAAJ,EAAkC;AAChC,eAAQ,IAAR;AACD;AACD,aAAQ,KAAR;AACD;;AAED;;;;;;;;;iCAM+B;AAAA,UAApBA,IAAoB,uEAAb,2BAAa;;AAC7B,UAAI,KAAKG,UAAL,CAAgB/D,GAAhB,CAAoB4D,IAApB,CAAJ,EAA+B;AAC7B,eAAO,IAAIxE,GAAJ,CAAQE,OAAOmC,IAAP,CAAY,KAAKe,UAAL,CAAgBoB,IAAhB,CAAZ,CAAR,CAAP;AACD;AACD,iCAAW,wCAAX;AACA,aAAO,IAAP;AACD;;AAED;;;;;;;;8BAKgD;AAAA,UAAxCA,IAAwC,uEAAjC,2BAAiC;AAAA,UAApB1J,IAAoB,uEAAb,2BAAa;;AAC9C,UAAI;AACFA,eAAO,KAAK8J,YAAL,CAAkB9J,IAAlB,EAAwB0J,IAAxB,CAAP;AACA,YAAI,KAAKK,WAAL,CAAiB/J,IAAjB,EAAuB0J,IAAvB,CAAJ,EAAkC;AAChC,cAAMM,kBAAkB,IAAI9E,GAAJ,CAAQE,OAAOmC,IAAP,CAAYvH,IAAZ,CAAR,CAAxB;AACA,cAAMiK,gCAAgC,IAAI/E,GAAJ,CAAQE,OAAOmC,IAAP,CAAY,KAAKe,UAAL,CAAgBoB,IAAhB,CAAZ,CAAR,CAAtC;AACAO,wCAA8BxD,MAA9B,CAAqC,IAArC;;AAEA,cAAK,CAACuD,gBAAgBlE,GAAhB,CAAoB,IAApB,CAAF,IAAiC,KAAKoC,WAA1C,EAAwD;AACtD,gBAAM0B,KAAK,KAAKM,WAAL,CAAiBR,IAAjB,EAAuB,CAAvB,CAAX;AACA,iBAAKpB,UAAL,CAAgBoB,IAAhB,EAAsBE,EAAtB,GAA2B,KAAKtB,UAAL,CAAgBoB,IAAhB,EAAsBE,EAAtB,CAAyBnM,MAAzB,CAAgCmM,EAAhC,CAA3B;AACD;;AAR+B;AAAA;AAAA;;AAAA;AAUhC,iCAAoBK,6BAApB,8HAAmD;AAAA,kBAAxCE,KAAwC;;AACjD,mBAAK7B,UAAL,CAAgBoB,IAAhB,EAAsBS,KAAtB,IAA+B,KAAK7B,UAAL,CAAgBoB,IAAhB,EAAsBS,KAAtB,EAA6B1M,MAA7B,CAAoCuC,KAAKmK,KAAL,CAApC,CAA/B;AACD;AAZ+B;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;;AAchC,cAAMC,aAAa,iBAAMjE,IAAN,CAAW6D,eAAX,EAA4B,CAA5B,CAAnB;AACA,cAAMK,QAASrK,KAAKoK,UAAL,EAAiBtO,WAAjB,qBAAD,GAA2C,CAA3C,GAA+CkE,KAAKoK,UAAL,EAAiB3O,MAA9E;AACA,mEAAuC4O,KAAvC,iBAAwDX,IAAxD;;AAEA,eAAKY,aAAL,CAAmBZ,IAAnB;AACD,SAnBD,MAmBO;AACL,gBAAM,IAAIrO,KAAJ,CAAU,gDAAV,CAAN;AACD;AACF,OAxBD,CAwBE,OAAO4C,CAAP,EAAU;AACV,mCAAW,uBAAX,EAAoCA,CAApC;AACD;AACF;;AAED;;;;;;;;;kCAMiD;AAAA,UAArCyL,IAAqC,uEAA9B,2BAA8B;AAAA,UAAjBa,WAAiB,uEAAH,CAAG;;AAC/C,UAAI;AACF,YAAI,CAAE,iBAAEzE,GAAF,CAAM,KAAKwC,UAAX,EAAuBoB,IAAvB,CAAN,EAAqC;AACnC,gBAAM,IAAIrO,KAAJ,sDAA4DqO,IAA5D,wBAAN;AACD;;AAED,YAAI,CAAE,iBAAE5D,GAAF,CAAM,KAAKwC,UAAL,CAAgBoB,IAAhB,CAAN,EAA6B,IAA7B,CAAN,EAA2C;AACzC,gBAAM,IAAIrO,KAAJ,sDAA4DqO,IAA5D,sCAAN;AACD;;AAED,YAAIc,UAAU,CAAd;AACA,YAAI,KAAKlC,UAAL,CAAgBoB,IAAhB,EAAsBE,EAAtB,CAAyBnO,MAAzB,KAAoC,CAAxC,EAA2C;AACzC+O,oBAAU,iBAAE1N,GAAF,CAAM,KAAKwL,UAAL,CAAgBoB,IAAhB,EAAsBE,EAA5B,IAAkC,CAA5C;AACD;;AAED,eAAQ,iBAAElJ,KAAF,CAAQ8J,OAAR,EAAiBA,UAAUD,WAA3B,CAAR;AACD,OAfD,CAeE,OAAOtM,CAAP,EAAU;AACV,mCAAWA,CAAX;AACA,eAAO,IAAP;AACD;AACF;;AAED;;;;;;;;;kCAMgC;AAAA,UAApByL,IAAoB,uEAAb,2BAAa;;AAC9B,UAAI,CAAE,iBAAE5D,GAAF,CAAM,KAAKwC,UAAX,EAAuBoB,IAAvB,CAAN,EAAqC;AACnC,wFAA6DA,IAA7D;AACA,eAAO,IAAP;AACD;;AAED,UAAMe,aAAa,EAAnB;AACA,UAAMC,uBAAuB,iBAAEnD,IAAF,CAAO,KAAKe,UAAL,CAAgBoB,IAAhB,CAAP,CAA7B;;AAEA,WAAK,IAAIlO,IAAI,CAAb,EAAgBA,IAAIkP,qBAAqBjP,MAAzC,EAAiDD,GAAjD,EAAsD;AACpDiP,mBAAWC,qBAAqBlP,CAArB,CAAX,IAAsC,EAAtC;AACD;;AAED,aAAQiP,UAAR;AACD;;AAED;;;;;;;;;kCAM6C;AAAA,UAAjCzK,IAAiC,uEAA1B,2BAA0B;AAAA,UAAb0J,IAAa,uEAAN,IAAM;;AAC3C,UAAKA,SAAS,IAAV,IAAoB,CAAC,KAAKG,UAAL,CAAgB/D,GAAhB,CAAoB4D,IAApB,CAAzB,EAAqD;AACnD,cAAM,IAAIrO,KAAJ,sDAA4DqO,IAA5D,wBAAN;AACD;;AAED,UAAI1J,KAAKlE,WAAL,KAAqBsJ,MAAzB,EAAiC;AAC/B,eAAQ,KAAR;AACD;;AAED,UAAM4E,kBAAkB5E,OAAOmC,IAAP,CAAYvH,IAAZ,CAAxB;AACA,UAAM0K,uBAAwBhB,SAAS,IAAV,GAAkBM,eAAlB,GAAoC5E,OAAOmC,IAAP,CAAY,KAAKe,UAAL,CAAgBoB,IAAhB,CAAZ,CAAjE;;AAEA,UAAIiB,iBAAiB,IAArB;AACA,WAAK,IAAInP,IAAI,CAAb,EAAgBA,IAAIkP,qBAAqBjP,MAAzC,EAAiDD,GAAjD,EAAsD;AACpD,YAAI,iBAAE2J,OAAF,CAAU6E,eAAV,EAA2BU,qBAAqBlP,CAArB,CAA3B,MAAwD,CAAC,CAA7D,EAAgE;AAC9D,cAAIwE,KAAK0K,qBAAqBlP,CAArB,CAAL,EAA8BM,WAA9B,qBAAJ,EAAyD;AACvD,gBAAI6O,mBAAmB,IAAvB,EAA6B;AAC3BA,+BAAiB3K,KAAK0K,qBAAqBlP,CAArB,CAAL,EAA8BC,MAA/C;AACD,aAFD,MAEO;AACL,kBAAMmP,YAAY5K,KAAK0K,qBAAqBlP,CAArB,CAAL,EAA8BC,MAAhD;AACA,kBAAIkP,mBAAmBC,SAAvB,EAAkC;AAChC;AACA,uBAAQ,KAAR;AACD;AACF;AACF,WAVD,MAUO,IAAID,mBAAmB,IAAvB,EAA6B;AAClC,mBAAQ,KAAR;AACD;AACF,SAdD,MAcO,IAAKD,qBAAqBlP,CAArB,MAA4B,IAA7B,IAAuC,CAAC,KAAK0M,WAAjD,EAA+D;AACpE;AACA,wGAA4EwC,qBAAqBlP,CAArB,CAA5E,qBAAmHkO,IAAnH;AACA,iBAAQ,KAAR;AACD;AACF;;AAED;;AAEA,aAAQ,IAAR;AACD;;AAED;AACA;;;;;;;;;;;;;mCAU8C;AAAA,UAAjC1J,IAAiC,uEAA1B,2BAA0B;AAAA,UAAb0J,IAAa,uEAAN,IAAM;;AAC5C;AACA,UAAI1J,KAAKlE,WAAL,qBAAJ,EAAgC;AAC9B,YAAIkE,KAAKvE,MAAL,KAAgB,CAApB,EAAuB;AACrB,qCAAW,0CAAX;AACA,iBAAO,IAAP;AACD;;AAED,YAAIuE,KAAK,CAAL,EAAQlE,WAAR,KAAwBsJ,MAA5B,EAAoC;AAClC,qCAAW,uDAAX;AACA,iBAAO,IAAP;AACD;;AAED,YAAMuE,SAASvE,OAAOmC,IAAP,CAAYvH,KAAK,CAAL,CAAZ,CAAf;;AAEA,YAAM6K,aAAa7K,KAAK,CAAL,CAAnB;AACA,aAAK,IAAIxE,IAAI,CAAb,EAAgBA,IAAIwE,KAAKvE,MAAzB,EAAiCD,GAAjC,EAAsC;AACpC,cAAMgF,MAAMR,KAAKxE,CAAL,CAAZ;AADoC;AAAA;AAAA;;AAAA;AAEpC,kCAAoBmO,MAApB,mIAA4B;AAAA,kBAAjBQ,KAAiB;;AAC1B,kBAAI,CAAC3J,IAAIwC,cAAJ,CAAmBmH,KAAnB,CAAL,EAAgC;AAC9B,sBAAM,IAAI9O,KAAJ,sCAA6C8O,KAA7C,mCAAN;AACD;AACD,kBAAIU,WAAWV,KAAX,EAAkBrO,WAAlB,qBAAJ,EAA6C;AAC3C+O,2BAAWV,KAAX,IAAoB,EAApB;AACD;AACDU,yBAAWV,KAAX,EAAkBvK,IAAlB,CAAuBY,IAAI2J,KAAJ,CAAvB;AACD;AAVmC;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAWrC;AACF;;AAED,UAAI,KAAKJ,WAAL,CAAiB/J,IAAjB,EAAuB0J,IAAvB,CAAJ,EAAkC;AAChC,eAAO1J,IAAP;AACD;AACD,iCAAW,qDAAX;AACA,aAAO,IAAP;AACD;;AAED;;;;;;;;;;;;;kCAU6C;AAAA,UAAjCA,IAAiC,uEAA1B,2BAA0B;AAAA,UAAb0J,IAAa,uEAAN,IAAM;;AAC3C,UAAI1J,KAAKlE,WAAL,qBAAJ,EAAgC;AAC9B,YAAKkE,KAAKvE,MAAL,GAAc,CAAf,IAAsBuE,KAAK,CAAL,EAAQlE,WAAR,KAAwBsJ,MAAlD,EAA2D;AACzD;AACA;AACA,iBAAOpF,IAAP;AACD;AACD,mCAAW,oDAAX;AACA,eAAO,IAAP;AACD;;AAED,UAAI,KAAK+J,WAAL,CAAiB/J,IAAjB,EAAuB0J,IAAvB,CAAJ,EAAkC;AAChC,YAAMC,SAAS,IAAIzE,GAAJ,CAAQE,OAAOmC,IAAP,CAAYvH,IAAZ,CAAR,CAAf;AACA,YAAM8K,UAAU9K,KAAK2J,OAAO,CAAP,CAAL,EAAgBlO,MAAhC;AACA,YAAMsP,YAAY,EAAlB;AACA,aAAK,IAAIvP,IAAI,CAAb,EAAgBA,IAAIsP,OAApB,EAA6BtP,GAA7B,EAAkC;AAChC,cAAMgF,MAAM,EAAZ;AADgC;AAAA;AAAA;;AAAA;AAEhC,kCAAoBmJ,MAApB,mIAA4B;AAAA,kBAAjBQ,KAAiB;;AAC1B,kBAAInK,KAAKmK,KAAL,EAAY1O,MAAZ,IAAsBD,CAA1B,EAA6B;AAC3B,qFAAmD2O,KAAnD;AACA,uBAAO,IAAP;AACD;AACD3J,kBAAI2J,KAAJ,IAAanK,KAAKmK,KAAL,EAAY3O,CAAZ,CAAb;AACD;AAR+B;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;;AAShCuP,oBAAUnL,IAAV,CAAeY,GAAf;AACD;;AAED,eAAOuK,SAAP;AACD;AACD,iCAAW,oDAAX;AACA,aAAO,IAAP;AACD;;;4BAEyC;AAAA,UAApC/M,IAAoC,uEAA7B,IAA6B;AAAA,UAAvBgN,MAAuB,uEAAd,YAAc;;AACxC,UAAIhN,KAAKlC,WAAL,sBAAJ,EAAiC;AAC/B,YAAI,CAAE,KAAKmP,QAAL,CAAcvB,IAAd,CAAN,EAA4B;AAC1B,oFAAuDA,IAAvD;AACA,iBAAO,IAAP;AACD;AACD1L,eAAO,KAAKsK,UAAL,CAAgBtK,IAAhB,CAAP;AACD;;AAEDA,aAAQgN,WAAW,YAAZ,GAA4B,KAAKlB,YAAL,CAAkB9L,IAAlB,CAA5B,GAAsD,KAAKkN,WAAL,CAAiBlN,IAAjB,CAA7D;;AAEA,UAAM0M,uBAAuBtF,OAAOmC,IAAP,CAAYvJ,IAAZ,CAA7B;;AAEA,UAAMuE,YAAY,EAAlB;AACA,WAAK,IAAI/G,IAAI,CAAb,EAAgBA,IAAIkP,qBAAqB,CAArB,EAAwBjP,MAA5C,EAAoDD,GAApD,EAAyD;AACvD,YAAMgF,MAAM,EAAZ;AACA,aAAK,IAAIJ,IAAI,CAAb,EAAgBA,IAAIsK,qBAAqBjP,MAAzC,EAAiD2E,GAAjD,EAAsD;AACpDI,cAAIZ,IAAJ,OAAa8K,qBAAqBtK,CAArB,EAAwB5E,CAAxB,CAAb;AACD;AACD,YAAMkH,OAAOlC,IAAImC,IAAJ,CAAS,GAAT,CAAb;AACAJ,kBAAU3C,IAAV,CAAepE,MAAM,CAAN,oCAAyCkH,IAAzC,GAAkDA,IAAjE;AACD;;AAED,UAAME,aAAaL,UAAUI,IAAV,CAAe,IAAf,CAAnB;;AAEA,aAAQC,UAAR;AACD;;;6BAE0C;AAAA,UAApC5E,IAAoC,uEAA7B,IAA6B;AAAA,UAAvBgN,MAAuB,uEAAd,YAAc;;AACzC,UAAIhN,SAAS,IAAb,EAAmB;AACjBA,eAAO,EAAP;AACA,YAAM6L,aAAa,KAAKA,UAAxB;AACA,YAAImB,WAAW,WAAf,EAA4B;AAAA;AAAA;AAAA;;AAAA;AAC1B,kCAAmBnB,UAAnB,mIAA+B;AAAA,kBAApBH,KAAoB;;AAC7B1L,mBAAK0L,KAAL,IAAa,KAAKwB,WAAL,CAAiB,KAAK5C,UAAL,CAAgBoB,KAAhB,CAAjB,CAAb;AACD;AAHyB;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAI3B,SAJD,MAIO;AACL1L,iBAAO,KAAKsK,UAAZ;AACD;AACF,OAVD,MAUO,IAAKtK,KAAKlC,WAAL,sBAAD,IAAkC,KAAKmP,QAAL,CAAcjN,IAAd,CAAtC,EAA4D;AACjEA,eAAO,KAAKkN,WAAL,CAAiB,KAAK5C,UAAL,CAAgBtK,IAAhB,CAAjB,CAAP;AACD;;AAEDA,aAAQgN,WAAW,YAAZ,GAA4B,KAAKlB,YAAL,CAAkB9L,IAAlB,CAA5B,GAAsD,KAAKkN,WAAL,CAAiBlN,IAAjB,CAA7D;;AAEA,aAAOwJ,KAAKC,SAAL,CAAezJ,IAAf,CAAP;AACD;;;+BAEU;AAAE;AACX;AACA;AACA,UAAI,IAAJ,EAAmC;AACjC;AACA;AACA,YAAI;AACF;AACD,SAFD,CAEE,OAAO9C,KAAP,EAAc;AACd,qCAAWA,KAAX;AACD;AACF,OARD,MAQO,IAAI,KAAKiQ,OAAT,EAAkB;AACrB;AACH;AACF;;;+BAEU,CAIV,C,CAJY;AACX;AACA;AACA;;;AAGF;;;;4BAC6E;AAAA,UAAvEC,UAAuE,uEAA1D,2BAA0D;AAAA,UAA7CC,SAA6C,uEAAjC,IAAiC;AAAA,UAA3B7L,QAA2B,uEAAhB,yBAAgB;;AAC3E,UAAIA,SAAS1B,MAAT,GAAkB,KAAKqL,mBAA3B,EAAgD;AAC9C3J,iBAAS7B,MAAT,CAAgB,qDAAhB;AACD,OAFD,MAEO;AACL6B,iBAAS1B,MAAT,IAAmB,CAAnB;;AAEA;AACA;AACA,YAAK,iBAAEgI,GAAF,CAAMsF,UAAN,EAAkB,OAAlB,CAAD,IAAiCA,WAAWE,KAAX,CAAiBxP,WAAjB,sBAArC,EAA+E;AAC7E,cAAIuP,cAAc,IAAlB,EAAwB;AACtB,mBAAO,KAAKC,KAAL,CAAWF,UAAX,EAAuB,EAAEG,QAAQ,MAAV,EAAkBC,UAAU,QAA5B,EAAvB,EAA+DhM,QAA/D,CAAP,CADsB,CACyD;AAChF;AACC;AACF,cAAMxB,OAAO;AACXyN,uBAAWL,WAAWvH,IADX;AAEX6H,yBAAaL,SAFF;AAGXM,mBAAOP,WAAWE;AAHP,WAAb;;AAME;AACF,2BAAEM,IAAF,CAAO;AACLC,iBAAKT,WAAWU,QADX;AAELjI,kBAAM,MAFD;AAGL7F,kBAAMwJ,KAAKC,SAAL,CAAezJ,IAAf,CAHD;AAIL+N,yBAAa;AAJR,WAAP,EAMGC,IANH,CAMQ,SAASA,IAAT,CAAchO,IAAd,EAAoBF,MAApB,EAA4B;AAChC;AACAsN,uBAAWM,WAAX,GAAyB1N,KAAK0N,WAA9B;AACA,gBAAI,KAAKtC,0BAAT,EAAqC;AACnC,mBAAK6C,KAAL,CAAWb,WAAW1B,IAAtB,EAA4B,EAAEgC,aAAa1N,KAAK0N,WAApB,EAA5B;AACD;AACD,6FAA+D5N,MAA/D,EAAyEE,IAAzE;AACAwB,qBAAS9C,OAAT;AACD,WARK,CAQJ5B,IARI,CAQC,IARD,CANR,EAeGoR,IAfH,CAeQ,UAAUd,UAAV,EAAsBe,GAAtB,EAA2B;AAC/B;AACA,gBAAMC,OAAOD,IAAIE,YAAjB;AACA,gBAAMC,UAAUF,KAAKE,OAAL,IAAgB,EAAhC;AACA,8FAAgEA,OAAhE;AACA,iBAAKhB,KAAL,CAAWF,UAAX,EAAuB,IAAvB,EAA6B5L,QAA7B;AACD,WANK,CAMJ1E,IANI,CAMC,IAND,EAMOsQ,UANP,CAfR;AAsBD;AACF;;AAGD,aAAO5L,SAASzB,OAAhB;AACD;;AAED;;;;4BACyF;AAAA,UAAnF4N,MAAmF,uEAA3E,2BAA2E;;AAAA,UAA9DN,SAA8D,uEAAlD,EAAkD;;AAAA;;AAAA,UAA9CD,UAA8C,uEAAjC,IAAiC;AAAA,UAA3B5L,QAA2B,uEAAhB,yBAAgB;;AACvF,UAAIA,SAAS1B,MAAT,GAAkB,KAAKqL,mBAA3B,EAAgD;AAC9C3J,iBAAS7B,MAAT,CAAgB,qDAAhB,EAAuEgO,MAAvE;AACD,OAFD,MAEO;AACLnM,iBAAS1B,MAAT,IAAmB,CAAnB;;AAEA,YAAIsN,eAAe,IAAnB,EAAyB;AACvB,cAAI,KAAK/B,WAAL,CAAiB5N,MAAjB,GAA0B,CAA9B,EAAiC;AAC/B2P,yBAAa,KAAK/B,WAAL,CAAiB,CAAjB,CAAb;AACD,WAFD,MAEO;AACL7J,qBAAS7B,MAAT,CAAgB,mDAAhB;AACD;AACF;;AAED,YAAIyN,WAAWvH,IAAX,KAAoB,KAAK+E,cAA7B,EAA6C;AAC3C;AACA,cAAM5K,OAAO;AACXyN,uBAAWL,WAAWvH,IADX;AAEX6H,yBAAaN,WAAWM,WAFb;AAGXC,yBAHW;AAIXN;AAJW,WAAb;;AAOA;AACA,2BAAEO,IAAF,CAAO;AACLC,iBAAKT,WAAWU,QADX;AAELjI,kBAAM,MAFD;AAGL7F,kBAAMwJ,KAAKC,SAAL,CAAezJ,IAAf,CAHD;AAIL+N,yBAAa;AAJR,WAAP,EAMCC,IAND,CAMM,UAAChO,IAAD,EAAOF,MAAP,EAAkB;AACtB;AACA,6FAA+DA,MAA/D,EAAyEE,IAAzE;AACAwB,qBAAS9C,OAAT,CAAiBsB,IAAjB;AACD,WAVD,EAWCkO,IAXD,CAWM,UAACC,GAAD,EAAS;AACb,gBAAMC,OAAOD,IAAIE,YAAJ,IAAoB,EAAEC,SAAS,EAAX,EAAeC,WAAW,KAA1B,EAAjC;AACA,gBAAIH,KAAKG,SAAT,EAAoB;AAClB,yCAAW,wEAAX;AACA,oBAAKjB,KAAL,CAAWF,UAAX,EAAuB9O,IAAvB,CAA4B,YAAM;AAAE,sBAAKqP,KAAL,CAAWA,MAAX,EAAkBN,SAAlB,EAA6BD,UAA7B,EAAyC5L,QAAzC;AAAoD,eAAxF;AACD,aAHD,MAGO;AACL,yCAAW,yDAAX,EAAsE4M,KAAK3E,SAAL,CAAekE,MAAf,CAAtE,EAA6FS,KAAKE,OAAlG;AACA,oBAAKX,KAAL,CAAWA,MAAX,EAAkBN,SAAlB,EAA6BD,UAA7B,EAAyC5L,QAAzC;AACD;AACF,WApBD;AAqBD,SA/BD,MA+BO;AACLA,mBAAS7B,MAAT,CAAgB,4CAAhB;AACD;AACF;;AAGD,aAAO6B,SAASzB,OAAhB;AACD;;AAED;;AAEA;;;;;;;;;;4BAOoC;AAAA,UAA9ByO,QAA8B,uEAAnB,IAAmB;AAAA,UAAbxO,IAAa,uEAAN,IAAM;;AAClC,UAAIwO,aAAa,IAAjB,EAAuB;AACrB,eAAOC,YAAP;AACD;;AAED,UAAIzO,SAAS,IAAb,EAAmB;AACjByO,qBAAaD,QAAb,IAAyBhF,KAAKC,SAAL,CAAezJ,IAAf,CAAzB;AACA,eAAOmG,SAAP;AACD;AACD,UAAI,CAACsI,aAAazJ,cAAb,CAA4BwJ,QAA5B,CAAL,EAA4C;AAC1C,8FAAoEA,QAApE;AACA,eAAOrI,SAAP;AACD;;AAED,UAAI;AACF,YAAMnG,QAAOwJ,KAAKkF,KAAL,CAAWD,aAAaD,QAAb,CAAX,CAAb;AACA,eAAOxO,KAAP;AACD,OAHD,CAGE,OAAOC,CAAP,EAAU;AACV,mCAAW,mDAAX,EAAgEA,CAAhE;AACD;AACD,aAAOwO,aAAaD,QAAb,CAAP;AACD;;;oCAEuB;AAAA;;AAAA,wCAAPG,KAAO;AAAPA,aAAO;AAAA;;AACtB,UAAIA,UAAU,EAAd,EAAkB;AAChBA,gBAAQ,IAAIzH,GAAJ,CAAQE,OAAOmC,IAAP,CAAY,KAAKe,UAAjB,CAAR,CAAR;AACD;;AAED,WAAKE,MAAL,CAAYpC,KAAZ,CAAkBuG,KAAlB;AACA,UAAI,CAAC,KAAKlE,WAAV,EAAuB;AACrB,aAAKA,WAAL,GAAmB,IAAnB;AACA,8BAAM,KAAKa,OAAX,EAAoBhN,IAApB,CAAyB,YAAM;AAC7B,iBAAKsD,IAAL;AACD,SAFD;AAGD;AACD;AACD;;;oCAEwD;AAAA,UAA3CgN,KAA2C,uEAAnC,2BAAmC;AAAA,UAAtB5B,MAAsB,uEAAb,WAAa;;AACvD;AACA,UAAI6B,WAAW,CAAC,EAAD,EAAK,CAAL,CAAf;AACA,UAAI;AACF,YAAI,CAAC,KAAKhD,UAAL,CAAgB/D,GAAhB,CAAoB8G,KAApB,CAAL,EAAiC;AAC/B,gBAAM,IAAIvR,KAAJ,CAAU,2CAAV,CAAN;AACD;;AAED;AACA,YAAI+J,OAAOmC,IAAP,CAAY,KAAKgB,eAAjB,EAAkCpD,OAAlC,CAA0CyH,KAA1C,MAAqD,CAAC,CAA1D,EAA6D;AAC3D,eAAKrE,eAAL,CAAqBqE,KAArB,IAA8B,CAA9B;AACD;;AAED,YAAME,YAAY,KAAKxE,UAAL,CAAgBsE,KAAhB,CAAlB;AACA,YAAMjD,SAAS,KAAKoD,UAAL,CAAgBH,KAAhB,CAAf;AACA,YAAM9B,UAAUgC,UAAUnD,OAAO1D,MAAP,EAAV,EAA2BxK,MAA3C;AACA,YAAMuR,YAAY,KAAKzE,eAAL,CAAqBqE,KAArB,CAAlB;;AAEA;AACA,YAAM5O,OAAOgN,WAAW,WAAX,GAAyB,EAAzB,GAA8B,EAA3C;AACA,YAAI5K,IAAI,CAAR;AACA,aAAK,IAAI5E,IAAIwR,SAAb,EAAwBxR,IAAIsP,OAA5B,EAAqCtP,GAArC,EAA0C;AACxC,cAAIwP,WAAW,WAAf,EAA4B;AAC1B,gBAAMxK,MAAM,EAAZ;AAD0B;AAAA;AAAA;;AAAA;AAE1B,oCAAoBmJ,MAApB,mIAA4B;AAAA,oBAAjBQ,KAAiB;;AAC1B,oBAAIA,UAAU,IAAd,EAAoB;;AAEpB,oBAAI2C,UAAU3C,KAAV,EAAiB1O,MAAjB,IAA2BD,CAA/B,EAAkC;AAChC,wBAAM,IAAIH,KAAJ,2CAAkD8O,KAAlD,0BAAN;AACD;AACD3J,oBAAI2J,KAAJ,IAAa2C,UAAU3C,KAAV,EAAiB3O,CAAjB,CAAb;AACD;AATyB;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;;AAW1BwC,iBAAK4B,IAAL,CAAUY,GAAV;AACD,WAZD,MAYO;AAAA;AAAA;AAAA;;AAAA;AACL,oCAAoBmJ,MAApB,mIAA4B;AAAA,oBAAjBQ,MAAiB;;AAC1B,oBAAIA,WAAU,IAAd,EAAoB;;AAEpB,oBAAI,CAACnM,KAAKgF,cAAL,CAAoBmH,MAApB,CAAL,EAAiC;AAC/BnM,uBAAKmM,MAAL,IAAc,EAAd;AACD;AACD,oBAAI2C,UAAU3C,MAAV,EAAiB1O,MAAjB,IAA2BD,CAA/B,EAAkC;AAChC,wBAAM,IAAIH,KAAJ,uCAA8C8O,MAA9C,0CAAN;AACD;AACDnM,qBAAKmM,MAAL,EAAY/J,CAAZ,EAAeR,IAAf,CAAoBkN,UAAU3C,MAAV,EAAiB3O,CAAjB,CAApB;AACD;AAXI;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;;AAYL4E,iBAAK,CAAL;AACD;AACF;AACDyM,mBAAW,CAAC7O,IAAD,EAAO8M,OAAP,CAAX;AACD,OA/CD,CA+CE,OAAO7M,CAAP,EAAU;AACV,mCAAWA,CAAX;AACD,OAjDD,SAiDU;AACR,eAAO4O,QAAP;AACD;AACF;;;2BAEM;AACL,WAAKpE,WAAL,GAAmB,CAAnB;AACA,WAAK,IAAIjN,IAAI,CAAb,EAAgBA,IAAI,KAAK6N,WAAL,CAAiB5N,MAArC,EAA6CD,GAA7C,EAAkD;AAChD,YAAM4P,aAAa,KAAK/B,WAAL,CAAiB7N,CAAjB,CAAnB;AACA,YAAI4P,WAAWvH,IAAX,KAAoB,KAAK+E,cAA7B,EAA6C;AAAA;AAAA;AAAA;;AAAA;AAC3C,kCAAoB,KAAKJ,MAAzB,mIAAiC;AAAA,kBAAtBoE,KAAsB;;AAC/B;AACA;AACA,kBAAK,KAAKxD,0BAAN,IAAsC,OAAO,KAAK6C,KAAL,CAAWb,WAAW1B,IAAtB,CAAP,KAAuC,WAA7E,IAA8F,KAAKuC,KAAL,CAAWb,WAAW1B,IAAtB,EAA4B1G,cAA5B,CAA2C,aAA3C,CAAlG,EAA8J;AAC5JoI,2BAAWM,WAAX,GAAyB,KAAKO,KAAL,CAAWb,WAAW1B,IAAtB,EAA4BgC,WAArD;AACD;;AAL8B,mCAOL,KAAKuB,aAAL,CAAmBL,KAAnB,CAPK;AAAA;AAAA,kBAOxB5M,IAPwB;AAAA,kBAOlBgN,SAPkB;;AAQ/B,kBAAMhP,OAAO;AACXyN,2BAAWL,WAAWvH,IADX;AAEX6H,6BAAaN,WAAWM,WAFb;AAGXC,uBAAOP,WAAWtM,GAHP;AAIXuM,2BAAW;AACTuB,8BADS;AAET5M;AAFS;AAJA,eAAb;;AAUA;AACA,+BAAE4L,IAAF,CAAO;AACLC,qBAAKT,WAAWU,QADX;AAELjI,sBAAM,MAFD;AAGL7F,sBAAMwJ,KAAKC,SAAL,CAAezJ,IAAf,CAHD;AAIL+N,6BAAa;AAJR,eAAP,EAMCC,IAND,CAMM,UAAUY,KAAV,EAAiBI,SAAjB,EAA4BhP,IAA5B,EAAkCF,MAAlC,EAA0C;AAC9C;AACA;AACA;AACA,qBAAKyK,eAAL,CAAqBqE,KAArB,IAA8BI,SAA9B;AACA,qBAAKxE,MAAL,CAAY/B,MAAZ,CAAmBmG,KAAnB;AACA,iGAA+D9O,MAA/D,EAAyEE,IAAzE;AACD,eAPK,CAOJlD,IAPI,CAOC,IAPD,EAOO8R,KAPP,EAOcI,SAPd,CANN,EAcCd,IAdD,CAcM,UAAUd,UAAV,EAAsBwB,KAAtB,EAA6BT,GAA7B,EAAkC;AAAA;;AACtC,oBAAMC,OAAOD,IAAIE,YAAJ,IAAoB,EAAEC,SAAS,EAAX,EAAeC,WAAW,KAA1B,EAAjC;AACA,oBAAIH,KAAKG,SAAT,EAAoB;AAClB,6CAAW,wEAAX;AACA;AACA,uBAAKjB,KAAL,CAAWF,UAAX,EAAuB9O,IAAvB,CAA4B,YAAM;AAAE,2BAAKgO,aAAL,CAAmBsC,KAAnB;AAA2B,mBAA/D;AACD,iBAJD,MAIO;AACL,mFAA+CA,KAA/C,qBAAsER,KAAKE,OAA3E;AACA,uBAAKhC,aAAL,CAAmBsC,KAAnB;AACD;AACF,eAVK,CAUJ9R,IAVI,CAUC,IAVD,EAUOsQ,UAVP,EAUmBwB,KAVnB,CAdN;AAyBD;AA7C0C;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AA8C5C;;AAED,YAAIxB,WAAWvH,IAAX,KAAoB,KAAKgF,iBAA7B,EAAgD;AAC9C;AACD;AACF;AACF;;;oCAEsC;AAAA;;AAAA,UAAzBwC,SAAyB,uEAAb,2BAAa;;AACrC,UAAM7L,WAAW,yBAAjB;AACA,UAAK,CAAC6L,UAAUrI,cAAV,CAAyB,MAAzB,CAAF,IAAwCqI,UAAUxH,IAAV,KAAmB,KAAK+E,cAApE,EAAqF;AACnF,YAAMsE,mBAAmB;AACvBrJ,gBAAM,KAAK+E,cADY;AAEvBc,gBAAM,IAFiB;AAGvBoC,oBAAU,IAHa;AAIvBJ,uBAAa,IAJU;AAKvB5M,eAAK,KAAKkK,SALa;AAMvBmE,sBAAY,KAAKC,gBANM;AAOvB9B,iBAAO,KAAKvC;AAPW,SAAzB;;AAWA,YAAMqC,aAAa,iBAAElE,MAAF,CAASgG,gBAAT,EAA2B7B,SAA3B,CAAnB;AACA,YAAID,WAAWU,QAAX,KAAwB,IAA5B,EAAkC;AAChCV,qBAAW1B,IAAX,GAAkB0B,WAAW1B,IAAX,IAAmB0B,WAAWvH,IAAhD;;AAEA,cAAIuH,WAAWM,WAAX,KAA2B,IAA/B,EAAqC;AACnC,iBAAKJ,KAAL,CAAWF,UAAX,EAAuBA,WAAWM,WAAlC,EACCpP,IADD,CACM,YAAM;AACV,qBAAK+M,WAAL,CAAiBzJ,IAAjB,CAAsBwL,UAAtB;AACA5L,uBAAS9C,OAAT,CAAiB0O,UAAjB;AACD,aAJD;AAKD,WAND,MAMO;AACL,iBAAK/B,WAAL,CAAiBzJ,IAAjB,CAAsBwL,UAAtB;AACA5L,qBAAS9C,OAAT,CAAiB0O,UAAjB;AACD;AACF,SAbD,MAaO;AACL5L,mBAAS7B,MAAT,CAAgB,uDAAhB;AACD;AACF,OA7BD,MA6BO;AACL6B,iBAAS7B,MAAT,CAAgB,wDAAhB;AACD;AACD,aAAO6B,SAASzB,OAAhB;AACD;;AAED;;AAGA;;;;;;;;wBAKiB;AACf,aAAQ,IAAImH,GAAJ,CAAQE,OAAOmC,IAAP,CAAY,KAAKe,UAAjB,CAAR,CAAR;AACD,K;sBAEc9D,K,EAAO;AACpB,YAAM,IAAInJ,KAAJ,CAAU,mCAAV,CAAN;AACD;;AAED;;;;;;;;wBAKgB;AACd,aAAQ,KAAKgS,UAAb;AACD,K;sBAEa7I,K,EAAO;AACnB,YAAM,IAAInJ,KAAJ,CAAU,mCAAV,CAAN;AACD;;AAED;;;;wBACgB;AACd,UAAI,KAAKiS,SAAL,CAAe1D,EAAf,CAAkBnO,MAAlB,GAA2B,CAA/B,EAAkC;AAChC,eAAQ,iBAAEqB,GAAF,CAAM,KAAKwQ,SAAL,CAAe1D,EAArB,IAA2B,CAAnC;AACD;AACD,aAAQ,CAAR;AACD,K;sBAGapF,K,EAAO;AACnB,UAAIA,MAAM1I,WAAN,sBAAJ,EAAkC;AAChC,aAAKyR,aAAL,GAAqB/I,KAArB,CADgC,CACL;AAC3B5J,gBAAQC,GAAR,6CAAoD2J,KAApD;AACD,OAHD,MAGO;AACL,cAAM,IAAInJ,KAAJ,CAAU,qCAAV,CAAN;AACD;AACF;;;;;;kBAlzBkBwM,W;;;;;;;;;;;;;qjBCdrB;;;AACA;;;;AACA;;;;AACA;;;;;;;;AAEA;IACqB2F,gB;AACnB;;;;;;;;;;AAUA,8BAA0B;AAAA;;AACxB;AACA,SAAKC,eAAL,GAAuB,IAAvB;AACA,SAAKC,eAAL,GAAuB,KAAKD,eAA5B;;AAEA;AACA,SAAKzP,IAAL,GAAY,EAAZ;;AAEA;;AAEA;;;;;;AAMA,SAAK2P,SAAL,GAAiB,IAAjB;;AAEA;;;;;;;AAOA,SAAKC,OAAL,GAAe,IAAf;;AAGA;;AA5BwB,sCAAXC,SAAW;AAAXA,eAAW;AAAA;;AA6BxB,SAAKC,QAAL,CAAcD,SAAd;AACD;;AAED;;AAEA;;;;;;;;;;;;;;;+BAWuB;AAAA;;AACrB,UAAI,KAAKD,OAAL,KAAiB,KAArB,EAA4B;AAC1B,cAAM,IAAIvS,KAAJ,CAAU,oFAAV,CAAN;AACD;;AAED,UAAM0S,kBAAkB,YAAGtQ,MAAH,uBAAxB;;AAEA,WAAKuQ,KAAL,GAAa,EAAb;AACA,UAAMC,WAAW,EAAjB;AACA,WAAK,IAAIzS,IAAI,CAAb,EAAgBA,IAAIuS,gBAAgBtS,MAApC,EAA4CD,GAA5C,EAAiD;AAC/C,YAAI,KAAK0S,eAAL,CAAqBH,gBAAgBvS,CAAhB,CAArB,CAAJ,EAA8C;AAC5C,eAAKwS,KAAL,CAAWxS,CAAX,IAAgB,EAAhB;AACA,eAAKwS,KAAL,CAAWxS,CAAX,EAAcqI,IAAd,GAAqB,KAAKsK,SAAL,CAAeJ,gBAAgBvS,CAAhB,CAAf,CAArB;AACA,eAAKwS,KAAL,CAAWxS,CAAX,EAAc4S,IAAd,GAAqBL,gBAAgBvS,CAAhB,CAArB;AACA,eAAKwS,KAAL,CAAWxS,CAAX,EAAc6S,MAAd,GAAuB,KAAvB,CAJ4C,CAIf;AAC7B,eAAKL,KAAL,CAAWxS,CAAX,EAAc8S,SAAd,GAA0B,KAA1B,CAL4C,CAKZ;AAChC,eAAKN,KAAL,CAAWxS,CAAX,EAAc+S,KAAd,GAAsB,KAAtB,CAN4C,CAMhB;AAC5B,eAAKP,KAAL,CAAWxS,CAAX,EAAcgT,GAAd,GAAoB,KAApB;AACA,eAAKR,KAAL,CAAWxS,CAAX,EAAcwC,IAAd,GAAqB,IAArB;AACAiQ,mBAASrO,IAAT,CAAc,KAAK6O,QAAL,CAAcjT,CAAd,CAAd;AACD,SAVD,MAUO;AACLZ,kBAAQI,IAAR,kDAA4D+S,gBAAgBvS,CAAhB,CAA5D;AACD;AACF;;AAED,aAAO,mBAAQsE,GAAR,CAAYmO,QAAZ,CAAP;AACD;;AAGD;;;;;;;;;;;;+BASkC;AAAA,UAAzBS,SAAyB,uEAAb,2BAAa;;AAChC,UAAMC,WAAW,yBAAjB;;AAEA,UAAI,OAAO,KAAKX,KAAL,CAAWU,SAAX,CAAP,KAAiC,WAArC,EAAkD;AAChD,eAAOC,SAAShR,MAAT,CAAgB,4DAAhB,CAAP;AACD;;AAED,UAAMiR,aAAa,IAAnB;AACA,uBAAEhD,IAAF,CAAO;AACL/H,cAAM,KADD;AAELgI,aAAK,KAAKmC,KAAL,CAAWU,SAAX,EAAsBN,IAFtB;AAGLS,qBAAa;AAHR,OAAP,EAIG7C,IAJH,CAIQ,UAAChO,IAAD,EAAO8Q,UAAP,EAAmBC,KAAnB,EAA6B;AACnCH,mBAAWZ,KAAX,CAAiBU,SAAjB,EAA4BL,MAA5B,GAAqC,IAArC;AACAO,mBAAWZ,KAAX,CAAiBU,SAAjB,EAA4BF,GAA5B,GAAkCxQ,IAAlC;;AAEA,YAAI;AACF4Q,qBAAWI,QAAX,CAAoBN,SAApB;AACD,SAFD,CAEE,OAAOzQ,CAAP,EAAU;AACV0Q,mBAAShR,MAAT,CAAgBM,CAAhB;AACD,SAJD,SAIU;AACR0Q,mBAASjS,OAAT,iCAA+CkS,WAAWZ,KAAX,CAAiBU,SAAjB,EAA4BN,IAA3E;AACD;AACF,OAfD;;AAiBA,aAAOO,SAAS5Q,OAAhB;AACD;;;+BAEiC;AAAA,UAAzB2Q,SAAyB,uEAAb,2BAAa;;AAChC,UAAI,OAAO,KAAKV,KAAL,CAAWU,SAAX,CAAP,KAAiC,WAArC,EAAkD;AAChD,cAAM,IAAIrT,KAAJ,CAAU,4DAAV,CAAN;AACD;;AAED,UAAM4T,OAAO,KAAKjB,KAAL,CAAWU,SAAX,CAAb;;AAEA,UAAIO,KAAKT,GAAL,KAAa,IAAjB,EAAuB;AACrB,cAAM,IAAInT,KAAJ,CAAU,8DAAV,CAAN;AACD,OAFD,MAEO,IAAI4T,KAAKT,GAAL,CAAS1S,WAAT,KAAyBoC,MAA7B,EAAqC;AAC1C,YAAIgR,eAAJ;AACA,YAAIC,MAAM,IAAV;AACA,gBAAQF,KAAKpL,IAAb;AACE,eAAK,MAAL;AACA;AACEqL,qBAAS1H,KAAKkF,KAAd;AACA;AACF,eAAK,KAAL;AACA;AACEwC,qBAAS,iBAAEE,GAAF,CAAMC,SAAf;AACA;AACF,eAAK,KAAL;AACA;AACE,gBAAIC,OAAOC,SAAX,EAAsB;AACpBL,uBAAS,IAAIK,SAAJ,EAAT;AACAL,uBAASA,OAAOM,eAAhB;AACAL,oBAAM,UAAN;AACD,aAJD,MAIO;AACL;AACAD,uBAAS,IAAII,OAAOG,aAAX,CAAyB,kBAAzB,CAAT;AACAP,qBAAOQ,KAAP,GAAe,KAAf;AACAR,uBAASA,OAAOS,OAAhB;AACD;AACD;AACF;AACE,kBAAM,IAAItU,KAAJ,CAAU,+DAAV,CAAN;AAvBJ;;AA0BA,YAAI;AACF,cAAI8T,GAAJ,EAAS;AACPF,iBAAKjR,IAAL,GAAYkR,OAAOD,KAAKT,GAAZ,EAAiBW,GAAjB,CAAZ;AACD,WAFD,MAEO;AACLF,iBAAKjR,IAAL,GAAYkR,OAAOD,KAAKT,GAAZ,CAAZ;AACD;AACF,SAND,CAME,OAAOvQ,CAAP,EAAU;AACVgR,eAAKX,SAAL,GAAiB,KAAjB;AACAW,eAAKjR,IAAL,GAAY,IAAZ;AACA,gBAAM,IAAI3C,KAAJ,CAAU4C,CAAV,CAAN;AACD,SAVD,SAUU;AACR;AACAgR,eAAKX,SAAL,GAAiB,IAAjB;;AAEA;AACA,eAAKsB,aAAL;AACD;AACF,OA9CM,MA8CA,IAAIX,KAAKT,GAAL,CAAS1S,WAAT,KAAyBsJ,MAA7B,EAAqC;AAC1C6J,aAAKjR,IAAL,GAAYiR,KAAKT,GAAjB;AACA;AACAS,aAAKX,SAAL,GAAiB,IAAjB;;AAEA;AACA,aAAKsB,aAAL;AACD,OAPM,MAOA;AACL,cAAM,IAAIvU,KAAJ,CAAU,oDAAV,CAAN;AACD;AACF;;;oCAEe;AACd;AACA,WAAK,IAAIG,IAAI,CAAb,EAAgBA,IAAI,KAAKwS,KAAL,CAAWvS,MAA/B,EAAuCD,GAAvC,EAA4C;AAC1C,YAAK,KAAKwS,KAAL,CAAWxS,CAAX,EAAc8S,SAAd,KAA4B,KAA7B,IAAwC,KAAKN,KAAL,CAAWxS,CAAX,EAAcwC,IAAtD,IAAgE,CAAC,KAAKgQ,KAAL,CAAWxS,CAAX,EAAc+S,KAAnF,EAA2F;AACzF,cAAMvQ,OAAO,KAAKgQ,KAAL,CAAWxS,CAAX,EAAcwC,IAA3B;AACA,cAAMuJ,OAAOnC,OAAOmC,IAAP,CAAYvJ,IAAZ,CAAb;AACA,eAAK,IAAIoC,IAAI,CAAb,EAAgBA,IAAImH,KAAK9L,MAAzB,EAAiC2E,GAAjC,EAAsC;AACpC,iBAAKyP,cAAL,CAAoBtI,KAAKnH,CAAL,CAApB,EAA6BpC,KAAKuJ,KAAKnH,CAAL,CAAL,CAA7B;AACD;;AAED,eAAK4N,KAAL,CAAWxS,CAAX,EAAc+S,KAAd,GAAsB,IAAtB;AACD;AACF;AACF;;AAGD;;;;;;;;;;;;;;;;qCAa4E;AAAA,UAA7DuB,OAA6D,uEAAnD,2BAAmD;AAAA,UAAtC9R,IAAsC,uEAA/B,2BAA+B;AAAA,UAAlB2P,SAAkB,uEAAN,IAAM;;AAC1E,UAAIoC,QAAQ/R,IAAZ;AACA,UAAI4L,WAAJ;AACA,UAAI5L,KAAKlC,WAAL,KAAqBsJ,MAAzB,EAAiC;AAAE;AACjCwE,aAAKkG,OAAL;AACAA,kBAAa9R,KAAKlC,WAAL,CAAiB4N,IAAjB,CAAsBsG,WAAtB,EAAb;AACAD,oCACGnG,EADH,EACQ5L,IADR;AAGD;;AAED,UAAI,OAAO,KAAKA,IAAL,CAAU8R,OAAV,CAAP,KAA8B,WAAlC,EAA+C;AAC7C,aAAK9R,IAAL,CAAU8R,OAAV,IAAqB,EAArB;AACD;;AAED,UAAInC,cAAc,IAAlB,EAAwB;AACtBA,oBAAY,KAAKA,SAAjB;AACD;;AAED,UAAIA,SAAJ,EAAe;AACb,aAAK3P,IAAL,CAAU8R,OAAV,IAAqB,KAAK5I,MAAL,CAAY,KAAKlJ,IAAL,CAAU8R,OAAV,CAAZ,EAAgCC,KAAhC,CAArB;AACD,OAFD,MAEO;AACL,aAAK/R,IAAL,CAAU8R,OAAV,IAAqB,KAAK5I,MAAL,CAAY6I,KAAZ,EAAmB,KAAK/R,IAAL,CAAU8R,OAAV,CAAnB,CAArB;AACD;AACF;;AAGD;;;;;;;;;;gCAOiC;AAAA,UAAvBA,OAAuB,uEAAb,2BAAa;;AAC/B,UAAI,KAAK9R,IAAL,CAAUgF,cAAV,CAAyB8M,OAAzB,CAAJ,EAAuC;AACrC,eAAO1K,OAAOmC,IAAP,CAAY,KAAKvJ,IAAL,CAAU8R,OAAV,CAAZ,EAAgCrU,MAAvC;AACD;AACD,aAAO,CAAP;AACD;;AAGD;;;;;;;;;;;;;;0BAW4C;AAAA,UAAxCE,MAAwC,uEAA/B,2BAA+B;AAAA,UAAlBgS,SAAkB,uEAAN,IAAM;;AAC1C,UAAIhS,OAAOG,WAAP,KAAuBsJ,MAA3B,EAAmC;AACjC,cAAM,IAAI/J,KAAJ,CAAU,yDAAV,CAAN;AACD;AACD,UAAM4U,eAAe,KAAKtC,SAA1B;AACA,UAAIA,cAAc,IAAlB,EAAwB;AACtBA,oBAAYsC,YAAZ;AACD,OAFD,MAEO;AACL,aAAKtC,SAAL,GAAiBA,SAAjB;AACD;;AAED,UAAMpG,OAAOnC,OAAOmC,IAAP,CAAY5L,MAAZ,CAAb;AACA,WAAK,IAAIH,IAAI,CAAb,EAAgBA,IAAI+L,KAAK9L,MAAzB,EAAiCD,GAAjC,EAAsC;AACpC,YAAIG,OAAO4L,KAAK/L,CAAL,CAAP,EAAgBM,WAAhB,KAAgCsJ,MAApC,EAA4C;AAC1C,eAAKyK,cAAL,CAAoBtI,KAAK/L,CAAL,CAApB,EAA6BG,OAAO4L,KAAK/L,CAAL,CAAP,CAA7B;AACD,SAFD,MAEO,IAAIG,OAAO4L,KAAK/L,CAAL,CAAP,EAAgBM,WAAhB,KAAgCC,KAApC,EAA2C;AAChD,eAAKmU,SAAL,CAAe3I,KAAK/L,CAAL,CAAf,EAAwBG,OAAO4L,KAAK/L,CAAL,CAAP,CAAxB,EAAyC,QAAzC;AACD,SAFM,MAEA;AACL,eAAK0U,SAAL,CAAe3I,KAAK/L,CAAL,CAAf,EAAwBG,OAAO4L,KAAK/L,CAAL,CAAP,CAAxB;AACD;AACF;;AAED,WAAKmS,SAAL,GAAiBsC,YAAjB;AACD;;AAGD;;;;;;;;;;;;;;;;gCAa0F;AAAA,UAAhFvG,IAAgF,uEAAzE,2BAAyE;AAAA,UAA5DlF,KAA4D,uEAApD,2BAAoD;AAAA,UAAvCsL,OAAuC,uEAA7B,SAA6B;AAAA,UAAlBnC,SAAkB,uEAAN,IAAM;;AACxF,UAAI,OAAO,KAAK3P,IAAL,CAAU8R,OAAV,CAAP,KAA8B,WAAlC,EAA+C;AAC7C,aAAK9R,IAAL,CAAU8R,OAAV,IAAqB,EAArB;AACD;;AAED,UAAInC,cAAc,IAAlB,EAAwB;AACtBA,oBAAY,KAAKA,SAAjB;AACD;;AAED,UAAI,CAAE,KAAK3P,IAAL,CAAU8R,OAAV,EAAmB9M,cAAnB,CAAkC0G,IAAlC,CAAF,IAA8CiE,SAAlD,EAA6D;AAC3D/S,gBAAQI,IAAR,4DAAsE0O,IAAtE;AACA,aAAK1L,IAAL,CAAU8R,OAAV,EAAmBpG,IAAnB,IAA2BlF,KAA3B;AACD;AACF;;AAED;;;;;;;;;;;gCAQkC;AAAA,UAAxB2L,QAAwB,uEAAb,2BAAa;;AAChC;AACA;AACA;AACA,aAAOA,SAAShO,MAAT,CAAgB,CAAC,CAAC,CAACgO,SAASC,WAAT,CAAqB,GAArB,CAAF,KAAgC,CAAjC,IAAsC,CAAtD,CAAP,CAJgC,CAIgC;AACjE;;;sCAEuC;AAAA,UAAxBD,QAAwB,uEAAb,2BAAa;;AACtC,UAAME,eAAe,CAAC,MAAD,EAAS,KAAT,EAAgB,KAAhB,CAArB;AACA,UAAIA,aAAalL,OAAb,CAAqB,KAAKgJ,SAAL,CAAegC,QAAf,CAArB,MAAmD,CAAC,CAAxD,EAA2D;AACzD,eAAO,IAAP;AACD;AACD,aAAO,KAAP;AACD;;AAED;;;;;;;;;;gCAO0C;AAAA,UAAhCG,gBAAgC,uEAAb,2BAAa;;AACxC,UAAIA,iBAAiBxU,WAAjB,KAAiC0R,gBAArC,EAAuD;AACrD,cAAM,IAAInS,KAAJ,CAAU,0FAAV,CAAN;AACD;;AAED,UAAMkV,mBAAmB,KAAKC,SAA9B;AACA,UAAMC,mBAAmBH,iBAAiBE,SAA1C;;AAEA,WAAK,IAAIhV,IAAI,CAAb,EAAgBA,IAAIiV,iBAAiBhV,MAArC,EAA6CD,GAA7C,EAAkD;AAChD,YAAI+U,iBAAiBpL,OAAjB,CAAyBsL,iBAAiBjV,CAAjB,CAAzB,MAAkD,CAAC,CAAvD,EAA0D;AACxD,eAAKwC,IAAL,CAAUyS,iBAAiBjV,CAAjB,CAAV,IAAiC8U,iBAAiBtS,IAAjB,CAAsByS,iBAAiBjV,CAAjB,CAAtB,CAAjC;AACD,SAFD,MAEO;AACL,eAAKwC,IAAL,CAAUyS,iBAAiBjV,CAAjB,CAAV,IAAiC,KAAK0L,MAAL,CAAY,KAAKlJ,IAAL,CAAUyS,iBAAiBjV,CAAjB,CAAV,CAAZ,EAA4C8U,iBAAiBtS,IAAjB,CAAsByS,iBAAiBjV,CAAjB,CAAtB,CAA5C,CAAjC;AACD;AACF;AACF;;AAGD;;;;;;;;;;8BAOqB;AACnB,UAAI8C,eAAJ;;AADmB,yCAAVkO,QAAU;AAAVA,gBAAU;AAAA;;AAEnB,UAAIA,SAAS/Q,MAAT,KAAoB,CAAxB,EAA2B;AACzB,YAAI,KAAKuC,IAAL,CAAUgF,cAAV,CAAyBwJ,QAAzB,CAAJ,EAAwC;AACtClO,mBAAS,KAAKN,IAAL,CAAUwO,QAAV,CAAT;AACD,SAFD,MAEO;AACL,cAAMgE,YAAY,KAAKA,SAAvB;AACA,eAAK,IAAIhV,IAAI,CAAb,EAAgBA,IAAIgV,UAAU/U,MAA9B,EAAsCD,GAAtC,EAA2C;AACzC,gBAAI,KAAKwC,IAAL,CAAUwS,UAAUhV,CAAV,CAAV,EAAwBwH,cAAxB,CAAuCwJ,QAAvC,CAAJ,EAAsD;AACpDlO,uBAAS,KAAKN,IAAL,CAAUwS,UAAUhV,CAAV,CAAV,EAAwBgR,QAAxB,CAAT;AACA;AACD;AACF;AACF;AACF,OAZD,MAYO,IAAIA,SAAS/Q,MAAT,GAAkB,CAAtB,EAAyB;AAC9B6C,iBAAS,EAAT;AACA,aAAK,IAAI9C,KAAI,CAAb,EAAgBA,KAAIgR,SAAS/Q,MAA7B,EAAqCD,IAArC,EAA0C;AACxC8C,iBAAOkO,SAAShR,EAAT,CAAP,IAAsB,KAAKkV,OAAL,CAAalE,SAAShR,EAAT,CAAb,CAAtB;AACD;AACF;;AAED,aAAO8C,MAAP;AACD;;AAGD;;;;;;;;;;;;;;6BAWgB;AACd;AACA,UAAMqS,WAAW,EAAjB;AACA,UAAIC,OAAO,KAAX;AACA,UAAIpV,IAAI,CAAR;AACA,UAAMC,SAAS,UAAKA,MAApB;;AAEA;AACA,UAAI2J,OAAOvD,SAAP,CAAiBgP,QAAjB,CAA0BC,IAA1B,uDAA4C,kBAAhD,EAAoE;AAClEF;AACApV,aAAK,CAAL;AACD;;AAED;AACA,UAAMuV,QAAQ,SAARA,KAAQ,CAAUC,GAAV,EAAe;AAC3B,aAAK,IAAMC,IAAX,IAAmBD,GAAnB,EAAwB;AACtB,cAAI5L,OAAOvD,SAAP,CAAiBmB,cAAjB,CAAgC8N,IAAhC,CAAqCE,GAArC,EAA0CC,IAA1C,CAAJ,EAAqD;AACnD;AACA,gBAAIL,QAAQxL,OAAOvD,SAAP,CAAiBgP,QAAjB,CAA0BC,IAA1B,CAA+BE,IAAIC,IAAJ,CAA/B,MAA8C,iBAA1D,EAA6E;AAC3EN,uBAASM,IAAT,IAAiB,KAAK/J,MAAL,CAAY,IAAZ,EAAkByJ,SAASM,IAAT,CAAlB,EAAkCD,IAAIC,IAAJ,CAAlC,CAAjB;AACD,aAFD,MAEO;AACLN,uBAASM,IAAT,IAAiBD,IAAIC,IAAJ,CAAjB;AACD;AACF;AACF;AACF,OAXD;;AAaA;AACA,aAAOzV,IAAIC,MAAX,EAAmBD,GAAnB,EAAwB;AACtB,YAAMwV,0BAAWxV,CAAX,yBAAWA,CAAX,CAAN;AACAuV,cAAMC,GAAN;AACD;;AAED,aAAOL,QAAP;AACD;;AAGD;;;;;;;;wBAKgB;AACd,aAAOvL,OAAOmC,IAAP,CAAY,KAAKvJ,IAAjB,CAAP;AACD;;;wBAES;AACR,aAAO,IAAIkT,KAAJ,CAAU,IAAV,EAAgB;AACrBC,WADqB,eACjB/T,MADiB,EACTgU,UADS,EACG;AACtB,cAAI,OAAOhU,OAAO+T,GAAP,CAAWC,UAAX,CAAP,KAAkC,WAAtC,EAAmD;AACjD,mBAAO,KAAP;AACD;AACD,iBAAO,IAAP;AACD;AANoB,OAAhB,CAAP;AAQD;;;wBAES;AACR,aAAO,IAAIF,KAAJ,CAAU,IAAV,EAAgB;AACrBC,WADqB,eACjB/T,MADiB,EACTgU,UADS,EACG;AACtB,cAAMhD,OAAOgD,WAAWC,KAAX,CAAiB,GAAjB,CAAb;AACA,cAAMb,YAAYpT,OAAOoT,SAAzB;AACA,cAAIc,kBAAkBlU,OAAOsQ,eAA7B;AACA,cAAI6D,iBAAiB,SAArB;AACA,cAAIC,wBAAJ;AACA,cAAIC,uBAAuB,KAA3B;AACA,eAAK,IAAIjW,IAAI,CAAb,EAAgBA,IAAI4S,KAAK3S,MAAzB,EAAiCD,GAAjC,EAAsC;AACpC,gBAAIgV,UAAUrL,OAAV,CAAkBiJ,KAAK5S,CAAL,CAAlB,MAA+B,CAAC,CAApC,EAAuC;AACrC+V,+BAAiBnD,KAAK5S,CAAL,CAAjB;AACAiW,qCAAuB,IAAvB;AACD,aAHD,MAGO,IAAIrD,KAAK5S,CAAL,EAAQC,MAAR,KAAmB,CAAvB,EAA0B;AAC/B6V,gCAAkBlD,KAAK5S,CAAL,CAAlB;AACD,aAFM,MAEA;AACL,kBAAI,OAAOgW,eAAP,KAA2B,WAA/B,EAA4C;AAC1C5W,wBAAQM,KAAR,4EAAuFsW,eAAvF,aAA8GpD,KAAK5S,CAAL,CAA9G;AACA,uBAAO2I,SAAP;AACD;AACDqN,gCAAkBpD,KAAK5S,CAAL,CAAlB;AACD;AACF;;AAED,cAAI,OAAOgW,eAAP,KAA2B,WAA/B,EAA4C;AAC1C,gBAAIC,oBAAJ,EAA0B;AACxBD,gCAAkBD,cAAlB;AACD,aAFD,MAEO;AACL,8FAA8DH,UAA9D;AACA,qBAAOjN,SAAP;AACD;AACF;;AAED,cAAI7F,eAAJ;AACA,cAAKlB,OAAOY,IAAP,CAAYgF,cAAZ,CAA2BuO,cAA3B,CAAD,IAAiDnU,OAAOY,IAAP,CAAYuT,cAAZ,EAA4BvO,cAA5B,CAA2CwO,eAA3C,CAArD,EAAmH;AACjHlT,qBAASlB,OAAOY,IAAP,CAAYuT,cAAZ,EAA4BC,eAA5B,CAAT;AACD,WAFD,MAEO;AACLlT,qBAASlB,OAAOsT,OAAP,CAAec,eAAf,CAAT;AACA,gBAAI,OAAOlT,MAAP,KAAkB,WAAtB,EAAmC;AACjC1D,sBAAQM,KAAR,kDAA6DqW,cAA7D,SAA+EC,eAA/E;AACA,qBAAOrN,SAAP;AACD;AACF;;AAED,cAAI7F,OAAOxC,WAAP,KAAuBsJ,MAA3B,EAAmC;AACjC,mBAAO9G,MAAP;AACD,WAFD,MAEO,IAAIA,OAAO0E,cAAP,CAAsBsO,eAAtB,CAAJ,EAA4C;AACjD,mBAAOhT,OAAOgT,eAAP,CAAP;AACD,WAFM,MAEA,IAAIhT,OAAO0E,cAAP,CAAsB5F,OAAOsQ,eAA7B,CAAJ,EAAmD;AACxD9S,oBAAQI,IAAR,6DAAuEoC,OAAOsQ,eAA9E;AACA,mBAAOpP,OAAOlB,OAAOsQ,eAAd,CAAP;AACD;AACD9S,kBAAQI,IAAR,CAAa,kFAAb;AACA,iBAAOsD,MAAP;AACD;AArDoB,OAAhB,CAAP;AAwDD;;;;;;kBAlhBkBkP,gB;;;;;;;;;;;;;;ACLrB;;;AACA;;;;AACA;;;;AACA;;;;AACA;;;;;;AAEA;IACqBkE,K;;AAGnB;;;;;AAKA,mBAAgE;AAAA,QAApDC,YAAoD,uEAArC,2BAAqC;AAAA,QAAxBC,QAAwB,uEAAb,2BAAa;;AAAA;;AAC9D,SAAKC,aAAL,GAAqBF,YAArB;AACA,SAAK3J,OAAL,GAAe2J,aAAa3J,OAA5B;AACA,SAAK8J,YAAL,GAAoBH,aAAaG,YAAjC;;AAEA,SAAKF,QAAL,GAAgBA,QAAhB;;AAEA;;;;;AAKA,SAAKG,eAAL,GAAuB,EAAvB;;AAEA;;;;;;AAMA,SAAKC,mBAAL,GAA2B,EAA3B;;AAEA;;;;;;AAMA,SAAKC,gBAAL,GAAwB,EAAxB;;AAEA;;;;;AAKA,SAAKC,gBAAL,GAAwB,EAAxB;;AAEA;;;;AAIA,SAAKC,aAAL,GAAqB,EAArB;;AAEA;;;;AAIA,SAAKC,SAAL,GAAiB,IAAjB;;AAEA;;;;;AAKA,SAAKC,YAAL,GAAoB,EAApB;AACD;;AAED;;AAEA;;AAEA;;;;;;;;4BAIsB;AAAA,UAAhBC,MAAgB,uEAAP,KAAO;;AACpB,UAAIA,MAAJ,EAAY;AACV,YAAI,KAAKF,SAAL,KAAmB,IAAvB,EAA6B;AAC3B,eAAKA,SAAL,GAAiB,IAAjB;AACA,eAAKD,aAAL,GAAqB,EAArB;AACA,eAAKR,YAAL,CAAkBY,iBAAlB,CAAoC,KAAKX,QAAzC;AACD;AACD;AACD;;AAED;AACA,UAAI,KAAKQ,SAAL,KAAmB,IAAvB,EAA6B;AAC3B,aAAKI,QAAL;AACD,OAFD,MAEO;AACL,YAAI,OAAO,KAAKxK,OAAL,CAAayK,QAApB,KAAiC,WAArC,EAAkD;AAAE,mCAAY,KAAKb,QAAjB,kBAAsC,KAAK5J,OAAL,CAAayK,QAAnD;AAAwE;;AAE5H,YAAMC,kBAAkB,EAAxB;AACA,aAAK,IAAIlX,IAAI,CAAb,EAAgBA,IAAI,KAAKwW,mBAAL,CAAyBvW,MAA7C,EAAqDD,GAArD,EAA0D;AACxDkX,0BAAgBlX,CAAhB,IAAqB,mBAAQmX,MAAR,CAAe,KAAKX,mBAAL,CAAyBxW,CAAzB,EAA4BV,IAA5B,CAAiC,KAAK8X,OAAtC,CAAf,GAArB;AACD;;AAED,2BAAQ9S,GAAR,CAAY4S,eAAZ,EAA6BpW,IAA7B,CAAkC,YAAM;AACtC;AACA,mCAAS,mDAAT,EAA8DoW,eAA9D;AACD,SAHD,EAGGnW,KAHH,CAGS,UAACrB,KAAD,EAAW;AAClB;AACA,qCAAWA,KAAX;AACD,SAND;AAOD;AACF;;AAED;;;;;;;0BAIM;AAAA;;AACJ,UAAI,KAAKkX,SAAL,KAAmB,IAAvB,EAA6B;AAC3B,YAAMM,kBAAkB,EAAxB;AACA,aAAK,IAAIlX,IAAI,CAAb,EAAgBA,IAAI,KAAKyW,gBAAL,CAAsBxW,MAA1C,EAAkDD,GAAlD,EAAuD;AACrDkX,0BAAgBlX,CAAhB,IAAqB,mBAAQmX,MAAR,CAAe,KAAKV,gBAAL,CAAsBzW,CAAtB,EAAyBV,IAAzB,CAA8B,KAAK8X,OAAnC,CAAf,GAArB;AACD;;AAED,2BAAQ9S,GAAR,CAAY4S,eAAZ,EAA6BpW,IAA7B,CAAkC,UAAC0B,IAAD,EAAU;AAC5C;AACE,mCAAS,gDAAT,EAA2D0U,eAA3D;AACA,mCAAY,MAAKd,QAAjB;AACA,iBAAO5T,IAAP;AACD,SALD,EAKGzB,KALH,CAKS,UAACrB,KAAD,EAAW;AACpB;AACE,qCAAWA,KAAX;AACA,iBAAO,IAAP;AACD,SATD;AAUD;AACF;;;6BAEQ;AACP,UAAK,KAAKkX,SAAL,KAAmB,IAApB,IAA8B,KAAKP,aAAL,CAAmBgB,UAAnB,CAA8BpX,MAAhE,EAAyE;AACvE,YAAIqX,kBAAJ;AACA,YAAMC,SAAS,KAAKlB,aAAL,CAAmBmB,oBAAnB,CAAwC,KAAKpB,QAA7C,CAAf;AACA,aAAK,IAAIpW,IAAI,CAAb,EAAgBA,IAAIuX,OAAOtX,MAA3B,EAAmCD,GAAnC,EAAwC;AACtCsX,sBAAYC,OAAOvX,CAAP,CAAZ;AACA,8DAAkCsX,UAAUnM,IAA5C;;AAEA,eAAKsM,WAAL,CAAiBH,SAAjB;AACD;AACD;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACD;;AAED;AACD;;AAED;;;;gCAEYI,K,EAAO;AACjB;AACA;AACA;AACA,UAAI,KAAKC,gBAAL,CAAsBD,MAAMvM,IAA5B,CAAJ,EAAuC;AACrC;AACA,YAAMyM,iBAAiB,KAAKrB,eAAL,CAAqBmB,MAAMvM,IAA3B,CAAvB;AACA,YAAIyM,eAAetX,WAAf,KAA+BC,KAAnC,EAA0C;AACxC,eAAK,IAAIP,IAAI,CAAb,EAAgBA,IAAI4X,eAAe3X,MAAnC,EAA2CD,GAA3C,EAAgD;AAC9C,+BAAQmX,MAAR,CAAeS,eAAe5X,CAAf,EAAkBV,IAAlB,CAAuB,KAAK8X,OAA5B,CAAf,EAAqDM,KAArD,EACG5W,IADH,CACQ,UAAU+W,YAAV,EAAwBrV,IAAxB,EAA8B;AAClC;AACA,uCAASA,IAAT;AACA,kBAAMsV,aAAa,iBAAEC,SAAF,CAAYL,KAAZ,CAAnB;AACAI,yBAAWtV,IAAX,CAAgBwV,gBAAhB,GAAmCH,YAAnC;AACA,mBAAKxB,aAAL,CAAmB4B,6BAAnB,CAAiDH,UAAjD;AACD,aANK,CAMJxY,IANI,CAMC,IAND,EAMOsY,eAAe5X,CAAf,EAAkBkO,IANzB,CADR,EAQGnN,KARH,CAQS,UAACrB,KAAD,EAAW;AAChB;AACA,yCAAWA,KAAX;AACD,aAXH;AAYD;AACF,SAfD,MAeO;AACL,6BAAQyX,MAAR,CAAeS,eAAetY,IAAf,CAAoB,KAAK8X,OAAzB,CAAf,IACGtW,IADH,CACQ,UAAU+W,YAAV,EAAwBrV,IAAxB,EAA8B;AAClC;AACA,qCAASA,IAAT;AACA,gBAAMsV,aAAa,iBAAEC,SAAF,CAAYL,KAAZ,CAAnB;AACAI,uBAAWtV,IAAX,CAAgBwV,gBAAhB,GAAmCH,YAAnC;AACA,iBAAKxB,aAAL,CAAmB4B,6BAAnB,CAAiDH,UAAjD;AACD,WANK,CAMJxY,IANI,CAMC,IAND,EAMOsY,eAAe1J,IANtB,CADR,EAQGnN,KARH,CAQS,UAACrB,KAAD,EAAW;AAChB;AACA,uCAAWA,KAAX;AACD,WAXH;AAYD;AACF,OAhCD,MAgCO;AACL,aAAK2W,aAAL,CAAmB4B,6BAAnB,CAAiDP,KAAjD;AACA,qDAA0BA,MAAMvM,IAAhC,kCAA+D,KAAKiL,QAApE;AACD;AACF;;;6BAEQ;AACP,UAAMD,eAAe,KAAKE,aAA1B;;AAEA,WAAKO,SAAL,GAAiBT,aAAa9K,QAA9B;AACA,WAAKsL,aAAL,GAAqBR,aAAa+B,YAAb,EAArB;AACA,gCAAU,KAAKvB,aAAf;AACAR,mBAAagC,cAAb,CAA4B,KAAK/B,QAAjC,EANO,CAMoC;AAC5C;;;+BAEU;AACT,UAAI,KAAKQ,SAAL,KAAmB,IAAvB,EAA6B;AAC3B,kCAAU,sCAAV;AACA;AACD;;AAED,UAAMT,eAAe,KAAKE,aAA1B;AACA,UAAM+B,eAAe,KAAKzB,aAA1B;;AAEA,WAAK,IAAI3W,IAAI,CAAb,EAAgBA,IAAIoY,aAAanY,MAAjC,EAAyCD,GAAzC,EAA8C;AAC5C,YAAIoY,aAAapY,CAAb,EAAgBM,WAAhB,wBAAJ,EAA+C;AAC7C8X,uBAAapY,CAAb,EAAgBoL,UAAhB,IAA8B+K,aAAa9K,QAAb,GAAwB,KAAKuL,SAA3D;AACA,cAAKwB,aAAapY,CAAb,EAAgBoL,UAAhB,GAA6B+K,aAAa9K,QAA3C,GAAuD,KAAKwL,YAAhE,EAA8E;AAC5EV,yBAAakC,mBAAb,CAAiCD,aAAapY,CAAb,CAAjC;AACAZ,oBAAQC,GAAR,CAAY,aAAZ;AACA,sCAAU+Y,aAAapY,CAAb,CAAV;AACD,WAJD,MAIO;AACLmW,yBAAamC,QAAb,CAAsBF,aAAapY,CAAb,CAAtB;AACAZ,oBAAQC,GAAR,CAAY,aAAZ;AACA,sCAAU+Y,aAAapY,CAAb,CAAV;AACD;AACF;AACF;;AAED,WAAK4W,SAAL,GAAiB,IAAjB;AACA,WAAKD,aAAL,GAAqB,EAArB;AACAR,mBAAaY,iBAAb,CAA+B,KAAKX,QAApC,EA1BS,CA0BqC;AAC/C;;AAED;AACA;AACA;;;;2CACuBmC,S,EAAWpG,S,EAAiC;AAAA,wCAAnBqG,iBAAmB;AAAnBA,yBAAmB;AAAA;;AACjE,iDAAcD,SAAd,EAAyBpG,SAAzB,SAAuCqG,iBAAvC;AACA,uDAAoBC,QAApB,SAAiCD,iBAAjC;;AAEA;AACA,UAAI,KAAKb,gBAAL,CAAsBY,SAAtB,CAAJ,EAAsC;AACpC,YAAI,KAAKhC,eAAL,CAAqBgC,SAArB,EAAgCjY,WAAhC,KAAgDC,KAApD,EAA2D;AACzD;AACA,eAAKgW,eAAL,CAAqBgC,SAArB,IAAkC,KAAKhC,eAAL,CAAqBgC,SAArB,EAAgCtW,MAAhC,CAAuCuW,iBAAvC,CAAlC;AACA,8CAAkB,KAAKpC,QAAvB,2GAAoImC,SAApI;AACD,SAJD,MAIO;AACL;AACA,eAAKhC,eAAL,CAAqBgC,SAArB,IAAkC,CAAC,KAAKhC,eAAL,CAAqBgC,SAArB,CAAD,EAAkCtW,MAAlC,CAAyCuW,iBAAzC,CAAlC;AACA,8CAAkB,KAAKpC,QAAvB,iGAA0HmC,SAA1H;AACD;AACF,OAVD,MAUO;AACL,aAAKhC,eAAL,CAAqBgC,SAArB,IAAkCC,iBAAlC;AACA,4CAAkB,KAAKpC,QAAvB,6CAAsE,KAAKA,QAA3E,uBAAmGmC,SAAnG;AACD;AACF;;;2CAEsBG,K,EAAOvG,S,EAAiC;AAAA,yCAAnBqG,iBAAmB;AAAnBA,yBAAmB;AAAA;;AAC7D,iDAAcE,KAAd,EAAqBvG,SAArB,SAAmCqG,iBAAnC;AACA,uDAAoBC,QAApB,SAAiCD,iBAAjC;;AAEA,UAAIG,kBAAJ;AACA,cAAQD,KAAR;AACE,aAAK,WAAL;AACEC,sBAAY,qBAAZ;AACA;AACF,aAAK,QAAL;AACEA,sBAAY,kBAAZ;AACA;AACF,aAAK,QAAL;AACEA,sBAAY,kBAAZ;AACA;AACF;AACE,gBAAM,IAAI9Y,KAAJ,CAAU,wDAAV,CAAN;AAXJ;;AAcA,UAAIsS,SAAJ,EAAe;AACb,aAAKwG,SAAL,IAAkBH,iBAAlB;AACA,4CAAkB,KAAKpC,QAAvB,uCAAiEuC,SAAjE;AACD,OAHD,MAGO;AACL,aAAKA,SAAL,IAAkB,KAAKA,SAAL,EAAgB1W,MAAhB,CAAuBuW,iBAAvB,CAAlB;AACA,4CAAkB,KAAKpC,QAAvB,qCAA+DuC,SAA/D,2BAA6F,KAAKvC,QAAlG;AACD;AACF;;AAED;;AAEA;;;;;;;uCAIuC;AAAA,yCAAnBoC,iBAAmB;AAAnBA,yBAAmB;AAAA;;AACrC,gDAAiBA,iBAAjB;AACA,uDAAoBC,QAApB,SAAiCD,iBAAjC;;AAEA,WAAK,IAAIxY,IAAI,CAAb,EAAgBA,IAAIwY,kBAAkBvY,MAAtC,EAA8CD,GAA9C,EAAmD;AACjD,aAAK4Y,sBAAL,CAA4BJ,kBAAkBxY,CAAlB,EAAqBkO,IAAjD,EAAuD,IAAvD,EAA6DsK,kBAAkBxY,CAAlB,CAA7D;AACD;AACF;;;sCAEiBuY,S,EAAiC;AAAA,yCAAnBC,iBAAmB;AAAnBA,yBAAmB;AAAA;;AACjD,iDAAcD,SAAd,SAA4BC,iBAA5B;AACA,uDAAoBC,QAApB,SAAiCD,iBAAjC;AACA,WAAKI,sBAAL,cAA4BL,SAA5B,EAAuC,KAAvC,SAAiDC,iBAAjD;AACD;;;4CAEuBD,S,EAAiC;AAAA,yCAAnBC,iBAAmB;AAAnBA,yBAAmB;AAAA;;AACvD,iDAAcD,SAAd,SAA4BC,iBAA5B;AACA,uDAAoBC,QAApB,SAAiCD,iBAAjC;AACA,WAAKI,sBAAL,cAA4BL,SAA5B,EAAuC,IAAvC,SAAgDC,iBAAhD;AACD;;;4CAE2C;AAAA,yCAAnBA,iBAAmB;AAAnBA,yBAAmB;AAAA;;AAC1C,gDAAiBA,iBAAjB;AACA,uDAAoBC,QAApB,SAAiCD,iBAAjC;;AAEA,WAAKK,sBAAL,cAA4B,WAA5B,EAAyC,KAAzC,SAAmDL,iBAAnD;AACD;;;kDAEiD;AAAA,yCAAnBA,iBAAmB;AAAnBA,yBAAmB;AAAA;;AAChD,gDAAiBA,iBAAjB;AACA,uDAAoBC,QAApB,SAAiCD,iBAAjC;;AAEA,WAAKK,sBAAL,cAA4B,WAA5B,EAAyC,IAAzC,SAAkDL,iBAAlD;AACD;;;8CAE6C;AAAA,yCAAnBA,iBAAmB;AAAnBA,yBAAmB;AAAA;;AAC5C,gDAAiBA,iBAAjB;AACA,uDAAoBC,QAApB,SAAiCD,iBAAjC;;AAEA,WAAKK,sBAAL,cAA4B,QAA5B,EAAsC,IAAtC,SAA+CL,iBAA/C;AACD;;;yCAEwC;AAAA,yCAAnBA,iBAAmB;AAAnBA,yBAAmB;AAAA;;AACvC,gDAAiBA,iBAAjB;AACA,uDAAoBC,QAApB,SAAiCD,iBAAjC;;AAEA,WAAKK,sBAAL,cAA4B,QAA5B,EAAsC,KAAtC,SAAgDL,iBAAhD;AACD;;;+CAE8C;AAAA,0CAAnBA,iBAAmB;AAAnBA,yBAAmB;AAAA;;AAC7C,gDAAiBA,iBAAjB;AACA,uDAAoBC,QAApB,SAAiCD,iBAAjC;;AAEA,WAAKK,sBAAL,cAA4B,QAA5B,EAAsC,KAAtC,SAAgDL,iBAAhD;AACD;;;yCAEwC;AAAA,0CAAnBA,iBAAmB;AAAnBA,yBAAmB;AAAA;;AACvC,gDAAiBA,iBAAjB;AACA,uDAAoBC,QAApB,SAAiCD,iBAAjC;;AAEA,WAAKK,sBAAL,cAA4B,QAA5B,EAAsC,KAAtC,SAAgDL,iBAAhD;AACD;;;uCAGyC;AAAA,UAAzBD,SAAyB,uEAAb,2BAAa;;AACxC,aAAQ,iBAAEjO,GAAF,CAAM,KAAKiM,eAAX,EAA4BgC,SAA5B,CAAR;AACD;;AAGD;AACA;;;;gCAC8B;AAAA,UAApBrK,IAAoB,uEAAb,2BAAa;;AAC5B,aAAQ,KAAKmI,aAAL,CAAmByC,SAAnB,CAA6B5K,IAA7B,CAAR;AACD;;;gCAEkD;AAAA,UAAzCA,IAAyC,uEAAlC,2BAAkC;AAAA,UAArBlF,KAAqB,uEAAb,2BAAa;;AACjD,aAAQ,KAAKqN,aAAL,CAAmB0C,SAAnB,CAA6B7K,IAA7B,EAAmClF,KAAnC,CAAR;AACD;;;wBAEa;AACZ,UAAI,KAAKqN,aAAL,CAAmB2C,WAAvB,EAAoC;AAClC,eAAQ,KAAK3C,aAAL,CAAmB2C,WAAnB,CAA+BC,UAA/B,CAA0C,IAA1C,CAAR;AACD;AACD,aAAQ;AACNC,oBAAY,IADN;AAENC,qBAAa,KAAK9C,aAAL,CAAmBC,YAF1B;AAGN8C,eAAO,KAAK5M,OAHN,EAGe;AACrB2J,sBAAc,KAAKE,aAJb;AAKNgD,eAAO,IALD;AAMNC,WAAG,KAAKjD,aAAL,CAAmBiD;AANhB,OAAR;AAQD;;;;;;kBAhYkBpD,K;;;;;;;;;;;;;;ACPrB;;;AACA;;;;AACA;;;;AACA;;;;AAEA;;;;AACA;;;;AACA;;;;AACA;;;;AACA;;;;;;;;AAOA;;;;;IAKqBqD,Y;;AAEnB;;;;;AAKA,0BAA8D;AAAA,QAAlDjN,MAAkD,uEAAzC,0BAAU,QAAV,CAAyC;AAAA,QAApB6M,WAAoB,uEAAN,IAAM;;AAAA;;AAC5D,SAAK3M,OAAL,GAAeF,MAAf;AACA,SAAK6M,WAAL,GAAmBA,WAAnB;;AAEA;AACA,QAAI,OAAO7M,OAAOkN,gBAAd,KAAmC,WAAvC,EAAoD;AAClD,WAAKR,WAAL,GAAmB1M,OAAOkN,gBAA1B;AACA,WAAKF,CAAL,GAAS,KAAKN,WAAL,CAAiBM,CAA1B;AACD,KAHD,MAGO;AACL,WAAKA,CAAL,GAAS,gCAAT;AACD;;AAED,QAAMA,IAAI,KAAKA,CAAf;;AAEA;;;;AAIA,SAAKjC,UAAL,GAAkB,EAAlB;;AAEA;;;;AAIA,SAAKoC,kBAAL,GAA0B,EAA1B;;AAEA;AACA;AACA;AACA;AACA;;AAEA,SAAKC,QAAL,GAAgB,EAAhB;;AAEA,SAAKJ,CAAL,CAAOhW,GAAP,CAAW;AACTqW,cAAQ;AACNC,cAAM,MADA;AAENC,eAAO,OAFD;AAGNC,gBAAQ;AAHF,OADC;AAMTvQ,cAAQ;AACNwQ,4BAAoB;AADd;AANC,KAAX,EASG,KATH;;AAWA;AACA,SAAKJ,MAAL,GAAc;AACZC,YAAM,oBAAU,IAAV,EAAgBN,EAAE3D,GAAF,CAAMqE,WAAtB,CADM;AAEZF,cAAQ,oBAAU,IAAV,EAAgBR,EAAE3D,GAAF,CAAMsE,aAAtB,CAFI;AAGZJ,aAAO,oBAAU,IAAV,EAAgBP,EAAE3D,GAAF,CAAMuE,YAAtB;AAHK,KAAd;;AAMA,SAAKC,gBAAL,GAAwBb,EAAE3D,GAAF,CAAMqE,WAA9B;;AAEA;;;;AAIA,SAAKI,WAAL,GAAmB,IAAnB;;AAEA;;;;AAIA,SAAKC,OAAL,GAAe,EAAf;;AAEA,SAAKC,eAAL,GAAuB,EAAvB;AACD;;AAED;;;;;6BACS;AACP;AACA,WAAK,IAAIta,IAAI,CAAb,EAAgBA,IAAI,KAAKyZ,kBAAL,CAAwBxZ,MAA5C,EAAoDD,GAApD,EAAyD;AACvD,YAAI,KAAKqL,QAAL,IAAiB,KAAKoO,kBAAL,CAAwBzZ,CAAxB,EAA2BoL,UAAhD,EAA4D;AAC1D,eAAKqO,kBAAL,CAAwBzZ,CAAxB,EAA2BoL,UAA3B,GAAwC,KAAKC,QAA7C,CAD0D,CACJ;AACtD,eAAKiN,QAAL,CAAc,KAAKmB,kBAAL,CAAwBzZ,CAAxB,CAAd;AACA,eAAKyZ,kBAAL,CAAwB/V,MAAxB,CAA+B1D,CAA/B;AACD;AACF;;AAED;AACA,WAAKua,YAAL,CAAkBC,MAAlB;AACD;;;iCAE+B;AAAA,UAArB9C,KAAqB,uEAAb,2BAAa;;AAC9B,UAAI;AACF,YAAI,KAAKyB,WAAL,CAAiB7Y,WAAjB,0BAAJ,EAAkD;AAChD,gBAAM,IAAIT,KAAJ,CAAU,sEAAV,CAAN;AACD;;AAED,YAAI,CAAC6X,MAAM9L,OAAX,EAAoB;AAClB,mCAAS8L,KAAT;AACA,gBAAM,IAAI7X,KAAJ,CAAU,qEAAV,CAAN;AACD;;AAED,YAAI6X,MAAM7L,MAAV,EAAkB;AAChB,mCAAS6L,KAAT;AACA,gBAAM,IAAI7X,KAAJ,CAAU,+CAAV,CAAN;AACD;;AAED6X,cAAM+C,gBAAN,GAAyB,KAAzB;AACA,YAAIlP,YAAYmM,MAAMlV,IAAN,CAAW+I,SAA3B;AACA,YAAIA,UAAUjL,WAAV,KAA0BC,KAA9B,EAAqC;AACnCgL,sBAAY,CAACA,SAAD,CAAZ;AACD;;AAED,aAAK,IAAIvL,IAAI,CAAb,EAAgBA,IAAIuL,UAAUtL,MAA9B,EAAsCD,GAAtC,EAA2C;AACzC,cAAI;AACF0X,kBAAMlV,IAAN,CAAWiJ,QAAX,GAAsB,KAAKJ,QAA3B;AACAqM,kBAAM7L,MAAN,GAAe,IAAf;;AAEA,qCAAS,yCAAT;AACA;AACA,iBAAKsN,WAAL,CAAiBuB,OAAjB,CAAyBnP,UAAUvL,CAAV,CAAzB,EAAuC0X,MAAMiD,SAA7C;AACA,qCAAS,wCAAT,EAAmDjD,KAAnD;AACD,WARD,CAQE,OAAOhY,KAAP,EAAc;AACd,6FAA+D6L,UAAUvL,CAAV,CAA/D,4EAAkJN,KAAlJ;AACA,iBAAKkb,eAAL,CAAqBlD,KAArB;AACD;AACF;AACF,OAnCD,CAmCE,OAAOjV,CAAP,EAAU;AACV,mCAAWA,CAAX;AACD;AACF;;;gCAE6B;AAAA,UAApBD,IAAoB,uEAAb,2BAAa;;AAC5B,UAAI;AACF,YAAI,KAAK2W,WAAL,CAAiB7Y,WAAjB,0BAAJ,EAAkD;AAChD,gBAAM,IAAIT,KAAJ,CAAU,qEAAV,CAAN;AACD;;AAED,YAAI,CAAE,iBAAEyK,GAAF,CAAM9H,IAAN,EAAY,WAAZ,CAAN,EAAiC;AAC/B,mCAASA,IAAT;AACA,gBAAM,IAAI3C,KAAJ,CAAU,wFAAV,CAAN;AACD;;AAED2C,aAAKiY,gBAAL,GAAwB,KAAxB;AACA,aAAK,IAAIza,IAAI,CAAb,EAAgBA,IAAIwC,KAAK+I,SAAL,CAAetL,MAAnC,EAA2CD,GAA3C,EAAgD;AAC9C,cAAI;AACF,iBAAKmZ,WAAL,CAAiBuB,OAAjB,CAAyBlY,KAAK+I,SAAL,CAAevL,CAAf,CAAzB,EAA4CwC,IAA5C;AACD,WAFD,CAEE,OAAO9C,KAAP,EAAc;AACdN,oBAAQM,KAAR,4CAAuD8C,KAAK+I,SAAL,CAAevL,CAAf,CAAvD,4EAA+IN,KAA/I;AACA,iBAAKkb,eAAL,CAAqBpY,IAArB;AACD;AACF;AACF,OAnBD,CAmBE,OAAOC,CAAP,EAAU;AACV,mCAAWA,CAAX;AACD;AACF;;;sCAEmC;AAAA,UAApBD,IAAoB,uEAAb,2BAAa;;AAClC,UAAIA,KAAKiY,gBAAL,KAA0B,KAA9B,EAAqC;AACnCjY,aAAKiY,gBAAL,GAAwB,IAAxB;AACA,aAAKf,QAAL,GAAgB,KAAKA,QAAL,CAAczX,MAAd,CAAqBO,IAArB,CAAhB;AACA,iCAAS,4CAAT;AACD,OAJD,MAIO;AACL,kCAAU,wEAAV;AACD;AACF;;AAED;;AAEA;;;;;;;;;+BAMuB;AACrB,UAAI;AACF,YAAMqY,iBAAiB,EAAvB;AACA,YAAIzE,iBAAJ;;AAFE,0CADM0E,SACN;AADMA,mBACN;AAAA;;AAGF,aAAK,IAAI9a,IAAI,CAAb,EAAgBA,IAAI8a,UAAU7a,MAA9B,EAAsCD,GAAtC,EAA2C;AACzCoW,qBAAW0E,UAAU9a,CAAV,CAAX;;AAEA,cAAIoW,SAAS9V,WAAT,KAAyBoC,MAA7B,EAAqC;AACnC,kBAAM,IAAI7C,KAAJ,CAAU,0CAAV,CAAN;AACD;;AAED,cAAI,iBAAEyK,GAAF,CAAM,KAAKqP,MAAX,EAAmBvD,QAAnB,CAAJ,EAAkC;AAChC,kBAAM,IAAIvW,KAAJ,sDAA4DuW,QAA5D,wBAAN;AACD;;AAED,eAAKuD,MAAL,CAAYvD,QAAZ,IAAwB,oBAAU,IAAV,EAAgBA,QAAhB,CAAxB;;AAEA,oEAAuCA,QAAvC;;AAEAyE,yBAAezW,IAAf,CAAoB,KAAKuV,MAAL,CAAYvD,QAAZ,CAApB;AACD;;AAED,eAAQyE,eAAe5a,MAAf,KAA0B,CAA3B,GAAgC4a,eAAe,CAAf,CAAhC,GAAoDA,cAA3D;AACD,OAtBD,CAsBE,OAAOpY,CAAP,EAAU;AACV,mCAAWA,CAAX;AACA,eAAO,IAAP;AACD;AACF;;AAED;;;;gCAC6C;AAAA,UAAnCsY,GAAmC,uEAA7B,2BAA6B;AAAA,UAAhBjE,MAAgB,uEAAP,KAAO;;AAC3C,UAAI,iBAAExM,GAAF,CAAM,KAAKqP,MAAX,EAAmBoB,GAAnB,CAAJ,EAA6B;AAC3B,aAAKR,YAAL,CAAkBS,GAAlB;;AAEA,aAAKb,gBAAL,GAAwBY,GAAxB;AACA,aAAKpB,MAAL,CAAYoB,GAAZ,EAAiBE,KAAjB,CAAuBnE,MAAvB;AACD,OALD,MAKO;AACL,mCAAW,kCAAX;AACD;AACF;;AAED;AACA;;AAGA;;;;;;;;;;mCAOe;AACb,UAAI;AACF,YAAMsC,QAAQ,KAAK5M,OAAnB;AACA,4CAAoB,8BAAQ0O,KAA5B,EAAmC9B,KAAnC;;AAEA,YAAM+B,gBAAgB;AACpB/M,cAAI,KADgB;AAEpBgN,0BAAgB,8BAAQC,QAAR,CAAiBC,kBAAjB,CAAoC,IAAI,8BAAQC,MAAZ,CAAmB,CAAnB,EAAsB,CAAtB,EAAyB,CAAzB,EAA4B,CAA5B,CAApC,CAFI;AAGpBC,iCAAuB,CAHH;AAIpBvT,aAAG,CAJiB;AAKpBE,aAAG,CALiB;AAMpBsT,kBAAQ;AANY,SAAtB;;AASA,YAAMC,MAAM,IAAI,8BAAQC,mBAAZ,CAAgCvC,KAAhC,EAAuC+B,aAAvC,CAAZ;;AAEAO,YAAIE,YAAJ,GAAmB,KAAnB;AACA,aAAKC,GAAL,CAAS,KAAT,EAAgBH,GAAhB;;AAEA,eAAOA,GAAP;AACD,OAnBD,CAmBE,OAAOjZ,CAAP,EAAU;AACV,mCAAWA,CAAX;AACA,eAAO,IAAP;AACD;AACF;;AAED;;;;kCACqJ;AAAA;;AAAA,+BAA3IiG,QAA2I;AAAA,UAA3IA,QAA2I,iCAAhI,IAAgI;AAAA,2BAA1H3D,IAA0H;AAAA,UAA1HA,IAA0H,6BAAnH,IAAmH;AAAA,6BAA7G+W,MAA6G;AAAA,UAA7GA,MAA6G,+BAApG,IAAoG;AAAA,2BAA9FC,IAA8F;AAAA,UAA9FA,IAA8F,6BAAvF,EAAuF;AAAA,+BAAnFC,QAAmF;AAAA,UAAnFA,QAAmF,iCAAxE,cAAwE;AAAA,+BAAxDC,QAAwD;AAAA,UAAxDA,QAAwD,iCAA7C,IAA6C;AAAA,iCAAvCC,UAAuC;AAAA,UAAvCA,UAAuC,mCAA1B,IAA0B;AAAA,gCAApBC,SAAoB;AAAA,UAApBA,SAAoB,kCAAR,IAAQ;;AACnJ;AACAL,eAAS,+BAAeA,MAAf,EAAuB,IAAI,8BAAQlW,OAAZ,CAAoB,CAApB,EAAuB,CAAvB,CAAvB,CAAT;AACA,UAAKqW,aAAa,IAAd,IAAwBA,SAAS3b,WAAT,uBAA5B,EAA+D;AAC7D,YAAK2b,aAAa,IAAd,IAAwBA,SAAS3b,WAAT,KAAyB8F,MAArD,EAA8D;AAC5D6V,qBAAW,sBAAMA,QAAN,CAAX;AACD,SAFD,MAEO;AACLA,qBAAY,yBAAD,CAAiB1Z,OAA5B;AACD;AACF;;AAED,UAAM6Z,YAAY,KAAKzG,GAAL,CAAS,KAAT,CAAlB;AACAyG,gBAAUR,YAAV,GAAyB,IAAzB;;AAGA,UAAIS,UAAU,KAAK1G,GAAL,CAAS,SAAT,CAAd;;AAEA,UAAIvH,KAAK,CAAT;AACA,UAAIiO,YAAY,IAAhB,EAAsB;AACpB3T,mBAAW,+BAAeA,QAAf,EAAyB,IAAI,8BAAQ9C,OAAZ,CAAoB,CAApB,EAAuB,CAAvB,CAAzB,CAAX;;AAEA,YAAM0W,cAAc,+BAAevX,IAAf,EAAqB,IAAI,8BAAQY,IAAZ,CAAiB,GAAjB,EAAsB,GAAtB,CAArB,CAApB;;AAEA;AACA,YAAM4W,aAAa,CAAC,MAAM,GAAP,EAAY,MAAM,GAAlB,EAAuB,KAAK,GAA5B,EAAiC,IAAjC,CAAnB;AACA,YAAIC,kBAAkB,IAAtB;AACA,YAAIC,0BAA0B,KAA9B;AACA,YAAIP,eAAe,IAAnB,EAAyB;AACvBM,4BAAkB,KAAlB;AACAC,oCAA0B,IAA1B;AACD;AACDP,qBAAa,+BAAeA,UAAf,qCAA+B,8BAAQX,MAAvC,gBAAiDgB,UAAjD,MAAb;AACAJ,oBAAY,+BAAeA,SAAf,EAA0B,IAAI,8BAAQZ,MAAZ,CAAmB,CAAnB,EAAsB,CAAtB,EAAyB,CAAzB,EAA4B,CAA5B,CAA1B,CAAZ;;AAEA,YAAMmB,QAAQ,8BAAQrB,QAAR,CAAiBC,kBAAjB,CAAoCY,UAApC,CAAd;;AAEA,YAAMS,aAAa,IAAI,8BAAQC,WAAZ,CAAwB;AACzCtQ,kBAAQ8P,SADiC;AAEzChO,cAAI,YAFqC;AAGzC;AACAvI,iBAAOyW,YAAYzW,KAJsB;AAKzCC,kBAAQwW,YAAYxW,MALqB;AAMzC;AACA;AACApB,gBAAMgY;AARmC,SAAxB,CAAnB;;AAWA,YAAMG,cAAc,IAAI,8BAAQC,MAAZ,CAAmBf,IAAnB,EAAyB;AAC3CzP,kBAAQqQ,UADmC;AAE3CvO,cAAI,aAFuC;AAG3C2O,2BAAiB,qBAH0B;AAI3CC,4BAAkBb,SAJyB;AAK3CK,0CAL2C;AAM3CC,0DAN2C;AAO3CT;AAP2C,SAAzB,CAApB;;AAUA,YAAIjX,SAAS,IAAb,EAAmB;AACjB4X,qBAAW9W,KAAX,GAAmBgX,YAAY9X,IAAZ,CAAiBc,KAAjB,GAAyB,EAA5C;AACA8W,qBAAW7W,MAAX,GAAoB+W,YAAY9X,IAAZ,CAAiBe,MAAjB,GAA0B,EAA9C;AACD;;AAED6W,mBAAWjU,QAAX,GAAsBA,SAASuU,QAAT,CAAkB,0BAAUN,WAAW5X,IAArB,EAA2BiB,KAA3B,CAAiC,GAAjC,EAAsC1C,GAAtC,CAA0CwY,MAA1C,CAAlB,CAAtB;;AAGAO,kBAAU,EAAEa,KAAKP,UAAP,EAAmBZ,MAAMc,WAAzB,EAAsCta,SAAS0Z,QAA/C,EAAyD7N,IAAI,CAA7D,EAAV;;AAEA,aAAKyN,GAAL,CAAS,SAAT,EAAoBQ,OAApB;AACD,OAlDD,MAkDO;AACLA,gBAAQN,IAAR,CAAaH,YAAb,GAA4B,IAA5B;AACAS,gBAAQa,GAAR,CAAYtB,YAAZ,GAA2B,IAA3B;;AAEAS,gBAAQN,IAAR,CAAaA,IAAb,GAAoBA,IAApB;;AAEA,YAAMoB,eAAed,QAAQa,GAAR,CAAYxU,QAAZ,CAAqBpF,GAArB,CAAyB,0BAAU+Y,QAAQa,GAAR,CAAYnY,IAAtB,EAA4BiB,KAA5B,CAAkC,GAAlC,CAAzB,CAArB;AACA,YAAIjB,SAAS,IAAb,EAAmB;AACjBsX,kBAAQa,GAAR,CAAYrX,KAAZ,GAAoBwW,QAAQN,IAAR,CAAahX,IAAb,CAAkBc,KAAlB,GAA0B,EAA9C;AACAwW,kBAAQa,GAAR,CAAYpX,MAAZ,GAAqBuW,QAAQN,IAAR,CAAahX,IAAb,CAAkBe,MAAlB,GAA2B,EAAhD;AACD,SAHD,MAGO;AACLuW,kBAAQa,GAAR,CAAYrX,KAAZ,GAAoBd,KAAKc,KAAzB;AACAwW,kBAAQa,GAAR,CAAYpX,MAAZ,GAAqBf,KAAKe,MAA1B;AACD;;AAGD4C,mBAAW,+BAAeA,QAAf,EAAyByU,YAAzB,CAAX;AACA,YAAMC,UAAU1U,SAASuU,QAAT,CAAkB,0BAAUZ,QAAQa,GAAR,CAAYnY,IAAtB,EAA4BiB,KAA5B,CAAkC,GAAlC,EAAuC1C,GAAvC,CAA2CwY,MAA3C,CAAlB,CAAhB;AACA;AACAO,gBAAQa,GAAR,CAAYxU,QAAZ,GAAuB0U,OAAvB;AACAf,gBAAQ9Z,OAAR,GAAkB0Z,QAAlB;;AAEA7N,aAAKiO,QAAQjO,EAAR,GAAa,CAAlB;AACAiO,gBAAQjO,EAAR,GAAaA,EAAb;AACD;;AAED6N,eAASnb,IAAT,CAAc,YAAM;AAClB,YAAMuc,iBAAiB,MAAK1H,GAAL,CAAS,SAAT,CAAvB;AACA,YAAK0H,mBAAmB,IAApB,IAA8BA,eAAejP,EAAf,KAAsBA,EAAxD,EAA6D;AAC3D,gBAAKkP,WAAL;AACD;AACF,OALD;;AAOA,aAAOjB,QAAQ9Z,OAAf;AACD;;;kCAEa;AACZ,UAAM8Z,UAAU,KAAK1G,GAAL,CAAS,SAAT,CAAhB;AACA,UAAI0G,YAAY,IAAhB,EAAsB;AACpBA,gBAAQN,IAAR,CAAaH,YAAb,GAA4B,KAA5B;AACAS,gBAAQa,GAAR,CAAYtB,YAAZ,GAA2B,KAA3B;AACD;AACF;;AAED;;AAEA;;;;;;;;wCAKkE;AAAA,UAAhDb,GAAgD,uEAA1C,EAA0C;AAAA,UAAtC5P,IAAsC,uEAA/B,IAA+B;AAAA,UAAzBoS,gBAAyB,uEAAN,IAAM;;AAChE,UAAMC,aAAa,SAAbA,UAAa,GAA0B;AAAA,YAAhBC,OAAgB,uEAAN,IAAM;;AAC3C,YAAMpE,QAAQ,KAAKA,KAAnB;AACA,YAAMlD,eAAe,KAAKA,YAA1B;AACA,YAAMmD,IAAI,KAAKA,CAAf;;AAEA,YAAImE,QAAQjb,IAAR,CAAakb,OAAb,KAAyB3C,GAA7B,EAAkC;AAChC1B,gBAAMsE,MAAN,GADgC,CACjB;AACfxH,uBAAayH,SAAb,CAAuBtE,EAAE3D,GAAF,CAAMuE,YAA7B;AACD;;AAED,eAAQ,4BAAR;AACD,OAXD;;AAaA,UAAM2D,aAAa,SAAbA,UAAa,GAAY;AAC7B,aAAKxE,KAAL,CAAWsE,MAAX,GAD6B,CACT;AACpB,aAAKxH,YAAL,CAAkByH,SAAlB,CAA4B,KAAKtE,CAAL,CAAO3D,GAAP,CAAWuE,YAAvC;AACA,eAAQ,4BAAR;AACD,OAJD;;AAOA,UAAM4D,UAAU,SAAVA,OAAU,GAA0B;AAAA,YAAhBL,OAAgB,uEAAN,IAAM;;AACxC,YAAIA,QAAQjb,IAAR,CAAakb,OAAb,KAAyB3C,GAA7B,EAAkC;AAChC,cAAI,KAAK5E,YAAL,CAAkBiE,WAAlB,KAAkC,IAAtC,EAA4C;AAC1C,iBAAKjE,YAAL,CAAkByH,SAAlB,CAA4B,KAAKzH,YAAL,CAAkBiE,WAA9C;AACD,WAFD,MAEO;AACL,uCAAW,kCAAX;AACD;AACF;;AAED,eAAQ,yBAAR;AACD,OAVD;;AAYAjP,aAAQA,SAAS,IAAV,GAAkBA,IAAlB,GAAyB,KAAKmO,CAAL,CAAO3D,GAAP,CAAW4B,MAAX,CAAkBwG,OAAlD;;AAEA,UAAMjD,YAAY,KAAKA,SAAvB;AACA,WAAK,IAAI9a,IAAI,CAAb,EAAgBA,IAAI8a,UAAU7a,MAA9B,EAAsCD,GAAtC,EAA2C;AACzC,YAAI8a,UAAU9a,CAAV,MAAiB,KAAKsZ,CAAL,CAAO3D,GAAP,CAAWuE,YAAhC,EAA8C;AAC5C;AACA,eAAK8D,qBAAL,CAA2BlD,UAAU9a,CAAV,CAA3B,EAAyCmL,IAAzC,EAA+CqS,UAA/C;AACA,eAAKQ,qBAAL,CAA2BlD,UAAU9a,CAAV,CAA3B,EAAyC,KAAKsZ,CAAL,CAAO3D,GAAP,CAAWsI,YAApD,EAAkEJ,UAAlE;AACD,SAJD,MAIO;AACL,eAAKG,qBAAL,CAA2BlD,UAAU9a,CAAV,CAA3B,EAAyCmL,IAAzC,EAA+C2S,OAA/C;AACA,eAAKE,qBAAL,CAA2BlD,UAAU9a,CAAV,CAA3B,EAAyC,KAAKsZ,CAAL,CAAO3D,GAAP,CAAWsI,YAApD,EAAkEH,OAAlE;AACD;AACF;;AAED,UAAIP,gBAAJ,EAAsB;AACpB,aAAKW,qBAAL;AACD;AACF;;AAED;;;;;;;4CAIwB;AACtB,UAAI,kCAAY,IAAhB,EAAsB;AACpB,eAAO,KAAP;AACD;;AAED,UAAMC,aAAa,SAAbA,UAAa,GAA0B;AAAA,YAAhBV,OAAgB,uEAAN,IAAM;;AAC3C,YAAI;AACF,cAAI,OAAO,KAAKvE,UAAZ,KAA2B,WAA/B,EAA4C;AAC1C,kBAAM,IAAIrZ,KAAJ,CAAU,2CAAV,CAAN;AACD;AACD,cAAMsW,eAAe,KAAKA,YAA1B;;AAEA,cAAMiI,oBAAoBjI,aAAaR,GAAb,CAAiB,mBAAjB,CAA1B;AACA,cAAM0I,SAAS,KAAKjF,KAAL,CAAWkF,YAA1B;;AAEA,cAAIF,sBAAsB,IAA1B,EAAgC;AAC9BA,8BAAkBrZ,IAAlB,GAAyBsZ,OAAOtZ,IAAhC;AACAqZ,8BAAkBxC,YAAlB,GAAiC,IAAjC;AACD,WAHD,MAGO;AACL,gBAAI,OAAOyC,MAAP,KAAkB,WAAtB,EAAmC;AACjC,qBAAQ,yCAAR;AACD;AACD;AACA;AACA,gBAAME,cAAc;AAClBnQ,kBAAI,mBADc;AAElB2N,oBAAM,OAFY;AAGlB9T,iBAAG,CAHe;AAIlBE,iBAAG,CAJe;AAKlBtC,qBAAOwY,OAAOxY,KALI;AAMlBC,sBAAQuY,OAAOvY,MANG;AAOlBpB,oBAAM,8BAAQ2W,QAAR,CAAiBC,kBAAjB,CAAoC,IAAI,8BAAQC,MAAZ,CAAmB,GAAnB,EAAwB,GAAxB,EAA6B,GAA7B,EAAkC,GAAlC,CAApC,CAPY;AAQlBS,wBAAU,cARQ;AASlBR,qCAAuB;AATL,aAApB;;AAYAiC,sBAAU,iBAAE/R,MAAF,CAAS6S,WAAT,EAAsBd,OAAtB,CAAV;;AAEA,gBAAIe,cAAcH,OAAOtZ,IAAzB;AACA,gBAAK0Y,QAAQ5X,KAAR,KAAkBwY,OAAOxY,KAA1B,IAAqC4X,QAAQ3X,MAAR,KAAmBuY,OAAOvY,MAAnE,EAA4E;AAC1E0Y,4BAAc,IAAI,8BAAQ7Y,IAAZ,CAAiB8X,QAAQ5X,KAAzB,EAAgC4X,QAAQ3X,MAAxC,CAAd;AACD;;AAED,gBAAMqV,gBAAgB;AACpB/M,kBAAIqP,QAAQrP,EADQ;AAEpBqQ,2BAAahB,QAAQjC,qBAFD;AAGpB9W,oBAAM+Y,QAAQ/Y,IAHM;AAIpB4H,sBAAQ,KAAK8M,KAAL,CAAWkF,YAJC;AAKpBvB,+BAAiB,qBALG;AAMpBhY,oBAAMyZ,WANc;AAOpB/C,sBAAQ,CAPY;AAQpBiD,wBAAU,CACR,IAAI,8BAAQ5B,MAAZ,CAAmBW,QAAQ1B,IAA3B,EAAiC;AAC/BC,0BAAUyB,QAAQzB,QADa;AAE/Be,iCAAiB,kBAFc;AAG/BN,yCAAyB,IAHM;AAI/BhB,wBAAQ;AAJuB,eAAjC,CADQ;AARU,aAAtB;;AAkBA,gBAAM2C,qBAAoB,IAAI,8BAAQxB,WAAZ,CAAwBzB,aAAxB,CAA1B;;AAEAhF,yBAAa0F,GAAb,CAAiB,mBAAjB,EAAsCuC,kBAAtC,EA7CK,CA6CoD;AAC1D;AACD,iBAAQ,4BAAR;AACD,SA5DD,CA4DE,OAAO3b,CAAP,EAAU;AACV,qCAAWA,CAAX;AACA,iBAAOA,CAAP;AACD;AACF,OAjED;;AAmEA,UAAMkc,WAAW,SAAXA,QAAW,GAAY;AAC3B,YAAI;AACF,cAAI,OAAO,KAAKtF,KAAZ,KAAsB,WAA1B,EAAuC;AACrC,kBAAM,IAAIxZ,KAAJ,CAAU,oCAAV,CAAN;AACD;AACD,cAAMsW,eAAe,KAAKA,YAA1B;AACA,cAAMiI,oBAAoBjI,aAAaR,GAAb,CAAiB,mBAAjB,CAA1B;;AAEA,cAAIyI,sBAAsB,IAA1B,EAAgC;AAC9B;AACA;AACAA,8BAAkBxC,YAAlB,GAAiC,KAAjC;AACD;;AAED,iBAAQ,0BAAR;AACD,SAdD,CAcE,OAAOnZ,CAAP,EAAU;AACV,qCAAWA,CAAX;AACA,iBAAOA,CAAP;AACD;AACF,OAnBD;;AAqBA,WAAKmc,yBAAL,CAA+B,KAAKtF,CAAL,CAAO3D,GAAP,CAAWuE,YAA1C,EAAwDiE,UAAxD;AACA,WAAKU,sBAAL,CAA4B,KAAKvF,CAAL,CAAO3D,GAAP,CAAWuE,YAAvC,EAAqDyE,QAArD;;AAEA,aAAO,IAAP;AACD;;;qCAEsC;AAAA,UAAxBvI,QAAwB,uEAAb,2BAAa;;AACrC,WAAKgE,WAAL,GAAmBhE,QAAnB;;AAEA;AACA,WAAK0I,cAAL;AACA,WAAKC,sBAAL;AACD;;;wCAEyC;AAAA,UAAxB3I,QAAwB,uEAAb,2BAAa;;AACxC,UAAI,KAAKgE,WAAL,KAAqBhE,QAAzB,EAAmC;AACjC,mCAAW,iFAAX;AACD,OAFD,MAEO;AACL,aAAKgE,WAAL,GAAmB,IAAnB;AACD;AACF;;AAED;;;;0CACgD;AAAA,UAA5B1C,KAA4B,uEAApB,0BAAU,OAAV,CAAoB;;AAC9C,UAAIA,MAAMpX,WAAN,wBAAJ,EAAqC;AACnC,YAAIoX,MAAMtM,UAAN,GAAmB,KAAKC,QAAL,GAAgB,EAAvC,EAA2C;AACzC,eAAKoO,kBAAL,CAAwBrV,IAAxB,CAA6BsT,KAA7B;AACA,mCAAS,yDAAT;AACD,SAHD,MAGO;AACL,eAAKY,QAAL,CAAcZ,KAAd;AACA,qCAAW,kHAAX;AACD;AACF,OARD,MAQO;AACL,mCAAW,gDAAX;AACD;AACF;;AAED;;;;+BACqC;AAAA,UAA5BA,KAA4B,uEAApB,0BAAU,OAAV,CAAoB;;AACnC,UAAIA,MAAMpX,WAAN,wBAAJ,EAAqC;AACnC,aAAK+W,UAAL,CAAgBjT,IAAhB,CAAqBsT,KAArB;AACA,iCAAS,wCAAT;AACD,OAHD,MAGO;AACL,mCAAW,gDAAX;AACD;AACF;;;+BAEiF;AAAA,UAAzEvM,IAAyE,uEAAlE,2BAAkE;AAAA,UAArD6T,IAAqD,uEAA9C,IAA8C;AAAA,UAAxCxc,IAAwC,uEAAjC,IAAiC;AAAA,UAA3B+I,SAA2B,uEAAf,CAAC,WAAD,CAAe;;AAChF;AACA,UAAIJ,KAAK7K,WAAL,wBAAJ,EAAoC;AAClC,iCAAS,uEAAT;AACA,aAAKgY,QAAL,CAAcnN,IAAd;AACA,eAAOA,IAAP;AACD;;AAED;AACA,UAAII,UAAUjL,WAAV,KAA0BC,KAA9B,EAAqC;AACnC,YAAIgL,UAAUjL,WAAV,KAA0BoC,MAA9B,EAAsC;AACpC6I,sBAAY,CAACA,SAAD,CAAZ;AACD,SAFD,MAEO;AACL,qCAAW,0EAAX;AACA,iBAAO,IAAP;AACD;AACF,OAPD,MAOO,IAAIA,UAAU5B,OAAV,CAAkB,WAAlB,MAAmC,CAAC,CAAxC,EAA2C;AAC9C;AACF4B,kBAAUnH,IAAV,CAAe,WAAf;AACD;;AAED,UAAM6a,eAAe;AACnB1T,4BADmB;AAEnBC,mBAAW,IAFQ;AAGnBC,kBAAU;AAHS,OAArB;AAKA,UAAIjJ,SAAS,IAAb,EAAmB;AACjByc,qBAAazc,IAAb,GAAoBA,IAApB,CADiB,CACQ;AAC1B,OAFD,MAEO,IAAKwc,SAAS,IAAV,IAAoBA,KAAK1e,WAAL,KAAqBsJ,MAAzC,IAAqDpH,SAAS,IAAlE,EAAyE;AAC9E;AACAyc,qBAAazc,IAAb,GAAoBwc,IAApB;AACAA,eAAO,IAAP;AACD;;AAED;AACA,UAAIA,SAAS,IAAb,EAAmB;AACjB,iCAAS,2EAAT;AACA,YAAMtH,SAAQ,wBAAcvM,IAAd,EAAoB,KAAKE,QAAzB,EAAmC4T,YAAnC,CAAd;AACA,aAAK3G,QAAL,CAAcZ,MAAd;AACA,eAAOA,MAAP;AACD;;AAED;AACA;AACA,UAAIsH,OAAO,KAAK1F,CAAL,CAAO3D,GAAP,CAAWuJ,yBAAtB,EAAiD;AAC/C;AACAF,gBAAQ,KAAK3T,QAAb;AACD;;AAED,UAAMqM,QAAQ,wBAAcvM,IAAd,EAAoB6T,IAApB,EAA0BC,YAA1B,CAAd;AACA,WAAK5G,mBAAL,CAAyBX,KAAzB;AACA,aAAOA,KAAP;AACD;;;uCAEkB;AACjB,WAAKL,UAAL,CAAgB3T,MAAhB,CAAuB,CAAvB,EAA0B,CAA1B;AACD;;;gCAEWgU,K,EAAO;AACjB,WAAKL,UAAL,GAAkB,iBAAE8H,OAAF,CAAU,KAAK9H,UAAf,EAA2BK,KAA3B,CAAlB;AACD;;;qDAE8D;AAAA,UAAhC0H,OAAgC,uEAAtB,KAAKC,eAAiB;;AAC7D,WAAK,IAAIrf,IAAI,CAAb,EAAgBA,IAAI,KAAKqX,UAAL,CAAgBpX,MAApC,EAA4CD,GAA5C,EAAiD;AAC/C,YAAM0X,QAAQ,KAAKL,UAAL,CAAgBrX,CAAhB,CAAd;AACA,YAAK0X,MAAM/L,QAAN,KAAmB,KAApB,IAA+B+L,MAAM/L,QAAN,KAAmByT,OAAtD,EAAgE;AAC9D,iBAAO,KAAK/H,UAAL,CAAgB3T,MAAhB,CAAuB1D,CAAvB,CAAP;AACD;AACF;;AAED,aAAO2I,SAAP;AACD;;;2CAEoD;AAAA;;AAAA,UAAhCyW,OAAgC,uEAAtB,KAAKC,eAAiB;;AACnD,UAAMC,WAAW,EAAjB;AACA,WAAK,IAAItf,IAAI,CAAb,EAAgBA,IAAI,KAAKqX,UAAL,CAAgBpX,MAApC,EAA4CD,GAA5C,EAAiD;AAC/C,YAAM0X,QAAQ,KAAKL,UAAL,CAAgBrX,CAAhB,CAAd;AACA,YAAK0X,MAAM/L,QAAN,KAAmB,KAApB,IAA+B+L,MAAM/L,QAAN,KAAmByT,OAAtD,EAAgE;AAC9DE,mBAASlb,IAAT,CAAcpE,CAAd;AACD;AACF;;AAED,aAAO,mBAAKqX,UAAL,EAAgBzP,WAAhB,mBAA+B0X,QAA/B,CAAP,CATmD,CASH;AACjD;;;qCAEgB;AACf,WAAKjI,UAAL,GAAkB,EAAlB;AACD;;;6CAEwB;AACvB,WAAKoC,kBAAL,GAA0B,EAA1B;AACD;;;mCAEc;AACb,aAAQ,KAAKpC,UAAL,CAAgBpV,MAAhB,CAAuB,KAAKwX,kBAA5B,CAAR;AACD;;AAED;;;;;;;kDAI8B/B,K,EAAO;AACnCA,YAAMlV,IAAN,CAAWgJ,SAAX,GAAuB,KAAKH,QAA5B;AACAqM,YAAM9L,OAAN,GAAgB,IAAhB;;AAEA,+BAAS,gEAAT;;AAEA,UAAI,KAAKuN,WAAL,CAAiB7Y,WAAjB,0BAAJ,EAAkD;AAChD,aAAKif,UAAL,CAAgB7H,KAAhB;AACD,OAFD,MAEO;AACL,kCAAU,wFAAV;AACD;AACF;;;sCAEiB;AAChB,WAAK8H,iBAAL,GAAyB,IAAzB;AACA,WAAKC,eAAL,GAAuB,KAAKpI,UAA5B;AACA;AACA;AACD;;;wCAE2C;AAAA,UAA1BqI,iBAA0B,uEAAN,IAAM;;AAC1C,WAAKF,iBAAL,GAAyB,KAAzB;;AAEA,UAAIE,iBAAJ,EAAuB;AACrB;AACA;AACA,aAAKZ,cAAL;AACD,OAJD,MAIO;AACL;AACD;AACF;;AAED;;AAEA;;;;;;;;;;0CAOsB1I,Q,EAAUmC,S,EAAiC;AAC/D,UAAI;AAAA,2CADwCC,iBACxC;AADwCA,2BACxC;AAAA;;AACF,mDAAcpC,QAAd,EAAwBmC,SAAxB,SAAsCC,iBAAtC;AACA,yDAAoBC,QAApB,SAAiCD,iBAAjC;;AAEA,YAAI,iBAAElO,GAAF,CAAM,KAAKqP,MAAX,EAAmBvD,QAAnB,CAAJ,EAAkC;AAAA;;AAChC,mCAAKuD,MAAL,CAAYvD,QAAZ,GAAsBwC,sBAAtB,0BAA6CL,SAA7C,EAAwD,IAAxD,SAAiEC,iBAAjE,GADgC,CACoD;AACrF,SAFD,MAEO;AACL,gBAAM,IAAI3Y,KAAJ,wCAA8CuW,QAA9C,kEAAN;AACD;AACF,OATD,CASE,OAAO3T,CAAP,EAAU;AACV,mCAAWA,CAAX;AACD;AACF;;AAED;;;;;;;;;gDAMqG;AAAA,UAA3E2T,QAA2E,uEAAhE,2BAAgE;AAAA,UAAnD4B,gBAAmD,uEAAhC,2BAAgC;AAAA,UAAnB7F,SAAmB,uEAAP,KAAO;;AACnG,UAAI,iBAAE7H,GAAF,CAAM,KAAKqP,MAAX,EAAmBvD,QAAnB,CAAJ,EAAkC;AAChC,aAAKuD,MAAL,CAAYvD,QAAZ,EAAsByC,sBAAtB,CAA6C,WAA7C,EAA0D1G,SAA1D,EAAqE6F,gBAArE;AACD,OAFD,MAEO;AACL,0EAA+C5B,QAA/C;AACD;AACF;;;6CAEiG;AAAA,UAA3EA,QAA2E,uEAAhE,2BAAgE;AAAA,UAAnD4B,gBAAmD,uEAAhC,2BAAgC;AAAA,UAAnB7F,SAAmB,uEAAP,KAAO;;AAChG,UAAI,iBAAE7H,GAAF,CAAM,KAAKqP,MAAX,EAAmBvD,QAAnB,CAAJ,EAAkC;AAChC,aAAKuD,MAAL,CAAYvD,QAAZ,EAAsByC,sBAAtB,CAA6C,QAA7C,EAAuD1G,SAAvD,EAAkE6F,gBAAlE;AACD,OAFD,MAEO;AACL,0EAA+C5B,QAA/C;AACD;AACF;;;6CAEiG;AAAA,UAA3EA,QAA2E,uEAAhE,2BAAgE;AAAA,UAAnD4B,gBAAmD,uEAAhC,2BAAgC;AAAA,UAAnB7F,SAAmB,uEAAP,KAAO;;AAChG,UAAI,iBAAE7H,GAAF,CAAM,KAAKqP,MAAX,EAAmBvD,QAAnB,CAAJ,EAAkC;AAChC,aAAKuD,MAAL,CAAYvD,QAAZ,EAAsByC,sBAAtB,CAA6C,QAA7C,EAAuD1G,SAAvD,EAAkE6F,gBAAlE;AACA,oHAAyF5B,QAAzF;AACD,OAHD,MAGO;AACL,0EAA+CA,QAA/C;AACD;AACF;;AAED;AACA;;;;;;;;;6CAMwD;AAAA,UAAjCuJ,IAAiC,uEAA1B,2BAA0B;AAAA,UAAbzR,IAAa,uEAAN,IAAM;;AACtD,UAAIyR,KAAKrf,WAAL,KAAqBmY,QAAzB,EAAmC;AACjC,mCAAW,6DAAX;AACD,OAFD,MAEO;AACL;AACA;AACA,YAAIvK,SAAS,IAAb,EAAmB;AAAEA,iBAAOyR,KAAKzR,IAAZ;AAAkB;;AAEvC,aAAKoM,eAAL,CAAqBpM,IAArB,IAA6ByR,IAA7B;AACD;AACF;;AAED;;;;;;;;+BAKuB;AAAA,yCAAXC,SAAW;AAAXA,iBAAW;AAAA;;AACrB,WAAK,IAAI5f,IAAI,CAAb,EAAgBA,IAAI4f,UAAU3f,MAA9B,EAAsCD,GAAtC,EAA2C;AACzC,aAAK6f,sBAAL,CAA4BD,UAAU5f,CAAV,CAA5B;AACD;AACF;;AAED;;;;uCACmBkO,I,EAAe;AAAA,yCAANnO,IAAM;AAANA,YAAM;AAAA;;AAChC,WAAKuV,IAAL,cAAUpH,IAAV,SAAmBnO,IAAnB;AACD;;AAED;;;;;;;;;yBAMKmO,I,EAAe;AAClB,UAAI,OAAOA,IAAP,KAAgB,WAApB,EAAiC;AAC/B,mCAAW,8DAAX;AACD,OAFD,MAEO,IAAI,iBAAE5D,GAAF,CAAM,KAAKgQ,eAAX,EAA4BpM,IAA5B,CAAJ,EAAuC;AAAA,2CAHlCnO,IAGkC;AAHlCA,cAGkC;AAAA;;AAC5C,eAAQ,KAAKua,eAAL,CAAqBpM,IAArB,EAA2B5O,IAA3B,CAAgC,KAAK8X,OAArC,mBAAiDrX,IAAjD,CAAR;AACD,OAFM,MAEA;AACL,4FAAiEmO,IAAjE;AACD;AACD,aAAOvF,SAAP;AACD;;;4BAEOuF,I,EAAe;AACrB,UAAI,OAAOA,IAAP,KAAgB,WAApB,EAAiC;AAC/B,mCAAW,wDAAX;AACD,OAFD,MAEO,IAAI,iBAAE5D,GAAF,CAAM,KAAKgQ,eAAX,EAA4BpM,IAA5B,CAAJ,EAAuC;AAAA,2CAH/BnO,IAG+B;AAH/BA,cAG+B;AAAA;;AAC5C,eAAQ,mBAAQoX,MAAR,CAAe,KAAKmD,eAAL,CAAqBpM,IAArB,CAAf,EAA2C5O,IAA3C,CAAgD,KAAK8X,OAArD,mBAAiErX,IAAjE,CAAR;AACD,OAFM,MAEA;AACL,6GAAkFmO,IAAlF;AACD;;AAED,aAAOvF,SAAP;AACD;;AAED;;;;;;;;;;;8CAQ2F;AAAA,UAAnEuF,IAAmE,uEAA5D,2BAA4D;AAAA,UAA/CvM,MAA+C,uEAAtC,2BAAsC;;AAAA;;AAAA,UAAzB5B,IAAyB,uEAAlB,EAAkB;AAAA,UAAd+f,OAAc,uEAAJ,EAAI;;AACzF,UAAI,CAAC,iBAAExV,GAAF,CAAM,KAAKgQ,eAAX,EAA4BpM,IAA5B,CAAL,EAAwC;AACtC,gHAAqFA,IAArF;AACA,eAAO,IAAP;AACD;AACC;AACF,UAAIvM,WAAW,CAAf,EAAkB;AAChB,eAAO,uBAAY,UAACT,OAAD,EAAa;AAC9BA,kBAAQ4e,OAAR;AACD,SAFM,CAAP;AAGD;;AAGD,UAAMhe,OAAO,KAAKS,OAAL,cAAa2L,IAAb,4BAAsBnO,IAAtB,IAA4Be,IAA5B,CAAiC,UAACkB,CAAD,EAAO;AACnD8d,kBAAUA,QAAQ7d,MAAR,CAAeD,CAAf,CAAV;AACA,eAAQ,OAAK+d,uBAAL,CAA6B7R,IAA7B,EAAmCvM,SAAS,CAA5C,EAA+C5B,IAA/C,EAAqD+f,OAArD,CAAR;AACD,OAHY,CAAb;;AAKA,aAAOhe,IAAP;AACD;;AAED;;;;;;;;;;;8BAQ2E;AAAA,UAAnEoM,IAAmE,uEAA5D,2BAA4D;AAAA,UAA/CvM,MAA+C,uEAAtC,2BAAsC;AAAA,UAAzB5B,IAAyB,uEAAlB,EAAkB;AAAA,UAAd+f,OAAc,uEAAJ,EAAI;;AACzE,WAAKC,uBAAL,CAA6B7R,IAA7B,EAAmCvM,MAAnC,EAA2C5B,IAA3C,EAAiD+f,OAAjD;AACD;;AAED;;;;;;;;gCAK0C;AAAA,UAAhC5R,IAAgC,uEAAzB,2BAAyB;AAAA,UAAZ8R,UAAY;;AACxC,UAAI,KAAK3F,OAAL,CAAa7S,cAAb,CAA4B0G,IAA5B,CAAJ,EAAuC;AACrC,eAAQ,KAAKmM,OAAL,CAAanM,IAAb,CAAR;AACD,OAFD,MAEO,IAAI,OAAO8R,UAAP,KAAsB,WAA1B,EAAuC;AAC5C,aAAK3F,OAAL,CAAanM,IAAb,IAAqB8R,UAArB;AACA,eAAO,KAAK3F,OAAL,CAAanM,IAAb,CAAP;AACD;AACD,qFAA4DA,IAA5D;AACA,aAAQ,IAAR;AACD;;;0BAEmC;AAAA,UAAhCA,IAAgC,uEAAzB,2BAAyB;AAAA,UAAZ8R,UAAY;;AAClC,aAAQ,KAAKlH,SAAL,CAAe5K,IAAf,EAAqB8R,UAArB,CAAR;AACD;;AAED;;;;;;;;;gCAMmD;AAAA,UAAzC9R,IAAyC,uEAAlC,2BAAkC;AAAA,UAArBlF,KAAqB,uEAAb,2BAAa;;AACjD,WAAKqR,OAAL,CAAanM,IAAb,IAAqBlF,KAArB;AACA,2DAAkCkF,IAAlC,oBAAmDlF,KAAnD;AACD;;;0BAE4C;AAAA,UAAzCkF,IAAyC,uEAAlC,2BAAkC;AAAA,UAArBlF,KAAqB,uEAAb,2BAAa;;AAC3C,WAAK+P,SAAL,CAAe7K,IAAf,EAAqBlF,KAArB;AACD;;;mCAEc+R,G,EAAK;AAClB,UAAI,iBAAEzQ,GAAF,CAAM,KAAKqP,MAAX,EAAmBoB,GAAnB,CAAJ,EAA6B;AAC3B,eAAQ,KAAKpB,MAAL,CAAYoB,GAAZ,CAAR;AACD;AACD,iCAAW,kCAAX;AACD;;AAED;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;;;;;;;;wBAKc;AACZ,UAAI,KAAK/B,WAAT,EAAsB;AACpB,eAAQ,KAAKA,WAAL,CAAiBC,UAAjB,CAA4B,IAA5B,CAAR;AACD;AACD,aAAQ;AACNC,oBAAY,IADN;AAENC,qBAAa,KAAKA,WAFZ;AAGNC,eAAO,KAAK5M,OAHN,EAGe;AACrB2J,sBAAc,IAJR;AAKNkD,eAAO,KAAKkB,YALN;AAMNjB,WAAG,KAAKA;AANF,OAAR;AAQD;;;wBAEe;AACd,aAAQ1P,OAAOmC,IAAP,CAAY,KAAK4N,MAAjB,CAAR;AACD;;;wBAEqB;AACpB,aAAQ,KAAKQ,gBAAb;AACD,K;sBAEmBY,G,EAAK;AACvB,UAAI,iBAAEzQ,GAAF,CAAM,KAAKqP,MAAX,EAAmBoB,GAAnB,CAAJ,EAA6B;AAC3B,aAAK6C,SAAL,CAAe7C,GAAf;AACD,OAFD,MAEO;AACL,mCAAW,kCAAX;AACD;AACF;;;wBAEkB;AACjB,aAAO,KAAKpB,MAAL,CAAY,KAAK0F,eAAjB,CAAP;AACD,K;sBAEgBhG,K,EAAO;AACtB,UAAI,OAAOA,MAAM0B,GAAb,KAAqB,WAAzB,EAAsC;AACpC,aAAKsE,eAAL,GAAuBhG,MAAM0B,GAA7B;AACD,OAFD,MAEO;AACL,mCAAW,2DAAX;AACD;AACF;;;wBAEe;AACd,aAAQ,KAAK1D,UAAb;AACD,K;sBAEarO,K,EAAO;AAAE;AACrB,iCAAW,4EAAX;AACD;;;wBAEgB;AACf,UAAI,KAAKqO,UAAL,CAAgBpX,MAApB,EAA4B;AAC1B,eAAQ,KAAKoX,UAAL,CAAgB,CAAhB,CAAR;AACD;AACD,aAAO1O,SAAP;AACD,K;sBAEcK,K,EAAO;AACpB;AACA,iCAAW,uCAAX;AACD;;AAED;;;;wBAEW;AACT,aAAQ,KAAKqC,QAAb;AACD;;;wBAEe;AACd,aAAQ,IAAIc,IAAJ,GAAWC,OAAX,KAAuB,IAA/B;AACD;;;wBAEc;AACb,aAAQ,IAAID,IAAJ,GAAWC,OAAX,EAAR;AACD;;;;;;kBAn+BkBmN,Y;;;;;;ACtBrB;AACA;;AAEA;AACA;AACA;AACA;;AAEA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,SAAS;AACT;AACA;AACA,KAAK;AACL;AACA;AACA;AACA;AACA;AACA,SAAS;AACT;AACA;AACA,KAAK;AACL;AACA;AACA,CAAC;AACD;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,KAAK;AACL;AACA;AACA;AACA,SAAS;AACT;AACA;AACA;AACA;;;AAGA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,KAAK;AACL;AACA;AACA;AACA,SAAS;AACT;AACA;AACA;AACA;AACA;;;;AAIA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,KAAK;AACL;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA,uBAAuB,sBAAsB;AAC7C;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,qBAAqB;AACrB;;AAEA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;;AAEA,2BAA2B;AAC3B;AACA;AACA;AACA,4BAA4B,UAAU;;;;;;;ACnLtC;;AAEA;AACA;AACA;AACA,CAAC;;AAED;AACA;AACA;AACA,CAAC;AACD;AACA;AACA;AACA;;AAEA;AACA;AACA,4CAA4C;;AAE5C;;;;;;;ACpBA,gD;;;;;;ACAA,gD;;;;;;ACAA,gD;;;;;;;;;;;;;qjBCAA;;;;;;;;;AASA;;;AACA;;;;AACA;;;;AAEA;;AACA;;;;AACA;;;;AAEA;;;;AACA;;;;AACA;;;;AACA;;;;AACA;;;;AAEA;;;;;;;;AAaA,IAAI,OAAOzF,MAAP,KAAkB,WAAtB,EAAmC;AACjC;AACA,MAAMmM,UAAUC,SAASC,oBAAT,CAA8B,QAA9B,CAAhB;AACA,MAAIF,QAAQhgB,MAAZ,EAAoB;AAClB,QAAMmgB,uBAAuBH,QAAQA,QAAQhgB,MAAR,GAAiB,CAAzB,EAA4BkE,GAAzD;AACA,QAAMkc,mBAAmBD,qBAAqB7Z,SAArB,CAA+B,GAA/B,CAAzB;AACAuN,WAAOsM,oBAAP,GAA8BA,qBAAqBzZ,MAArB,CAA4B,CAA5B,EAA+B0Z,iBAAiBA,iBAAiBpgB,MAAjB,GAA0B,CAA3C,CAA/B,CAA9B;AACD,GAJD,MAIO;AACL6T,WAAOsM,oBAAP,GAA8B,IAA9B;AACD;AACF;;AAED;;IACqBE,U;AACnB;;;;;AAKA,wBAEsB;AAAA,QAFV1e,MAEU,uEAFD,2BAEC;AAAA,QADpB2e,YACoB,uEADL,IACK;AAAA,QAApBC,MAAoB,uEAAX,SAAW;;AAAA;;AACpB,QAAI,OAAO1M,MAAP,KAAkB,WAAtB,EAAmC;AAAE;AACnC,aAAO,EAAEpU,OAAO,4DAAT,EAAP;AACD;AACD;AACA;;AAEA;AACA,SAAK+gB,OAAL,GAAgB,OAAO7e,OAAO3B,MAAd,KAAyB,WAA1B,GAAyC2B,OAAO,CAAP,CAAzC,GAAqDA,MAApE;AACA,SAAKyc,MAAL,GAAc,KAAKoC,OAAnB;;AAEA;AACA,QAAID,WAAW,SAAf,EAA0B;AACxB;AACA,WAAKA,MAAL,GAAc,IAAI,8BAAQE,MAAZ,CAAmB,KAAKrC,MAAxB,EAAgC,KAAhC,EAAuC,IAAvC,EAA6C,KAA7C,CAAd,CAFwB,CAE0C;AACnE,KAHD,MAGO;AACL,YAAM,IAAIxe,KAAJ,CAAU,+CAAV,CAAN;AACD;;AAED;AACA,SAAKiG,MAAL,GAAcgO,OAAO6M,WAArB;AACA,SAAK9a,KAAL,GAAaiO,OAAO8M,UAApB;AACA,SAAKC,mBAAL,GAA2B,KAAKxC,MAAL,CAAYvY,MAAvC;AACA,SAAKgb,kBAAL,GAA0B,KAAKzC,MAAL,CAAYxY,KAAtC;;AAEA;;;;AAIA,SAAKsT,WAAL,GAAmB,0BAAgB,IAAhB,CAAnB;;AAEA;;;;;AAKA,SAAKvJ,UAAL,GAAkB,IAAlB;;AAEA;AACA,QAAMmR,kBAAkB,KAAK5H,WAAL,CAAiBjM,iBAAzC;;AAEA;AACA;AACA,SAAKiM,WAAL,CAAiBhM,QAAjB,CAA0B,WAA1B,EAAuC4T,eAAvC;AACA,SAAK5H,WAAL,CAAiBhM,QAAjB,CAA0B,aAA1B,EAAyC4T,eAAzC;;AAEA;AACA,QAAMC,mBAAmB,CAAC,OAAD,EAAU,YAAV,CAAzB;AACA,SAAK7H,WAAL,CAAiBhM,QAAjB,CAA0B,YAA1B,EAAwC6T,gBAAxC;;AAEA;AACA,QAAMC,oBAAoB,CAAC,MAAD,EAAS,YAAT,CAA1B;AACA,SAAK9H,WAAL,CAAiBhM,QAAjB,CAA0B,aAA1B,EAAyC8T,iBAAzC;;AAEA;AACA,QAAMC,mBAAmB,CAAC,MAAD,EAAS,YAAT,CAAzB;AACA,SAAK/H,WAAL,CAAiBhM,QAAjB,CAA0B,aAA1B,EAAyC+T,gBAAzC;;AAEA;AACA;;;;AAIA,QAAIX,YAAJ,EAAkB;AAChB,WAAKY,aAAL,GAAqBZ,YAArB;AACD,KAFD,MAEO;AACL,WAAKY,aAAL,GAAqBrN,OAAOsM,oBAA5B;AACD;;AAED,SAAKgB,iBAAL,GAA4B,KAAKD,aAAjC;;AAEA;;;;AAIA,SAAKE,YAAL,GAAoB,EAApB;;AAEA,SAAK/H,CAAL,GAAS,gCAAT;AACA,SAAKA,CAAL,CAAOhW,GAAP,CAAW;AACTqW,cAAQ;AACNG,gBAAQ,QADF;AAENF,cAAM,MAFA;AAGNC,eAAO;AAHD,OADC;AAMTyH,eAAS;AACPf,sBAAcA,gBAAgBzM,OAAOsM;AAD9B;AANA,KAAX;;AAYA;AACA,SAAKmB,KAAL,GAAa,EAAb;AACA,SAAKC,QAAL,GAAgB,EAAhB,CA5FoB,CA4FD;AACnB,SAAKC,eAAL,GAAuB,OAAO3N,OAAO4N,cAAd,KAAiC,WAAjC,GAA+C5N,OAAO4N,cAAtD,GAAuE,KAA9F;AACA,SAAKC,iBAAL;;AAEA;AACA,SAAKC,YAAL,GAAoB,IAApB;;AAEA;AACA,SAAKC,UAAL,GAAkB,EAAlB;;AAEA;AACA,SAAKhS,SAAL,GAAiB,EAAjB;AACA,SAAKA,SAAL,CAAeiS,oBAAf,GAAsC,IAAtC;;AAEA;AACA,SAAKC,MAAL,GAAc,EAAd;AACA,SAAKC,eAAL,GAAuB,EAAvB;AACA,SAAKA,eAAL,CAAqBpC,SAArB,GAAiC,EAAjC;AACA,SAAKoC,eAAL,CAAqBC,gBAArB,GAAwC,EAAxC;;AAEA;AACA,SAAKD,eAAL,CAAqBE,OAArB,GAA+B5B,WAAW6B,uBAA1C;AACA,SAAKH,eAAL,CAAqBI,cAArB,GAAsC,EAAEnL,UAAU,SAAZ,EAAuBoL,kBAAkB,IAAzC,EAAtC;;AAEA,SAAKC,gBAAL,GAAwB,EAAxB;;AAEA;AACA,SAAKC,SAAL,GAAiB,IAAjB;;AAEA;AACA,QAAI,qCAAoB,UAAxB,EAAoC;AAClC,WAAKA,SAAL,GAAiB,+BAAjB;AACD;AACF;;AAED;AACA;;;;;;;;;;;6CAUiI;AAAA,UAA1GC,cAA0G,uEAAzF,0BAAU,gBAAV,CAAyF;AAAA,UAA5D/E,OAA4D,uEAAlD,EAAkD;AAAA,UAA9CyE,OAA8C,uEAApC,KAAoC;AAAA,UAA7B3f,OAA6B,uEAAnB,KAAmB;AAAA,UAAZwY,GAAY,uEAAN,IAAM;;AAC/H;AACA0C,gBAAU,iBAAEgF,KAAF,CAAQhF,OAAR,CAAV;;AAEA,UAAK1C,QAAQ,IAAT,IAAmByH,eAAetU,IAAf,KAAwB,EAA/C,EAAoD;AAClD6M,cAAMyH,eAAetU,IAArB;AACD,OAFD,MAEO;AACL6M,wBAAcnR,OAAOmC,IAAP,CAAY,KAAKiW,eAAL,CAAqBpC,SAAjC,EAA4C3f,MAA1D;AACD;;AAED,UAAIiiB,OAAJ,EAAa;AACX,aAAKF,eAAL,CAAqBE,OAArB,GAA+BM,cAA/B;AACA,aAAKR,eAAL,CAAqBI,cAArB,GAAsC3E,OAAtC;AACD,OAHD,MAGO;AACL,aAAKuE,eAAL,CAAqBpC,SAArB,CAA+B7E,GAA/B,IAAsCyH,cAAtC;AACA,aAAKR,eAAL,CAAqBC,gBAArB,CAAsClH,GAAtC,IAA6C0C,OAA7C;AACD;AACF;;;8CAEkH;AAAA,UAA3FiF,qBAA2F,uEAAnE,0BAAU,uBAAV,CAAmE;AAAA,UAA/BjF,OAA+B,uEAArB,EAAqB;AAAA,UAAjBlb,OAAiB,uEAAP,KAAO;;AACjH;AACAkb,cAAQxG,QAAR,GAAmB,SAAnB;;AAEA,WAAK0L,sBAAL,CACED,qBADF,EAEEjF,OAFF,EAGE,IAHF,EAIElb,OAJF;AAMD;;;yCAEqC;AAAA;;AAAA,UAAnBwY,GAAmB,uEAAb,2BAAa;;AACpC,UAAM6H,eAAe,KAAKZ,eAAL,CAAqBC,gBAArB,CAAsClH,GAAtC,CAArB;AACA,UAAM8H,YAAY,KAAKb,eAAL,CAAqBpC,SAArB,CAA+B7E,GAA/B,CAAlB;;AAEA,UAAMxY,UAAU,mBAAQ4U,MAAR,CAAe0L,UAAUvjB,IAAV,CAAe,KAAK8X,OAApB,CAAf,EAA6CwL,YAA7C,EACb9hB,IADa,CACR,UAACsY,KAAD,EAAW;AACf,YAAI,OAAOA,MAAMnC,QAAb,KAA0B,WAA9B,EAA2C;AACzCmC,gBAAMnC,QAAN,GAAiB8D,GAAjB;AACD;;AAED,cAAKgH,MAAL,CAAY3I,MAAMnC,QAAlB,IAA8BmC,KAA9B;AACD,OAPa,CAAhB;;AASA,aAAO7W,OAAP;AACD;;;qCAEgB;AACf,UAAMugB,eAAelZ,OAAOmC,IAAP,CAAY,KAAKiW,eAAL,CAAqBpC,SAAjC,CAArB;AACA,UAAMnN,WAAW,EAAjB;AACA,WAAK,IAAIzS,IAAI,CAAb,EAAgBA,IAAI8iB,aAAa7iB,MAAjC,EAAyCD,GAAzC,EAA8C;AAC5CyS,iBAASrO,IAAT,CAAc,KAAK2e,kBAAL,CAAwBD,aAAa9iB,CAAb,CAAxB,CAAd;AACD;;AAED,aAAO,mBAAQsE,GAAR,CAAYmO,QAAZ,CAAP;AACD;;;2CAyD+D;AAAA,UAA3CuQ,MAA2C,uEAAlC,2BAAkC;AAAA,UAArB5J,KAAqB,uEAAb,2BAAa;;AAC9D,UAAI4J,OAAO1iB,WAAP,qBAAJ,EAAkC;AAChC0iB,iBAAS,CAACA,MAAD,CAAT;AACD;;AAED,UAAMC,cAAc,EAApB;AACA,WAAK,IAAIjjB,IAAI,CAAb,EAAgBA,IAAIgjB,OAAO/iB,MAA3B,EAAmCD,GAAnC,EAAwC;AACtC,YAAMyiB,QAAQO,OAAOhjB,CAAP,EAAUyiB,KAAV,EAAd;AACAA,cAAMS,MAAN,GAAe9J,KAAf;;AAEA,YAAI4J,OAAOhjB,CAAP,EAAUM,WAAV,KAA0B,8BAAQ6iB,IAAtC,EAA4C;AAC1C,cAAIV,MAAMW,QAAV,EAAoB;AAClBX,kBAAMW,QAAN,GAAiBX,MAAMW,QAAN,CAAeX,KAAf,EAAjB;AACAA,kBAAMW,QAAN,CAAeF,MAAf,GAAwB9J,KAAxB;AACA,gBAAIqJ,MAAMW,QAAN,CAAeC,YAAnB,EAAiC;AAC/B,mBAAK,IAAIze,IAAI,CAAb,EAAgBA,IAAI6d,MAAMW,QAAN,CAAeC,YAAf,CAA4BpjB,MAAhD,EAAwD2E,GAAxD,EAA6D;AAC3D6d,sBAAMW,QAAN,CAAeC,YAAf,CAA4Bze,CAA5B,IAAiC6d,MAAMW,QAAN,CAAeC,YAAf,CAA4Bze,CAA5B,EAA+B6d,KAA/B,EAAjC;AACAA,sBAAMW,QAAN,CAAeC,YAAf,CAA4Bze,CAA5B,EAA+Bse,MAA/B,GAAwC9J,KAAxC;AACD;AACF;AACF;AACDA,gBAAMkK,OAAN,CAAcb,KAAd;AACD;;AAEDQ,oBAAY7e,IAAZ,CAAiBqe,KAAjB;AACD;;AAED,aAAOQ,WAAP;AACD;;;iCAE4E;AAAA,UAAlEM,WAAkE,uEAApD,2BAAoD;AAAA,UAAvCnK,KAAuC,uEAA/B,2BAA+B;AAAA,UAAlBoK,WAAkB,uEAAJ,EAAI;;AAC3E,UAAID,YAAYjjB,WAAZ,KAA4BsJ,MAAhC,EAAwC;AACtC,cAAM,IAAI/J,KAAJ,CAAU,qDAAV,CAAN;AACD;;AAED,UAAK2jB,gBAAgB,EAAjB,IAAyB,OAAO,KAAKrC,aAAZ,KAA8B,WAA3D,EAAyE;AACvEqC,sBAAc,KAAKrC,aAAnB;AACD;;AAED,UAAMsC,iBAAiB,CAAC,KAAD,EAAQ,KAAR,EAAe,KAAf,EAAsB,MAAtB,EAA8B,KAA9B,CAAvB;AACA,UAAMC,eAAe,CAAC,KAAD,EAAQ,KAAR,EAAe,MAAf,EAAuB,KAAvB,EAA8B,KAA9B,EAAqC,KAArC,CAArB;;AAEA,UAAMC,eAAe,IAAI,8BAAQC,aAAZ,CAA0BxK,KAA1B,CAArB;AACA,UAAME,IAAI,KAAKA,CAAf;;AAEA,UAAMuK,iBAAiB,EAAvB;;AAEA,UAAM1S,QAAQvH,OAAOmC,IAAP,CAAYwX,WAAZ,CAAd;AACA,UAAI5U,cAAJ;AACA,UAAItG,aAAJ;AACA,UAAIuK,aAAJ;AACA,WAAK,IAAI5S,IAAI,CAAb,EAAgBA,IAAImR,MAAMlR,MAA1B,EAAkCD,GAAlC,EAAuC;AACrC2O,gBAAQ4U,YAAYpS,MAAMnR,CAAN,CAAZ,CAAR;;AAEA,YAAI2O,MAAMrO,WAAN,sBAAJ,EAAkC;AAChCsS,iBAAO,KAAKuO,aAAL,GAAqBxS,KAA5B;;AAEA,cAAI8U,eAAe9Z,OAAf,CAAuB2P,EAAE3G,SAAF,CAAYC,IAAZ,CAAvB,MAA8C,CAAC,CAAnD,EAAsD;AACpDvK,mBAAO,SAAP;AACD,WAFD,MAEO,IAAIqb,aAAa/Z,OAAb,CAAqB2P,EAAE3G,SAAF,CAAYC,IAAZ,CAArB,MAA4C,CAAC,CAAjD,EAAoD;AACzDvK,mBAAO,OAAP;AACD,WAFM,MAEA;AACLjJ,oBAAQI,IAAR,CAAa,+HAAb;AACA6I,mBAAO,SAAP;AACD;AACF,SAXD,MAWO,IAAKsG,MAAMrO,WAAN,KAAsBsJ,MAAvB,IAAmCA,OAAOmC,IAAP,CAAY4C,KAAZ,EAAmBlF,QAAnB,CAA4B,CAAC,MAAD,EAAS,MAAT,CAA5B,CAAvC,EAAuF;AAC5FmJ,iBAAO,KAAKuO,aAAL,GAAqBxS,MAAMiE,IAAlC;AACAvK,iBAAOsG,MAAMtG,IAAb;AACD,SAHM,MAGA;AACLjJ,kBAAQI,IAAR,CAAa,sCAAb;AACA6I,iBAAO,SAAP;AACD;;AAED,YAAIA,SAAS,SAAb,EAAwB;AACtB,cAAMyb,mBAAmBH,aAAaI,cAAb,CAA+B5S,MAAMnR,CAAN,CAA/B,WAA+C4S,IAA/C,CAAzB;AACAkR,2BAAiBE,SAAjB,GAA6B,UAAUC,IAAV,EAAgB;AAC3C3K,cAAEhW,GAAF,CAAM;AACJ4gB,4CACG,KAAKC,WADR,EACsBF,KAAKG,OAD3B;AADI,aAAN;AAKD,WAN4B,CAM3B9kB,IAN2B,CAMtB;AACL6kB,yBAAahT,MAAMnR,CAAN;AADR,WANsB,CAA7B;AASD,SAXD,MAWO,IAAIqI,SAAS,OAAb,EAAsB;AAC3B,cAAMyb,oBAAmBH,aAAaU,iBAAb,CAAkClT,MAAMnR,CAAN,CAAlC,WAAkD4S,IAAlD,CAAzB;AACAkR,4BAAiBE,SAAjB,GAA6B,UAAUC,IAAV,EAAgB;AAC3C,gBAAMK,UAAU,yBAAhB;AACAT,2BAAezf,IAAf,CAAoBkgB,QAAQ/hB,OAA5B;AACA+W,cAAEhW,GAAF,CAAM;AACJihB,0CACG,KAAKC,SADR,EACoB,IAAI,8BAAQC,KAAZ,CAAkB,KAAKD,SAAvB,EAAkCP,KAAKzhB,IAAvC,EAA6C4W,KAA7C,EAAoDkL,QAAQpjB,OAA5D,CADpB;AADI,aAAN;AAKD,WAR4B,CAQ3B5B,IAR2B,CAQtB;AACLklB,uBAAWrT,MAAMnR,CAAN;AADN,WARsB,CAA7B;AAWD;AACD;AACD;;AAED;AACA,UAAM0kB,eAAe,yBAArB;;AAEAf,mBAAagB,IAAb;AACAhB,mBAAaiB,QAAb,GAAwB,SAASA,QAAT,CAAkBC,KAAlB,EAAyB;AAC/C,iCAAS,wCAAT,EAAmDA,KAAnD;AACA,2BAAQvgB,GAAR,CAAYuf,cAAZ,EAA4B/iB,IAA5B,CAAiC;AAAA,iBAAM4jB,aAAaxjB,OAAb,CAAqB2jB,KAArB,CAAN;AAAA,SAAjC;AACD,OAHD;;AAKA,aAAOH,aAAaniB,OAApB;AACD;;;0CAE6D;AAAA,UAA1CuiB,KAA0C,uEAAlC,2BAAkC;AAAA,UAArB1L,KAAqB,uEAAb,2BAAa;;AAC5D;AACA,UAAI0L,MAAMxkB,WAAN,qBAAJ,EAAiC;AAC/B,eAAO,KAAKykB,oBAAL,CAA0BD,KAA1B,EAAiC1L,KAAjC,CAAP;AACD;;AAED,UAAMqJ,QAAQqC,MAAMrC,KAAN,EAAd;AACAA,YAAMS,MAAN,GAAe9J,KAAf;;AAEA,UAAI0L,MAAMxkB,WAAN,KAAsB,8BAAQ6iB,IAAlC,EAAwC;AACtC,YAAIV,MAAMW,QAAV,EAAoB;AAClBX,gBAAMW,QAAN,GAAiBX,MAAMW,QAAN,CAAeX,KAAf,EAAjB;AACAA,gBAAMW,QAAN,CAAeF,MAAf,GAAwB9J,KAAxB;AACA,cAAIqJ,MAAMW,QAAN,CAAeC,YAAnB,EAAiC;AAC/B,iBAAK,IAAIrjB,IAAI,CAAb,EAAgBA,IAAIyiB,MAAMW,QAAN,CAAeC,YAAf,CAA4BpjB,MAAhD,EAAwDD,GAAxD,EAA6D;AAC3DyiB,oBAAMW,QAAN,CAAeC,YAAf,CAA4BrjB,CAA5B,IAAiCyiB,MAAMW,QAAN,CAAeC,YAAf,CAA4BrjB,CAA5B,EAA+ByiB,KAA/B,EAAjC;AACAA,oBAAMW,QAAN,CAAeC,YAAf,CAA4BrjB,CAA5B,EAA+BkjB,MAA/B,GAAwC9J,KAAxC;AACD;AACF;AACF;AACDA,cAAMkK,OAAN,CAAcb,KAAd;AACD;;AAED,aAAOA,KAAP;AACD;;AAED;AACA;AACA;;;;;;gCAGY;AAAA;;AACV,UAAI,OAAO3O,MAAP,KAAkB,WAAtB,EAAmC;AACjC,eAAO,mBAAQ5S,OAAR,EAAP;AACD;;AAED4S,aAAOkR,gBAAP,CAAwB,QAAxB,EAAkC,YAAM;AACtC,eAAKxE,MAAL,CAAYyE,MAAZ;AACD,OAFD;;AAIA,UAAMjhB,WAAW,yBAAjB;AACA;AACA,UAAMoe,iBAAiB,KAAKJ,eAAL,CAAqBI,cAA5C;AACA,UAAM8C,eAAgB,KAAKlD,eAAL,CAAqBE,OAArB,CAA6B5iB,IAA7B,CAAkC,KAAK8X,OAAvC,CAAD,CAAkDgL,cAAlD,CAArB;AACA8C,mBAAaC,cAAb,CAA4BrkB,IAA5B,CAAiC,YAAM;AACnC;AACF,eAAKihB,MAAL,CAAYG,OAAZ,GAAsBgD,YAAtB;;AAEE;AACF,eAAKE,YAAL,GAAoBF,aAAajO,QAAjC;;AAEA,YAAK,OAAOiO,aAAaC,cAApB,KAAuC,WAAxC,IAAyDD,aAAaC,cAAb,CAA4B7kB,WAA5B,uBAA7D,EAAmH;AACjH,iBAAO4kB,aAAaC,cAApB;AACD;AACD,eAAO,mBAAQjkB,OAAR,EAAP;AACD,OAXD,EAYGJ,IAZH,CAYQ,YAAM;AACV;AACA,eAAKqY,WAAL,CAAiBuB,OAAjB,CAAyB,aAAzB,EAAwC;AACtCvP,gBAAM,OAAKmO,CAAL,CAAO3D,GAAP,CAAW0P,eADqB;AAEtCja,sBAAY,OAAKC;AAFqB,SAAxC;;AAKA;AACA,eAAKmV,MAAL,CAAY8E,aAAZ,CAA0B,YAAM;AAC9B,iBAAKvD,MAAL,CAAY,OAAKqD,YAAjB,EAA+BG,MAA/B;AACD,SAFD;;AAIA;AACA,eAAO,OAAKC,cAAL,EAAP;AACD,OA1BH,EA2BG1kB,IA3BH,CA2BQ,UAACgQ,OAAD,EAAa;AACjB,iCAASA,OAAT;AACA9M,iBAAS9C,OAAT,CAAiB,mDAAjB;AACD,OA9BH;;AAgCA,aAAO8C,SAASzB,OAAhB;AACD;;AAED;AACA;;;;wCACoB;AAAA;;AAClB;AACA;AACA,UAAM+W,IAAI,KAAKA,CAAf;AACAA,QAAEhW,GAAF,CAAM;AACJie,eAAO,EAAE;AACPkE,qBAAW,WADN;AAELC,uBAAa,cAFR;AAGLC,qBAAW;AAHN,SADH;AAMJpO,gBAAQ;AACNqO,qBAAW,YADL;AAENC,iBAAO,aAFD;AAGNC,gBAAM,YAHA;AAIN/H,mBAAS,UAJH;AAKNgI,iBAAO,QALD;AAMNd,kBAAQ,QANF;AAONpL,iBAAO,OAPD;AAQNmM,sBAAY,aARN;AASNC,wBAAc,eATR;AAUNC,0BAAgB;AAVV;AANJ,OAAN;;AAoBA;AACApS,aAAOkR,gBAAP,CAAwB,SAAxB,EAAmC,UAACmB,GAAD,EAAS;AAC1C,iCAAS,4BAAT;AACA,iCAASA,GAAT;;AAEA;AACA,eAAKC,WAAL,CAAiBD,GAAjB;;AAEA;AACA,YAAME,YAAY,wBAChB/M,EAAE3D,GAAF,CAAM2Q,cADU,EAEhB,OAAKjb,QAFW,EAED;AACbE,qBAAW,CAAC,WAAD,EAAc,WAAd,CADE;AAEbC,qBAAW,IAFE;AAGbC,oBAAU,IAHG;AAIbiS,mBAASyI,IAAIzI;AAJA,SAFC,CAAlB;;AAUA;AACA,YAAI,OAAO,OAAK6I,kBAAZ,KAAmC,WAAvC,EAAoD;AAClD,cAAI,OAAO,OAAKA,kBAAL,CAAwBpQ,YAA/B,KAAgD,WAApD,EAAiE;AAC/D,mBAAKoQ,kBAAL,CAAwBpQ,YAAxB,CAAqCmC,QAArC,CAA8C+N,SAA9C;AACD;AACF;AACF,OAxBD;;AA0BA;AACA;AACAvS,aAAOkR,gBAAP,CAAwB,OAAxB,EAAiC,UAACmB,GAAD,EAAS;AACxC,eAAKC,WAAL,CAAiBD,GAAjB;AACD,OAFD;;AAIA;;;;;;;;;;;;;;;;AAmBArS,aAAOkR,gBAAP,CAAwB,WAAxB,EAAqC,UAACmB,GAAD,EAAS;AAC5C,iCAAS,8BAAT;AACA,iCAASA,GAAT;;AAEA,YAAME,YAAY,wBAChB/M,EAAE3D,GAAF,CAAM6Q,YADU,EAEhB,IAAIra,IAAJ,GAAWC,OAAX,EAFgB,EAEM;AACpBb,qBAAW,CAAC,WAAD,EAAc,aAAd,CADS;AAEpBC,qBAAW,IAFS;AAGpBC,oBAAU,IAHU;AAIpBgb,mBAASN,IAAIM,OAJO;AAKpBC,mBAASP,IAAIO,OALO;AAMpBC,mBAASR,IAAIM,OAAJ,IACN,OAAKG,UAAL,CAAgB/gB,KAAhB,GAAwBiO,OAAO8M,UADzB,CANW;AAQpBiG,mBAAS,CAAC/S,OAAO6M,WAAP,GAAqBwF,IAAIO,OAA1B,KACN,OAAKE,UAAL,CAAgB9gB,MAAhB,GAAyBgO,OAAO6M,WAD1B;AARW,SAFN,CAAlB;;AAeA;AACA,YAAI,OAAO,OAAK4F,kBAAZ,KAAmC,WAAvC,EAAoD;AAClD,cAAI,OAAO,OAAKA,kBAAL,CAAwBpQ,YAA/B,KAAgD,WAApD,EAAiE;AAC/D,mBAAKoQ,kBAAL,CAAwBpQ,YAAxB,CAAqCmC,QAArC,CAA8C+N,SAA9C;AACD;AACF;AACF,OAzBD;;AA4BAvS,aAAOkR,gBAAP,CAAwB,QAAxB,EAAkC,UAACmB,GAAD,EAAS;AACzC,iCAAS,2BAAT;AACA,iCAASA,GAAT;;AAEA,YAAME,YAAY,wBAChB/M,EAAE3D,GAAF,CAAMmR,aADU,EAEhB,OAAKzb,QAFW,EAED;AACbE,qBAAW,CAAC,WAAD,CADE;AAEbC,qBAAW,IAFE;AAGbC,oBAAU,IAHG;AAIbsb,uBAAaZ,IAAIvkB,MAAJ,CAAWmlB,WAJX;AAKbC,sBAAYb,IAAIvkB,MAAJ,CAAWolB;AALV,SAFC,CAAlB;;AAWA;AACA;AACA,YAAI,OAAO,OAAKT,kBAAZ,KAAmC,WAAvC,EAAoD;AAClD,cAAI;AACF,mBAAKU,sBAAL,CAA4BZ,SAA5B;AACD,WAFD,CAEE,OAAO5jB,CAAP,EAAU;AACVrD,oBAAQM,KAAR,CAAc+C,CAAd;AACD,WAJD,SAIU;AACR,gBAAI,OAAO,OAAK8jB,kBAAL,CAAwBW,kBAA/B,KAAsD,WAA1D,EAAuE;AACrE,qBAAKX,kBAAL,CAAwBW,kBAAxB;AACD;AACF;AACF;AACF,OA5BD;AA6BD;;;gCAEWzkB,C,EAAG;AACb,UAAM0kB,QAAQ,EAAd;AACA,UAAMC,YAAY,EAAlB;AACA,UAAMC,UAAU,EAAhB,CAHa,CAGM;;AAEnB;AACA,WAAK7F,QAAL,CAAc/e,EAAEib,OAAhB,IAA2Bjb,EAAE4F,IAAF,KAAW,SAAtC;;AAEA;AACA,UAAI,KAAKmZ,QAAL,CAAc4F,SAAd,KAA4B,KAAK5F,QAAL,CAAc6F,OAAd,CAA5B,IAAsD,KAAK7F,QAAL,CAAc2F,KAAd,CAA1D,EAAgF;AAC9E;AACA;AACA,aAAK3F,QAAL,CAAc2F,KAAd,IAAuB,KAAvB;AACA,aAAK3F,QAAL,CAAc6F,OAAd,IAAyB,KAAzB;;AAEA;AACA,aAAKC,gBAAL;;AAEA;AACA7kB,UAAE8kB,cAAF;AACD;AACF;;;sCAE2C;AAAA,UAA5BnO,KAA4B,uEAApB,0BAAU,OAAV,CAAoB;;AAC1CA,YAAMjD,YAAN,GAAqB,2BAAiBiD,KAAjB,EAAwB,KAAKD,WAA7B,CAArB;AACD;;AAED;;;;6CACgD;AAAA,UAAzBkN,SAAyB,uEAAb,2BAAa;;AAC9C;AACA,UAAI,OAAO,KAAKE,kBAAZ,KAAmC,WAAvC,EAAoD;AAClD;AACA,YAAI,OAAO,KAAKA,kBAAL,CAAwBpQ,YAA/B,KAAgD,WAApD,EAAiE;AAC/D;AACA,eAAKoQ,kBAAL,CAAwBpQ,YAAxB,CAAqCmC,QAArC,CAA8C+N,SAA9C;AACD,SAHD,MAGO;AACL,gBAAM,IAAIxmB,KAAJ,CAAU,0EAAV,CAAN;AACD;AACF,OARD,MAQO;AACL;AACA,cAAM,IAAIA,KAAJ,CAAU,4DAAV,CAAN;AACD;AACF;;AAGD;;;;;;;;;;;;;;;;;;;;;;;;;;oCAuBqC;AAAA;;AAAA,UAAvB4d,OAAuB,uEAAb,2BAAa;;AACnC,UAAM+J,cAAc;AAClBvQ,4BAAkBzT,KAAKhC,MAAL,KAAgB,MADhB;AAElBimB,0BAAkB,IAAI,8BAAQlM,MAAZ,CAAmB,CAAnB,EAAsB,CAAtB,EAAyB,CAAzB,EAA4B,CAA5B,CAFA;AAGlBC,+BAAuB,CAHL;AAIlBkM,oBAAY,IAAI,8BAAQnM,MAAZ,CAAmB,CAAnB,EAAsB,CAAtB,EAAyB,CAAzB,EAA4B,CAA5B,CAJM;AAKlB1V,eAAO,IALW;AAMlBC,gBAAQ,IANU;AAOlB6hB,4BAAoB,CAPF;AAQlBC,6BAAqB,CARH;AASlBC,kBAAUzhB,OAAO0hB,iBATC;AAUlBC,mBAAW3hB,OAAO0hB,iBAVA;AAWlBE,kBAAU5hB,OAAO6hB,iBAXC;AAYlBC,mBAAW9hB,OAAO6hB;AAZA,OAApB;;AAeAxK,gBAAU,iBAAE/R,MAAF,CAAS8b,WAAT,EAAsB/J,OAAtB,CAAV;;AAEA,UAAM0K,sBAAsB,SAAtBA,mBAAsB,GAAmB;AAAA,YAAlBC,MAAkB,uEAAT,IAAS;;AAC7C,YAAIrjB,OAAO,IAAX;AACA,YAAIc,QAAQ,IAAZ;AACA,YAAIC,SAAS,IAAb;;AAEA,YAAMuiB,SAAS,CAAC,OAAKzB,UAAL,CAAgB/gB,KAAhB,GAAwB4X,QAAQkK,kBAAjC,EAAqDrhB,OAArD,CAA6DmX,QAAQoK,QAArE,EAA+EpK,QAAQuK,QAAvF,CAAf;AACA,YAAMM,UAAU,CAAC,OAAK1B,UAAL,CAAgB9gB,MAAhB,GAAyB2X,QAAQmK,mBAAlC,EAAuDthB,OAAvD,CAA+DmX,QAAQoK,QAAvE,EAAiFpK,QAAQyK,SAAzF,CAAhB;;AAEA,YAAIjgB,IAAI,IAAR;AACA,YAAIE,IAAI,IAAR;;AAEA,YAAIsV,QAAQ5X,KAAZ,EAAmB;AACjBA,kBAAQ4X,QAAQ5X,KAAhB;AACD,SAFD,MAEO,IAAI4X,QAAQkK,kBAAR,KAA+B,CAAnC,EAAsC;AAC3C9hB,kBAAQwiB,MAAR;AACD;AACD,YAAI5K,QAAQ3X,MAAZ,EAAoB;AAClBA,mBAAS2X,QAAQ3X,MAAjB;AACD,SAFD,MAEO,IAAI2X,QAAQmK,mBAAR,KAAgC,CAApC,EAAuC;AAC5C9hB,mBAASwiB,OAAT;AACD;;AAED,YAAKxiB,WAAW,IAAZ,IAAsBD,UAAU,IAAhC,IAAyCuiB,MAA7C,EAAqD;AACnDrjB,iBAAO,IAAI,8BAAQY,IAAZ,CAAiBE,UAAU,IAAV,GAAiBA,KAAjB,GAAyBwiB,MAA1C,EAAkDviB,WAAW,IAAX,GAAkBA,MAAlB,GAA2BwiB,OAA7E,CAAP;AACArgB,cAAK,OAAK2e,UAAL,CAAgB/gB,KAAhB,GAAwB,CAAzB,GAAgC,OAAK+gB,UAAL,CAAgB/gB,KAAhB,GAAwB4X,QAAQkK,kBAAjC,GAAuD,CAA1F;AACAxf,cAAK,OAAKye,UAAL,CAAgB9gB,MAAhB,GAAyB,CAA1B,GAAiC,OAAK8gB,UAAL,CAAgB9gB,MAAhB,GAAyB2X,QAAQmK,mBAAlC,GAAyD,CAA7F;AACD;;AAED,eAAO,EAAE7iB,UAAF,EAAQkD,IAAR,EAAWE,IAAX,EAAP;AACD,OA7BD;;AAlBmC,iCAiDLggB,qBAjDK;AAAA,UAiDrB3J,WAjDqB,wBAiD3BzZ,IAjD2B;;AAoDnC,UAAMqU,QAAQ,IAAI,8BAAQ8B,KAAZ,CAAkB,KAAKsF,MAAvB,CAAd;;AAEA;;;;AAIApH,YAAMnC,QAAN,GAAiBwG,QAAQxG,QAAzB;;AAEA;;;;AAIAmC,YAAMI,gBAAN,GAAyB,IAAzB;;AAEA;AACA,WAAK+O,eAAL,CAAqBnP,KAArB;;AAEA;AACAA,YAAMsO,UAAN,GAAmBjK,QAAQiK,UAA3B;;AAEA,UAAMc,SAAS,IAAI,8BAAQC,eAAZ,CAA4B,QAA5B,EAAsC,CAAtC,EAAyCjlB,KAAKklB,EAAL,GAAU,CAAnD,EAAsD,EAAtD,EAA0D,8BAAQC,OAAR,CAAgBC,IAAhB,EAA1D,EAAkFxP,KAAlF,CAAf;AACA,UAAI+B,gBAAgB;AAClB/M,YAAI,cADc;AAElBgN,wBAAgB,8BAAQC,QAAR,CAAiBC,kBAAjB,CAAoCmC,QAAQiK,UAA5C,CAFE;AAGlBhjB,cAAM,8BAAQ2W,QAAR,CAAiBC,kBAAjB,CAAoCmC,QAAQiK,UAA5C,CAHY;AAIlBjM,gBAAQ;AAJU,OAApB;;AAOA,UAAM4C,SAAS,IAAI,8BAAQ1C,mBAAZ,CAAgCvC,KAAhC,EAAuC+B,aAAvC,CAAf;;AAEAA,sBAAgB;AACd/M,YAAI,eADU;AAEd9B,gBAAQ+R,MAFM;AAGdI,qBAAahB,QAAQjC,qBAHP;AAIdqN,yBAAiB,CAJH;AAKdnkB,cAAM,8BAAQ2W,QAAR,CAAiBC,kBAAjB,CAAoCmC,QAAQgK,gBAA5C,CALQ;AAMd1K,yBAAiB,sBANH;AAOdhY,cAAMyZ,WAPQ;AAQd/C,gBAAQ;AARM,OAAhB;;AAWA,UAAMqN,gBAAgB,IAAI,8BAAQlM,WAAZ,CAAwBzB,aAAxB,CAAtB;;AAEA;AACA/B,YAAMkF,YAAN,GAAqBD,MAArB;AACAjF,YAAM0P,aAAN,GAAsBA,aAAtB;AACA1P,YAAM2P,aAAN,GAAsBP,MAAtB;;AAEA;AACApP,YAAM4P,UAAN,GAAmB5P,MAAMjD,YAAN,CAAmB8S,YAAnB,EAAnB;;AAEA;AACA,UAAK,OAAOnV,OAAO4N,cAAd,KAAiC,WAAlC,IAAmD5N,OAAO4N,cAAP,KAA0B,IAAjF,EAAwF,CAEvF;AADC;;;AAGF;;AAEA;AACA,UAAMwF,qBAAqB,SAArBA,kBAAqB,GAAY;AAAA;;AACrC;AACA,YAAI1I,WAAJ,EAAiB;AACf,eAAKsK,aAAL,CAAmBI,QAAnB,GAA8B,KAAK1P,gBAAL,CAAsBnO,QAAtB,GAAiC,IAA/D;AACA,gCAAM,IAAN,EAAYvK,IAAZ,CAAiB,YAAM;AACrB,gBAAI,OAAKgoB,aAAL,CAAmBI,QAAnB,GAA8B,OAAK1P,gBAAL,CAAsBnO,QAAxD,EAAkE;AAChE;AADgE,0CAElC8c,qBAFkC;AAAA,kBAElD3J,YAFkD,yBAExDzZ,IAFwD;;AAGhE,wCAAU,oDAAV,EAAgEyZ,YAAhE;AACA,qBAAKsK,aAAL,CAAmB/jB,IAAnB,GAA0ByZ,YAA1B;;AAEA;AACA,kBAAI,OAAO,OAAK2K,QAAZ,KAAyB,WAA7B,EAA0C;AACxC,oBAAI,OAAKA,QAAL,CAAc7oB,WAAd,KAA8BmY,QAAlC,EAA4C;AAC1C,yBAAK0Q,QAAL,GAAgB,CAAC,OAAKA,QAAN,CAAhB;AACD;;AAHuC;AAAA;AAAA;;AAAA;AAKxC,uCAAgB,OAAKA,QAArB,8HAA+B;AAAA,wBAApBC,CAAoB;;AAC7B,wBAAIA,EAAE9oB,WAAF,KAAkBmY,QAAtB,EAAgC;AAChC2Q,sBAAE9pB,IAAF,CAAO,OAAKka,gBAAL,CAAsBpC,OAA7B;AACD;AARuC;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AASzC;AACF;AACF,WAnBD;AAoBD;AACF,OAzBD;;AA4BAgC,YAAM8N,kBAAN,GAA2BA,kBAA3B;;AAEA;;;;;AAKA9N,YAAM+P,QAAN,GAAiB,IAAjB;;AAEA;AACA/P,YAAMiQ,oBAAN,CAA2B,YAAM;AAC/BjQ,cAAMjD,YAAN,CAAmBqE,MAAnB;AACD,OAFD;;AAIA,aAAQpB,KAAR;AACD;;AAED;;;;oCACuC;AAAA;;AAAA,UAAzBvJ,SAAyB,uEAAb,2BAAa;;AACrC,UAAI,CAAC,KAAKsJ,WAAV,EAAuB;AACrB,cAAM,IAAItZ,KAAJ,CAAU,4CAAV,CAAN;AACD;;AAED,WAAKsZ,WAAL,CAAiBmQ,aAAjB,CAA+BzZ,SAA/B,EACC/O,IADD,CACM,UAAC8O,UAAD,EAAgB;AAAE,eAAKA,UAAL,GAAkBA,UAAlB;AAA8B,OADtD,EAEC7O,KAFD,CAEO,UAACrB,KAAD,EAAW;AAAE,mCAAWA,KAAX;AAAmB,OAFvC;AAGD;;;oCAEiC;AAAA,UAApB6pB,IAAoB,uEAAb,2BAAa;;AAChC;AACA;AACA;AACA;;AAEA,UAAI,CAAC,KAAKpQ,WAAV,EAAuB;AACrB,cAAM,IAAItZ,KAAJ,CAAU,4CAAV,CAAN;AACD;;AAED,WAAKsZ,WAAL,CAAiBuB,OAAjB,CAAyB,aAAzB,EAAwC,EAAE6O,UAAF,EAAQne,YAAY,KAAKC,QAAzB,EAAxC;AACD;;;oCAEe;AACd,UAAI,CAAC,KAAK8N,WAAV,EAAuB;AACrB,cAAM,IAAItZ,KAAJ,CAAU,4CAAV,CAAN;AACD;;AAED,aAAO,KAAKsZ,WAAL,CAAiBhJ,KAAjB,CAAuB,eAAvB,EAAwC,EAAxC,EAA4C,KAAKP,UAAjD,CAAP;AACD;;AAED;;;;+BACWzP,M,EAAQ;AACjB,UAAMiZ,QAAS,OAAO,KAAKmN,kBAAZ,KAAmC,WAApC,GAAmD,KAAKA,kBAAxD,GAA6E,IAA3F;AACA,UAAMpQ,eAAiBiD,UAAU,IAAX,IAAqB,OAAOA,MAAMjD,YAAb,KAA8B,WAApD,GAAoEiD,MAAMjD,YAA1E,GAAyF,IAA9G;AACA,UAAMkD,QAAUlD,iBAAiB,IAAlB,IAA4B,OAAOA,aAAaoE,YAApB,KAAqC,WAAlE,GAAkF,KAAKgM,kBAAL,CAAwBpQ,YAAxB,CAAqCoE,YAAvH,GAAsI,IAApJ;;AAEA,UAAMiP,cAAc;AAClBtQ,oBAAY,IADM;AAElBC,qBAAc,OAAO,KAAKA,WAAZ,KAA4B,WAA7B,GAA4C,KAAKA,WAAjD,GAA+D,IAF1D;AAGlBC,oBAHkB;AAIlBjD,kCAJkB;AAKlBkD,oBALkB;AAMlBC,WAAG,KAAKA;AANU,OAApB;;AASA,UAAI,OAAOnZ,MAAP,KAAkB,WAAtB,EAAmC;AACjC,eAAQqpB,WAAR;AACD;AACD,UAAIC,aAAa,EAAjB;AACA,cAAQtpB,OAAOG,WAAf;AACE,aAAK,8BAAQ4a,KAAb;AACEuO,uBAAa;AACXrQ,mBAAOjZ,MADI;AAEXgW,0BAAchW,OAAOgW,YAFV;AAGXkD,mBAAOlZ,OAAOgW,YAAP,CAAoBoE;AAHhB,WAAb;AAKA;AACF;AACEkP,uBAAa;AACXrQ,mBAAOjZ,OAAOqM,OADH;AAEX2J,0BAAchW,MAFH;AAGXkZ,mBAAOlZ,OAAOoa;AAHH,WAAb;AAKA;AACF;AACEkP,uBAAa;AACXrQ,mBAAOjZ,OAAOqM,OADH;AAEX2J,0BAAchW,OAAOkW,aAFV;AAGXgD,mBAAOlZ;AAHI,WAAb;AAKA;AACF;AACE,oCAAU,oFAAV;AACA,iBAAQqpB,WAAR;AAxBJ;;AA2BA,aAAQ,iBAAE9d,MAAF,CAAS8d,WAAT,EAAsBC,UAAtB,CAAR;AACD;;;uCAsEkB;AACjB,UAAMrQ,QAAQ,KAAKmN,kBAAnB;AACA,WAAK9E,eAAL,GAAuB,CAAC,KAAKA,eAA7B;;AAEA,UAAI,OAAOrI,KAAP,KAAiB,WAArB,EAAkC;AAChC,YAAI,KAAKqI,eAAT,EAA0B;AACxB,eAAKM,MAAL,CAAY,KAAKO,gBAAjB,EAAmCoH,UAAnC,CAA8CC,IAA9C;;AAEA,cAAI,OAAO,KAAK5H,MAAL,CAAY,KAAKO,gBAAjB,EAAmCwG,aAA1C,KAA4D,WAAhE,EAA6E;AAC3E,iBAAK/G,MAAL,CAAY,KAAKO,gBAAjB,EAAmCwG,aAAnC,CAAiDc,6BAAjD;AACD;AACF,SAND,MAMO;AACL,eAAK7H,MAAL,CAAY,KAAKO,gBAAjB,EAAmCoH,UAAnC,CAA8CG,IAA9C;;AAEA,cAAK,OAAO,KAAK9H,MAAL,CAAY,KAAKO,gBAAjB,EAAmCwG,aAA1C,KAA4D,WAA7D,IAA8E,KAAK/G,MAAL,CAAY,KAAKO,gBAAjB,EAAmCwG,aAAnC,CAAiDgB,gBAAjD,KAAsE,IAAxJ,EAA+J;AAC7J,iBAAK/H,MAAL,CAAY,KAAKO,gBAAjB,EAAmCwG,aAAnC,CAAiDgB,gBAAjD,CAAkEC,OAAlE;AACA,iBAAKhI,MAAL,CAAY,KAAKO,gBAAjB,EAAmCwG,aAAnC,CAAiDgB,gBAAjD,GAAoE,IAApE;AACD;AACF;AACF,OAfD,MAeO;AACL1qB,gBAAQM,KAAR,CAAc,8DAAd;AACD;AACF;;;;;AAuED;;AAEA;;;;;;;gCAOoH;AAAA,2BAA5G2I,IAA4G;AAAA,UAA5GA,IAA4G,6BAArG,cAAqG;AAAA,4BAArF2hB,KAAqF;AAAA,UAArFA,KAAqF,8BAA7E,EAA6E;AAAA,8BAAzEpnB,OAAyE;AAAA,UAAzEA,OAAyE,gCAA/D,EAA+D;AAAA,4BAA3D8U,KAA2D;AAAA,UAA3DA,KAA2D,8BAAnD,wBAAc,KAAK4B,CAAL,CAAO3D,GAAP,CAAWsU,qBAAzB,CAAmD;;AAClH,WAAKrI,YAAL,GAAoB,EAAEpf,MAAM,EAAE6F,UAAF,EAAQ2hB,YAAR,EAAepnB,gBAAf,EAAwB8U,YAAxB,EAAR,EAApB;AACA,UAAM1T,WAAW,yBAAjB;;AAEA,WAAK4d,YAAL,CAAkB5d,QAAlB,GAA6BA,QAA7B;;AAEA,UAAMkmB,WAAW,gCAAe7hB,IAAf,EAAqB,SAAS8hB,SAAT,GAAqB;AACzD,YAAKzS,MAAMpX,WAAN,wBAAD,IAAsC,KAAK6V,YAAL,KAAsB,IAAhE,EAAuE;AACrE,eAAKA,YAAL,CAAkBmC,QAAlB,CAA2BZ,KAA3B;AACD;;AAED,aAAKwB,UAAL,CAAgB0I,YAAhB,CAA6B5d,QAA7B,CAAsC9C,OAAtC,CAA8C,eAA9C;AACA,aAAKgY,UAAL,CAAgB0I,YAAhB,GAA+B,IAA/B;AACD,OAPqC,CAOpCtiB,IAPoC,CAO/B,KAAK8X,OAP0B,CAArB,CAAjB;;AASA8S,eAASF,KAAT,GAAiBA,KAAjB;AACAE,eAAStnB,OAAT,GAAmBA,OAAnB;;AAEA,WAAKgf,YAAL,CAAkBsI,QAAlB,GAA6BA,QAA7B;AACA,aAAOlmB,SAASzB,OAAhB;AACD;;AAED;;;;iCACapC,M,EAAQiqB,Q,EAAUzf,I,EAAM0f,E,EAAI;AACvC,UAAMte,OAAO,CAAC;AACZue,eAAO,CADK;AAEZthB,eAAO2B;AAFK,OAAD,EAGV;AACD2f,eAAO,GADN;AAEDthB,eAAOqhB;AAFN,OAHU,CAAb;;AAQA,UAAME,YAAY,IAAI,8BAAQC,SAAZ,CAChB,WADgB,EAEhBJ,QAFgB,EAGhB,GAHgB,EAIhB,8BAAQI,SAAR,CAAkBC,mBAJF,EAKhB,8BAAQD,SAAR,CAAkBE,0BALF,CAAlB;AAOAH,gBAAUI,OAAV,CAAkB5e,IAAlB;;AAEA,WAAKwa,kBAAL,CAAwBqE,aAAxB,CAAsCzqB,MAAtC;AACAA,aAAO0qB,UAAP,CAAkBzmB,IAAlB,CAAuBmmB,SAAvB;AACApqB,aAAO+iB,MAAP,CAAc4H,cAAd,CAA6B3qB,MAA7B,EAAqC,CAArC,EAAwC,GAAxC,EAA6C,KAA7C,EAAoD,CAApD,EAAuD,YAAM,CAAE,CAA/D;AACD;;;mCAEcA,M,EAAQiqB,Q,EAAUzf,I,EAAM0f,E,EAAqB;AAAA,UAAjBU,UAAiB,uEAAJ,EAAI;;AAC1D,UAAMhf,OAAO,CAAC;AACZue,eAAO,CADK;AAEZthB,eAAO2B;AAFK,OAAD,EAGV;AACD2f,eAAOS,UADN;AAED/hB,eAAOqhB;AAFN,OAHU,CAAb;;AAQA,UAAME,YAAY,IAAI,8BAAQC,SAAZ,CAChB,WADgB,EAEhBJ,QAFgB,EAGhB,EAHgB,EAIhB,8BAAQI,SAAR,CAAkBQ,qBAJF,EAKhB,8BAAQR,SAAR,CAAkBE,0BALF,CAAlB;AAOAH,gBAAUI,OAAV,CAAkB5e,IAAlB;;AAEA,WAAKwa,kBAAL,CAAwBqE,aAAxB,CAAsCzqB,MAAtC;;AAEAA,aAAO0qB,UAAP,CAAkBzmB,IAAlB,CAAuBmmB,SAAvB;AACD;;;kCAEapqB,M,EAAQiqB,Q,EAAUzf,I,EAAM0f,E,EAAI;AACxC,UAAMte,OAAO,CAAC;AACZue,eAAO,CADK;AAEZthB,eAAO2B;AAFK,OAAD,EAGV;AACD2f,eAAO,EADN;AAEDthB,eAAOqhB;AAFN,OAHU,CAAb;;AAQA,UAAME,YAAY,IAAI,8BAAQC,SAAZ,CAChB,WADgB,EAEhBJ,QAFgB,EAGhB,EAHgB,EAIhB,8BAAQI,SAAR,CAAkBS,oBAJF,EAKhB,8BAAQT,SAAR,CAAkBE,0BALF,CAAlB;AAOAH,gBAAUI,OAAV,CAAkB5e,IAAlB;;AAEA5L,aAAO+iB,MAAP,CAAc0H,aAAd,CAA4BzqB,MAA5B;;AAEAA,aAAO0qB,UAAP,CAAkBzmB,IAAlB,CAAuBmmB,SAAvB;AACD;;;8CAEyBW,O,EAASC,M,EAAQ/R,K,EAAO;AAChD;AACA;AACAA,cAAQ,KAAK2I,MAAL,CAAY,KAAKqD,YAAjB,CAAR;AACA,UAAMgG,eAAe,IAAI,8BAAQZ,SAAZ,CACnB,SADmB,EAEnB,OAFmB,EAGnB,EAHmB,EAInB,8BAAQA,SAAR,CAAkBC,mBAJC,EAKnB,8BAAQD,SAAR,CAAkBE,0BALC,CAArB;AAOA,UAAMlC,SAASpP,MAAMiS,YAArB;AACA,UAAMC,YAAY,EAAlB;;AAEA,UAAIhL,WAAWiL,MAAX,CAAkB/C,OAAOgD,KAAzB,EAAgCN,OAAhC,CAAJ,EAA8C;AAC5CI,kBAAUlnB,IAAV,CAAe;AACbkmB,iBAAO,CADM;AAEbthB,iBAAOwf,OAAOgD;AAFD,SAAf;;AAKApsB,gBAAQC,GAAR,CAAYmpB,OAAOgD,KAAnB;AACApsB,gBAAQC,GAAR,CAAY6rB,OAAZ;;AAEA,YAAIO,YAAY,CAACjoB,KAAKklB,EAAtB;AACA,YAAIgD,aAAaloB,KAAKklB,EAAtB;;AAEA,YAAIF,OAAOgD,KAAP,GAAe,CAAnB,EAAsB;AACpBC,sBAAYjoB,KAAKklB,EAAjB;AACAgD,uBAAa,CAACloB,KAAKklB,EAAnB;AACD;;AAED4C,kBAAUlnB,IAAV,CAAe;AACbkmB,iBAAO,EADM;AAEbthB,iBAAOyiB;AAFM,SAAf;AAIAH,kBAAUlnB,IAAV,CAAe;AACbkmB,iBAAO,EADM;AAEbthB,iBAAO0iB;AAFM,SAAf;AAIAJ,kBAAUlnB,IAAV,CAAe;AACbkmB,iBAAO,GADM;AAEbthB,iBAAOkiB;AAFM,SAAf;AAID,OA7BD,MA6BO;AACLI,kBAAUlnB,IAAV,CAAe;AACbkmB,iBAAO,CADM;AAEbthB,iBAAOwf,OAAOgD;AAFD,SAAf;AAIAF,kBAAUlnB,IAAV,CAAe;AACbkmB,iBAAO,GADM;AAEbthB,iBAAOkiB;AAFM,SAAf;AAID;;AAED,UAAMS,cAAc,IAAI,8BAAQnB,SAAZ,CAClB,SADkB,EAElB,MAFkB,EAGlB,EAHkB,EAIlB,8BAAQA,SAAR,CAAkBC,mBAJA,EAKlB,8BAAQD,SAAR,CAAkBE,0BALA,CAApB;;AAQA,UAAMkB,WAAW,EAAjB;AACAA,eAASxnB,IAAT,CAAc;AACZkmB,eAAO,CADK;AAEZthB,eAAOwf,OAAOqD;AAFF,OAAd;AAIAD,eAASxnB,IAAT,CAAc;AACZkmB,eAAO,GADK;AAEZthB,eAAOmiB;AAFK,OAAd;;AAKAC,mBAAaT,OAAb,CAAqBW,SAArB;AACAK,kBAAYhB,OAAZ,CAAoBiB,QAApB;;AAEApD,aAAOqC,UAAP,CAAkBzmB,IAAlB,CAAuBgnB,YAAvB;AACA5C,aAAOqC,UAAP,CAAkBzmB,IAAlB,CAAuBunB,WAAvB;;AAEAvS,YAAM0R,cAAN,CAAqBtC,MAArB,EAA6B,CAA7B,EAAgC,GAAhC,EAAqC,KAArC,EAA4C,CAA5C,EAA+C,YAAM,CAAE,CAAvD;AACD;;AAED;AACA;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;2CA4BuD;AAAA,UAAlCsD,IAAkC,uEAA3B,2BAA2B;AAAA,UAAdrO,OAAc,uEAAJ,EAAI;;AACrD,UAAI,OAAOqO,KAAK5I,MAAZ,KAAuB,WAA3B,EAAwC;AACtC,cAAM,IAAIrjB,KAAJ,CAAU,iDAAV,CAAN;AACD;;AAED,UAAMuZ,QAAQ0S,KAAK5I,MAAnB;;AAEA;AACA,UAAMsE,cAAc;AAClBtZ,2BAAiB4d,KAAK5d,IADJ;AAElB6d,kBAAU,IAFQ;AAGlB3H,iBAAS,KAAKhD,iBAHI;AAIlB4K,oBAAY,IAJM;AAKlBC,oBAAY,IALM;AAMlBC,gBAAQ,IAAI,8BAAQ3Q,MAAZ,CAAmB,GAAnB,EAAwB,GAAxB,EAA6B,CAA7B,EAAgC,CAAhC,CANU;AAOlB4Q,gBAAQ,IAAI,8BAAQ5Q,MAAZ,CAAmB,GAAnB,EAAwB,GAAxB,EAA6B,CAA7B,EAAgC,CAAhC,CAPU;AAQlB6Q,mBAAW,IAAI,8BAAQ7Q,MAAZ,CAAmB,CAAnB,EAAsB,CAAtB,EAAyB,GAAzB,EAA8B,CAA9B,CARO;AASlB8Q,iBAAS,GATS;AAUlBC,iBAAS,GAVS;AAWlBC,qBAAa,GAXK;AAYlBC,qBAAa,GAZK;AAalBC,kBAAU,GAbQ;AAclBC,mBAAW,8BAAQC,cAAR,CAAuBC,gBAdhB;AAelBC,iBAAS,IAAI,8BAAQlE,OAAZ,CAAoB,CAApB,EAAuB,IAAvB,EAA6B,CAA7B,CAfS;AAgBlB;AACAmE,oBAAY,IAAI,8BAAQnE,OAAZ,CAAoB,CAAC,CAArB,EAAwB,CAAC,CAAzB,EAA4B,CAA5B,CAjBM;AAkBlBoE,oBAAY,IAAI,8BAAQpE,OAAZ,CAAoB,CAApB,EAAuB,CAAvB,EAA0B,CAAC,CAA3B,CAlBM;AAmBlBqE,yBAAiB,CAnBC;AAoBlBC,yBAAiB,IAAIzpB,KAAKklB,EApBR;AAqBlBwE,sBAAc,GArBI;AAsBlBC,sBAAc,GAtBI;AAuBlBC,qBAAa,IAvBK;AAwBlBC,iBAAS;AAxBS,OAApB;;AA2BA;AACA5P,gBAAU,iBAAE/R,MAAF,CAAS8b,WAAT,EAAsB/J,OAAtB,CAAV;;AAEA;AACA,UAAM6P,iBAAiB,IAAI,8BAAQX,cAAZ,CACrB,WADqB,EAErBlP,QAAQsO,QAFa,EAGrB3S,KAHqB,CAAvB;;AAMA;AACAkU,qBAAeC,eAAf,GAAiC,IAAI,8BAAQC,OAAZ,CAC/B/P,QAAQ2G,OADuB,EAE/BhL,KAF+B,CAAjC;;AAKA;AACAkU,qBAAeG,OAAf,GAAyB3B,IAAzB;AACA;AACA,UAAIrO,QAAQuO,UAAR,KAAuB,IAA3B,EAAiC;AAC/BsB,uBAAetB,UAAf,GAA4BvO,QAAQuO,UAApC,CAD+B,CACgB;AAChD;;AAED,UAAIvO,QAAQwO,UAAR,KAAuB,IAA3B,EAAiC;AAC/BqB,uBAAerB,UAAf,GAA4BxO,QAAQwO,UAApC,CAD+B,CACgB;AAChD;;AAED;AACAqB,qBAAepB,MAAf,GAAwBzO,QAAQyO,MAAhC;AACAoB,qBAAenB,MAAf,GAAwB1O,QAAQ0O,MAAhC;AACAmB,qBAAelB,SAAf,GAA2B3O,QAAQ2O,SAAnC;;AAEA;AACAkB,qBAAejB,OAAf,GAAyB5O,QAAQ4O,OAAjC;AACAiB,qBAAehB,OAAf,GAAyB7O,QAAQ6O,OAAjC;;AAEA;AACAgB,qBAAef,WAAf,GAA6B9O,QAAQ8O,WAArC;AACAe,qBAAed,WAAf,GAA6B/O,QAAQ+O,WAArC;;AAEA;AACAc,qBAAeb,QAAf,GAA0BhP,QAAQgP,QAAlC;;AAEA;AACAa,qBAAeZ,SAAf,GAA2BjP,QAAQiP,SAAnC;;AAEA;AACAY,qBAAeT,OAAf,GAAyBpP,QAAQoP,OAAjC;;AAEA;AACAS,qBAAeR,UAAf,GAA4BrP,QAAQqP,UAApC;AACAQ,qBAAeP,UAAf,GAA4BtP,QAAQsP,UAApC;;AAEA;AACAO,qBAAeN,eAAf,GAAiCvP,QAAQuP,eAAzC;AACAM,qBAAeL,eAAf,GAAiCxP,QAAQwP,eAAzC;;AAEA;AACAK,qBAAeJ,YAAf,GAA8BzP,QAAQyP,YAAtC;AACAI,qBAAeH,YAAf,GAA8B1P,QAAQ0P,YAAtC;AACAG,qBAAeF,WAAf,GAA6B3P,QAAQ2P,WAArC;;AAEA;AACA,UAAI3P,QAAQ4P,OAAZ,EAAqB;AACnBC,uBAAeI,KAAf;AACD;;AAED,aAAOJ,cAAP;AACD;;AAED;AACA;;;;wBA9dc;AACZ,aAAO,KAAKrU,UAAL,EAAP;AACD;;AAED;AACA;AACA;;;;;;;;;AAoBA;wBACmB;AACjB,aAAO,KAAKqJ,gBAAZ;AACD,K;sBAEgBrL,Q,EAAU;AACzB,UAAIrN,OAAOmC,IAAP,CAAY,KAAKgW,MAAjB,EAAyBpY,OAAzB,CAAiCsN,QAAjC,MAA+C,CAAC,CAApD,EAAuD;AACrD,YAAI,KAAKqL,gBAAT,EAA2B;AACzB,eAAKP,MAAL,CAAY,KAAKO,gBAAjB,EAAmCnM,YAAnC,CAAgDyH,SAAhD,CAA0D,KAAKtE,CAAL,CAAO3D,GAAP,CAAWqE,WAArE;;AAEA;AACA,cAAK,OAAOlG,OAAO4N,cAAd,KAAiC,WAAlC,IAAmD5N,OAAO4N,cAAP,KAA0B,IAAjF,EAAwF;AACtF,iBAAKK,MAAL,CAAY,KAAKO,gBAAjB,EAAmCoH,UAAnC,CAA8CG,IAA9C;;AAEA,gBAAK,OAAO,KAAK9H,MAAL,CAAY,KAAKO,gBAAjB,EAAmCwG,aAA1C,KAA4D,WAA7D,IAA8E,KAAK/G,MAAL,CAAY,KAAKO,gBAAjB,EAAmCwG,aAAnC,CAAiDgB,gBAAjD,KAAsE,IAAxJ,EAA+J;AAC7J;AACA;AACD;AACF;AACF;;AAED,aAAKxH,gBAAL,GAAwBrL,QAAxB;;AAEA,aAAK8K,MAAL,CAAY9K,QAAZ,EAAsBd,YAAtB,CAAmCyH,SAAnC,CAA6C,KAAKtE,CAAL,CAAO3D,GAAP,CAAWsE,aAAxD;;AAEA;AACA,YAAK,OAAOnG,OAAO4N,cAAd,KAAiC,WAAlC,IAAmD5N,OAAO4N,cAAP,KAA0B,IAA7E,IAAuF,KAAKD,eAAhG,EAAkH;AAChH,eAAKM,MAAL,CAAY9K,QAAZ,EAAsByS,UAAtB,CAAiCC,IAAjC;;AAEA,cAAI,OAAO,KAAK5H,MAAL,CAAY9K,QAAZ,EAAsB6R,aAA7B,KAA+C,WAAnD,EAAgE;AAC9D;AACD;AACF;;AAED,0EAAgD7R,QAAhD;AACD,OA7BD,MA6BO,IAAIA,aAAa,IAAb,IAAqBA,aAAa,EAAtC,EAA0C;AAC/C,aAAKqL,gBAAL,GAAwB,EAAxB;AACD,OAFM,MAEA;AACLljB,gBAAQM,KAAR,CAAc,4CAAd;AACD;AACF;;;wBA0BwB;AACvB,aAAO,KAAKqiB,MAAL,CAAY,KAAKO,gBAAjB,CAAP;AACD,K;sBAEsBqL,W,EAAa;AAClC,UAAI,iBAAErjB,GAAF,CAAMqjB,WAAN,EAAmB,UAAnB,CAAJ,EAAoC;AAClC,aAAKvI,YAAL,GAAoBuI,YAAY1W,QAAhC;AACD,OAFD,MAEO;AACL,cAAM,IAAIpX,KAAJ,CAAU,iCAAV,CAAN;AACD;AACF;;;wBAEU;AACT,aAAO,KAAKwL,QAAZ;AACD;;;wBAEe;AACd,aAAO,IAAIc,IAAJ,GAAWC,OAAX,KAAuB,IAA9B;AACD;;;wBAEc;AACb,aAAO,IAAID,IAAJ,GAAWC,OAAX,EAAP;AACD;;;wBAEc;AACb,aAAO,KAAKmW,SAAZ;AACD,K;sBAEYqL,Q,EAAU;AACrB,UAAI,KAAKrL,SAAT,EAAoB;AAClB,aAAKA,SAAL,CAAetX,MAAf;AACD;AACD,WAAKsX,SAAL,GAAiBqL,QAAjB;AACD;;;wBAEgB;AACf,aAAO,IAAI,8BAAQjoB,IAAZ,CACL,KAAK6a,MAAL,CAAYqN,cAAZ,EADK,EAEL,KAAKrN,MAAL,CAAYsN,eAAZ,EAFK,CAAP;AAID,K;wBAEkC;AAAA,UAApB/oB,IAAoB,uEAAb,2BAAa;;AACjC,cAAQA,KAAKzE,WAAb;AACE;AACE,eAAK+d,MAAL,CAAYxY,KAAZ,GAAoBd,IAApB;AACA,eAAKsZ,MAAL,CAAYvY,MAAZ,GAAqBf,IAArB;AACA;AACF,aAAK,8BAAQY,IAAb;AACE,eAAK0Y,MAAL,CAAYxY,KAAZ,GAAuBd,KAAKc,KAA5B;AACA,eAAKwY,MAAL,CAAYvY,MAAZ,GAAwBf,KAAKe,MAA7B;AACA;AACF;AACE,cAAIf,KAAK9E,MAAL,KAAgB,CAApB,EAAuB;AACrB,iBAAKoe,MAAL,CAAYxY,KAAZ,GAAoBd,KAAK,CAAL,CAApB;AACA,iBAAKsZ,MAAL,CAAYvY,MAAZ,GAAqBf,KAAK,CAAL,CAArB;AACD,WAHD,MAGO;AACL,kBAAM,IAAIlF,KAAJ,CACN,mFADM,CAAN;AAGD;AACD;AACF;AACE,gBAAM,IAAIA,KAAJ,CACN,mFADM,CAAN;AApBJ;AAwBD;;;4CAh1B8B4d,O,EAAS;AACtC;AACA,UAAMvE,aAAa,KAAKA,UAAxB;;AAEA,UAAMsO,cAAc;AAClBC,0BAAkB,IAAI,8BAAQlM,MAAZ,CAAmB,CAAnB,EAAsB,CAAtB,EAAyB,CAAzB,EAA4B,CAA5B,CADA;AAElBC,+BAAuB,CAFL;AAGlBkM,oBAAY,IAAI,8BAAQnM,MAAZ,CAAmB,CAAnB,EAAsB,CAAtB,EAAyB,CAAzB,EAA4B,CAA5B,CAHM;AAIlBoM,4BAAoB,CAJF;AAKlBC,6BAAqB,CALH;AAMlBmG,cAAM,SANY;AAOlBC,eAAO,IAPW;AAQlB3L,0BAAkB;AARA,OAApB;;AAWA5E,gBAAU,iBAAE/R,MAAF,CAAS8b,WAAT,EAAsB/J,OAAtB,CAAV;;AAEA;AACA,UAAMrE,QAAQF,WAAW+U,aAAX,CAAyBxQ,OAAzB,CAAd;;AAEA;AACA,UAAI8F,cAAc;AAChB2K,cAAM;AACJtb,gBAAM,2BADF;AAEJvK,gBAAM;AAFF;AADU,OAAlB;;AAOA;AACA,UAAIoV,QAAQ4E,gBAAZ,EAA8B;AAC5BkB,sBAAc,iBAAE7X,MAAF,CAAS6X,WAAT,EAAsBrK,WAAWmI,YAAjC,CAAd;AACD;;AAED;AACAjI,YAAM+L,cAAN,GAAuBjM,WAAWiV,UAAX,CAAsB5K,WAAtB,EAAmCnK,KAAnC,EACtBtY,IADsB,CACjB,YAAM;AACV,YAAMud,SAASjF,MAAM0P,aAArB;;AAEA,YAAM1E,UAAUlL,WAAWI,CAAX,CAAa3D,GAAb,CAAiByY,aAAjC;AACAhK,gBAAQiK,QAAR,GAAmB,IAAnB;;AAEA,YAAMvoB,SAAS,2BAAKxE,GAAL,CAAS4X,WAAW0N,UAAX,CAAsB9gB,MAAtB,GAA+B,IAAxC,EAA8C,EAA9C,CAAf;AACA,YAAI,8BAAQwoB,QAAZ,CAAqBlK,OAArB,EAA8B,EAAE;AAC9B9X,kBAAQ+R,MADoB;AAE5BjQ,cAAI,MAFwB;AAG5B2O,2BAAiB,qBAHW;AAI5BhY,gBAAM,IAAI,8BAAQY,IAAZ,CAAiBG,SAAS,IAAT,GAAgB,GAAjC,EAAsCA,MAAtC,CAJsB;AAK5ByoB,kBAAQ,8BAAQ3oB,OAAR,CAAgBgjB,IAAhB;AALoB,SAA9B;AAOD,OAfsB,CAAvB;;AAkBA,aAAOxP,KAAP;AACD;;;6BA2lCeoV,O,EAAS;AACvB,UAAMC,SAASjrB,KAAKklB,EAApB;AACA8F,iBAAWC,MAAX;AACA,UAAMC,OAAOlrB,KAAKkrB,IAAL,CAAUF,OAAV,CAAb;AACA,aAAOA,UACJE,OAAOlrB,KAAKC,KAAL,CAAWD,KAAKmrB,GAAL,CAASH,OAAT,KAAqB,IAAIhrB,KAAKklB,EAA9B,CAAX,CAAP,IAAwD,IAAIllB,KAAKklB,EAAjE,CADI,GAEL+F,MAFF;AAGD;;;8CAEgCG,S,EAAWC,Y,EAAc;AACxDA,qBAAevO,WAAWwO,QAAX,CAAoBD,YAApB,CAAf;AACAzvB,cAAQC,GAAR,CAAYwvB,YAAZ;AACAzvB,cAAQC,GAAR,gBAAyBuvB,SAAzB;AACA,UAAIF,OAAOlrB,KAAKkrB,IAAL,CAAUG,YAAV,CAAX;;AAEA,UAAIA,iBAAiB,CAArB,EAAwB;AACtBH,eAAOlrB,KAAKkrB,IAAL,CAAUE,SAAV,CAAP;AACD;AACD,UAAMG,cAAcF,eAAgBH,QAAQ,IAAIlrB,KAAKklB,EAAjB,CAApC;AACAtpB,cAAQC,GAAR,kBAA2B0vB,WAA3B;AACA,UAAMC,kBAAkBxrB,KAAKmrB,GAAL,CAASC,YAAYC,YAArB,CAAxB;AACA,UAAMI,iBAAiBzrB,KAAKmrB,GAAL,CAASC,YAAYG,WAArB,CAAvB;;AAEA,aAAOC,mBAAmBC,cAAnB,GAAoCJ,YAApC,GAAmDE,WAA1D;AACD;;;2BAEaG,M,EAAQC,M,EAAQ;AAC5B,aAAO3rB,KAAKmrB,GAAL,CAASO,SAASC,MAAlB,IAA4B3rB,KAAKklB,EAAxC;AACD;;AAED;AACA;;;;;;;;;;;;;;;;;4BAce0G,K,EAAoG;AAAA,sFAAJ,EAAI;AAAA,sCAA3FC,aAA2F;AAAA,UAA3FA,aAA2F,uCAA3E,IAA2E;AAAA,6BAArEC,IAAqE;AAAA,UAArEA,IAAqE,8BAA9D,IAA8D;AAAA,kCAAxDC,SAAwD;AAAA,UAAxDA,SAAwD,mCAA5C,IAA4C;AAAA,kCAAtCC,SAAsC;AAAA,UAAtCA,SAAsC,mCAA1B,EAA0B;AAAA,8BAAtB3V,KAAsB;AAAA,UAAtBA,KAAsB,+BAAd,KAAc;;AACjH,0CAAoB,8BAAQ4K,KAA5B,EAAmC2K,KAAnC;;AAEA,UAAIC,kBAAkB,IAAtB,EAA4B;AAC1BA,wBAAgBD,MAAMK,SAAN,EAAhB;AACD;AACD,0CAAoBrpB,MAApB,EAA4BipB,aAA5B,EAA2CC,IAA3C,EAAiDC,SAAjD;;AAEAF,sBAAgBA,cAAc/oB,OAAd,CAAsB,CAAtB,EAAyB,CAAzB,CAAhB;AACAgpB,aAAOA,KAAKhpB,OAAL,CAAa,CAAb,EAAgB,CAAhB,CAAP;;AAEA,UAAIopB,YAAYJ,OAAOD,aAAvB;AACA,UAAIK,YAAYJ,OAAO,EAAvB,EAA2B;AACzBI,oBAAYJ,OAAO,EAAnB;AACD;AACDD,uBAAiBK,SAAjB;AACA,UAAIL,gBAAgBE,SAApB,EAA+B;AAC7B,4DAAkCF,aAAlC;AACAD,cAAMO,SAAN,CAAgBN,aAAhB;AACA,8BAAMG,SAAN,EAAiB1uB,IAAjB,CAAsB;AAAA,iBAAMwf,WAAWsP,OAAX,CAAmBR,KAAnB,EAA0B,EAAEC,4BAAF,EAAiBC,UAAjB,EAAuBC,oBAAvB,EAAkCC,oBAAlC,EAA6C3V,YAA7C,EAA1B,CAAN;AAAA,SAAtB;AACD,OAJD,MAIO,IAAIA,KAAJ,EAAW;AAChB,iCAAS,iBAAT;AACAuV,cAAMvV,KAAN;AACD,OAHM,MAGA;AACL,iCAAS,gBAAT;AACAuV,cAAMS,IAAN;AACD;AACF;;AAGD;;;;;;;;;8BAMiB7mB,K,EAAO8mB,G,EAAK;AAC3B,UAAMvoB,IAAI,EAAV;AACA,WAAK,IAAIvH,IAAI,CAAb,EAAgBA,KAAK8vB,GAArB,EAA0B9vB,GAA1B,EAA+B;AAC7BuH,UAAEnD,IAAF,CAAO4E,KAAP;AACD;AACD,aAAOzB,CAAP;AACD;;AAED;;;;;;;;;;;;yCAS4BvF,C,EAAG+tB,W,EAAaC,O,EAAS;AACnD,UAAMC,IAAIjuB,IAAIwB,KAAK0sB,GAAL,CAASH,WAAT,CAAJ,GAA4BvsB,KAAK2sB,GAAL,CAASH,OAAT,CAAtC;AACA,UAAM/nB,IAAIjG,IAAIwB,KAAK0sB,GAAL,CAASH,WAAT,CAAJ,GAA4BvsB,KAAK0sB,GAAL,CAASF,OAAT,CAAtC;AACA,UAAM7nB,IAAInG,IAAIwB,KAAK2sB,GAAL,CAASJ,WAAT,CAAd;;AAEA,aAAO,IAAI,8BAAQpH,OAAZ,CAAoB1gB,CAApB,EAAuBE,CAAvB,EAA0B8nB,CAA1B,CAAP;AACD;;AAED;;;;;;;;;uCAM0B5uB,G,EAAKC,G,EAAK;AAClC,aAASkC,KAAKhC,MAAL,MAAiBF,MAAMD,GAAvB,CAAD,GAAgCA,GAAxC;AACD;;;uCAE4C;AAAA,UAArB4F,KAAqB,uEAAb,2BAAa;;AAC3C,UAAIA,MAAM3G,WAAN,qBAAJ,EAAiC;AAC/B,eAAO2G,MAAMzD,KAAK4sB,KAAL,CACX9P,WAAW+P,kBAAX,CAA8B,CAA9B,EAAiCppB,MAAMhH,MAAN,GAAe,CAAhD,CADW,CAAN,CAAP;AAGD;AACD,YAAM,IAAIJ,KAAJ,CAAU,4CAAV,CAAN;AACD;;;wBAhlByB,CAAQ,C,CAAN;;AAE5B;;;;;;;wBAIgC,CAAQ,C,CAAN;;AAElC;;;;;;;wBAIsB,CAAE,IAAM;;;wBAEN,CAAQ,C,CAAN;;;;;;kBAp5BPygB,U;;;;;;;;;;;;;;ACnCpB;;;;AACA;;;;AACA;;;;AACA;;;;AACA;;;;AACA;;;;AAEA;;;;AA+BD;AACC,IAAI,OAAOxM,MAAP,KAAkB,WAAtB,EAAmC;AACjCA,SAAOwM,UAAP;AACAxM,SAAOyF,YAAP;AACAzF,SAAOoC,KAAP;AACApC,SAAO5I,SAAP;AACA4I,SAAOzH,WAAP;AACAyH,SAAO9B,gBAAP;AACA8B,SAAO1S,MAAP;AACA0S,SAAO9S,KAAP;AACA8S,SAAO5R,QAAP;AACD,C,CA/DF;;;;;;;;;;;;;AAaC;QAsDCoe,U;QACA/G,Y;QACArD,K;QACAhL,S;QACAmB,W;QACA2F,gB;QACAzR,K;QACAmC,M;QACA0D,M;QACAsD,G;QACApE,I;QACAH,M;QACAN,M;QACAN,M;QACAxB,iB;QACAJ,G;QACAT,Q;QACAT,O;QACAL,M;QACAJ,K;QACAJ,iB;QACAJ,mB;QACAV,a;QACAH,S;QACAR,Q;QACAI,S;QACAE,U;QACAP,I;QACAgB,c;QACAuF,S;QACAM,S;QACApF,c;QACAgD,a;;;;;;;;;;;;ACnGF,IAAM2sB,gBAAgB,IAAtB;;QAESA,a,GAAAA,a;;;;;;ACFT;AACA;;AAEA;AACA;AACA;;AAEA,uBAAuB;AACvB;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,qBAAqB,iBAAiB;AACtC;AACA;AACA;AACA,kBAAkB;AAClB;AACA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,SAAS;AACT;AACA;AACA;AACA;AACA;AACA,iBAAiB;AACjB;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA,0CAA0C,sBAAsB,EAAE;AAClE;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA,SAAS;AACT;AACA;;AAEA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA,yCAAyC;AACzC;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA,UAAU;AACV;AACA;;AAEA,KAAK;AACL;AACA;;AAEA,KAAK;AACL;AACA;;AAEA,KAAK;AACL;AACA;;AAEA,KAAK;AACL;AACA;AACA;;AAEA;AACA;AACA,CAAC;;;;;;;;ACzLD;;AAEA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;;AAEA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA,KAAK;AACL;AACA;;AAEA;AACA;AACA;AACA;;;;;;;ACpDA,gD","file":"experiment.max.js","sourcesContent":["(function webpackUniversalModuleDefinition(root, factory) {\n\tif(typeof exports === 'object' && typeof module === 'object')\n\t\tmodule.exports = factory(require(\"lodash\"), require(\"experiment-babylon-js\"), require(\"experiment-mathjs\"), require(\"jQuery\"), require(\"experiment-boxes\"));\n\telse if(typeof define === 'function' && define.amd)\n\t\tdefine(\"experiment\", [\"lodash\", \"experiment-babylon-js\", \"experiment-mathjs\", \"jQuery\", \"experiment-boxes\"], factory);\n\telse if(typeof exports === 'object')\n\t\texports[\"experiment\"] = factory(require(\"lodash\"), require(\"experiment-babylon-js\"), require(\"experiment-mathjs\"), require(\"jQuery\"), require(\"experiment-boxes\"));\n\telse\n\t\troot[\"experiment\"] = factory(root[\"_\"], root[\"BABYLON\"], root[\"math\"], root[\"jQuery\"], root[\"experimentBoxes\"]);\n})(this, function(__WEBPACK_EXTERNAL_MODULE_2__, __WEBPACK_EXTERNAL_MODULE_10__, __WEBPACK_EXTERNAL_MODULE_11__, __WEBPACK_EXTERNAL_MODULE_12__, __WEBPACK_EXTERNAL_MODULE_18__) {\nreturn \n\n\n// WEBPACK FOOTER //\n// webpack/universalModuleDefinition"," \t// The module cache\n \tvar installedModules = {};\n\n \t// The require function\n \tfunction __webpack_require__(moduleId) {\n\n \t\t// Check if module is in cache\n \t\tif(installedModules[moduleId])\n \t\t\treturn installedModules[moduleId].exports;\n\n \t\t// Create a new module (and put it into the cache)\n \t\tvar module = installedModules[moduleId] = {\n \t\t\ti: moduleId,\n \t\t\tl: false,\n \t\t\texports: {}\n \t\t};\n\n \t\t// Execute the module function\n \t\tmodules[moduleId].call(module.exports, module, module.exports, __webpack_require__);\n\n \t\t// Flag the module as loaded\n \t\tmodule.l = true;\n\n \t\t// Return the exports of the module\n \t\treturn module.exports;\n \t}\n\n\n \t// expose the modules object (__webpack_modules__)\n \t__webpack_require__.m = modules;\n\n \t// expose the module cache\n \t__webpack_require__.c = installedModules;\n\n \t// identity function for calling harmony imports with the correct context\n \t__webpack_require__.i = function(value) { return value; };\n\n \t// define getter function for harmony exports\n \t__webpack_require__.d = function(exports, name, getter) {\n \t\tif(!__webpack_require__.o(exports, name)) {\n \t\t\tObject.defineProperty(exports, name, {\n \t\t\t\tconfigurable: false,\n \t\t\t\tenumerable: true,\n \t\t\t\tget: getter\n \t\t\t});\n \t\t}\n \t};\n\n \t// getDefaultExport function for compatibility with non-harmony modules\n \t__webpack_require__.n = function(module) {\n \t\tvar getter = module && module.__esModule ?\n \t\t\tfunction getDefault() { return module['default']; } :\n \t\t\tfunction getModuleExports() { return module; };\n \t\t__webpack_require__.d(getter, 'a', getter);\n \t\treturn getter;\n \t};\n\n \t// Object.prototype.hasOwnProperty.call\n \t__webpack_require__.o = function(object, property) { return Object.prototype.hasOwnProperty.call(object, property); };\n\n \t// __webpack_public_path__\n \t__webpack_require__.p = \"\";\n\n \t// Load entry module and return exports\n \treturn __webpack_require__(__webpack_require__.s = 14);\n\n\n\n// WEBPACK FOOTER //\n// webpack/bootstrap fd66b5b8422506a602d7","/**\n * This file should contain utility functions that are independant of the task.\n *\n *\n */\n\nimport _ from 'lodash'\nimport math from 'experiment-mathjs'\nimport Promise from 'bluebird'\n\nimport { DEBUG_MODE_ON } from '../config'\n\nPromise.config({\n    // Enable warnings\n  warnings: false,\n    // Enable long stack traces\n  longStackTraces: false,\n    // Enable cancellation\n  cancellation: false,\n    // Enable monitoring\n  monitoring: false,\n})\n\n/**\n * noop - just your friendly empty function\n *\n * @returns {undefined}\n */\nfunction noop() {}\n\n\n/**\n * Debug functions\n */\nconst debuglog = DEBUG_MODE_ON ? console.log.bind(console) : noop\nconst debugWarn = DEBUG_MODE_ON ? console.warn.bind(console) : noop\nconst debugError = DEBUG_MODE_ON ? console.error.bind(console) : noop\n\n/**\n * Allows to return an error for missing parameters.\n * @param  {String} param Optional string to add after the error.\n */\nfunction mandatory(param = '') {\n  throw new Error(`Missing parameter ${param}`)\n}\n\n/**\n * Checks the type of all given parameters, return an error if one is undefined.\n * @param  {...object} args List of arguments to checks\n * @return {bool}      true if all arguments are defined\n */\n\nfunction mustBeDefined(...args) {\n  for (let i = 0; i < args.length; i++) {\n    if (typeof args[i] === 'undefined') {\n      throw new Error(`Argument ${i} is undefined.`) // TODO transform that into debugError...\n    }\n  }\n\n  return true\n}\n\n/**\n * Creates a new object of class TargetClass = defaultValue.constructor from the object parameter, only if the object is not\n * already an instance of TargetClass. If object is an array, the object is created like so new TargetClass(...object)\n * @method spreadToObject\n * @param  {Object|Array}       object      The object or array to be converted into TargetClass\n * @param  {Object}       defaultValue      If the object is undefined or null this value is returned.\n *                                          If not, the object is Transformed into the TargetClass which is defaultValue.constructor\n * @return {[type]}                         Object of class TargetClass\n */\nfunction spreadToObject(object, defaultValue) {\n  if ((typeof object === 'undefined') || (object === null)) {\n    return defaultValue\n  }\n\n  const TargetClass = defaultValue.constructor\n  if (object.constructor === TargetClass) {\n    return object\n  } else if (object.constructor === Array) {\n    return new TargetClass(...object)\n  }\n  debugWarn('spreadToObject: cannot spread to target class')\n  return defaultValue\n}\n\n/**\n * Checks the constructor of all given parameters, return an error if one is not as specified.\n * @param  {object} constructorObject constructor\n * @param  {...object} args         list of arguments to check\n * @return {bool}                   true if all arguments have specified constructorObject as constructor\n */\n\nfunction mustHaveConstructor(constructorObject, ...args) {\n  if (args.allHaveConstructor(constructorObject) === false) {\n    throw new Error('Wrong constructor in arguments.')\n  }\n\n  return true\n}\n\nfunction hasConstructor(constructorObject, ...args) {\n  if (args.allHaveConstructor(constructorObject) === false) {\n    return false\n  }\n\n  return true\n}\n\n/**\n * Returns true if o looks like a promise. From the es-promisify package.\n * https://github.com/digitaldesignlabs/es6-promisify/\n * @param  {object} o Object to test\n * @return {bool}   True if looks like a promise, false otherwise\n */\nfunction looksLikeAPromise(o) {\n  return o && typeof o.then === 'function' && typeof o.catch === 'function'\n}\n\n\n/**\n * From http://www.datchley.name/promise-patterns-anti-patterns/\n * @param  {int} ms delay in ms\n * @return {promise} promise which will resolve in delay ms\n */\nfunction delay(ms) {\n  return new Promise((resolve) => {\n    setTimeout(resolve, ms)\n  })\n}\n\n/**\n * @param  {int} min min delay in ms\n * @param  {int} max max delay in ms\n * @return {promise} promise which will resolve in delay ms\n */\nfunction jitter(min = mandatory(), max = mandatory()) {\n  return new Promise((resolve) => {\n    const randomDuration = _.random(min, max)\n    setTimeout(resolve, randomDuration)\n  })\n}\n\n/**\n * Recurse on a given promise chain\n * @param  {Promise} promise Promise to recurse on\n * @param  {numeric} amount  amount of time to recurse\n * @return {Promise}         Promise\n */\nfunction recurse(promiseGenerator = mandatory(),\n  amount = mandatory(),\n  target = this, args = [],\n  concatOnArray = []) {\n  // Base case - just return the promisified result\n  if (amount === 0) {\n    return new Promise((resolve) => {\n      resolve(concatOnArray)\n    })\n  }\n\n\n  const next = promiseGenerator.apply(target, args).then((r) => {\n    concatOnArray = concatOnArray.concat(r)\n    return (recurse(promiseGenerator, amount - 1, target, args, concatOnArray))\n  })\n\n  return next\n}\n\n/**\n * Compatible helper to replace the now defunc Promise.defer()\n * @method Deferred\n */\nfunction Deferred() {\n  this.resolve = null\n  this.reject = null\n  this.resolved = false\n  this.rejected = false\n  this.status = 0\n  /* A newly created Pomise object.\n   * Initially in pending state.\n   */\n  this.promise = new Promise((resolve, reject) => {\n    this.resolve = (data) => {\n      this.resolved = true\n      resolve(data)\n    }\n    this.reject = (e) => {\n      this.rejected = true\n      if (e.constructor === String) {\n        e = new Error(e)\n      }\n      reject(e)\n    }\n  })\n  // Object.freeze(this)\n}\n\n/**\n * From http://stackoverflow.com/questions/3751520/how-to-generate-sequence-of-numbers-chars-in-javascript\n * TODO Pull request math js\n * @param  {object} content Repeated sequence\n * @param  {int} count   Number of time the sequence must be repeat\n * @return {array}       Array with repeated sequence\n */\nfunction rep(content = mandatory(), count = mandatory()) {\n  let result = []\n  if (typeof (content) === 'function') {\n    for (let i = 0; i < count; i++) {\n      result = result.concat(content(i))\n    }\n  } else {\n    for (let i = 0; i < count; i++) {\n      result = result.concat(content)\n    }\n  }\n  return result\n}\n\nfunction samplePermutation(sequence = mandatory(), repetition = false, n = null) {\n  if (sequence.constructor !== Array) {\n    throw new Error('samplePermutation: sequence needs to be an array.')\n  }\n\n  if (n === null) {\n    n = sequence.length\n  }\n\n  const copy = sequence.slice(0)\n  let permutation = []\n  let add\n  while ((repetition && (permutation.length < n)) || ((!repetition) && (copy.length))) {\n    const index = Math.floor(Math.random() * copy.length)\n    if (repetition) {\n      add = copy[index]\n    } else {\n      add = copy.splice(index, 1)\n    }\n    permutation = permutation.concat(add)\n  }\n\n  return (permutation)\n}\n\n/* ======= Loading ======= */\nfunction preloadImages(...images) { // TODO make it a RessourceManager function\n  const imgArray = []\n  const promiseArray = []\n  for (const image of images) {\n    if (image.constructor === String) {\n      const deferred = new Deferred()\n      const img = new Image()\n      img.src = image\n      imgArray.push(img)\n\n      img.onload = function () {\n        this.resolve()\n      }.bind(deferred)\n\n      promiseArray.push(deferred.promise)\n    } else {\n      debugError('preloadImages: invalid string url ', image)\n    }\n  }\n\n\n  return [Promise.all(promiseArray), imgArray]\n}\n\n/* =============== Personalized Matrix Functions =============== */\nfunction matrix(rows = mandatory(), cols = mandatory(), fill = 0) {\n  const matrixObject = []\n\n  for (let i = 0; i < rows; i++) {\n    matrixObject[i] = []\n    for (let j = 0; j < cols; j++) {\n      matrixObject[i][j] = fill\n    }\n  }\n\n  return (matrixObject)\n}\n\nfunction getRow(matrixObject = mandatory(), rowIndex = mandatory()) {\n  matrixObject = math.matrix(matrixObject)\n  const size = (matrixObject.size())[0]\n  const row = math.subset(matrixObject, math.index(rowIndex, math.range(0, size)))\n\n  return (row)\n}\n\nfunction rowSum(matrixObject = mandatory(), rows = null) {\n  matrixObject = math.matrix(matrixObject)\n  const size = (matrixObject.size())[0]\n  if (rows === null) {\n    rows = math.range(0, size - 1)\n  }\n  if (rows.constructor !== Array) {\n    rows = [rows]\n  }\n\n  const rowSumArray = []\n  for (let i = 0; i < rows.length; i++) {\n    rowSumArray.push(math.sum(getRow(matrixObject, rows[i])))\n  }\n\n  return (rowSumArray)\n}\n\n// set or get the diagonal of a matrix\nfunction diag(matrixObject = mandatory(), setTo = null): Array {\n  const rows = matrixObject.length\n  // const cols = matrixObject[0].length\n\n  const diagonalValues = []\n\n  for (let i = 0; i < rows; i++) {\n    if (setTo) {\n      matrixObject[i][i] = setTo\n    }\n    diagonalValues.push(matrixObject[i][i])\n  }\n\n  return ([diagonalValues, matrixObject])\n}\n\n/* ======= BABYLON HELPERS ======= */\n\nfunction sizeToVec(size = null) {\n  mustHaveConstructor(BABYLON.Size, size)\n  return (new BABYLON.Vector2(size.width, size.height))\n}\n\nfunction scaleSize(size = null, scale = 1) {\n  mustHaveConstructor(BABYLON.Size, size)\n\n  const floatScale = parseFloat(scale)\n  if (isNaN(floatScale)) {\n    throw new Error(`taskObject.scaleSize: scale is invalid ${scale}`)\n  }\n\n  return new BABYLON.Size(size.width * floatScale, size.height * floatScale)\n}\n\n/* ======= Number functions ======= */\nNumber.prototype.boundTo = function boundTo(min = mandatory(), max = mandatory()) {\n  mustHaveConstructor(Number, min, max)\n  return Math.max(Math.min(this, max), min)\n}\n\n\n/* =============== String functions =============== */\n\n/**\n * Find all the positions of a needle in a haystack string\n * @param  {string} needle   string to find\n * @param  {string} haystack string to scan\n * @return {Array}  Either -1 if no match is found or an array containing the indicies\n */\nString.prototype.indicesOf = function indicesOf(needle = mandatory()): Array<number> | -1 {\n  const haystack = this\n  const indices = []\n  for (let i = 0; i < haystack.length; i++) {\n    if ((haystack.substr(i, needle.length)) === needle) {\n      indices.push(i)\n    }\n  }\n\n  if (indices.length) {\n    return (indices)\n  }\n  return (-1)\n}\n\n/* =============== Array prototype overload =============== */\nArray.prototype.hasNeighbouringRepeat = function hasNeighbouringRepeat() {\n  let previousElement = null\n  for (let i = 0; i < this.length; i++) {\n    if (previousElement === this[i]) {\n      return true\n    }\n    previousElement = this[i]\n  }\n  return false\n}\n\nArray.prototype.toCsv = function toCsv() {\n  const lineArray = []\n  this.forEach((array, index) => {\n    const line = array.join(',')\n    lineArray.push(index === 0 ?\n      `data:text/csv;charset=utf-8,${line}` :\n      line)\n  })\n  const csvContent = lineArray.join('\\n')\n\n  return (csvContent)\n}\n\nArray.prototype.uniqueValues = function uniqueValues() {\n  const u = {}\n  const a = []\n\n  for (let i = 0; i < this.length; i++) {\n    if (!u.hasOwnProperty(this[i])) {\n      a.push(this[i])\n      u[this[i]] = 1\n    }\n  }\n  return a\n}\n\nArray.prototype.min = function min() {\n  const u = this.uniqueValues()\n\n  if (u.allHaveConstructor(Number)) {\n    let minValue = u[0]\n    for (let i = 0; i < u.length; i++) {\n      if (u[i] < minValue) { minValue = u[i] }\n    }\n    return minValue\n  }\n  return NaN\n}\n\nArray.prototype.max = function max() {\n  const u = this.uniqueValues()\n\n  if (u.allHaveConstructor(Number)) {\n    let maxValue = u[0]\n    for (let i = 0; i < u.length; i++) {\n      if (u[i] > maxValue) { maxValue = u[i] }\n    }\n    return maxValue\n  }\n  return NaN\n}\n\n\n/**\n * multisplice - from http://upshots.org/actionscript/javascript-splice-array-on-multiple-indices-multisplice\n * With some es6 magic\n *\n * @returns {Array}\n */\nArray.prototype.multisplice = function (...args) {\n  args.sort((a, b) => a - b)\n  const spliced = []\n  for (let i = 0; i < args.length; i++) {\n    const index = args[i] - i\n    spliced.push(this.splice(index, 1)[0])\n  }\n  return spliced\n}\n\n/**\n * Return an array of objects with x and y property. Y is taken as the values of the array, and x is either the index if null, or the values of the specified array.\n * @param  {?array} x X values, if null, the index is taken as x\n * @return {array}   Array of x and y [{x: x[i], y: this[i]},...]\n */\nArray.prototype.getXY = function getXY(x = null): Array {\n  if (x !== null) {\n    if (x.constructor !== Array) {\n      throw new Error('Array.getXY: x needs to be an array.')\n    }\n\n    if (x.length !== this.length) {\n      throw new Error('Array.getXY: x needs to be of the same length as array')\n    }\n  } else {\n    debuglog('Array.getXY: x === null, x will be taken as the index of each value.')\n  }\n\n  const xyArray = []\n  for (let i = 0; i < this.length; i++) {\n    if (x !== null) {\n      xyArray.push({\n        x: x[i],\n        y: this[i],\n      })\n    } else {\n      xyArray.push({\n        x: i,\n        y: this[i],\n      })\n    }\n  }\n\n  return (xyArray)\n}\n\nArray.prototype.average = function average(type = 'global', size = 5): ?Number {\n  if (type === 'global') {\n    const sum = this.sum()\n    if (!isNaN(sum)) {\n      return (sum / this.length)\n    }\n  } else if (type === 'sliding') {\n    const windowAverages = []\n    for (let i = 0; i < this.length; i++) {\n      let endIndex = i + size\n      if (endIndex > this.length) {\n        endIndex = this.length\n      }\n      const windowArray = this.slice(i, endIndex)\n\n      const sum = windowArray.sum()\n      if (!isNaN(sum)) {\n        windowAverages.push(sum / windowArray.length)\n      }\n    }\n    return (windowAverages)\n  } else if (type === 'bins') {\n    const bins = []\n    let position = 0\n    while (position < this.length) {\n      const endIndex = position + size\n      if (endIndex > this.length) {\n        break\n      }\n\n      const windowArray = this.slice(position, endIndex)\n\n      const sum = windowArray.sum()\n      if (!isNaN(sum)) {\n        bins.push(sum / windowArray.length)\n      }\n\n      position = endIndex\n    }\n\n    return (bins)\n  }\n\n  return undefined\n}\n\nArray.prototype.sum = function sum() {\n  let total = 0\n  for (let i = 0; i < this.length; i++) {\n    if (isNaN(this[i])) {\n      return (NaN)\n    }\n    total += this[i]\n  }\n  return (total)\n}\n\nArray.prototype.integrate = function integrate() {\n  let sum = 0\n  const cumulativeArray = []\n  for (let i = 0; i < this.length; i++) {\n    if (isNaN(this[i])) {\n      return (NaN)\n    }\n\n    sum += this[i]\n    cumulativeArray.push(sum)\n  }\n  return (cumulativeArray)\n}\n\nArray.prototype.equals = function equals(value) {\n  const resultVector = []\n  let result = null\n  for (let i = 0, l = this.length; i < l; ++i) {\n    result = (this[i] === value)\n    resultVector.push(result)\n  }\n  return resultVector\n}\n\nArray.prototype.ntrue = function ntrue() {\n  let resultSum = 0\n  let result = null\n  for (let i = 0, l = this.length; i < l; ++i) {\n    result = (this[i] === true) ?\n      1 :\n      0\n    resultSum += result\n  }\n  return resultSum\n}\n\nArray.prototype.nEquals = function nEquals(value) {\n  return this.equals(value).ntrue()\n}\n\nArray.prototype.indicesOf = function indicesOf(value) {\n  const resultVector = []\n  for (let i = 0, l = this.length; i < l; i++) {\n    if (this[i] === value) {\n      resultVector.push(i)\n    }\n  }\n  return resultVector\n}\n\nArray.prototype.exclude = function exclude(values) {\n  // returns an array without exluded values\n  const resultVector = []\n  for (let i = 0, l = this.length; i < l; ++i) {\n    let addit = true\n    for (let j = 0; j < values.length; ++j) {\n      if (this[i] === values[j]) {\n        addit = false\n      }\n    }\n    if (addit) {\n      resultVector.push(this[i])\n    }\n  }\n  return resultVector\n}\n\nArray.prototype.allHaveConstructor = function allHaveConstructor(constructorObject) {\n  for (let i = 0; i < this.length; i++) {\n    if ((typeof this[i] === 'undefined') || (this[i] === null) || (this[i].constructor !== constructorObject)) {\n      return false\n    }\n  }\n  return true\n}\n\nArray.prototype.includes = function includes(...array) {\n  if ((array.length === 1) && ((array[0].constructor === Set) || (array[0].constructor === Array))) {\n    array = array[0]\n  }\n  // returns a bool wether all value of specified array are in current array\n  for (let i = 0; i < array.length; i++) {\n    if (this.indexOf(array[i]) === -1) { return false }\n  }\n  return true\n}\n\n\n/**\n * observe - Starts a repeated check (default to every 500 millisecond) on the attribute of an object until it is set to a\n *           specified value. Returns a promise that will resolve when the value match.\n *           TODO maybe think of creating an _observedValues property somewhere... maybe in a global object\n *\n * @param {string} [attribute=string]   attribute to check\n * @param {boolean} [lookForValue=true] value to match\n * @param {number}  [rate=500]          how many milliseconds between two checks\n *\n * @returns {Promise} Promise will resolve when the attribute has the value lookForValue\n */\nObject.defineProperty(Object.prototype, 'observe', {\n  value: function observe(attribute = mandatory(), lookForValue = true, rate = 500): Promise {\n    const deferred = new Deferred()\n    debuglog('Started observing ', this, ' attribute ', attribute, ' for value ', lookForValue, ' current value ', this[attribute])\n    const checkForValue = () => {\n      if (this[attribute] === lookForValue) {\n        debuglog('Finished observing ', this, ' attribute ', attribute, ' for value ', lookForValue, ' current value ', this[attribute])\n        deferred.resolve(lookForValue)\n      } else {\n        debuglog('im still observing ', this, ' attribute ', attribute, ' for value ', lookForValue, ' current value ', this[attribute])\n        delay(rate).then(checkForValue)\n      }\n    }\n    checkForValue()\n    return deferred.promise\n  },\n  enumerable: false,\n})\n\n\n/**\n * isSuperset - Returns true if the set is a superset of the specified subset\n *\n * @param {Set} subset a set\n *\n * @returns {bool}\n */\nSet.prototype.isSuperset = function (subset) {\n  for (const elem of subset) {\n    if (!this.has(elem)) {\n      return false\n    }\n  }\n  return true\n}\n\nSet.prototype.union = function (setB) {\n  const union = new Set(this)\n  for (const elem of setB) {\n    union.add(elem)\n  }\n  return union\n}\n\nSet.prototype.sample = function (n = 1, repeat = true) {\n  const result = []\n  const array = Array.from(this)\n  for (let i = 0; i < n; i++) {\n    const index = _.random(0, array.length - 1)\n    result.push(array[index])\n    if (!repeat) {\n      array.splice(index, 1)\n    }\n  }\n  return result\n}\n\n/**\n * unite - Performs union in place. Replaces current set.\n *\n * @param {Set} setB\n *\n * @returns {undefined}\n */\nSet.prototype.unite = function (setB) {\n  for (const elem of setB) {\n    this.add(elem)\n  }\n  return undefined\n}\n\nSet.prototype.intersection = function (setB) {\n  const intersection = new Set()\n  for (const elem of setB) {\n    if (this.has(elem)) {\n      intersection.add(elem)\n    }\n  }\n  return intersection\n}\n\n\n/**\n * intersect - Performs an intersection in place (replace current set values)\n *\n * @param {Set} setB Description\n *\n * @returns {undefined}\n */\nSet.prototype.intersect = function (setB) {\n  for (const elem of this) {\n    if (!setB.has(elem)) {\n      this.remove(elem)\n    }\n  }\n  return undefined\n}\n\nSet.prototype.difference = function (setB) {\n  const difference = new Set(this)\n  for (const elem of setB) {\n    difference.delete(elem)\n  }\n  return difference\n}\n\nexport {\n  Array,\n  String,\n  Object,\n  Number,\n  Set,\n  diag,\n  rowSum,\n  getRow,\n  matrix,\n  samplePermutation,\n  rep,\n  Deferred,\n  recurse,\n  jitter,\n  delay,\n  looksLikeAPromise,\n  mustHaveConstructor,\n  mustBeDefined,\n  mandatory,\n  debuglog,\n  debugWarn,\n  debugError,\n  noop,\n  spreadToObject,\n  sizeToVec,\n  scaleSize,\n  hasConstructor,\n  preloadImages,\n}\n\n\n\n// WEBPACK FOOTER //\n// ./src/framework/utilities.js","/* @preserve\n * The MIT License (MIT)\n * \n * Copyright (c) 2013-2017 Petka Antonov\n * \n * Permission is hereby granted, free of charge, to any person obtaining a copy\n * of this software and associated documentation files (the \"Software\"), to deal\n * in the Software without restriction, including without limitation the rights\n * to use, copy, modify, merge, publish, distribute, sublicense, and/or sell\n * copies of the Software, and to permit persons to whom the Software is\n * furnished to do so, subject to the following conditions:\n * \n * The above copyright notice and this permission notice shall be included in\n * all copies or substantial portions of the Software.\n * \n * THE SOFTWARE IS PROVIDED \"AS IS\", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR\n * IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,\n * FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT.  IN NO EVENT SHALL THE\n * AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER\n * LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,\n * OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN\n * THE SOFTWARE.\n * \n */\n/**\n * bluebird build version 3.5.0\n * Features enabled: core, race, call_get, generators, map, nodeify, promisify, props, reduce, settle, some, using, timers, filter, any, each\n*/\n!function(e){if(\"object\"==typeof exports&&\"undefined\"!=typeof module)module.exports=e();else if(\"function\"==typeof define&&define.amd)define([],e);else{var f;\"undefined\"!=typeof window?f=window:\"undefined\"!=typeof global?f=global:\"undefined\"!=typeof self&&(f=self),f.Promise=e()}}(function(){var define,module,exports;return (function e(t,n,r){function s(o,u){if(!n[o]){if(!t[o]){var a=typeof _dereq_==\"function\"&&_dereq_;if(!u&&a)return a(o,!0);if(i)return i(o,!0);var f=new Error(\"Cannot find module '\"+o+\"'\");throw f.code=\"MODULE_NOT_FOUND\",f}var l=n[o]={exports:{}};t[o][0].call(l.exports,function(e){var n=t[o][1][e];return s(n?n:e)},l,l.exports,e,t,n,r)}return n[o].exports}var i=typeof _dereq_==\"function\"&&_dereq_;for(var o=0;o<r.length;o++)s(r[o]);return s})({1:[function(_dereq_,module,exports){\n\"use strict\";\nmodule.exports = function(Promise) {\nvar SomePromiseArray = Promise._SomePromiseArray;\nfunction any(promises) {\n    var ret = new SomePromiseArray(promises);\n    var promise = ret.promise();\n    ret.setHowMany(1);\n    ret.setUnwrap();\n    ret.init();\n    return promise;\n}\n\nPromise.any = function (promises) {\n    return any(promises);\n};\n\nPromise.prototype.any = function () {\n    return any(this);\n};\n\n};\n\n},{}],2:[function(_dereq_,module,exports){\n\"use strict\";\nvar firstLineError;\ntry {throw new Error(); } catch (e) {firstLineError = e;}\nvar schedule = _dereq_(\"./schedule\");\nvar Queue = _dereq_(\"./queue\");\nvar util = _dereq_(\"./util\");\n\nfunction Async() {\n    this._customScheduler = false;\n    this._isTickUsed = false;\n    this._lateQueue = new Queue(16);\n    this._normalQueue = new Queue(16);\n    this._haveDrainedQueues = false;\n    this._trampolineEnabled = true;\n    var self = this;\n    this.drainQueues = function () {\n        self._drainQueues();\n    };\n    this._schedule = schedule;\n}\n\nAsync.prototype.setScheduler = function(fn) {\n    var prev = this._schedule;\n    this._schedule = fn;\n    this._customScheduler = true;\n    return prev;\n};\n\nAsync.prototype.hasCustomScheduler = function() {\n    return this._customScheduler;\n};\n\nAsync.prototype.enableTrampoline = function() {\n    this._trampolineEnabled = true;\n};\n\nAsync.prototype.disableTrampolineIfNecessary = function() {\n    if (util.hasDevTools) {\n        this._trampolineEnabled = false;\n    }\n};\n\nAsync.prototype.haveItemsQueued = function () {\n    return this._isTickUsed || this._haveDrainedQueues;\n};\n\n\nAsync.prototype.fatalError = function(e, isNode) {\n    if (isNode) {\n        process.stderr.write(\"Fatal \" + (e instanceof Error ? e.stack : e) +\n            \"\\n\");\n        process.exit(2);\n    } else {\n        this.throwLater(e);\n    }\n};\n\nAsync.prototype.throwLater = function(fn, arg) {\n    if (arguments.length === 1) {\n        arg = fn;\n        fn = function () { throw arg; };\n    }\n    if (typeof setTimeout !== \"undefined\") {\n        setTimeout(function() {\n            fn(arg);\n        }, 0);\n    } else try {\n        this._schedule(function() {\n            fn(arg);\n        });\n    } catch (e) {\n        throw new Error(\"No async scheduler available\\u000a\\u000a    See http://goo.gl/MqrFmX\\u000a\");\n    }\n};\n\nfunction AsyncInvokeLater(fn, receiver, arg) {\n    this._lateQueue.push(fn, receiver, arg);\n    this._queueTick();\n}\n\nfunction AsyncInvoke(fn, receiver, arg) {\n    this._normalQueue.push(fn, receiver, arg);\n    this._queueTick();\n}\n\nfunction AsyncSettlePromises(promise) {\n    this._normalQueue._pushOne(promise);\n    this._queueTick();\n}\n\nif (!util.hasDevTools) {\n    Async.prototype.invokeLater = AsyncInvokeLater;\n    Async.prototype.invoke = AsyncInvoke;\n    Async.prototype.settlePromises = AsyncSettlePromises;\n} else {\n    Async.prototype.invokeLater = function (fn, receiver, arg) {\n        if (this._trampolineEnabled) {\n            AsyncInvokeLater.call(this, fn, receiver, arg);\n        } else {\n            this._schedule(function() {\n                setTimeout(function() {\n                    fn.call(receiver, arg);\n                }, 100);\n            });\n        }\n    };\n\n    Async.prototype.invoke = function (fn, receiver, arg) {\n        if (this._trampolineEnabled) {\n            AsyncInvoke.call(this, fn, receiver, arg);\n        } else {\n            this._schedule(function() {\n                fn.call(receiver, arg);\n            });\n        }\n    };\n\n    Async.prototype.settlePromises = function(promise) {\n        if (this._trampolineEnabled) {\n            AsyncSettlePromises.call(this, promise);\n        } else {\n            this._schedule(function() {\n                promise._settlePromises();\n            });\n        }\n    };\n}\n\nAsync.prototype._drainQueue = function(queue) {\n    while (queue.length() > 0) {\n        var fn = queue.shift();\n        if (typeof fn !== \"function\") {\n            fn._settlePromises();\n            continue;\n        }\n        var receiver = queue.shift();\n        var arg = queue.shift();\n        fn.call(receiver, arg);\n    }\n};\n\nAsync.prototype._drainQueues = function () {\n    this._drainQueue(this._normalQueue);\n    this._reset();\n    this._haveDrainedQueues = true;\n    this._drainQueue(this._lateQueue);\n};\n\nAsync.prototype._queueTick = function () {\n    if (!this._isTickUsed) {\n        this._isTickUsed = true;\n        this._schedule(this.drainQueues);\n    }\n};\n\nAsync.prototype._reset = function () {\n    this._isTickUsed = false;\n};\n\nmodule.exports = Async;\nmodule.exports.firstLineError = firstLineError;\n\n},{\"./queue\":26,\"./schedule\":29,\"./util\":36}],3:[function(_dereq_,module,exports){\n\"use strict\";\nmodule.exports = function(Promise, INTERNAL, tryConvertToPromise, debug) {\nvar calledBind = false;\nvar rejectThis = function(_, e) {\n    this._reject(e);\n};\n\nvar targetRejected = function(e, context) {\n    context.promiseRejectionQueued = true;\n    context.bindingPromise._then(rejectThis, rejectThis, null, this, e);\n};\n\nvar bindingResolved = function(thisArg, context) {\n    if (((this._bitField & 50397184) === 0)) {\n        this._resolveCallback(context.target);\n    }\n};\n\nvar bindingRejected = function(e, context) {\n    if (!context.promiseRejectionQueued) this._reject(e);\n};\n\nPromise.prototype.bind = function (thisArg) {\n    if (!calledBind) {\n        calledBind = true;\n        Promise.prototype._propagateFrom = debug.propagateFromFunction();\n        Promise.prototype._boundValue = debug.boundValueFunction();\n    }\n    var maybePromise = tryConvertToPromise(thisArg);\n    var ret = new Promise(INTERNAL);\n    ret._propagateFrom(this, 1);\n    var target = this._target();\n    ret._setBoundTo(maybePromise);\n    if (maybePromise instanceof Promise) {\n        var context = {\n            promiseRejectionQueued: false,\n            promise: ret,\n            target: target,\n            bindingPromise: maybePromise\n        };\n        target._then(INTERNAL, targetRejected, undefined, ret, context);\n        maybePromise._then(\n            bindingResolved, bindingRejected, undefined, ret, context);\n        ret._setOnCancel(maybePromise);\n    } else {\n        ret._resolveCallback(target);\n    }\n    return ret;\n};\n\nPromise.prototype._setBoundTo = function (obj) {\n    if (obj !== undefined) {\n        this._bitField = this._bitField | 2097152;\n        this._boundTo = obj;\n    } else {\n        this._bitField = this._bitField & (~2097152);\n    }\n};\n\nPromise.prototype._isBound = function () {\n    return (this._bitField & 2097152) === 2097152;\n};\n\nPromise.bind = function (thisArg, value) {\n    return Promise.resolve(value).bind(thisArg);\n};\n};\n\n},{}],4:[function(_dereq_,module,exports){\n\"use strict\";\nvar old;\nif (typeof Promise !== \"undefined\") old = Promise;\nfunction noConflict() {\n    try { if (Promise === bluebird) Promise = old; }\n    catch (e) {}\n    return bluebird;\n}\nvar bluebird = _dereq_(\"./promise\")();\nbluebird.noConflict = noConflict;\nmodule.exports = bluebird;\n\n},{\"./promise\":22}],5:[function(_dereq_,module,exports){\n\"use strict\";\nvar cr = Object.create;\nif (cr) {\n    var callerCache = cr(null);\n    var getterCache = cr(null);\n    callerCache[\" size\"] = getterCache[\" size\"] = 0;\n}\n\nmodule.exports = function(Promise) {\nvar util = _dereq_(\"./util\");\nvar canEvaluate = util.canEvaluate;\nvar isIdentifier = util.isIdentifier;\n\nvar getMethodCaller;\nvar getGetter;\nif (!true) {\nvar makeMethodCaller = function (methodName) {\n    return new Function(\"ensureMethod\", \"                                    \\n\\\n        return function(obj) {                                               \\n\\\n            'use strict'                                                     \\n\\\n            var len = this.length;                                           \\n\\\n            ensureMethod(obj, 'methodName');                                 \\n\\\n            switch(len) {                                                    \\n\\\n                case 1: return obj.methodName(this[0]);                      \\n\\\n                case 2: return obj.methodName(this[0], this[1]);             \\n\\\n                case 3: return obj.methodName(this[0], this[1], this[2]);    \\n\\\n                case 0: return obj.methodName();                             \\n\\\n                default:                                                     \\n\\\n                    return obj.methodName.apply(obj, this);                  \\n\\\n            }                                                                \\n\\\n        };                                                                   \\n\\\n        \".replace(/methodName/g, methodName))(ensureMethod);\n};\n\nvar makeGetter = function (propertyName) {\n    return new Function(\"obj\", \"                                             \\n\\\n        'use strict';                                                        \\n\\\n        return obj.propertyName;                                             \\n\\\n        \".replace(\"propertyName\", propertyName));\n};\n\nvar getCompiled = function(name, compiler, cache) {\n    var ret = cache[name];\n    if (typeof ret !== \"function\") {\n        if (!isIdentifier(name)) {\n            return null;\n        }\n        ret = compiler(name);\n        cache[name] = ret;\n        cache[\" size\"]++;\n        if (cache[\" size\"] > 512) {\n            var keys = Object.keys(cache);\n            for (var i = 0; i < 256; ++i) delete cache[keys[i]];\n            cache[\" size\"] = keys.length - 256;\n        }\n    }\n    return ret;\n};\n\ngetMethodCaller = function(name) {\n    return getCompiled(name, makeMethodCaller, callerCache);\n};\n\ngetGetter = function(name) {\n    return getCompiled(name, makeGetter, getterCache);\n};\n}\n\nfunction ensureMethod(obj, methodName) {\n    var fn;\n    if (obj != null) fn = obj[methodName];\n    if (typeof fn !== \"function\") {\n        var message = \"Object \" + util.classString(obj) + \" has no method '\" +\n            util.toString(methodName) + \"'\";\n        throw new Promise.TypeError(message);\n    }\n    return fn;\n}\n\nfunction caller(obj) {\n    var methodName = this.pop();\n    var fn = ensureMethod(obj, methodName);\n    return fn.apply(obj, this);\n}\nPromise.prototype.call = function (methodName) {\n    var args = [].slice.call(arguments, 1);;\n    if (!true) {\n        if (canEvaluate) {\n            var maybeCaller = getMethodCaller(methodName);\n            if (maybeCaller !== null) {\n                return this._then(\n                    maybeCaller, undefined, undefined, args, undefined);\n            }\n        }\n    }\n    args.push(methodName);\n    return this._then(caller, undefined, undefined, args, undefined);\n};\n\nfunction namedGetter(obj) {\n    return obj[this];\n}\nfunction indexedGetter(obj) {\n    var index = +this;\n    if (index < 0) index = Math.max(0, index + obj.length);\n    return obj[index];\n}\nPromise.prototype.get = function (propertyName) {\n    var isIndex = (typeof propertyName === \"number\");\n    var getter;\n    if (!isIndex) {\n        if (canEvaluate) {\n            var maybeGetter = getGetter(propertyName);\n            getter = maybeGetter !== null ? maybeGetter : namedGetter;\n        } else {\n            getter = namedGetter;\n        }\n    } else {\n        getter = indexedGetter;\n    }\n    return this._then(getter, undefined, undefined, propertyName, undefined);\n};\n};\n\n},{\"./util\":36}],6:[function(_dereq_,module,exports){\n\"use strict\";\nmodule.exports = function(Promise, PromiseArray, apiRejection, debug) {\nvar util = _dereq_(\"./util\");\nvar tryCatch = util.tryCatch;\nvar errorObj = util.errorObj;\nvar async = Promise._async;\n\nPromise.prototype[\"break\"] = Promise.prototype.cancel = function() {\n    if (!debug.cancellation()) return this._warn(\"cancellation is disabled\");\n\n    var promise = this;\n    var child = promise;\n    while (promise._isCancellable()) {\n        if (!promise._cancelBy(child)) {\n            if (child._isFollowing()) {\n                child._followee().cancel();\n            } else {\n                child._cancelBranched();\n            }\n            break;\n        }\n\n        var parent = promise._cancellationParent;\n        if (parent == null || !parent._isCancellable()) {\n            if (promise._isFollowing()) {\n                promise._followee().cancel();\n            } else {\n                promise._cancelBranched();\n            }\n            break;\n        } else {\n            if (promise._isFollowing()) promise._followee().cancel();\n            promise._setWillBeCancelled();\n            child = promise;\n            promise = parent;\n        }\n    }\n};\n\nPromise.prototype._branchHasCancelled = function() {\n    this._branchesRemainingToCancel--;\n};\n\nPromise.prototype._enoughBranchesHaveCancelled = function() {\n    return this._branchesRemainingToCancel === undefined ||\n           this._branchesRemainingToCancel <= 0;\n};\n\nPromise.prototype._cancelBy = function(canceller) {\n    if (canceller === this) {\n        this._branchesRemainingToCancel = 0;\n        this._invokeOnCancel();\n        return true;\n    } else {\n        this._branchHasCancelled();\n        if (this._enoughBranchesHaveCancelled()) {\n            this._invokeOnCancel();\n            return true;\n        }\n    }\n    return false;\n};\n\nPromise.prototype._cancelBranched = function() {\n    if (this._enoughBranchesHaveCancelled()) {\n        this._cancel();\n    }\n};\n\nPromise.prototype._cancel = function() {\n    if (!this._isCancellable()) return;\n    this._setCancelled();\n    async.invoke(this._cancelPromises, this, undefined);\n};\n\nPromise.prototype._cancelPromises = function() {\n    if (this._length() > 0) this._settlePromises();\n};\n\nPromise.prototype._unsetOnCancel = function() {\n    this._onCancelField = undefined;\n};\n\nPromise.prototype._isCancellable = function() {\n    return this.isPending() && !this._isCancelled();\n};\n\nPromise.prototype.isCancellable = function() {\n    return this.isPending() && !this.isCancelled();\n};\n\nPromise.prototype._doInvokeOnCancel = function(onCancelCallback, internalOnly) {\n    if (util.isArray(onCancelCallback)) {\n        for (var i = 0; i < onCancelCallback.length; ++i) {\n            this._doInvokeOnCancel(onCancelCallback[i], internalOnly);\n        }\n    } else if (onCancelCallback !== undefined) {\n        if (typeof onCancelCallback === \"function\") {\n            if (!internalOnly) {\n                var e = tryCatch(onCancelCallback).call(this._boundValue());\n                if (e === errorObj) {\n                    this._attachExtraTrace(e.e);\n                    async.throwLater(e.e);\n                }\n            }\n        } else {\n            onCancelCallback._resultCancelled(this);\n        }\n    }\n};\n\nPromise.prototype._invokeOnCancel = function() {\n    var onCancelCallback = this._onCancel();\n    this._unsetOnCancel();\n    async.invoke(this._doInvokeOnCancel, this, onCancelCallback);\n};\n\nPromise.prototype._invokeInternalOnCancel = function() {\n    if (this._isCancellable()) {\n        this._doInvokeOnCancel(this._onCancel(), true);\n        this._unsetOnCancel();\n    }\n};\n\nPromise.prototype._resultCancelled = function() {\n    this.cancel();\n};\n\n};\n\n},{\"./util\":36}],7:[function(_dereq_,module,exports){\n\"use strict\";\nmodule.exports = function(NEXT_FILTER) {\nvar util = _dereq_(\"./util\");\nvar getKeys = _dereq_(\"./es5\").keys;\nvar tryCatch = util.tryCatch;\nvar errorObj = util.errorObj;\n\nfunction catchFilter(instances, cb, promise) {\n    return function(e) {\n        var boundTo = promise._boundValue();\n        predicateLoop: for (var i = 0; i < instances.length; ++i) {\n            var item = instances[i];\n\n            if (item === Error ||\n                (item != null && item.prototype instanceof Error)) {\n                if (e instanceof item) {\n                    return tryCatch(cb).call(boundTo, e);\n                }\n            } else if (typeof item === \"function\") {\n                var matchesPredicate = tryCatch(item).call(boundTo, e);\n                if (matchesPredicate === errorObj) {\n                    return matchesPredicate;\n                } else if (matchesPredicate) {\n                    return tryCatch(cb).call(boundTo, e);\n                }\n            } else if (util.isObject(e)) {\n                var keys = getKeys(item);\n                for (var j = 0; j < keys.length; ++j) {\n                    var key = keys[j];\n                    if (item[key] != e[key]) {\n                        continue predicateLoop;\n                    }\n                }\n                return tryCatch(cb).call(boundTo, e);\n            }\n        }\n        return NEXT_FILTER;\n    };\n}\n\nreturn catchFilter;\n};\n\n},{\"./es5\":13,\"./util\":36}],8:[function(_dereq_,module,exports){\n\"use strict\";\nmodule.exports = function(Promise) {\nvar longStackTraces = false;\nvar contextStack = [];\n\nPromise.prototype._promiseCreated = function() {};\nPromise.prototype._pushContext = function() {};\nPromise.prototype._popContext = function() {return null;};\nPromise._peekContext = Promise.prototype._peekContext = function() {};\n\nfunction Context() {\n    this._trace = new Context.CapturedTrace(peekContext());\n}\nContext.prototype._pushContext = function () {\n    if (this._trace !== undefined) {\n        this._trace._promiseCreated = null;\n        contextStack.push(this._trace);\n    }\n};\n\nContext.prototype._popContext = function () {\n    if (this._trace !== undefined) {\n        var trace = contextStack.pop();\n        var ret = trace._promiseCreated;\n        trace._promiseCreated = null;\n        return ret;\n    }\n    return null;\n};\n\nfunction createContext() {\n    if (longStackTraces) return new Context();\n}\n\nfunction peekContext() {\n    var lastIndex = contextStack.length - 1;\n    if (lastIndex >= 0) {\n        return contextStack[lastIndex];\n    }\n    return undefined;\n}\nContext.CapturedTrace = null;\nContext.create = createContext;\nContext.deactivateLongStackTraces = function() {};\nContext.activateLongStackTraces = function() {\n    var Promise_pushContext = Promise.prototype._pushContext;\n    var Promise_popContext = Promise.prototype._popContext;\n    var Promise_PeekContext = Promise._peekContext;\n    var Promise_peekContext = Promise.prototype._peekContext;\n    var Promise_promiseCreated = Promise.prototype._promiseCreated;\n    Context.deactivateLongStackTraces = function() {\n        Promise.prototype._pushContext = Promise_pushContext;\n        Promise.prototype._popContext = Promise_popContext;\n        Promise._peekContext = Promise_PeekContext;\n        Promise.prototype._peekContext = Promise_peekContext;\n        Promise.prototype._promiseCreated = Promise_promiseCreated;\n        longStackTraces = false;\n    };\n    longStackTraces = true;\n    Promise.prototype._pushContext = Context.prototype._pushContext;\n    Promise.prototype._popContext = Context.prototype._popContext;\n    Promise._peekContext = Promise.prototype._peekContext = peekContext;\n    Promise.prototype._promiseCreated = function() {\n        var ctx = this._peekContext();\n        if (ctx && ctx._promiseCreated == null) ctx._promiseCreated = this;\n    };\n};\nreturn Context;\n};\n\n},{}],9:[function(_dereq_,module,exports){\n\"use strict\";\nmodule.exports = function(Promise, Context) {\nvar getDomain = Promise._getDomain;\nvar async = Promise._async;\nvar Warning = _dereq_(\"./errors\").Warning;\nvar util = _dereq_(\"./util\");\nvar canAttachTrace = util.canAttachTrace;\nvar unhandledRejectionHandled;\nvar possiblyUnhandledRejection;\nvar bluebirdFramePattern =\n    /[\\\\\\/]bluebird[\\\\\\/]js[\\\\\\/](release|debug|instrumented)/;\nvar nodeFramePattern = /\\((?:timers\\.js):\\d+:\\d+\\)/;\nvar parseLinePattern = /[\\/<\\(](.+?):(\\d+):(\\d+)\\)?\\s*$/;\nvar stackFramePattern = null;\nvar formatStack = null;\nvar indentStackFrames = false;\nvar printWarning;\nvar debugging = !!(util.env(\"BLUEBIRD_DEBUG\") != 0 &&\n                        (true ||\n                         util.env(\"BLUEBIRD_DEBUG\") ||\n                         util.env(\"NODE_ENV\") === \"development\"));\n\nvar warnings = !!(util.env(\"BLUEBIRD_WARNINGS\") != 0 &&\n    (debugging || util.env(\"BLUEBIRD_WARNINGS\")));\n\nvar longStackTraces = !!(util.env(\"BLUEBIRD_LONG_STACK_TRACES\") != 0 &&\n    (debugging || util.env(\"BLUEBIRD_LONG_STACK_TRACES\")));\n\nvar wForgottenReturn = util.env(\"BLUEBIRD_W_FORGOTTEN_RETURN\") != 0 &&\n    (warnings || !!util.env(\"BLUEBIRD_W_FORGOTTEN_RETURN\"));\n\nPromise.prototype.suppressUnhandledRejections = function() {\n    var target = this._target();\n    target._bitField = ((target._bitField & (~1048576)) |\n                      524288);\n};\n\nPromise.prototype._ensurePossibleRejectionHandled = function () {\n    if ((this._bitField & 524288) !== 0) return;\n    this._setRejectionIsUnhandled();\n    async.invokeLater(this._notifyUnhandledRejection, this, undefined);\n};\n\nPromise.prototype._notifyUnhandledRejectionIsHandled = function () {\n    fireRejectionEvent(\"rejectionHandled\",\n                                  unhandledRejectionHandled, undefined, this);\n};\n\nPromise.prototype._setReturnedNonUndefined = function() {\n    this._bitField = this._bitField | 268435456;\n};\n\nPromise.prototype._returnedNonUndefined = function() {\n    return (this._bitField & 268435456) !== 0;\n};\n\nPromise.prototype._notifyUnhandledRejection = function () {\n    if (this._isRejectionUnhandled()) {\n        var reason = this._settledValue();\n        this._setUnhandledRejectionIsNotified();\n        fireRejectionEvent(\"unhandledRejection\",\n                                      possiblyUnhandledRejection, reason, this);\n    }\n};\n\nPromise.prototype._setUnhandledRejectionIsNotified = function () {\n    this._bitField = this._bitField | 262144;\n};\n\nPromise.prototype._unsetUnhandledRejectionIsNotified = function () {\n    this._bitField = this._bitField & (~262144);\n};\n\nPromise.prototype._isUnhandledRejectionNotified = function () {\n    return (this._bitField & 262144) > 0;\n};\n\nPromise.prototype._setRejectionIsUnhandled = function () {\n    this._bitField = this._bitField | 1048576;\n};\n\nPromise.prototype._unsetRejectionIsUnhandled = function () {\n    this._bitField = this._bitField & (~1048576);\n    if (this._isUnhandledRejectionNotified()) {\n        this._unsetUnhandledRejectionIsNotified();\n        this._notifyUnhandledRejectionIsHandled();\n    }\n};\n\nPromise.prototype._isRejectionUnhandled = function () {\n    return (this._bitField & 1048576) > 0;\n};\n\nPromise.prototype._warn = function(message, shouldUseOwnTrace, promise) {\n    return warn(message, shouldUseOwnTrace, promise || this);\n};\n\nPromise.onPossiblyUnhandledRejection = function (fn) {\n    var domain = getDomain();\n    possiblyUnhandledRejection =\n        typeof fn === \"function\" ? (domain === null ?\n                                            fn : util.domainBind(domain, fn))\n                                 : undefined;\n};\n\nPromise.onUnhandledRejectionHandled = function (fn) {\n    var domain = getDomain();\n    unhandledRejectionHandled =\n        typeof fn === \"function\" ? (domain === null ?\n                                            fn : util.domainBind(domain, fn))\n                                 : undefined;\n};\n\nvar disableLongStackTraces = function() {};\nPromise.longStackTraces = function () {\n    if (async.haveItemsQueued() && !config.longStackTraces) {\n        throw new Error(\"cannot enable long stack traces after promises have been created\\u000a\\u000a    See http://goo.gl/MqrFmX\\u000a\");\n    }\n    if (!config.longStackTraces && longStackTracesIsSupported()) {\n        var Promise_captureStackTrace = Promise.prototype._captureStackTrace;\n        var Promise_attachExtraTrace = Promise.prototype._attachExtraTrace;\n        config.longStackTraces = true;\n        disableLongStackTraces = function() {\n            if (async.haveItemsQueued() && !config.longStackTraces) {\n                throw new Error(\"cannot enable long stack traces after promises have been created\\u000a\\u000a    See http://goo.gl/MqrFmX\\u000a\");\n            }\n            Promise.prototype._captureStackTrace = Promise_captureStackTrace;\n            Promise.prototype._attachExtraTrace = Promise_attachExtraTrace;\n            Context.deactivateLongStackTraces();\n            async.enableTrampoline();\n            config.longStackTraces = false;\n        };\n        Promise.prototype._captureStackTrace = longStackTracesCaptureStackTrace;\n        Promise.prototype._attachExtraTrace = longStackTracesAttachExtraTrace;\n        Context.activateLongStackTraces();\n        async.disableTrampolineIfNecessary();\n    }\n};\n\nPromise.hasLongStackTraces = function () {\n    return config.longStackTraces && longStackTracesIsSupported();\n};\n\nvar fireDomEvent = (function() {\n    try {\n        if (typeof CustomEvent === \"function\") {\n            var event = new CustomEvent(\"CustomEvent\");\n            util.global.dispatchEvent(event);\n            return function(name, event) {\n                var domEvent = new CustomEvent(name.toLowerCase(), {\n                    detail: event,\n                    cancelable: true\n                });\n                return !util.global.dispatchEvent(domEvent);\n            };\n        } else if (typeof Event === \"function\") {\n            var event = new Event(\"CustomEvent\");\n            util.global.dispatchEvent(event);\n            return function(name, event) {\n                var domEvent = new Event(name.toLowerCase(), {\n                    cancelable: true\n                });\n                domEvent.detail = event;\n                return !util.global.dispatchEvent(domEvent);\n            };\n        } else {\n            var event = document.createEvent(\"CustomEvent\");\n            event.initCustomEvent(\"testingtheevent\", false, true, {});\n            util.global.dispatchEvent(event);\n            return function(name, event) {\n                var domEvent = document.createEvent(\"CustomEvent\");\n                domEvent.initCustomEvent(name.toLowerCase(), false, true,\n                    event);\n                return !util.global.dispatchEvent(domEvent);\n            };\n        }\n    } catch (e) {}\n    return function() {\n        return false;\n    };\n})();\n\nvar fireGlobalEvent = (function() {\n    if (util.isNode) {\n        return function() {\n            return process.emit.apply(process, arguments);\n        };\n    } else {\n        if (!util.global) {\n            return function() {\n                return false;\n            };\n        }\n        return function(name) {\n            var methodName = \"on\" + name.toLowerCase();\n            var method = util.global[methodName];\n            if (!method) return false;\n            method.apply(util.global, [].slice.call(arguments, 1));\n            return true;\n        };\n    }\n})();\n\nfunction generatePromiseLifecycleEventObject(name, promise) {\n    return {promise: promise};\n}\n\nvar eventToObjectGenerator = {\n    promiseCreated: generatePromiseLifecycleEventObject,\n    promiseFulfilled: generatePromiseLifecycleEventObject,\n    promiseRejected: generatePromiseLifecycleEventObject,\n    promiseResolved: generatePromiseLifecycleEventObject,\n    promiseCancelled: generatePromiseLifecycleEventObject,\n    promiseChained: function(name, promise, child) {\n        return {promise: promise, child: child};\n    },\n    warning: function(name, warning) {\n        return {warning: warning};\n    },\n    unhandledRejection: function (name, reason, promise) {\n        return {reason: reason, promise: promise};\n    },\n    rejectionHandled: generatePromiseLifecycleEventObject\n};\n\nvar activeFireEvent = function (name) {\n    var globalEventFired = false;\n    try {\n        globalEventFired = fireGlobalEvent.apply(null, arguments);\n    } catch (e) {\n        async.throwLater(e);\n        globalEventFired = true;\n    }\n\n    var domEventFired = false;\n    try {\n        domEventFired = fireDomEvent(name,\n                    eventToObjectGenerator[name].apply(null, arguments));\n    } catch (e) {\n        async.throwLater(e);\n        domEventFired = true;\n    }\n\n    return domEventFired || globalEventFired;\n};\n\nPromise.config = function(opts) {\n    opts = Object(opts);\n    if (\"longStackTraces\" in opts) {\n        if (opts.longStackTraces) {\n            Promise.longStackTraces();\n        } else if (!opts.longStackTraces && Promise.hasLongStackTraces()) {\n            disableLongStackTraces();\n        }\n    }\n    if (\"warnings\" in opts) {\n        var warningsOption = opts.warnings;\n        config.warnings = !!warningsOption;\n        wForgottenReturn = config.warnings;\n\n        if (util.isObject(warningsOption)) {\n            if (\"wForgottenReturn\" in warningsOption) {\n                wForgottenReturn = !!warningsOption.wForgottenReturn;\n            }\n        }\n    }\n    if (\"cancellation\" in opts && opts.cancellation && !config.cancellation) {\n        if (async.haveItemsQueued()) {\n            throw new Error(\n                \"cannot enable cancellation after promises are in use\");\n        }\n        Promise.prototype._clearCancellationData =\n            cancellationClearCancellationData;\n        Promise.prototype._propagateFrom = cancellationPropagateFrom;\n        Promise.prototype._onCancel = cancellationOnCancel;\n        Promise.prototype._setOnCancel = cancellationSetOnCancel;\n        Promise.prototype._attachCancellationCallback =\n            cancellationAttachCancellationCallback;\n        Promise.prototype._execute = cancellationExecute;\n        propagateFromFunction = cancellationPropagateFrom;\n        config.cancellation = true;\n    }\n    if (\"monitoring\" in opts) {\n        if (opts.monitoring && !config.monitoring) {\n            config.monitoring = true;\n            Promise.prototype._fireEvent = activeFireEvent;\n        } else if (!opts.monitoring && config.monitoring) {\n            config.monitoring = false;\n            Promise.prototype._fireEvent = defaultFireEvent;\n        }\n    }\n    return Promise;\n};\n\nfunction defaultFireEvent() { return false; }\n\nPromise.prototype._fireEvent = defaultFireEvent;\nPromise.prototype._execute = function(executor, resolve, reject) {\n    try {\n        executor(resolve, reject);\n    } catch (e) {\n        return e;\n    }\n};\nPromise.prototype._onCancel = function () {};\nPromise.prototype._setOnCancel = function (handler) { ; };\nPromise.prototype._attachCancellationCallback = function(onCancel) {\n    ;\n};\nPromise.prototype._captureStackTrace = function () {};\nPromise.prototype._attachExtraTrace = function () {};\nPromise.prototype._clearCancellationData = function() {};\nPromise.prototype._propagateFrom = function (parent, flags) {\n    ;\n    ;\n};\n\nfunction cancellationExecute(executor, resolve, reject) {\n    var promise = this;\n    try {\n        executor(resolve, reject, function(onCancel) {\n            if (typeof onCancel !== \"function\") {\n                throw new TypeError(\"onCancel must be a function, got: \" +\n                                    util.toString(onCancel));\n            }\n            promise._attachCancellationCallback(onCancel);\n        });\n    } catch (e) {\n        return e;\n    }\n}\n\nfunction cancellationAttachCancellationCallback(onCancel) {\n    if (!this._isCancellable()) return this;\n\n    var previousOnCancel = this._onCancel();\n    if (previousOnCancel !== undefined) {\n        if (util.isArray(previousOnCancel)) {\n            previousOnCancel.push(onCancel);\n        } else {\n            this._setOnCancel([previousOnCancel, onCancel]);\n        }\n    } else {\n        this._setOnCancel(onCancel);\n    }\n}\n\nfunction cancellationOnCancel() {\n    return this._onCancelField;\n}\n\nfunction cancellationSetOnCancel(onCancel) {\n    this._onCancelField = onCancel;\n}\n\nfunction cancellationClearCancellationData() {\n    this._cancellationParent = undefined;\n    this._onCancelField = undefined;\n}\n\nfunction cancellationPropagateFrom(parent, flags) {\n    if ((flags & 1) !== 0) {\n        this._cancellationParent = parent;\n        var branchesRemainingToCancel = parent._branchesRemainingToCancel;\n        if (branchesRemainingToCancel === undefined) {\n            branchesRemainingToCancel = 0;\n        }\n        parent._branchesRemainingToCancel = branchesRemainingToCancel + 1;\n    }\n    if ((flags & 2) !== 0 && parent._isBound()) {\n        this._setBoundTo(parent._boundTo);\n    }\n}\n\nfunction bindingPropagateFrom(parent, flags) {\n    if ((flags & 2) !== 0 && parent._isBound()) {\n        this._setBoundTo(parent._boundTo);\n    }\n}\nvar propagateFromFunction = bindingPropagateFrom;\n\nfunction boundValueFunction() {\n    var ret = this._boundTo;\n    if (ret !== undefined) {\n        if (ret instanceof Promise) {\n            if (ret.isFulfilled()) {\n                return ret.value();\n            } else {\n                return undefined;\n            }\n        }\n    }\n    return ret;\n}\n\nfunction longStackTracesCaptureStackTrace() {\n    this._trace = new CapturedTrace(this._peekContext());\n}\n\nfunction longStackTracesAttachExtraTrace(error, ignoreSelf) {\n    if (canAttachTrace(error)) {\n        var trace = this._trace;\n        if (trace !== undefined) {\n            if (ignoreSelf) trace = trace._parent;\n        }\n        if (trace !== undefined) {\n            trace.attachExtraTrace(error);\n        } else if (!error.__stackCleaned__) {\n            var parsed = parseStackAndMessage(error);\n            util.notEnumerableProp(error, \"stack\",\n                parsed.message + \"\\n\" + parsed.stack.join(\"\\n\"));\n            util.notEnumerableProp(error, \"__stackCleaned__\", true);\n        }\n    }\n}\n\nfunction checkForgottenReturns(returnValue, promiseCreated, name, promise,\n                               parent) {\n    if (returnValue === undefined && promiseCreated !== null &&\n        wForgottenReturn) {\n        if (parent !== undefined && parent._returnedNonUndefined()) return;\n        if ((promise._bitField & 65535) === 0) return;\n\n        if (name) name = name + \" \";\n        var handlerLine = \"\";\n        var creatorLine = \"\";\n        if (promiseCreated._trace) {\n            var traceLines = promiseCreated._trace.stack.split(\"\\n\");\n            var stack = cleanStack(traceLines);\n            for (var i = stack.length - 1; i >= 0; --i) {\n                var line = stack[i];\n                if (!nodeFramePattern.test(line)) {\n                    var lineMatches = line.match(parseLinePattern);\n                    if (lineMatches) {\n                        handlerLine  = \"at \" + lineMatches[1] +\n                            \":\" + lineMatches[2] + \":\" + lineMatches[3] + \" \";\n                    }\n                    break;\n                }\n            }\n\n            if (stack.length > 0) {\n                var firstUserLine = stack[0];\n                for (var i = 0; i < traceLines.length; ++i) {\n\n                    if (traceLines[i] === firstUserLine) {\n                        if (i > 0) {\n                            creatorLine = \"\\n\" + traceLines[i - 1];\n                        }\n                        break;\n                    }\n                }\n\n            }\n        }\n        var msg = \"a promise was created in a \" + name +\n            \"handler \" + handlerLine + \"but was not returned from it, \" +\n            \"see http://goo.gl/rRqMUw\" +\n            creatorLine;\n        promise._warn(msg, true, promiseCreated);\n    }\n}\n\nfunction deprecated(name, replacement) {\n    var message = name +\n        \" is deprecated and will be removed in a future version.\";\n    if (replacement) message += \" Use \" + replacement + \" instead.\";\n    return warn(message);\n}\n\nfunction warn(message, shouldUseOwnTrace, promise) {\n    if (!config.warnings) return;\n    var warning = new Warning(message);\n    var ctx;\n    if (shouldUseOwnTrace) {\n        promise._attachExtraTrace(warning);\n    } else if (config.longStackTraces && (ctx = Promise._peekContext())) {\n        ctx.attachExtraTrace(warning);\n    } else {\n        var parsed = parseStackAndMessage(warning);\n        warning.stack = parsed.message + \"\\n\" + parsed.stack.join(\"\\n\");\n    }\n\n    if (!activeFireEvent(\"warning\", warning)) {\n        formatAndLogError(warning, \"\", true);\n    }\n}\n\nfunction reconstructStack(message, stacks) {\n    for (var i = 0; i < stacks.length - 1; ++i) {\n        stacks[i].push(\"From previous event:\");\n        stacks[i] = stacks[i].join(\"\\n\");\n    }\n    if (i < stacks.length) {\n        stacks[i] = stacks[i].join(\"\\n\");\n    }\n    return message + \"\\n\" + stacks.join(\"\\n\");\n}\n\nfunction removeDuplicateOrEmptyJumps(stacks) {\n    for (var i = 0; i < stacks.length; ++i) {\n        if (stacks[i].length === 0 ||\n            ((i + 1 < stacks.length) && stacks[i][0] === stacks[i+1][0])) {\n            stacks.splice(i, 1);\n            i--;\n        }\n    }\n}\n\nfunction removeCommonRoots(stacks) {\n    var current = stacks[0];\n    for (var i = 1; i < stacks.length; ++i) {\n        var prev = stacks[i];\n        var currentLastIndex = current.length - 1;\n        var currentLastLine = current[currentLastIndex];\n        var commonRootMeetPoint = -1;\n\n        for (var j = prev.length - 1; j >= 0; --j) {\n            if (prev[j] === currentLastLine) {\n                commonRootMeetPoint = j;\n                break;\n            }\n        }\n\n        for (var j = commonRootMeetPoint; j >= 0; --j) {\n            var line = prev[j];\n            if (current[currentLastIndex] === line) {\n                current.pop();\n                currentLastIndex--;\n            } else {\n                break;\n            }\n        }\n        current = prev;\n    }\n}\n\nfunction cleanStack(stack) {\n    var ret = [];\n    for (var i = 0; i < stack.length; ++i) {\n        var line = stack[i];\n        var isTraceLine = \"    (No stack trace)\" === line ||\n            stackFramePattern.test(line);\n        var isInternalFrame = isTraceLine && shouldIgnore(line);\n        if (isTraceLine && !isInternalFrame) {\n            if (indentStackFrames && line.charAt(0) !== \" \") {\n                line = \"    \" + line;\n            }\n            ret.push(line);\n        }\n    }\n    return ret;\n}\n\nfunction stackFramesAsArray(error) {\n    var stack = error.stack.replace(/\\s+$/g, \"\").split(\"\\n\");\n    for (var i = 0; i < stack.length; ++i) {\n        var line = stack[i];\n        if (\"    (No stack trace)\" === line || stackFramePattern.test(line)) {\n            break;\n        }\n    }\n    if (i > 0 && error.name != \"SyntaxError\") {\n        stack = stack.slice(i);\n    }\n    return stack;\n}\n\nfunction parseStackAndMessage(error) {\n    var stack = error.stack;\n    var message = error.toString();\n    stack = typeof stack === \"string\" && stack.length > 0\n                ? stackFramesAsArray(error) : [\"    (No stack trace)\"];\n    return {\n        message: message,\n        stack: error.name == \"SyntaxError\" ? stack : cleanStack(stack)\n    };\n}\n\nfunction formatAndLogError(error, title, isSoft) {\n    if (typeof console !== \"undefined\") {\n        var message;\n        if (util.isObject(error)) {\n            var stack = error.stack;\n            message = title + formatStack(stack, error);\n        } else {\n            message = title + String(error);\n        }\n        if (typeof printWarning === \"function\") {\n            printWarning(message, isSoft);\n        } else if (typeof console.log === \"function\" ||\n            typeof console.log === \"object\") {\n            console.log(message);\n        }\n    }\n}\n\nfunction fireRejectionEvent(name, localHandler, reason, promise) {\n    var localEventFired = false;\n    try {\n        if (typeof localHandler === \"function\") {\n            localEventFired = true;\n            if (name === \"rejectionHandled\") {\n                localHandler(promise);\n            } else {\n                localHandler(reason, promise);\n            }\n        }\n    } catch (e) {\n        async.throwLater(e);\n    }\n\n    if (name === \"unhandledRejection\") {\n        if (!activeFireEvent(name, reason, promise) && !localEventFired) {\n            formatAndLogError(reason, \"Unhandled rejection \");\n        }\n    } else {\n        activeFireEvent(name, promise);\n    }\n}\n\nfunction formatNonError(obj) {\n    var str;\n    if (typeof obj === \"function\") {\n        str = \"[function \" +\n            (obj.name || \"anonymous\") +\n            \"]\";\n    } else {\n        str = obj && typeof obj.toString === \"function\"\n            ? obj.toString() : util.toString(obj);\n        var ruselessToString = /\\[object [a-zA-Z0-9$_]+\\]/;\n        if (ruselessToString.test(str)) {\n            try {\n                var newStr = JSON.stringify(obj);\n                str = newStr;\n            }\n            catch(e) {\n\n            }\n        }\n        if (str.length === 0) {\n            str = \"(empty array)\";\n        }\n    }\n    return (\"(<\" + snip(str) + \">, no stack trace)\");\n}\n\nfunction snip(str) {\n    var maxChars = 41;\n    if (str.length < maxChars) {\n        return str;\n    }\n    return str.substr(0, maxChars - 3) + \"...\";\n}\n\nfunction longStackTracesIsSupported() {\n    return typeof captureStackTrace === \"function\";\n}\n\nvar shouldIgnore = function() { return false; };\nvar parseLineInfoRegex = /[\\/<\\(]([^:\\/]+):(\\d+):(?:\\d+)\\)?\\s*$/;\nfunction parseLineInfo(line) {\n    var matches = line.match(parseLineInfoRegex);\n    if (matches) {\n        return {\n            fileName: matches[1],\n            line: parseInt(matches[2], 10)\n        };\n    }\n}\n\nfunction setBounds(firstLineError, lastLineError) {\n    if (!longStackTracesIsSupported()) return;\n    var firstStackLines = firstLineError.stack.split(\"\\n\");\n    var lastStackLines = lastLineError.stack.split(\"\\n\");\n    var firstIndex = -1;\n    var lastIndex = -1;\n    var firstFileName;\n    var lastFileName;\n    for (var i = 0; i < firstStackLines.length; ++i) {\n        var result = parseLineInfo(firstStackLines[i]);\n        if (result) {\n            firstFileName = result.fileName;\n            firstIndex = result.line;\n            break;\n        }\n    }\n    for (var i = 0; i < lastStackLines.length; ++i) {\n        var result = parseLineInfo(lastStackLines[i]);\n        if (result) {\n            lastFileName = result.fileName;\n            lastIndex = result.line;\n            break;\n        }\n    }\n    if (firstIndex < 0 || lastIndex < 0 || !firstFileName || !lastFileName ||\n        firstFileName !== lastFileName || firstIndex >= lastIndex) {\n        return;\n    }\n\n    shouldIgnore = function(line) {\n        if (bluebirdFramePattern.test(line)) return true;\n        var info = parseLineInfo(line);\n        if (info) {\n            if (info.fileName === firstFileName &&\n                (firstIndex <= info.line && info.line <= lastIndex)) {\n                return true;\n            }\n        }\n        return false;\n    };\n}\n\nfunction CapturedTrace(parent) {\n    this._parent = parent;\n    this._promisesCreated = 0;\n    var length = this._length = 1 + (parent === undefined ? 0 : parent._length);\n    captureStackTrace(this, CapturedTrace);\n    if (length > 32) this.uncycle();\n}\nutil.inherits(CapturedTrace, Error);\nContext.CapturedTrace = CapturedTrace;\n\nCapturedTrace.prototype.uncycle = function() {\n    var length = this._length;\n    if (length < 2) return;\n    var nodes = [];\n    var stackToIndex = {};\n\n    for (var i = 0, node = this; node !== undefined; ++i) {\n        nodes.push(node);\n        node = node._parent;\n    }\n    length = this._length = i;\n    for (var i = length - 1; i >= 0; --i) {\n        var stack = nodes[i].stack;\n        if (stackToIndex[stack] === undefined) {\n            stackToIndex[stack] = i;\n        }\n    }\n    for (var i = 0; i < length; ++i) {\n        var currentStack = nodes[i].stack;\n        var index = stackToIndex[currentStack];\n        if (index !== undefined && index !== i) {\n            if (index > 0) {\n                nodes[index - 1]._parent = undefined;\n                nodes[index - 1]._length = 1;\n            }\n            nodes[i]._parent = undefined;\n            nodes[i]._length = 1;\n            var cycleEdgeNode = i > 0 ? nodes[i - 1] : this;\n\n            if (index < length - 1) {\n                cycleEdgeNode._parent = nodes[index + 1];\n                cycleEdgeNode._parent.uncycle();\n                cycleEdgeNode._length =\n                    cycleEdgeNode._parent._length + 1;\n            } else {\n                cycleEdgeNode._parent = undefined;\n                cycleEdgeNode._length = 1;\n            }\n            var currentChildLength = cycleEdgeNode._length + 1;\n            for (var j = i - 2; j >= 0; --j) {\n                nodes[j]._length = currentChildLength;\n                currentChildLength++;\n            }\n            return;\n        }\n    }\n};\n\nCapturedTrace.prototype.attachExtraTrace = function(error) {\n    if (error.__stackCleaned__) return;\n    this.uncycle();\n    var parsed = parseStackAndMessage(error);\n    var message = parsed.message;\n    var stacks = [parsed.stack];\n\n    var trace = this;\n    while (trace !== undefined) {\n        stacks.push(cleanStack(trace.stack.split(\"\\n\")));\n        trace = trace._parent;\n    }\n    removeCommonRoots(stacks);\n    removeDuplicateOrEmptyJumps(stacks);\n    util.notEnumerableProp(error, \"stack\", reconstructStack(message, stacks));\n    util.notEnumerableProp(error, \"__stackCleaned__\", true);\n};\n\nvar captureStackTrace = (function stackDetection() {\n    var v8stackFramePattern = /^\\s*at\\s*/;\n    var v8stackFormatter = function(stack, error) {\n        if (typeof stack === \"string\") return stack;\n\n        if (error.name !== undefined &&\n            error.message !== undefined) {\n            return error.toString();\n        }\n        return formatNonError(error);\n    };\n\n    if (typeof Error.stackTraceLimit === \"number\" &&\n        typeof Error.captureStackTrace === \"function\") {\n        Error.stackTraceLimit += 6;\n        stackFramePattern = v8stackFramePattern;\n        formatStack = v8stackFormatter;\n        var captureStackTrace = Error.captureStackTrace;\n\n        shouldIgnore = function(line) {\n            return bluebirdFramePattern.test(line);\n        };\n        return function(receiver, ignoreUntil) {\n            Error.stackTraceLimit += 6;\n            captureStackTrace(receiver, ignoreUntil);\n            Error.stackTraceLimit -= 6;\n        };\n    }\n    var err = new Error();\n\n    if (typeof err.stack === \"string\" &&\n        err.stack.split(\"\\n\")[0].indexOf(\"stackDetection@\") >= 0) {\n        stackFramePattern = /@/;\n        formatStack = v8stackFormatter;\n        indentStackFrames = true;\n        return function captureStackTrace(o) {\n            o.stack = new Error().stack;\n        };\n    }\n\n    var hasStackAfterThrow;\n    try { throw new Error(); }\n    catch(e) {\n        hasStackAfterThrow = (\"stack\" in e);\n    }\n    if (!(\"stack\" in err) && hasStackAfterThrow &&\n        typeof Error.stackTraceLimit === \"number\") {\n        stackFramePattern = v8stackFramePattern;\n        formatStack = v8stackFormatter;\n        return function captureStackTrace(o) {\n            Error.stackTraceLimit += 6;\n            try { throw new Error(); }\n            catch(e) { o.stack = e.stack; }\n            Error.stackTraceLimit -= 6;\n        };\n    }\n\n    formatStack = function(stack, error) {\n        if (typeof stack === \"string\") return stack;\n\n        if ((typeof error === \"object\" ||\n            typeof error === \"function\") &&\n            error.name !== undefined &&\n            error.message !== undefined) {\n            return error.toString();\n        }\n        return formatNonError(error);\n    };\n\n    return null;\n\n})([]);\n\nif (typeof console !== \"undefined\" && typeof console.warn !== \"undefined\") {\n    printWarning = function (message) {\n        console.warn(message);\n    };\n    if (util.isNode && process.stderr.isTTY) {\n        printWarning = function(message, isSoft) {\n            var color = isSoft ? \"\\u001b[33m\" : \"\\u001b[31m\";\n            console.warn(color + message + \"\\u001b[0m\\n\");\n        };\n    } else if (!util.isNode && typeof (new Error().stack) === \"string\") {\n        printWarning = function(message, isSoft) {\n            console.warn(\"%c\" + message,\n                        isSoft ? \"color: darkorange\" : \"color: red\");\n        };\n    }\n}\n\nvar config = {\n    warnings: warnings,\n    longStackTraces: false,\n    cancellation: false,\n    monitoring: false\n};\n\nif (longStackTraces) Promise.longStackTraces();\n\nreturn {\n    longStackTraces: function() {\n        return config.longStackTraces;\n    },\n    warnings: function() {\n        return config.warnings;\n    },\n    cancellation: function() {\n        return config.cancellation;\n    },\n    monitoring: function() {\n        return config.monitoring;\n    },\n    propagateFromFunction: function() {\n        return propagateFromFunction;\n    },\n    boundValueFunction: function() {\n        return boundValueFunction;\n    },\n    checkForgottenReturns: checkForgottenReturns,\n    setBounds: setBounds,\n    warn: warn,\n    deprecated: deprecated,\n    CapturedTrace: CapturedTrace,\n    fireDomEvent: fireDomEvent,\n    fireGlobalEvent: fireGlobalEvent\n};\n};\n\n},{\"./errors\":12,\"./util\":36}],10:[function(_dereq_,module,exports){\n\"use strict\";\nmodule.exports = function(Promise) {\nfunction returner() {\n    return this.value;\n}\nfunction thrower() {\n    throw this.reason;\n}\n\nPromise.prototype[\"return\"] =\nPromise.prototype.thenReturn = function (value) {\n    if (value instanceof Promise) value.suppressUnhandledRejections();\n    return this._then(\n        returner, undefined, undefined, {value: value}, undefined);\n};\n\nPromise.prototype[\"throw\"] =\nPromise.prototype.thenThrow = function (reason) {\n    return this._then(\n        thrower, undefined, undefined, {reason: reason}, undefined);\n};\n\nPromise.prototype.catchThrow = function (reason) {\n    if (arguments.length <= 1) {\n        return this._then(\n            undefined, thrower, undefined, {reason: reason}, undefined);\n    } else {\n        var _reason = arguments[1];\n        var handler = function() {throw _reason;};\n        return this.caught(reason, handler);\n    }\n};\n\nPromise.prototype.catchReturn = function (value) {\n    if (arguments.length <= 1) {\n        if (value instanceof Promise) value.suppressUnhandledRejections();\n        return this._then(\n            undefined, returner, undefined, {value: value}, undefined);\n    } else {\n        var _value = arguments[1];\n        if (_value instanceof Promise) _value.suppressUnhandledRejections();\n        var handler = function() {return _value;};\n        return this.caught(value, handler);\n    }\n};\n};\n\n},{}],11:[function(_dereq_,module,exports){\n\"use strict\";\nmodule.exports = function(Promise, INTERNAL) {\nvar PromiseReduce = Promise.reduce;\nvar PromiseAll = Promise.all;\n\nfunction promiseAllThis() {\n    return PromiseAll(this);\n}\n\nfunction PromiseMapSeries(promises, fn) {\n    return PromiseReduce(promises, fn, INTERNAL, INTERNAL);\n}\n\nPromise.prototype.each = function (fn) {\n    return PromiseReduce(this, fn, INTERNAL, 0)\n              ._then(promiseAllThis, undefined, undefined, this, undefined);\n};\n\nPromise.prototype.mapSeries = function (fn) {\n    return PromiseReduce(this, fn, INTERNAL, INTERNAL);\n};\n\nPromise.each = function (promises, fn) {\n    return PromiseReduce(promises, fn, INTERNAL, 0)\n              ._then(promiseAllThis, undefined, undefined, promises, undefined);\n};\n\nPromise.mapSeries = PromiseMapSeries;\n};\n\n\n},{}],12:[function(_dereq_,module,exports){\n\"use strict\";\nvar es5 = _dereq_(\"./es5\");\nvar Objectfreeze = es5.freeze;\nvar util = _dereq_(\"./util\");\nvar inherits = util.inherits;\nvar notEnumerableProp = util.notEnumerableProp;\n\nfunction subError(nameProperty, defaultMessage) {\n    function SubError(message) {\n        if (!(this instanceof SubError)) return new SubError(message);\n        notEnumerableProp(this, \"message\",\n            typeof message === \"string\" ? message : defaultMessage);\n        notEnumerableProp(this, \"name\", nameProperty);\n        if (Error.captureStackTrace) {\n            Error.captureStackTrace(this, this.constructor);\n        } else {\n            Error.call(this);\n        }\n    }\n    inherits(SubError, Error);\n    return SubError;\n}\n\nvar _TypeError, _RangeError;\nvar Warning = subError(\"Warning\", \"warning\");\nvar CancellationError = subError(\"CancellationError\", \"cancellation error\");\nvar TimeoutError = subError(\"TimeoutError\", \"timeout error\");\nvar AggregateError = subError(\"AggregateError\", \"aggregate error\");\ntry {\n    _TypeError = TypeError;\n    _RangeError = RangeError;\n} catch(e) {\n    _TypeError = subError(\"TypeError\", \"type error\");\n    _RangeError = subError(\"RangeError\", \"range error\");\n}\n\nvar methods = (\"join pop push shift unshift slice filter forEach some \" +\n    \"every map indexOf lastIndexOf reduce reduceRight sort reverse\").split(\" \");\n\nfor (var i = 0; i < methods.length; ++i) {\n    if (typeof Array.prototype[methods[i]] === \"function\") {\n        AggregateError.prototype[methods[i]] = Array.prototype[methods[i]];\n    }\n}\n\nes5.defineProperty(AggregateError.prototype, \"length\", {\n    value: 0,\n    configurable: false,\n    writable: true,\n    enumerable: true\n});\nAggregateError.prototype[\"isOperational\"] = true;\nvar level = 0;\nAggregateError.prototype.toString = function() {\n    var indent = Array(level * 4 + 1).join(\" \");\n    var ret = \"\\n\" + indent + \"AggregateError of:\" + \"\\n\";\n    level++;\n    indent = Array(level * 4 + 1).join(\" \");\n    for (var i = 0; i < this.length; ++i) {\n        var str = this[i] === this ? \"[Circular AggregateError]\" : this[i] + \"\";\n        var lines = str.split(\"\\n\");\n        for (var j = 0; j < lines.length; ++j) {\n            lines[j] = indent + lines[j];\n        }\n        str = lines.join(\"\\n\");\n        ret += str + \"\\n\";\n    }\n    level--;\n    return ret;\n};\n\nfunction OperationalError(message) {\n    if (!(this instanceof OperationalError))\n        return new OperationalError(message);\n    notEnumerableProp(this, \"name\", \"OperationalError\");\n    notEnumerableProp(this, \"message\", message);\n    this.cause = message;\n    this[\"isOperational\"] = true;\n\n    if (message instanceof Error) {\n        notEnumerableProp(this, \"message\", message.message);\n        notEnumerableProp(this, \"stack\", message.stack);\n    } else if (Error.captureStackTrace) {\n        Error.captureStackTrace(this, this.constructor);\n    }\n\n}\ninherits(OperationalError, Error);\n\nvar errorTypes = Error[\"__BluebirdErrorTypes__\"];\nif (!errorTypes) {\n    errorTypes = Objectfreeze({\n        CancellationError: CancellationError,\n        TimeoutError: TimeoutError,\n        OperationalError: OperationalError,\n        RejectionError: OperationalError,\n        AggregateError: AggregateError\n    });\n    es5.defineProperty(Error, \"__BluebirdErrorTypes__\", {\n        value: errorTypes,\n        writable: false,\n        enumerable: false,\n        configurable: false\n    });\n}\n\nmodule.exports = {\n    Error: Error,\n    TypeError: _TypeError,\n    RangeError: _RangeError,\n    CancellationError: errorTypes.CancellationError,\n    OperationalError: errorTypes.OperationalError,\n    TimeoutError: errorTypes.TimeoutError,\n    AggregateError: errorTypes.AggregateError,\n    Warning: Warning\n};\n\n},{\"./es5\":13,\"./util\":36}],13:[function(_dereq_,module,exports){\nvar isES5 = (function(){\n    \"use strict\";\n    return this === undefined;\n})();\n\nif (isES5) {\n    module.exports = {\n        freeze: Object.freeze,\n        defineProperty: Object.defineProperty,\n        getDescriptor: Object.getOwnPropertyDescriptor,\n        keys: Object.keys,\n        names: Object.getOwnPropertyNames,\n        getPrototypeOf: Object.getPrototypeOf,\n        isArray: Array.isArray,\n        isES5: isES5,\n        propertyIsWritable: function(obj, prop) {\n            var descriptor = Object.getOwnPropertyDescriptor(obj, prop);\n            return !!(!descriptor || descriptor.writable || descriptor.set);\n        }\n    };\n} else {\n    var has = {}.hasOwnProperty;\n    var str = {}.toString;\n    var proto = {}.constructor.prototype;\n\n    var ObjectKeys = function (o) {\n        var ret = [];\n        for (var key in o) {\n            if (has.call(o, key)) {\n                ret.push(key);\n            }\n        }\n        return ret;\n    };\n\n    var ObjectGetDescriptor = function(o, key) {\n        return {value: o[key]};\n    };\n\n    var ObjectDefineProperty = function (o, key, desc) {\n        o[key] = desc.value;\n        return o;\n    };\n\n    var ObjectFreeze = function (obj) {\n        return obj;\n    };\n\n    var ObjectGetPrototypeOf = function (obj) {\n        try {\n            return Object(obj).constructor.prototype;\n        }\n        catch (e) {\n            return proto;\n        }\n    };\n\n    var ArrayIsArray = function (obj) {\n        try {\n            return str.call(obj) === \"[object Array]\";\n        }\n        catch(e) {\n            return false;\n        }\n    };\n\n    module.exports = {\n        isArray: ArrayIsArray,\n        keys: ObjectKeys,\n        names: ObjectKeys,\n        defineProperty: ObjectDefineProperty,\n        getDescriptor: ObjectGetDescriptor,\n        freeze: ObjectFreeze,\n        getPrototypeOf: ObjectGetPrototypeOf,\n        isES5: isES5,\n        propertyIsWritable: function() {\n            return true;\n        }\n    };\n}\n\n},{}],14:[function(_dereq_,module,exports){\n\"use strict\";\nmodule.exports = function(Promise, INTERNAL) {\nvar PromiseMap = Promise.map;\n\nPromise.prototype.filter = function (fn, options) {\n    return PromiseMap(this, fn, options, INTERNAL);\n};\n\nPromise.filter = function (promises, fn, options) {\n    return PromiseMap(promises, fn, options, INTERNAL);\n};\n};\n\n},{}],15:[function(_dereq_,module,exports){\n\"use strict\";\nmodule.exports = function(Promise, tryConvertToPromise, NEXT_FILTER) {\nvar util = _dereq_(\"./util\");\nvar CancellationError = Promise.CancellationError;\nvar errorObj = util.errorObj;\nvar catchFilter = _dereq_(\"./catch_filter\")(NEXT_FILTER);\n\nfunction PassThroughHandlerContext(promise, type, handler) {\n    this.promise = promise;\n    this.type = type;\n    this.handler = handler;\n    this.called = false;\n    this.cancelPromise = null;\n}\n\nPassThroughHandlerContext.prototype.isFinallyHandler = function() {\n    return this.type === 0;\n};\n\nfunction FinallyHandlerCancelReaction(finallyHandler) {\n    this.finallyHandler = finallyHandler;\n}\n\nFinallyHandlerCancelReaction.prototype._resultCancelled = function() {\n    checkCancel(this.finallyHandler);\n};\n\nfunction checkCancel(ctx, reason) {\n    if (ctx.cancelPromise != null) {\n        if (arguments.length > 1) {\n            ctx.cancelPromise._reject(reason);\n        } else {\n            ctx.cancelPromise._cancel();\n        }\n        ctx.cancelPromise = null;\n        return true;\n    }\n    return false;\n}\n\nfunction succeed() {\n    return finallyHandler.call(this, this.promise._target()._settledValue());\n}\nfunction fail(reason) {\n    if (checkCancel(this, reason)) return;\n    errorObj.e = reason;\n    return errorObj;\n}\nfunction finallyHandler(reasonOrValue) {\n    var promise = this.promise;\n    var handler = this.handler;\n\n    if (!this.called) {\n        this.called = true;\n        var ret = this.isFinallyHandler()\n            ? handler.call(promise._boundValue())\n            : handler.call(promise._boundValue(), reasonOrValue);\n        if (ret === NEXT_FILTER) {\n            return ret;\n        } else if (ret !== undefined) {\n            promise._setReturnedNonUndefined();\n            var maybePromise = tryConvertToPromise(ret, promise);\n            if (maybePromise instanceof Promise) {\n                if (this.cancelPromise != null) {\n                    if (maybePromise._isCancelled()) {\n                        var reason =\n                            new CancellationError(\"late cancellation observer\");\n                        promise._attachExtraTrace(reason);\n                        errorObj.e = reason;\n                        return errorObj;\n                    } else if (maybePromise.isPending()) {\n                        maybePromise._attachCancellationCallback(\n                            new FinallyHandlerCancelReaction(this));\n                    }\n                }\n                return maybePromise._then(\n                    succeed, fail, undefined, this, undefined);\n            }\n        }\n    }\n\n    if (promise.isRejected()) {\n        checkCancel(this);\n        errorObj.e = reasonOrValue;\n        return errorObj;\n    } else {\n        checkCancel(this);\n        return reasonOrValue;\n    }\n}\n\nPromise.prototype._passThrough = function(handler, type, success, fail) {\n    if (typeof handler !== \"function\") return this.then();\n    return this._then(success,\n                      fail,\n                      undefined,\n                      new PassThroughHandlerContext(this, type, handler),\n                      undefined);\n};\n\nPromise.prototype.lastly =\nPromise.prototype[\"finally\"] = function (handler) {\n    return this._passThrough(handler,\n                             0,\n                             finallyHandler,\n                             finallyHandler);\n};\n\n\nPromise.prototype.tap = function (handler) {\n    return this._passThrough(handler, 1, finallyHandler);\n};\n\nPromise.prototype.tapCatch = function (handlerOrPredicate) {\n    var len = arguments.length;\n    if(len === 1) {\n        return this._passThrough(handlerOrPredicate,\n                                 1,\n                                 undefined,\n                                 finallyHandler);\n    } else {\n         var catchInstances = new Array(len - 1),\n            j = 0, i;\n        for (i = 0; i < len - 1; ++i) {\n            var item = arguments[i];\n            if (util.isObject(item)) {\n                catchInstances[j++] = item;\n            } else {\n                return Promise.reject(new TypeError(\n                    \"tapCatch statement predicate: \"\n                    + \"expecting an object but got \" + util.classString(item)\n                ));\n            }\n        }\n        catchInstances.length = j;\n        var handler = arguments[i];\n        return this._passThrough(catchFilter(catchInstances, handler, this),\n                                 1,\n                                 undefined,\n                                 finallyHandler);\n    }\n\n};\n\nreturn PassThroughHandlerContext;\n};\n\n},{\"./catch_filter\":7,\"./util\":36}],16:[function(_dereq_,module,exports){\n\"use strict\";\nmodule.exports = function(Promise,\n                          apiRejection,\n                          INTERNAL,\n                          tryConvertToPromise,\n                          Proxyable,\n                          debug) {\nvar errors = _dereq_(\"./errors\");\nvar TypeError = errors.TypeError;\nvar util = _dereq_(\"./util\");\nvar errorObj = util.errorObj;\nvar tryCatch = util.tryCatch;\nvar yieldHandlers = [];\n\nfunction promiseFromYieldHandler(value, yieldHandlers, traceParent) {\n    for (var i = 0; i < yieldHandlers.length; ++i) {\n        traceParent._pushContext();\n        var result = tryCatch(yieldHandlers[i])(value);\n        traceParent._popContext();\n        if (result === errorObj) {\n            traceParent._pushContext();\n            var ret = Promise.reject(errorObj.e);\n            traceParent._popContext();\n            return ret;\n        }\n        var maybePromise = tryConvertToPromise(result, traceParent);\n        if (maybePromise instanceof Promise) return maybePromise;\n    }\n    return null;\n}\n\nfunction PromiseSpawn(generatorFunction, receiver, yieldHandler, stack) {\n    if (debug.cancellation()) {\n        var internal = new Promise(INTERNAL);\n        var _finallyPromise = this._finallyPromise = new Promise(INTERNAL);\n        this._promise = internal.lastly(function() {\n            return _finallyPromise;\n        });\n        internal._captureStackTrace();\n        internal._setOnCancel(this);\n    } else {\n        var promise = this._promise = new Promise(INTERNAL);\n        promise._captureStackTrace();\n    }\n    this._stack = stack;\n    this._generatorFunction = generatorFunction;\n    this._receiver = receiver;\n    this._generator = undefined;\n    this._yieldHandlers = typeof yieldHandler === \"function\"\n        ? [yieldHandler].concat(yieldHandlers)\n        : yieldHandlers;\n    this._yieldedPromise = null;\n    this._cancellationPhase = false;\n}\nutil.inherits(PromiseSpawn, Proxyable);\n\nPromiseSpawn.prototype._isResolved = function() {\n    return this._promise === null;\n};\n\nPromiseSpawn.prototype._cleanup = function() {\n    this._promise = this._generator = null;\n    if (debug.cancellation() && this._finallyPromise !== null) {\n        this._finallyPromise._fulfill();\n        this._finallyPromise = null;\n    }\n};\n\nPromiseSpawn.prototype._promiseCancelled = function() {\n    if (this._isResolved()) return;\n    var implementsReturn = typeof this._generator[\"return\"] !== \"undefined\";\n\n    var result;\n    if (!implementsReturn) {\n        var reason = new Promise.CancellationError(\n            \"generator .return() sentinel\");\n        Promise.coroutine.returnSentinel = reason;\n        this._promise._attachExtraTrace(reason);\n        this._promise._pushContext();\n        result = tryCatch(this._generator[\"throw\"]).call(this._generator,\n                                                         reason);\n        this._promise._popContext();\n    } else {\n        this._promise._pushContext();\n        result = tryCatch(this._generator[\"return\"]).call(this._generator,\n                                                          undefined);\n        this._promise._popContext();\n    }\n    this._cancellationPhase = true;\n    this._yieldedPromise = null;\n    this._continue(result);\n};\n\nPromiseSpawn.prototype._promiseFulfilled = function(value) {\n    this._yieldedPromise = null;\n    this._promise._pushContext();\n    var result = tryCatch(this._generator.next).call(this._generator, value);\n    this._promise._popContext();\n    this._continue(result);\n};\n\nPromiseSpawn.prototype._promiseRejected = function(reason) {\n    this._yieldedPromise = null;\n    this._promise._attachExtraTrace(reason);\n    this._promise._pushContext();\n    var result = tryCatch(this._generator[\"throw\"])\n        .call(this._generator, reason);\n    this._promise._popContext();\n    this._continue(result);\n};\n\nPromiseSpawn.prototype._resultCancelled = function() {\n    if (this._yieldedPromise instanceof Promise) {\n        var promise = this._yieldedPromise;\n        this._yieldedPromise = null;\n        promise.cancel();\n    }\n};\n\nPromiseSpawn.prototype.promise = function () {\n    return this._promise;\n};\n\nPromiseSpawn.prototype._run = function () {\n    this._generator = this._generatorFunction.call(this._receiver);\n    this._receiver =\n        this._generatorFunction = undefined;\n    this._promiseFulfilled(undefined);\n};\n\nPromiseSpawn.prototype._continue = function (result) {\n    var promise = this._promise;\n    if (result === errorObj) {\n        this._cleanup();\n        if (this._cancellationPhase) {\n            return promise.cancel();\n        } else {\n            return promise._rejectCallback(result.e, false);\n        }\n    }\n\n    var value = result.value;\n    if (result.done === true) {\n        this._cleanup();\n        if (this._cancellationPhase) {\n            return promise.cancel();\n        } else {\n            return promise._resolveCallback(value);\n        }\n    } else {\n        var maybePromise = tryConvertToPromise(value, this._promise);\n        if (!(maybePromise instanceof Promise)) {\n            maybePromise =\n                promiseFromYieldHandler(maybePromise,\n                                        this._yieldHandlers,\n                                        this._promise);\n            if (maybePromise === null) {\n                this._promiseRejected(\n                    new TypeError(\n                        \"A value %s was yielded that could not be treated as a promise\\u000a\\u000a    See http://goo.gl/MqrFmX\\u000a\\u000a\".replace(\"%s\", String(value)) +\n                        \"From coroutine:\\u000a\" +\n                        this._stack.split(\"\\n\").slice(1, -7).join(\"\\n\")\n                    )\n                );\n                return;\n            }\n        }\n        maybePromise = maybePromise._target();\n        var bitField = maybePromise._bitField;\n        ;\n        if (((bitField & 50397184) === 0)) {\n            this._yieldedPromise = maybePromise;\n            maybePromise._proxy(this, null);\n        } else if (((bitField & 33554432) !== 0)) {\n            Promise._async.invoke(\n                this._promiseFulfilled, this, maybePromise._value()\n            );\n        } else if (((bitField & 16777216) !== 0)) {\n            Promise._async.invoke(\n                this._promiseRejected, this, maybePromise._reason()\n            );\n        } else {\n            this._promiseCancelled();\n        }\n    }\n};\n\nPromise.coroutine = function (generatorFunction, options) {\n    if (typeof generatorFunction !== \"function\") {\n        throw new TypeError(\"generatorFunction must be a function\\u000a\\u000a    See http://goo.gl/MqrFmX\\u000a\");\n    }\n    var yieldHandler = Object(options).yieldHandler;\n    var PromiseSpawn$ = PromiseSpawn;\n    var stack = new Error().stack;\n    return function () {\n        var generator = generatorFunction.apply(this, arguments);\n        var spawn = new PromiseSpawn$(undefined, undefined, yieldHandler,\n                                      stack);\n        var ret = spawn.promise();\n        spawn._generator = generator;\n        spawn._promiseFulfilled(undefined);\n        return ret;\n    };\n};\n\nPromise.coroutine.addYieldHandler = function(fn) {\n    if (typeof fn !== \"function\") {\n        throw new TypeError(\"expecting a function but got \" + util.classString(fn));\n    }\n    yieldHandlers.push(fn);\n};\n\nPromise.spawn = function (generatorFunction) {\n    debug.deprecated(\"Promise.spawn()\", \"Promise.coroutine()\");\n    if (typeof generatorFunction !== \"function\") {\n        return apiRejection(\"generatorFunction must be a function\\u000a\\u000a    See http://goo.gl/MqrFmX\\u000a\");\n    }\n    var spawn = new PromiseSpawn(generatorFunction, this);\n    var ret = spawn.promise();\n    spawn._run(Promise.spawn);\n    return ret;\n};\n};\n\n},{\"./errors\":12,\"./util\":36}],17:[function(_dereq_,module,exports){\n\"use strict\";\nmodule.exports =\nfunction(Promise, PromiseArray, tryConvertToPromise, INTERNAL, async,\n         getDomain) {\nvar util = _dereq_(\"./util\");\nvar canEvaluate = util.canEvaluate;\nvar tryCatch = util.tryCatch;\nvar errorObj = util.errorObj;\nvar reject;\n\nif (!true) {\nif (canEvaluate) {\n    var thenCallback = function(i) {\n        return new Function(\"value\", \"holder\", \"                             \\n\\\n            'use strict';                                                    \\n\\\n            holder.pIndex = value;                                           \\n\\\n            holder.checkFulfillment(this);                                   \\n\\\n            \".replace(/Index/g, i));\n    };\n\n    var promiseSetter = function(i) {\n        return new Function(\"promise\", \"holder\", \"                           \\n\\\n            'use strict';                                                    \\n\\\n            holder.pIndex = promise;                                         \\n\\\n            \".replace(/Index/g, i));\n    };\n\n    var generateHolderClass = function(total) {\n        var props = new Array(total);\n        for (var i = 0; i < props.length; ++i) {\n            props[i] = \"this.p\" + (i+1);\n        }\n        var assignment = props.join(\" = \") + \" = null;\";\n        var cancellationCode= \"var promise;\\n\" + props.map(function(prop) {\n            return \"                                                         \\n\\\n                promise = \" + prop + \";                                      \\n\\\n                if (promise instanceof Promise) {                            \\n\\\n                    promise.cancel();                                        \\n\\\n                }                                                            \\n\\\n            \";\n        }).join(\"\\n\");\n        var passedArguments = props.join(\", \");\n        var name = \"Holder$\" + total;\n\n\n        var code = \"return function(tryCatch, errorObj, Promise, async) {    \\n\\\n            'use strict';                                                    \\n\\\n            function [TheName](fn) {                                         \\n\\\n                [TheProperties]                                              \\n\\\n                this.fn = fn;                                                \\n\\\n                this.asyncNeeded = true;                                     \\n\\\n                this.now = 0;                                                \\n\\\n            }                                                                \\n\\\n                                                                             \\n\\\n            [TheName].prototype._callFunction = function(promise) {          \\n\\\n                promise._pushContext();                                      \\n\\\n                var ret = tryCatch(this.fn)([ThePassedArguments]);           \\n\\\n                promise._popContext();                                       \\n\\\n                if (ret === errorObj) {                                      \\n\\\n                    promise._rejectCallback(ret.e, false);                   \\n\\\n                } else {                                                     \\n\\\n                    promise._resolveCallback(ret);                           \\n\\\n                }                                                            \\n\\\n            };                                                               \\n\\\n                                                                             \\n\\\n            [TheName].prototype.checkFulfillment = function(promise) {       \\n\\\n                var now = ++this.now;                                        \\n\\\n                if (now === [TheTotal]) {                                    \\n\\\n                    if (this.asyncNeeded) {                                  \\n\\\n                        async.invoke(this._callFunction, this, promise);     \\n\\\n                    } else {                                                 \\n\\\n                        this._callFunction(promise);                         \\n\\\n                    }                                                        \\n\\\n                                                                             \\n\\\n                }                                                            \\n\\\n            };                                                               \\n\\\n                                                                             \\n\\\n            [TheName].prototype._resultCancelled = function() {              \\n\\\n                [CancellationCode]                                           \\n\\\n            };                                                               \\n\\\n                                                                             \\n\\\n            return [TheName];                                                \\n\\\n        }(tryCatch, errorObj, Promise, async);                               \\n\\\n        \";\n\n        code = code.replace(/\\[TheName\\]/g, name)\n            .replace(/\\[TheTotal\\]/g, total)\n            .replace(/\\[ThePassedArguments\\]/g, passedArguments)\n            .replace(/\\[TheProperties\\]/g, assignment)\n            .replace(/\\[CancellationCode\\]/g, cancellationCode);\n\n        return new Function(\"tryCatch\", \"errorObj\", \"Promise\", \"async\", code)\n                           (tryCatch, errorObj, Promise, async);\n    };\n\n    var holderClasses = [];\n    var thenCallbacks = [];\n    var promiseSetters = [];\n\n    for (var i = 0; i < 8; ++i) {\n        holderClasses.push(generateHolderClass(i + 1));\n        thenCallbacks.push(thenCallback(i + 1));\n        promiseSetters.push(promiseSetter(i + 1));\n    }\n\n    reject = function (reason) {\n        this._reject(reason);\n    };\n}}\n\nPromise.join = function () {\n    var last = arguments.length - 1;\n    var fn;\n    if (last > 0 && typeof arguments[last] === \"function\") {\n        fn = arguments[last];\n        if (!true) {\n            if (last <= 8 && canEvaluate) {\n                var ret = new Promise(INTERNAL);\n                ret._captureStackTrace();\n                var HolderClass = holderClasses[last - 1];\n                var holder = new HolderClass(fn);\n                var callbacks = thenCallbacks;\n\n                for (var i = 0; i < last; ++i) {\n                    var maybePromise = tryConvertToPromise(arguments[i], ret);\n                    if (maybePromise instanceof Promise) {\n                        maybePromise = maybePromise._target();\n                        var bitField = maybePromise._bitField;\n                        ;\n                        if (((bitField & 50397184) === 0)) {\n                            maybePromise._then(callbacks[i], reject,\n                                               undefined, ret, holder);\n                            promiseSetters[i](maybePromise, holder);\n                            holder.asyncNeeded = false;\n                        } else if (((bitField & 33554432) !== 0)) {\n                            callbacks[i].call(ret,\n                                              maybePromise._value(), holder);\n                        } else if (((bitField & 16777216) !== 0)) {\n                            ret._reject(maybePromise._reason());\n                        } else {\n                            ret._cancel();\n                        }\n                    } else {\n                        callbacks[i].call(ret, maybePromise, holder);\n                    }\n                }\n\n                if (!ret._isFateSealed()) {\n                    if (holder.asyncNeeded) {\n                        var domain = getDomain();\n                        if (domain !== null) {\n                            holder.fn = util.domainBind(domain, holder.fn);\n                        }\n                    }\n                    ret._setAsyncGuaranteed();\n                    ret._setOnCancel(holder);\n                }\n                return ret;\n            }\n        }\n    }\n    var args = [].slice.call(arguments);;\n    if (fn) args.pop();\n    var ret = new PromiseArray(args).promise();\n    return fn !== undefined ? ret.spread(fn) : ret;\n};\n\n};\n\n},{\"./util\":36}],18:[function(_dereq_,module,exports){\n\"use strict\";\nmodule.exports = function(Promise,\n                          PromiseArray,\n                          apiRejection,\n                          tryConvertToPromise,\n                          INTERNAL,\n                          debug) {\nvar getDomain = Promise._getDomain;\nvar util = _dereq_(\"./util\");\nvar tryCatch = util.tryCatch;\nvar errorObj = util.errorObj;\nvar async = Promise._async;\n\nfunction MappingPromiseArray(promises, fn, limit, _filter) {\n    this.constructor$(promises);\n    this._promise._captureStackTrace();\n    var domain = getDomain();\n    this._callback = domain === null ? fn : util.domainBind(domain, fn);\n    this._preservedValues = _filter === INTERNAL\n        ? new Array(this.length())\n        : null;\n    this._limit = limit;\n    this._inFlight = 0;\n    this._queue = [];\n    async.invoke(this._asyncInit, this, undefined);\n}\nutil.inherits(MappingPromiseArray, PromiseArray);\n\nMappingPromiseArray.prototype._asyncInit = function() {\n    this._init$(undefined, -2);\n};\n\nMappingPromiseArray.prototype._init = function () {};\n\nMappingPromiseArray.prototype._promiseFulfilled = function (value, index) {\n    var values = this._values;\n    var length = this.length();\n    var preservedValues = this._preservedValues;\n    var limit = this._limit;\n\n    if (index < 0) {\n        index = (index * -1) - 1;\n        values[index] = value;\n        if (limit >= 1) {\n            this._inFlight--;\n            this._drainQueue();\n            if (this._isResolved()) return true;\n        }\n    } else {\n        if (limit >= 1 && this._inFlight >= limit) {\n            values[index] = value;\n            this._queue.push(index);\n            return false;\n        }\n        if (preservedValues !== null) preservedValues[index] = value;\n\n        var promise = this._promise;\n        var callback = this._callback;\n        var receiver = promise._boundValue();\n        promise._pushContext();\n        var ret = tryCatch(callback).call(receiver, value, index, length);\n        var promiseCreated = promise._popContext();\n        debug.checkForgottenReturns(\n            ret,\n            promiseCreated,\n            preservedValues !== null ? \"Promise.filter\" : \"Promise.map\",\n            promise\n        );\n        if (ret === errorObj) {\n            this._reject(ret.e);\n            return true;\n        }\n\n        var maybePromise = tryConvertToPromise(ret, this._promise);\n        if (maybePromise instanceof Promise) {\n            maybePromise = maybePromise._target();\n            var bitField = maybePromise._bitField;\n            ;\n            if (((bitField & 50397184) === 0)) {\n                if (limit >= 1) this._inFlight++;\n                values[index] = maybePromise;\n                maybePromise._proxy(this, (index + 1) * -1);\n                return false;\n            } else if (((bitField & 33554432) !== 0)) {\n                ret = maybePromise._value();\n            } else if (((bitField & 16777216) !== 0)) {\n                this._reject(maybePromise._reason());\n                return true;\n            } else {\n                this._cancel();\n                return true;\n            }\n        }\n        values[index] = ret;\n    }\n    var totalResolved = ++this._totalResolved;\n    if (totalResolved >= length) {\n        if (preservedValues !== null) {\n            this._filter(values, preservedValues);\n        } else {\n            this._resolve(values);\n        }\n        return true;\n    }\n    return false;\n};\n\nMappingPromiseArray.prototype._drainQueue = function () {\n    var queue = this._queue;\n    var limit = this._limit;\n    var values = this._values;\n    while (queue.length > 0 && this._inFlight < limit) {\n        if (this._isResolved()) return;\n        var index = queue.pop();\n        this._promiseFulfilled(values[index], index);\n    }\n};\n\nMappingPromiseArray.prototype._filter = function (booleans, values) {\n    var len = values.length;\n    var ret = new Array(len);\n    var j = 0;\n    for (var i = 0; i < len; ++i) {\n        if (booleans[i]) ret[j++] = values[i];\n    }\n    ret.length = j;\n    this._resolve(ret);\n};\n\nMappingPromiseArray.prototype.preservedValues = function () {\n    return this._preservedValues;\n};\n\nfunction map(promises, fn, options, _filter) {\n    if (typeof fn !== \"function\") {\n        return apiRejection(\"expecting a function but got \" + util.classString(fn));\n    }\n\n    var limit = 0;\n    if (options !== undefined) {\n        if (typeof options === \"object\" && options !== null) {\n            if (typeof options.concurrency !== \"number\") {\n                return Promise.reject(\n                    new TypeError(\"'concurrency' must be a number but it is \" +\n                                    util.classString(options.concurrency)));\n            }\n            limit = options.concurrency;\n        } else {\n            return Promise.reject(new TypeError(\n                            \"options argument must be an object but it is \" +\n                             util.classString(options)));\n        }\n    }\n    limit = typeof limit === \"number\" &&\n        isFinite(limit) && limit >= 1 ? limit : 0;\n    return new MappingPromiseArray(promises, fn, limit, _filter).promise();\n}\n\nPromise.prototype.map = function (fn, options) {\n    return map(this, fn, options, null);\n};\n\nPromise.map = function (promises, fn, options, _filter) {\n    return map(promises, fn, options, _filter);\n};\n\n\n};\n\n},{\"./util\":36}],19:[function(_dereq_,module,exports){\n\"use strict\";\nmodule.exports =\nfunction(Promise, INTERNAL, tryConvertToPromise, apiRejection, debug) {\nvar util = _dereq_(\"./util\");\nvar tryCatch = util.tryCatch;\n\nPromise.method = function (fn) {\n    if (typeof fn !== \"function\") {\n        throw new Promise.TypeError(\"expecting a function but got \" + util.classString(fn));\n    }\n    return function () {\n        var ret = new Promise(INTERNAL);\n        ret._captureStackTrace();\n        ret._pushContext();\n        var value = tryCatch(fn).apply(this, arguments);\n        var promiseCreated = ret._popContext();\n        debug.checkForgottenReturns(\n            value, promiseCreated, \"Promise.method\", ret);\n        ret._resolveFromSyncValue(value);\n        return ret;\n    };\n};\n\nPromise.attempt = Promise[\"try\"] = function (fn) {\n    if (typeof fn !== \"function\") {\n        return apiRejection(\"expecting a function but got \" + util.classString(fn));\n    }\n    var ret = new Promise(INTERNAL);\n    ret._captureStackTrace();\n    ret._pushContext();\n    var value;\n    if (arguments.length > 1) {\n        debug.deprecated(\"calling Promise.try with more than 1 argument\");\n        var arg = arguments[1];\n        var ctx = arguments[2];\n        value = util.isArray(arg) ? tryCatch(fn).apply(ctx, arg)\n                                  : tryCatch(fn).call(ctx, arg);\n    } else {\n        value = tryCatch(fn)();\n    }\n    var promiseCreated = ret._popContext();\n    debug.checkForgottenReturns(\n        value, promiseCreated, \"Promise.try\", ret);\n    ret._resolveFromSyncValue(value);\n    return ret;\n};\n\nPromise.prototype._resolveFromSyncValue = function (value) {\n    if (value === util.errorObj) {\n        this._rejectCallback(value.e, false);\n    } else {\n        this._resolveCallback(value, true);\n    }\n};\n};\n\n},{\"./util\":36}],20:[function(_dereq_,module,exports){\n\"use strict\";\nvar util = _dereq_(\"./util\");\nvar maybeWrapAsError = util.maybeWrapAsError;\nvar errors = _dereq_(\"./errors\");\nvar OperationalError = errors.OperationalError;\nvar es5 = _dereq_(\"./es5\");\n\nfunction isUntypedError(obj) {\n    return obj instanceof Error &&\n        es5.getPrototypeOf(obj) === Error.prototype;\n}\n\nvar rErrorKey = /^(?:name|message|stack|cause)$/;\nfunction wrapAsOperationalError(obj) {\n    var ret;\n    if (isUntypedError(obj)) {\n        ret = new OperationalError(obj);\n        ret.name = obj.name;\n        ret.message = obj.message;\n        ret.stack = obj.stack;\n        var keys = es5.keys(obj);\n        for (var i = 0; i < keys.length; ++i) {\n            var key = keys[i];\n            if (!rErrorKey.test(key)) {\n                ret[key] = obj[key];\n            }\n        }\n        return ret;\n    }\n    util.markAsOriginatingFromRejection(obj);\n    return obj;\n}\n\nfunction nodebackForPromise(promise, multiArgs) {\n    return function(err, value) {\n        if (promise === null) return;\n        if (err) {\n            var wrapped = wrapAsOperationalError(maybeWrapAsError(err));\n            promise._attachExtraTrace(wrapped);\n            promise._reject(wrapped);\n        } else if (!multiArgs) {\n            promise._fulfill(value);\n        } else {\n            var args = [].slice.call(arguments, 1);;\n            promise._fulfill(args);\n        }\n        promise = null;\n    };\n}\n\nmodule.exports = nodebackForPromise;\n\n},{\"./errors\":12,\"./es5\":13,\"./util\":36}],21:[function(_dereq_,module,exports){\n\"use strict\";\nmodule.exports = function(Promise) {\nvar util = _dereq_(\"./util\");\nvar async = Promise._async;\nvar tryCatch = util.tryCatch;\nvar errorObj = util.errorObj;\n\nfunction spreadAdapter(val, nodeback) {\n    var promise = this;\n    if (!util.isArray(val)) return successAdapter.call(promise, val, nodeback);\n    var ret =\n        tryCatch(nodeback).apply(promise._boundValue(), [null].concat(val));\n    if (ret === errorObj) {\n        async.throwLater(ret.e);\n    }\n}\n\nfunction successAdapter(val, nodeback) {\n    var promise = this;\n    var receiver = promise._boundValue();\n    var ret = val === undefined\n        ? tryCatch(nodeback).call(receiver, null)\n        : tryCatch(nodeback).call(receiver, null, val);\n    if (ret === errorObj) {\n        async.throwLater(ret.e);\n    }\n}\nfunction errorAdapter(reason, nodeback) {\n    var promise = this;\n    if (!reason) {\n        var newReason = new Error(reason + \"\");\n        newReason.cause = reason;\n        reason = newReason;\n    }\n    var ret = tryCatch(nodeback).call(promise._boundValue(), reason);\n    if (ret === errorObj) {\n        async.throwLater(ret.e);\n    }\n}\n\nPromise.prototype.asCallback = Promise.prototype.nodeify = function (nodeback,\n                                                                     options) {\n    if (typeof nodeback == \"function\") {\n        var adapter = successAdapter;\n        if (options !== undefined && Object(options).spread) {\n            adapter = spreadAdapter;\n        }\n        this._then(\n            adapter,\n            errorAdapter,\n            undefined,\n            this,\n            nodeback\n        );\n    }\n    return this;\n};\n};\n\n},{\"./util\":36}],22:[function(_dereq_,module,exports){\n\"use strict\";\nmodule.exports = function() {\nvar makeSelfResolutionError = function () {\n    return new TypeError(\"circular promise resolution chain\\u000a\\u000a    See http://goo.gl/MqrFmX\\u000a\");\n};\nvar reflectHandler = function() {\n    return new Promise.PromiseInspection(this._target());\n};\nvar apiRejection = function(msg) {\n    return Promise.reject(new TypeError(msg));\n};\nfunction Proxyable() {}\nvar UNDEFINED_BINDING = {};\nvar util = _dereq_(\"./util\");\n\nvar getDomain;\nif (util.isNode) {\n    getDomain = function() {\n        var ret = process.domain;\n        if (ret === undefined) ret = null;\n        return ret;\n    };\n} else {\n    getDomain = function() {\n        return null;\n    };\n}\nutil.notEnumerableProp(Promise, \"_getDomain\", getDomain);\n\nvar es5 = _dereq_(\"./es5\");\nvar Async = _dereq_(\"./async\");\nvar async = new Async();\nes5.defineProperty(Promise, \"_async\", {value: async});\nvar errors = _dereq_(\"./errors\");\nvar TypeError = Promise.TypeError = errors.TypeError;\nPromise.RangeError = errors.RangeError;\nvar CancellationError = Promise.CancellationError = errors.CancellationError;\nPromise.TimeoutError = errors.TimeoutError;\nPromise.OperationalError = errors.OperationalError;\nPromise.RejectionError = errors.OperationalError;\nPromise.AggregateError = errors.AggregateError;\nvar INTERNAL = function(){};\nvar APPLY = {};\nvar NEXT_FILTER = {};\nvar tryConvertToPromise = _dereq_(\"./thenables\")(Promise, INTERNAL);\nvar PromiseArray =\n    _dereq_(\"./promise_array\")(Promise, INTERNAL,\n                               tryConvertToPromise, apiRejection, Proxyable);\nvar Context = _dereq_(\"./context\")(Promise);\n /*jshint unused:false*/\nvar createContext = Context.create;\nvar debug = _dereq_(\"./debuggability\")(Promise, Context);\nvar CapturedTrace = debug.CapturedTrace;\nvar PassThroughHandlerContext =\n    _dereq_(\"./finally\")(Promise, tryConvertToPromise, NEXT_FILTER);\nvar catchFilter = _dereq_(\"./catch_filter\")(NEXT_FILTER);\nvar nodebackForPromise = _dereq_(\"./nodeback\");\nvar errorObj = util.errorObj;\nvar tryCatch = util.tryCatch;\nfunction check(self, executor) {\n    if (self == null || self.constructor !== Promise) {\n        throw new TypeError(\"the promise constructor cannot be invoked directly\\u000a\\u000a    See http://goo.gl/MqrFmX\\u000a\");\n    }\n    if (typeof executor !== \"function\") {\n        throw new TypeError(\"expecting a function but got \" + util.classString(executor));\n    }\n\n}\n\nfunction Promise(executor) {\n    if (executor !== INTERNAL) {\n        check(this, executor);\n    }\n    this._bitField = 0;\n    this._fulfillmentHandler0 = undefined;\n    this._rejectionHandler0 = undefined;\n    this._promise0 = undefined;\n    this._receiver0 = undefined;\n    this._resolveFromExecutor(executor);\n    this._promiseCreated();\n    this._fireEvent(\"promiseCreated\", this);\n}\n\nPromise.prototype.toString = function () {\n    return \"[object Promise]\";\n};\n\nPromise.prototype.caught = Promise.prototype[\"catch\"] = function (fn) {\n    var len = arguments.length;\n    if (len > 1) {\n        var catchInstances = new Array(len - 1),\n            j = 0, i;\n        for (i = 0; i < len - 1; ++i) {\n            var item = arguments[i];\n            if (util.isObject(item)) {\n                catchInstances[j++] = item;\n            } else {\n                return apiRejection(\"Catch statement predicate: \" +\n                    \"expecting an object but got \" + util.classString(item));\n            }\n        }\n        catchInstances.length = j;\n        fn = arguments[i];\n        return this.then(undefined, catchFilter(catchInstances, fn, this));\n    }\n    return this.then(undefined, fn);\n};\n\nPromise.prototype.reflect = function () {\n    return this._then(reflectHandler,\n        reflectHandler, undefined, this, undefined);\n};\n\nPromise.prototype.then = function (didFulfill, didReject) {\n    if (debug.warnings() && arguments.length > 0 &&\n        typeof didFulfill !== \"function\" &&\n        typeof didReject !== \"function\") {\n        var msg = \".then() only accepts functions but was passed: \" +\n                util.classString(didFulfill);\n        if (arguments.length > 1) {\n            msg += \", \" + util.classString(didReject);\n        }\n        this._warn(msg);\n    }\n    return this._then(didFulfill, didReject, undefined, undefined, undefined);\n};\n\nPromise.prototype.done = function (didFulfill, didReject) {\n    var promise =\n        this._then(didFulfill, didReject, undefined, undefined, undefined);\n    promise._setIsFinal();\n};\n\nPromise.prototype.spread = function (fn) {\n    if (typeof fn !== \"function\") {\n        return apiRejection(\"expecting a function but got \" + util.classString(fn));\n    }\n    return this.all()._then(fn, undefined, undefined, APPLY, undefined);\n};\n\nPromise.prototype.toJSON = function () {\n    var ret = {\n        isFulfilled: false,\n        isRejected: false,\n        fulfillmentValue: undefined,\n        rejectionReason: undefined\n    };\n    if (this.isFulfilled()) {\n        ret.fulfillmentValue = this.value();\n        ret.isFulfilled = true;\n    } else if (this.isRejected()) {\n        ret.rejectionReason = this.reason();\n        ret.isRejected = true;\n    }\n    return ret;\n};\n\nPromise.prototype.all = function () {\n    if (arguments.length > 0) {\n        this._warn(\".all() was passed arguments but it does not take any\");\n    }\n    return new PromiseArray(this).promise();\n};\n\nPromise.prototype.error = function (fn) {\n    return this.caught(util.originatesFromRejection, fn);\n};\n\nPromise.getNewLibraryCopy = module.exports;\n\nPromise.is = function (val) {\n    return val instanceof Promise;\n};\n\nPromise.fromNode = Promise.fromCallback = function(fn) {\n    var ret = new Promise(INTERNAL);\n    ret._captureStackTrace();\n    var multiArgs = arguments.length > 1 ? !!Object(arguments[1]).multiArgs\n                                         : false;\n    var result = tryCatch(fn)(nodebackForPromise(ret, multiArgs));\n    if (result === errorObj) {\n        ret._rejectCallback(result.e, true);\n    }\n    if (!ret._isFateSealed()) ret._setAsyncGuaranteed();\n    return ret;\n};\n\nPromise.all = function (promises) {\n    return new PromiseArray(promises).promise();\n};\n\nPromise.cast = function (obj) {\n    var ret = tryConvertToPromise(obj);\n    if (!(ret instanceof Promise)) {\n        ret = new Promise(INTERNAL);\n        ret._captureStackTrace();\n        ret._setFulfilled();\n        ret._rejectionHandler0 = obj;\n    }\n    return ret;\n};\n\nPromise.resolve = Promise.fulfilled = Promise.cast;\n\nPromise.reject = Promise.rejected = function (reason) {\n    var ret = new Promise(INTERNAL);\n    ret._captureStackTrace();\n    ret._rejectCallback(reason, true);\n    return ret;\n};\n\nPromise.setScheduler = function(fn) {\n    if (typeof fn !== \"function\") {\n        throw new TypeError(\"expecting a function but got \" + util.classString(fn));\n    }\n    return async.setScheduler(fn);\n};\n\nPromise.prototype._then = function (\n    didFulfill,\n    didReject,\n    _,    receiver,\n    internalData\n) {\n    var haveInternalData = internalData !== undefined;\n    var promise = haveInternalData ? internalData : new Promise(INTERNAL);\n    var target = this._target();\n    var bitField = target._bitField;\n\n    if (!haveInternalData) {\n        promise._propagateFrom(this, 3);\n        promise._captureStackTrace();\n        if (receiver === undefined &&\n            ((this._bitField & 2097152) !== 0)) {\n            if (!((bitField & 50397184) === 0)) {\n                receiver = this._boundValue();\n            } else {\n                receiver = target === this ? undefined : this._boundTo;\n            }\n        }\n        this._fireEvent(\"promiseChained\", this, promise);\n    }\n\n    var domain = getDomain();\n    if (!((bitField & 50397184) === 0)) {\n        var handler, value, settler = target._settlePromiseCtx;\n        if (((bitField & 33554432) !== 0)) {\n            value = target._rejectionHandler0;\n            handler = didFulfill;\n        } else if (((bitField & 16777216) !== 0)) {\n            value = target._fulfillmentHandler0;\n            handler = didReject;\n            target._unsetRejectionIsUnhandled();\n        } else {\n            settler = target._settlePromiseLateCancellationObserver;\n            value = new CancellationError(\"late cancellation observer\");\n            target._attachExtraTrace(value);\n            handler = didReject;\n        }\n\n        async.invoke(settler, target, {\n            handler: domain === null ? handler\n                : (typeof handler === \"function\" &&\n                    util.domainBind(domain, handler)),\n            promise: promise,\n            receiver: receiver,\n            value: value\n        });\n    } else {\n        target._addCallbacks(didFulfill, didReject, promise, receiver, domain);\n    }\n\n    return promise;\n};\n\nPromise.prototype._length = function () {\n    return this._bitField & 65535;\n};\n\nPromise.prototype._isFateSealed = function () {\n    return (this._bitField & 117506048) !== 0;\n};\n\nPromise.prototype._isFollowing = function () {\n    return (this._bitField & 67108864) === 67108864;\n};\n\nPromise.prototype._setLength = function (len) {\n    this._bitField = (this._bitField & -65536) |\n        (len & 65535);\n};\n\nPromise.prototype._setFulfilled = function () {\n    this._bitField = this._bitField | 33554432;\n    this._fireEvent(\"promiseFulfilled\", this);\n};\n\nPromise.prototype._setRejected = function () {\n    this._bitField = this._bitField | 16777216;\n    this._fireEvent(\"promiseRejected\", this);\n};\n\nPromise.prototype._setFollowing = function () {\n    this._bitField = this._bitField | 67108864;\n    this._fireEvent(\"promiseResolved\", this);\n};\n\nPromise.prototype._setIsFinal = function () {\n    this._bitField = this._bitField | 4194304;\n};\n\nPromise.prototype._isFinal = function () {\n    return (this._bitField & 4194304) > 0;\n};\n\nPromise.prototype._unsetCancelled = function() {\n    this._bitField = this._bitField & (~65536);\n};\n\nPromise.prototype._setCancelled = function() {\n    this._bitField = this._bitField | 65536;\n    this._fireEvent(\"promiseCancelled\", this);\n};\n\nPromise.prototype._setWillBeCancelled = function() {\n    this._bitField = this._bitField | 8388608;\n};\n\nPromise.prototype._setAsyncGuaranteed = function() {\n    if (async.hasCustomScheduler()) return;\n    this._bitField = this._bitField | 134217728;\n};\n\nPromise.prototype._receiverAt = function (index) {\n    var ret = index === 0 ? this._receiver0 : this[\n            index * 4 - 4 + 3];\n    if (ret === UNDEFINED_BINDING) {\n        return undefined;\n    } else if (ret === undefined && this._isBound()) {\n        return this._boundValue();\n    }\n    return ret;\n};\n\nPromise.prototype._promiseAt = function (index) {\n    return this[\n            index * 4 - 4 + 2];\n};\n\nPromise.prototype._fulfillmentHandlerAt = function (index) {\n    return this[\n            index * 4 - 4 + 0];\n};\n\nPromise.prototype._rejectionHandlerAt = function (index) {\n    return this[\n            index * 4 - 4 + 1];\n};\n\nPromise.prototype._boundValue = function() {};\n\nPromise.prototype._migrateCallback0 = function (follower) {\n    var bitField = follower._bitField;\n    var fulfill = follower._fulfillmentHandler0;\n    var reject = follower._rejectionHandler0;\n    var promise = follower._promise0;\n    var receiver = follower._receiverAt(0);\n    if (receiver === undefined) receiver = UNDEFINED_BINDING;\n    this._addCallbacks(fulfill, reject, promise, receiver, null);\n};\n\nPromise.prototype._migrateCallbackAt = function (follower, index) {\n    var fulfill = follower._fulfillmentHandlerAt(index);\n    var reject = follower._rejectionHandlerAt(index);\n    var promise = follower._promiseAt(index);\n    var receiver = follower._receiverAt(index);\n    if (receiver === undefined) receiver = UNDEFINED_BINDING;\n    this._addCallbacks(fulfill, reject, promise, receiver, null);\n};\n\nPromise.prototype._addCallbacks = function (\n    fulfill,\n    reject,\n    promise,\n    receiver,\n    domain\n) {\n    var index = this._length();\n\n    if (index >= 65535 - 4) {\n        index = 0;\n        this._setLength(0);\n    }\n\n    if (index === 0) {\n        this._promise0 = promise;\n        this._receiver0 = receiver;\n        if (typeof fulfill === \"function\") {\n            this._fulfillmentHandler0 =\n                domain === null ? fulfill : util.domainBind(domain, fulfill);\n        }\n        if (typeof reject === \"function\") {\n            this._rejectionHandler0 =\n                domain === null ? reject : util.domainBind(domain, reject);\n        }\n    } else {\n        var base = index * 4 - 4;\n        this[base + 2] = promise;\n        this[base + 3] = receiver;\n        if (typeof fulfill === \"function\") {\n            this[base + 0] =\n                domain === null ? fulfill : util.domainBind(domain, fulfill);\n        }\n        if (typeof reject === \"function\") {\n            this[base + 1] =\n                domain === null ? reject : util.domainBind(domain, reject);\n        }\n    }\n    this._setLength(index + 1);\n    return index;\n};\n\nPromise.prototype._proxy = function (proxyable, arg) {\n    this._addCallbacks(undefined, undefined, arg, proxyable, null);\n};\n\nPromise.prototype._resolveCallback = function(value, shouldBind) {\n    if (((this._bitField & 117506048) !== 0)) return;\n    if (value === this)\n        return this._rejectCallback(makeSelfResolutionError(), false);\n    var maybePromise = tryConvertToPromise(value, this);\n    if (!(maybePromise instanceof Promise)) return this._fulfill(value);\n\n    if (shouldBind) this._propagateFrom(maybePromise, 2);\n\n    var promise = maybePromise._target();\n\n    if (promise === this) {\n        this._reject(makeSelfResolutionError());\n        return;\n    }\n\n    var bitField = promise._bitField;\n    if (((bitField & 50397184) === 0)) {\n        var len = this._length();\n        if (len > 0) promise._migrateCallback0(this);\n        for (var i = 1; i < len; ++i) {\n            promise._migrateCallbackAt(this, i);\n        }\n        this._setFollowing();\n        this._setLength(0);\n        this._setFollowee(promise);\n    } else if (((bitField & 33554432) !== 0)) {\n        this._fulfill(promise._value());\n    } else if (((bitField & 16777216) !== 0)) {\n        this._reject(promise._reason());\n    } else {\n        var reason = new CancellationError(\"late cancellation observer\");\n        promise._attachExtraTrace(reason);\n        this._reject(reason);\n    }\n};\n\nPromise.prototype._rejectCallback =\nfunction(reason, synchronous, ignoreNonErrorWarnings) {\n    var trace = util.ensureErrorObject(reason);\n    var hasStack = trace === reason;\n    if (!hasStack && !ignoreNonErrorWarnings && debug.warnings()) {\n        var message = \"a promise was rejected with a non-error: \" +\n            util.classString(reason);\n        this._warn(message, true);\n    }\n    this._attachExtraTrace(trace, synchronous ? hasStack : false);\n    this._reject(reason);\n};\n\nPromise.prototype._resolveFromExecutor = function (executor) {\n    if (executor === INTERNAL) return;\n    var promise = this;\n    this._captureStackTrace();\n    this._pushContext();\n    var synchronous = true;\n    var r = this._execute(executor, function(value) {\n        promise._resolveCallback(value);\n    }, function (reason) {\n        promise._rejectCallback(reason, synchronous);\n    });\n    synchronous = false;\n    this._popContext();\n\n    if (r !== undefined) {\n        promise._rejectCallback(r, true);\n    }\n};\n\nPromise.prototype._settlePromiseFromHandler = function (\n    handler, receiver, value, promise\n) {\n    var bitField = promise._bitField;\n    if (((bitField & 65536) !== 0)) return;\n    promise._pushContext();\n    var x;\n    if (receiver === APPLY) {\n        if (!value || typeof value.length !== \"number\") {\n            x = errorObj;\n            x.e = new TypeError(\"cannot .spread() a non-array: \" +\n                                    util.classString(value));\n        } else {\n            x = tryCatch(handler).apply(this._boundValue(), value);\n        }\n    } else {\n        x = tryCatch(handler).call(receiver, value);\n    }\n    var promiseCreated = promise._popContext();\n    bitField = promise._bitField;\n    if (((bitField & 65536) !== 0)) return;\n\n    if (x === NEXT_FILTER) {\n        promise._reject(value);\n    } else if (x === errorObj) {\n        promise._rejectCallback(x.e, false);\n    } else {\n        debug.checkForgottenReturns(x, promiseCreated, \"\",  promise, this);\n        promise._resolveCallback(x);\n    }\n};\n\nPromise.prototype._target = function() {\n    var ret = this;\n    while (ret._isFollowing()) ret = ret._followee();\n    return ret;\n};\n\nPromise.prototype._followee = function() {\n    return this._rejectionHandler0;\n};\n\nPromise.prototype._setFollowee = function(promise) {\n    this._rejectionHandler0 = promise;\n};\n\nPromise.prototype._settlePromise = function(promise, handler, receiver, value) {\n    var isPromise = promise instanceof Promise;\n    var bitField = this._bitField;\n    var asyncGuaranteed = ((bitField & 134217728) !== 0);\n    if (((bitField & 65536) !== 0)) {\n        if (isPromise) promise._invokeInternalOnCancel();\n\n        if (receiver instanceof PassThroughHandlerContext &&\n            receiver.isFinallyHandler()) {\n            receiver.cancelPromise = promise;\n            if (tryCatch(handler).call(receiver, value) === errorObj) {\n                promise._reject(errorObj.e);\n            }\n        } else if (handler === reflectHandler) {\n            promise._fulfill(reflectHandler.call(receiver));\n        } else if (receiver instanceof Proxyable) {\n            receiver._promiseCancelled(promise);\n        } else if (isPromise || promise instanceof PromiseArray) {\n            promise._cancel();\n        } else {\n            receiver.cancel();\n        }\n    } else if (typeof handler === \"function\") {\n        if (!isPromise) {\n            handler.call(receiver, value, promise);\n        } else {\n            if (asyncGuaranteed) promise._setAsyncGuaranteed();\n            this._settlePromiseFromHandler(handler, receiver, value, promise);\n        }\n    } else if (receiver instanceof Proxyable) {\n        if (!receiver._isResolved()) {\n            if (((bitField & 33554432) !== 0)) {\n                receiver._promiseFulfilled(value, promise);\n            } else {\n                receiver._promiseRejected(value, promise);\n            }\n        }\n    } else if (isPromise) {\n        if (asyncGuaranteed) promise._setAsyncGuaranteed();\n        if (((bitField & 33554432) !== 0)) {\n            promise._fulfill(value);\n        } else {\n            promise._reject(value);\n        }\n    }\n};\n\nPromise.prototype._settlePromiseLateCancellationObserver = function(ctx) {\n    var handler = ctx.handler;\n    var promise = ctx.promise;\n    var receiver = ctx.receiver;\n    var value = ctx.value;\n    if (typeof handler === \"function\") {\n        if (!(promise instanceof Promise)) {\n            handler.call(receiver, value, promise);\n        } else {\n            this._settlePromiseFromHandler(handler, receiver, value, promise);\n        }\n    } else if (promise instanceof Promise) {\n        promise._reject(value);\n    }\n};\n\nPromise.prototype._settlePromiseCtx = function(ctx) {\n    this._settlePromise(ctx.promise, ctx.handler, ctx.receiver, ctx.value);\n};\n\nPromise.prototype._settlePromise0 = function(handler, value, bitField) {\n    var promise = this._promise0;\n    var receiver = this._receiverAt(0);\n    this._promise0 = undefined;\n    this._receiver0 = undefined;\n    this._settlePromise(promise, handler, receiver, value);\n};\n\nPromise.prototype._clearCallbackDataAtIndex = function(index) {\n    var base = index * 4 - 4;\n    this[base + 2] =\n    this[base + 3] =\n    this[base + 0] =\n    this[base + 1] = undefined;\n};\n\nPromise.prototype._fulfill = function (value) {\n    var bitField = this._bitField;\n    if (((bitField & 117506048) >>> 16)) return;\n    if (value === this) {\n        var err = makeSelfResolutionError();\n        this._attachExtraTrace(err);\n        return this._reject(err);\n    }\n    this._setFulfilled();\n    this._rejectionHandler0 = value;\n\n    if ((bitField & 65535) > 0) {\n        if (((bitField & 134217728) !== 0)) {\n            this._settlePromises();\n        } else {\n            async.settlePromises(this);\n        }\n    }\n};\n\nPromise.prototype._reject = function (reason) {\n    var bitField = this._bitField;\n    if (((bitField & 117506048) >>> 16)) return;\n    this._setRejected();\n    this._fulfillmentHandler0 = reason;\n\n    if (this._isFinal()) {\n        return async.fatalError(reason, util.isNode);\n    }\n\n    if ((bitField & 65535) > 0) {\n        async.settlePromises(this);\n    } else {\n        this._ensurePossibleRejectionHandled();\n    }\n};\n\nPromise.prototype._fulfillPromises = function (len, value) {\n    for (var i = 1; i < len; i++) {\n        var handler = this._fulfillmentHandlerAt(i);\n        var promise = this._promiseAt(i);\n        var receiver = this._receiverAt(i);\n        this._clearCallbackDataAtIndex(i);\n        this._settlePromise(promise, handler, receiver, value);\n    }\n};\n\nPromise.prototype._rejectPromises = function (len, reason) {\n    for (var i = 1; i < len; i++) {\n        var handler = this._rejectionHandlerAt(i);\n        var promise = this._promiseAt(i);\n        var receiver = this._receiverAt(i);\n        this._clearCallbackDataAtIndex(i);\n        this._settlePromise(promise, handler, receiver, reason);\n    }\n};\n\nPromise.prototype._settlePromises = function () {\n    var bitField = this._bitField;\n    var len = (bitField & 65535);\n\n    if (len > 0) {\n        if (((bitField & 16842752) !== 0)) {\n            var reason = this._fulfillmentHandler0;\n            this._settlePromise0(this._rejectionHandler0, reason, bitField);\n            this._rejectPromises(len, reason);\n        } else {\n            var value = this._rejectionHandler0;\n            this._settlePromise0(this._fulfillmentHandler0, value, bitField);\n            this._fulfillPromises(len, value);\n        }\n        this._setLength(0);\n    }\n    this._clearCancellationData();\n};\n\nPromise.prototype._settledValue = function() {\n    var bitField = this._bitField;\n    if (((bitField & 33554432) !== 0)) {\n        return this._rejectionHandler0;\n    } else if (((bitField & 16777216) !== 0)) {\n        return this._fulfillmentHandler0;\n    }\n};\n\nfunction deferResolve(v) {this.promise._resolveCallback(v);}\nfunction deferReject(v) {this.promise._rejectCallback(v, false);}\n\nPromise.defer = Promise.pending = function() {\n    debug.deprecated(\"Promise.defer\", \"new Promise\");\n    var promise = new Promise(INTERNAL);\n    return {\n        promise: promise,\n        resolve: deferResolve,\n        reject: deferReject\n    };\n};\n\nutil.notEnumerableProp(Promise,\n                       \"_makeSelfResolutionError\",\n                       makeSelfResolutionError);\n\n_dereq_(\"./method\")(Promise, INTERNAL, tryConvertToPromise, apiRejection,\n    debug);\n_dereq_(\"./bind\")(Promise, INTERNAL, tryConvertToPromise, debug);\n_dereq_(\"./cancel\")(Promise, PromiseArray, apiRejection, debug);\n_dereq_(\"./direct_resolve\")(Promise);\n_dereq_(\"./synchronous_inspection\")(Promise);\n_dereq_(\"./join\")(\n    Promise, PromiseArray, tryConvertToPromise, INTERNAL, async, getDomain);\nPromise.Promise = Promise;\nPromise.version = \"3.5.0\";\n_dereq_('./map.js')(Promise, PromiseArray, apiRejection, tryConvertToPromise, INTERNAL, debug);\n_dereq_('./call_get.js')(Promise);\n_dereq_('./using.js')(Promise, apiRejection, tryConvertToPromise, createContext, INTERNAL, debug);\n_dereq_('./timers.js')(Promise, INTERNAL, debug);\n_dereq_('./generators.js')(Promise, apiRejection, INTERNAL, tryConvertToPromise, Proxyable, debug);\n_dereq_('./nodeify.js')(Promise);\n_dereq_('./promisify.js')(Promise, INTERNAL);\n_dereq_('./props.js')(Promise, PromiseArray, tryConvertToPromise, apiRejection);\n_dereq_('./race.js')(Promise, INTERNAL, tryConvertToPromise, apiRejection);\n_dereq_('./reduce.js')(Promise, PromiseArray, apiRejection, tryConvertToPromise, INTERNAL, debug);\n_dereq_('./settle.js')(Promise, PromiseArray, debug);\n_dereq_('./some.js')(Promise, PromiseArray, apiRejection);\n_dereq_('./filter.js')(Promise, INTERNAL);\n_dereq_('./each.js')(Promise, INTERNAL);\n_dereq_('./any.js')(Promise);\n                                                         \n    util.toFastProperties(Promise);                                          \n    util.toFastProperties(Promise.prototype);                                \n    function fillTypes(value) {                                              \n        var p = new Promise(INTERNAL);                                       \n        p._fulfillmentHandler0 = value;                                      \n        p._rejectionHandler0 = value;                                        \n        p._promise0 = value;                                                 \n        p._receiver0 = value;                                                \n    }                                                                        \n    // Complete slack tracking, opt out of field-type tracking and           \n    // stabilize map                                                         \n    fillTypes({a: 1});                                                       \n    fillTypes({b: 2});                                                       \n    fillTypes({c: 3});                                                       \n    fillTypes(1);                                                            \n    fillTypes(function(){});                                                 \n    fillTypes(undefined);                                                    \n    fillTypes(false);                                                        \n    fillTypes(new Promise(INTERNAL));                                        \n    debug.setBounds(Async.firstLineError, util.lastLineError);               \n    return Promise;                                                          \n\n};\n\n},{\"./any.js\":1,\"./async\":2,\"./bind\":3,\"./call_get.js\":5,\"./cancel\":6,\"./catch_filter\":7,\"./context\":8,\"./debuggability\":9,\"./direct_resolve\":10,\"./each.js\":11,\"./errors\":12,\"./es5\":13,\"./filter.js\":14,\"./finally\":15,\"./generators.js\":16,\"./join\":17,\"./map.js\":18,\"./method\":19,\"./nodeback\":20,\"./nodeify.js\":21,\"./promise_array\":23,\"./promisify.js\":24,\"./props.js\":25,\"./race.js\":27,\"./reduce.js\":28,\"./settle.js\":30,\"./some.js\":31,\"./synchronous_inspection\":32,\"./thenables\":33,\"./timers.js\":34,\"./using.js\":35,\"./util\":36}],23:[function(_dereq_,module,exports){\n\"use strict\";\nmodule.exports = function(Promise, INTERNAL, tryConvertToPromise,\n    apiRejection, Proxyable) {\nvar util = _dereq_(\"./util\");\nvar isArray = util.isArray;\n\nfunction toResolutionValue(val) {\n    switch(val) {\n    case -2: return [];\n    case -3: return {};\n    case -6: return new Map();\n    }\n}\n\nfunction PromiseArray(values) {\n    var promise = this._promise = new Promise(INTERNAL);\n    if (values instanceof Promise) {\n        promise._propagateFrom(values, 3);\n    }\n    promise._setOnCancel(this);\n    this._values = values;\n    this._length = 0;\n    this._totalResolved = 0;\n    this._init(undefined, -2);\n}\nutil.inherits(PromiseArray, Proxyable);\n\nPromiseArray.prototype.length = function () {\n    return this._length;\n};\n\nPromiseArray.prototype.promise = function () {\n    return this._promise;\n};\n\nPromiseArray.prototype._init = function init(_, resolveValueIfEmpty) {\n    var values = tryConvertToPromise(this._values, this._promise);\n    if (values instanceof Promise) {\n        values = values._target();\n        var bitField = values._bitField;\n        ;\n        this._values = values;\n\n        if (((bitField & 50397184) === 0)) {\n            this._promise._setAsyncGuaranteed();\n            return values._then(\n                init,\n                this._reject,\n                undefined,\n                this,\n                resolveValueIfEmpty\n           );\n        } else if (((bitField & 33554432) !== 0)) {\n            values = values._value();\n        } else if (((bitField & 16777216) !== 0)) {\n            return this._reject(values._reason());\n        } else {\n            return this._cancel();\n        }\n    }\n    values = util.asArray(values);\n    if (values === null) {\n        var err = apiRejection(\n            \"expecting an array or an iterable object but got \" + util.classString(values)).reason();\n        this._promise._rejectCallback(err, false);\n        return;\n    }\n\n    if (values.length === 0) {\n        if (resolveValueIfEmpty === -5) {\n            this._resolveEmptyArray();\n        }\n        else {\n            this._resolve(toResolutionValue(resolveValueIfEmpty));\n        }\n        return;\n    }\n    this._iterate(values);\n};\n\nPromiseArray.prototype._iterate = function(values) {\n    var len = this.getActualLength(values.length);\n    this._length = len;\n    this._values = this.shouldCopyValues() ? new Array(len) : this._values;\n    var result = this._promise;\n    var isResolved = false;\n    var bitField = null;\n    for (var i = 0; i < len; ++i) {\n        var maybePromise = tryConvertToPromise(values[i], result);\n\n        if (maybePromise instanceof Promise) {\n            maybePromise = maybePromise._target();\n            bitField = maybePromise._bitField;\n        } else {\n            bitField = null;\n        }\n\n        if (isResolved) {\n            if (bitField !== null) {\n                maybePromise.suppressUnhandledRejections();\n            }\n        } else if (bitField !== null) {\n            if (((bitField & 50397184) === 0)) {\n                maybePromise._proxy(this, i);\n                this._values[i] = maybePromise;\n            } else if (((bitField & 33554432) !== 0)) {\n                isResolved = this._promiseFulfilled(maybePromise._value(), i);\n            } else if (((bitField & 16777216) !== 0)) {\n                isResolved = this._promiseRejected(maybePromise._reason(), i);\n            } else {\n                isResolved = this._promiseCancelled(i);\n            }\n        } else {\n            isResolved = this._promiseFulfilled(maybePromise, i);\n        }\n    }\n    if (!isResolved) result._setAsyncGuaranteed();\n};\n\nPromiseArray.prototype._isResolved = function () {\n    return this._values === null;\n};\n\nPromiseArray.prototype._resolve = function (value) {\n    this._values = null;\n    this._promise._fulfill(value);\n};\n\nPromiseArray.prototype._cancel = function() {\n    if (this._isResolved() || !this._promise._isCancellable()) return;\n    this._values = null;\n    this._promise._cancel();\n};\n\nPromiseArray.prototype._reject = function (reason) {\n    this._values = null;\n    this._promise._rejectCallback(reason, false);\n};\n\nPromiseArray.prototype._promiseFulfilled = function (value, index) {\n    this._values[index] = value;\n    var totalResolved = ++this._totalResolved;\n    if (totalResolved >= this._length) {\n        this._resolve(this._values);\n        return true;\n    }\n    return false;\n};\n\nPromiseArray.prototype._promiseCancelled = function() {\n    this._cancel();\n    return true;\n};\n\nPromiseArray.prototype._promiseRejected = function (reason) {\n    this._totalResolved++;\n    this._reject(reason);\n    return true;\n};\n\nPromiseArray.prototype._resultCancelled = function() {\n    if (this._isResolved()) return;\n    var values = this._values;\n    this._cancel();\n    if (values instanceof Promise) {\n        values.cancel();\n    } else {\n        for (var i = 0; i < values.length; ++i) {\n            if (values[i] instanceof Promise) {\n                values[i].cancel();\n            }\n        }\n    }\n};\n\nPromiseArray.prototype.shouldCopyValues = function () {\n    return true;\n};\n\nPromiseArray.prototype.getActualLength = function (len) {\n    return len;\n};\n\nreturn PromiseArray;\n};\n\n},{\"./util\":36}],24:[function(_dereq_,module,exports){\n\"use strict\";\nmodule.exports = function(Promise, INTERNAL) {\nvar THIS = {};\nvar util = _dereq_(\"./util\");\nvar nodebackForPromise = _dereq_(\"./nodeback\");\nvar withAppended = util.withAppended;\nvar maybeWrapAsError = util.maybeWrapAsError;\nvar canEvaluate = util.canEvaluate;\nvar TypeError = _dereq_(\"./errors\").TypeError;\nvar defaultSuffix = \"Async\";\nvar defaultPromisified = {__isPromisified__: true};\nvar noCopyProps = [\n    \"arity\",    \"length\",\n    \"name\",\n    \"arguments\",\n    \"caller\",\n    \"callee\",\n    \"prototype\",\n    \"__isPromisified__\"\n];\nvar noCopyPropsPattern = new RegExp(\"^(?:\" + noCopyProps.join(\"|\") + \")$\");\n\nvar defaultFilter = function(name) {\n    return util.isIdentifier(name) &&\n        name.charAt(0) !== \"_\" &&\n        name !== \"constructor\";\n};\n\nfunction propsFilter(key) {\n    return !noCopyPropsPattern.test(key);\n}\n\nfunction isPromisified(fn) {\n    try {\n        return fn.__isPromisified__ === true;\n    }\n    catch (e) {\n        return false;\n    }\n}\n\nfunction hasPromisified(obj, key, suffix) {\n    var val = util.getDataPropertyOrDefault(obj, key + suffix,\n                                            defaultPromisified);\n    return val ? isPromisified(val) : false;\n}\nfunction checkValid(ret, suffix, suffixRegexp) {\n    for (var i = 0; i < ret.length; i += 2) {\n        var key = ret[i];\n        if (suffixRegexp.test(key)) {\n            var keyWithoutAsyncSuffix = key.replace(suffixRegexp, \"\");\n            for (var j = 0; j < ret.length; j += 2) {\n                if (ret[j] === keyWithoutAsyncSuffix) {\n                    throw new TypeError(\"Cannot promisify an API that has normal methods with '%s'-suffix\\u000a\\u000a    See http://goo.gl/MqrFmX\\u000a\"\n                        .replace(\"%s\", suffix));\n                }\n            }\n        }\n    }\n}\n\nfunction promisifiableMethods(obj, suffix, suffixRegexp, filter) {\n    var keys = util.inheritedDataKeys(obj);\n    var ret = [];\n    for (var i = 0; i < keys.length; ++i) {\n        var key = keys[i];\n        var value = obj[key];\n        var passesDefaultFilter = filter === defaultFilter\n            ? true : defaultFilter(key, value, obj);\n        if (typeof value === \"function\" &&\n            !isPromisified(value) &&\n            !hasPromisified(obj, key, suffix) &&\n            filter(key, value, obj, passesDefaultFilter)) {\n            ret.push(key, value);\n        }\n    }\n    checkValid(ret, suffix, suffixRegexp);\n    return ret;\n}\n\nvar escapeIdentRegex = function(str) {\n    return str.replace(/([$])/, \"\\\\$\");\n};\n\nvar makeNodePromisifiedEval;\nif (!true) {\nvar switchCaseArgumentOrder = function(likelyArgumentCount) {\n    var ret = [likelyArgumentCount];\n    var min = Math.max(0, likelyArgumentCount - 1 - 3);\n    for(var i = likelyArgumentCount - 1; i >= min; --i) {\n        ret.push(i);\n    }\n    for(var i = likelyArgumentCount + 1; i <= 3; ++i) {\n        ret.push(i);\n    }\n    return ret;\n};\n\nvar argumentSequence = function(argumentCount) {\n    return util.filledRange(argumentCount, \"_arg\", \"\");\n};\n\nvar parameterDeclaration = function(parameterCount) {\n    return util.filledRange(\n        Math.max(parameterCount, 3), \"_arg\", \"\");\n};\n\nvar parameterCount = function(fn) {\n    if (typeof fn.length === \"number\") {\n        return Math.max(Math.min(fn.length, 1023 + 1), 0);\n    }\n    return 0;\n};\n\nmakeNodePromisifiedEval =\nfunction(callback, receiver, originalName, fn, _, multiArgs) {\n    var newParameterCount = Math.max(0, parameterCount(fn) - 1);\n    var argumentOrder = switchCaseArgumentOrder(newParameterCount);\n    var shouldProxyThis = typeof callback === \"string\" || receiver === THIS;\n\n    function generateCallForArgumentCount(count) {\n        var args = argumentSequence(count).join(\", \");\n        var comma = count > 0 ? \", \" : \"\";\n        var ret;\n        if (shouldProxyThis) {\n            ret = \"ret = callback.call(this, {{args}}, nodeback); break;\\n\";\n        } else {\n            ret = receiver === undefined\n                ? \"ret = callback({{args}}, nodeback); break;\\n\"\n                : \"ret = callback.call(receiver, {{args}}, nodeback); break;\\n\";\n        }\n        return ret.replace(\"{{args}}\", args).replace(\", \", comma);\n    }\n\n    function generateArgumentSwitchCase() {\n        var ret = \"\";\n        for (var i = 0; i < argumentOrder.length; ++i) {\n            ret += \"case \" + argumentOrder[i] +\":\" +\n                generateCallForArgumentCount(argumentOrder[i]);\n        }\n\n        ret += \"                                                             \\n\\\n        default:                                                             \\n\\\n            var args = new Array(len + 1);                                   \\n\\\n            var i = 0;                                                       \\n\\\n            for (var i = 0; i < len; ++i) {                                  \\n\\\n               args[i] = arguments[i];                                       \\n\\\n            }                                                                \\n\\\n            args[i] = nodeback;                                              \\n\\\n            [CodeForCall]                                                    \\n\\\n            break;                                                           \\n\\\n        \".replace(\"[CodeForCall]\", (shouldProxyThis\n                                ? \"ret = callback.apply(this, args);\\n\"\n                                : \"ret = callback.apply(receiver, args);\\n\"));\n        return ret;\n    }\n\n    var getFunctionCode = typeof callback === \"string\"\n                                ? (\"this != null ? this['\"+callback+\"'] : fn\")\n                                : \"fn\";\n    var body = \"'use strict';                                                \\n\\\n        var ret = function (Parameters) {                                    \\n\\\n            'use strict';                                                    \\n\\\n            var len = arguments.length;                                      \\n\\\n            var promise = new Promise(INTERNAL);                             \\n\\\n            promise._captureStackTrace();                                    \\n\\\n            var nodeback = nodebackForPromise(promise, \" + multiArgs + \");   \\n\\\n            var ret;                                                         \\n\\\n            var callback = tryCatch([GetFunctionCode]);                      \\n\\\n            switch(len) {                                                    \\n\\\n                [CodeForSwitchCase]                                          \\n\\\n            }                                                                \\n\\\n            if (ret === errorObj) {                                          \\n\\\n                promise._rejectCallback(maybeWrapAsError(ret.e), true, true);\\n\\\n            }                                                                \\n\\\n            if (!promise._isFateSealed()) promise._setAsyncGuaranteed();     \\n\\\n            return promise;                                                  \\n\\\n        };                                                                   \\n\\\n        notEnumerableProp(ret, '__isPromisified__', true);                   \\n\\\n        return ret;                                                          \\n\\\n    \".replace(\"[CodeForSwitchCase]\", generateArgumentSwitchCase())\n        .replace(\"[GetFunctionCode]\", getFunctionCode);\n    body = body.replace(\"Parameters\", parameterDeclaration(newParameterCount));\n    return new Function(\"Promise\",\n                        \"fn\",\n                        \"receiver\",\n                        \"withAppended\",\n                        \"maybeWrapAsError\",\n                        \"nodebackForPromise\",\n                        \"tryCatch\",\n                        \"errorObj\",\n                        \"notEnumerableProp\",\n                        \"INTERNAL\",\n                        body)(\n                    Promise,\n                    fn,\n                    receiver,\n                    withAppended,\n                    maybeWrapAsError,\n                    nodebackForPromise,\n                    util.tryCatch,\n                    util.errorObj,\n                    util.notEnumerableProp,\n                    INTERNAL);\n};\n}\n\nfunction makeNodePromisifiedClosure(callback, receiver, _, fn, __, multiArgs) {\n    var defaultThis = (function() {return this;})();\n    var method = callback;\n    if (typeof method === \"string\") {\n        callback = fn;\n    }\n    function promisified() {\n        var _receiver = receiver;\n        if (receiver === THIS) _receiver = this;\n        var promise = new Promise(INTERNAL);\n        promise._captureStackTrace();\n        var cb = typeof method === \"string\" && this !== defaultThis\n            ? this[method] : callback;\n        var fn = nodebackForPromise(promise, multiArgs);\n        try {\n            cb.apply(_receiver, withAppended(arguments, fn));\n        } catch(e) {\n            promise._rejectCallback(maybeWrapAsError(e), true, true);\n        }\n        if (!promise._isFateSealed()) promise._setAsyncGuaranteed();\n        return promise;\n    }\n    util.notEnumerableProp(promisified, \"__isPromisified__\", true);\n    return promisified;\n}\n\nvar makeNodePromisified = canEvaluate\n    ? makeNodePromisifiedEval\n    : makeNodePromisifiedClosure;\n\nfunction promisifyAll(obj, suffix, filter, promisifier, multiArgs) {\n    var suffixRegexp = new RegExp(escapeIdentRegex(suffix) + \"$\");\n    var methods =\n        promisifiableMethods(obj, suffix, suffixRegexp, filter);\n\n    for (var i = 0, len = methods.length; i < len; i+= 2) {\n        var key = methods[i];\n        var fn = methods[i+1];\n        var promisifiedKey = key + suffix;\n        if (promisifier === makeNodePromisified) {\n            obj[promisifiedKey] =\n                makeNodePromisified(key, THIS, key, fn, suffix, multiArgs);\n        } else {\n            var promisified = promisifier(fn, function() {\n                return makeNodePromisified(key, THIS, key,\n                                           fn, suffix, multiArgs);\n            });\n            util.notEnumerableProp(promisified, \"__isPromisified__\", true);\n            obj[promisifiedKey] = promisified;\n        }\n    }\n    util.toFastProperties(obj);\n    return obj;\n}\n\nfunction promisify(callback, receiver, multiArgs) {\n    return makeNodePromisified(callback, receiver, undefined,\n                                callback, null, multiArgs);\n}\n\nPromise.promisify = function (fn, options) {\n    if (typeof fn !== \"function\") {\n        throw new TypeError(\"expecting a function but got \" + util.classString(fn));\n    }\n    if (isPromisified(fn)) {\n        return fn;\n    }\n    options = Object(options);\n    var receiver = options.context === undefined ? THIS : options.context;\n    var multiArgs = !!options.multiArgs;\n    var ret = promisify(fn, receiver, multiArgs);\n    util.copyDescriptors(fn, ret, propsFilter);\n    return ret;\n};\n\nPromise.promisifyAll = function (target, options) {\n    if (typeof target !== \"function\" && typeof target !== \"object\") {\n        throw new TypeError(\"the target of promisifyAll must be an object or a function\\u000a\\u000a    See http://goo.gl/MqrFmX\\u000a\");\n    }\n    options = Object(options);\n    var multiArgs = !!options.multiArgs;\n    var suffix = options.suffix;\n    if (typeof suffix !== \"string\") suffix = defaultSuffix;\n    var filter = options.filter;\n    if (typeof filter !== \"function\") filter = defaultFilter;\n    var promisifier = options.promisifier;\n    if (typeof promisifier !== \"function\") promisifier = makeNodePromisified;\n\n    if (!util.isIdentifier(suffix)) {\n        throw new RangeError(\"suffix must be a valid identifier\\u000a\\u000a    See http://goo.gl/MqrFmX\\u000a\");\n    }\n\n    var keys = util.inheritedDataKeys(target);\n    for (var i = 0; i < keys.length; ++i) {\n        var value = target[keys[i]];\n        if (keys[i] !== \"constructor\" &&\n            util.isClass(value)) {\n            promisifyAll(value.prototype, suffix, filter, promisifier,\n                multiArgs);\n            promisifyAll(value, suffix, filter, promisifier, multiArgs);\n        }\n    }\n\n    return promisifyAll(target, suffix, filter, promisifier, multiArgs);\n};\n};\n\n\n},{\"./errors\":12,\"./nodeback\":20,\"./util\":36}],25:[function(_dereq_,module,exports){\n\"use strict\";\nmodule.exports = function(\n    Promise, PromiseArray, tryConvertToPromise, apiRejection) {\nvar util = _dereq_(\"./util\");\nvar isObject = util.isObject;\nvar es5 = _dereq_(\"./es5\");\nvar Es6Map;\nif (typeof Map === \"function\") Es6Map = Map;\n\nvar mapToEntries = (function() {\n    var index = 0;\n    var size = 0;\n\n    function extractEntry(value, key) {\n        this[index] = value;\n        this[index + size] = key;\n        index++;\n    }\n\n    return function mapToEntries(map) {\n        size = map.size;\n        index = 0;\n        var ret = new Array(map.size * 2);\n        map.forEach(extractEntry, ret);\n        return ret;\n    };\n})();\n\nvar entriesToMap = function(entries) {\n    var ret = new Es6Map();\n    var length = entries.length / 2 | 0;\n    for (var i = 0; i < length; ++i) {\n        var key = entries[length + i];\n        var value = entries[i];\n        ret.set(key, value);\n    }\n    return ret;\n};\n\nfunction PropertiesPromiseArray(obj) {\n    var isMap = false;\n    var entries;\n    if (Es6Map !== undefined && obj instanceof Es6Map) {\n        entries = mapToEntries(obj);\n        isMap = true;\n    } else {\n        var keys = es5.keys(obj);\n        var len = keys.length;\n        entries = new Array(len * 2);\n        for (var i = 0; i < len; ++i) {\n            var key = keys[i];\n            entries[i] = obj[key];\n            entries[i + len] = key;\n        }\n    }\n    this.constructor$(entries);\n    this._isMap = isMap;\n    this._init$(undefined, isMap ? -6 : -3);\n}\nutil.inherits(PropertiesPromiseArray, PromiseArray);\n\nPropertiesPromiseArray.prototype._init = function () {};\n\nPropertiesPromiseArray.prototype._promiseFulfilled = function (value, index) {\n    this._values[index] = value;\n    var totalResolved = ++this._totalResolved;\n    if (totalResolved >= this._length) {\n        var val;\n        if (this._isMap) {\n            val = entriesToMap(this._values);\n        } else {\n            val = {};\n            var keyOffset = this.length();\n            for (var i = 0, len = this.length(); i < len; ++i) {\n                val[this._values[i + keyOffset]] = this._values[i];\n            }\n        }\n        this._resolve(val);\n        return true;\n    }\n    return false;\n};\n\nPropertiesPromiseArray.prototype.shouldCopyValues = function () {\n    return false;\n};\n\nPropertiesPromiseArray.prototype.getActualLength = function (len) {\n    return len >> 1;\n};\n\nfunction props(promises) {\n    var ret;\n    var castValue = tryConvertToPromise(promises);\n\n    if (!isObject(castValue)) {\n        return apiRejection(\"cannot await properties of a non-object\\u000a\\u000a    See http://goo.gl/MqrFmX\\u000a\");\n    } else if (castValue instanceof Promise) {\n        ret = castValue._then(\n            Promise.props, undefined, undefined, undefined, undefined);\n    } else {\n        ret = new PropertiesPromiseArray(castValue).promise();\n    }\n\n    if (castValue instanceof Promise) {\n        ret._propagateFrom(castValue, 2);\n    }\n    return ret;\n}\n\nPromise.prototype.props = function () {\n    return props(this);\n};\n\nPromise.props = function (promises) {\n    return props(promises);\n};\n};\n\n},{\"./es5\":13,\"./util\":36}],26:[function(_dereq_,module,exports){\n\"use strict\";\nfunction arrayMove(src, srcIndex, dst, dstIndex, len) {\n    for (var j = 0; j < len; ++j) {\n        dst[j + dstIndex] = src[j + srcIndex];\n        src[j + srcIndex] = void 0;\n    }\n}\n\nfunction Queue(capacity) {\n    this._capacity = capacity;\n    this._length = 0;\n    this._front = 0;\n}\n\nQueue.prototype._willBeOverCapacity = function (size) {\n    return this._capacity < size;\n};\n\nQueue.prototype._pushOne = function (arg) {\n    var length = this.length();\n    this._checkCapacity(length + 1);\n    var i = (this._front + length) & (this._capacity - 1);\n    this[i] = arg;\n    this._length = length + 1;\n};\n\nQueue.prototype.push = function (fn, receiver, arg) {\n    var length = this.length() + 3;\n    if (this._willBeOverCapacity(length)) {\n        this._pushOne(fn);\n        this._pushOne(receiver);\n        this._pushOne(arg);\n        return;\n    }\n    var j = this._front + length - 3;\n    this._checkCapacity(length);\n    var wrapMask = this._capacity - 1;\n    this[(j + 0) & wrapMask] = fn;\n    this[(j + 1) & wrapMask] = receiver;\n    this[(j + 2) & wrapMask] = arg;\n    this._length = length;\n};\n\nQueue.prototype.shift = function () {\n    var front = this._front,\n        ret = this[front];\n\n    this[front] = undefined;\n    this._front = (front + 1) & (this._capacity - 1);\n    this._length--;\n    return ret;\n};\n\nQueue.prototype.length = function () {\n    return this._length;\n};\n\nQueue.prototype._checkCapacity = function (size) {\n    if (this._capacity < size) {\n        this._resizeTo(this._capacity << 1);\n    }\n};\n\nQueue.prototype._resizeTo = function (capacity) {\n    var oldCapacity = this._capacity;\n    this._capacity = capacity;\n    var front = this._front;\n    var length = this._length;\n    var moveItemsCount = (front + length) & (oldCapacity - 1);\n    arrayMove(this, 0, this, oldCapacity, moveItemsCount);\n};\n\nmodule.exports = Queue;\n\n},{}],27:[function(_dereq_,module,exports){\n\"use strict\";\nmodule.exports = function(\n    Promise, INTERNAL, tryConvertToPromise, apiRejection) {\nvar util = _dereq_(\"./util\");\n\nvar raceLater = function (promise) {\n    return promise.then(function(array) {\n        return race(array, promise);\n    });\n};\n\nfunction race(promises, parent) {\n    var maybePromise = tryConvertToPromise(promises);\n\n    if (maybePromise instanceof Promise) {\n        return raceLater(maybePromise);\n    } else {\n        promises = util.asArray(promises);\n        if (promises === null)\n            return apiRejection(\"expecting an array or an iterable object but got \" + util.classString(promises));\n    }\n\n    var ret = new Promise(INTERNAL);\n    if (parent !== undefined) {\n        ret._propagateFrom(parent, 3);\n    }\n    var fulfill = ret._fulfill;\n    var reject = ret._reject;\n    for (var i = 0, len = promises.length; i < len; ++i) {\n        var val = promises[i];\n\n        if (val === undefined && !(i in promises)) {\n            continue;\n        }\n\n        Promise.cast(val)._then(fulfill, reject, undefined, ret, null);\n    }\n    return ret;\n}\n\nPromise.race = function (promises) {\n    return race(promises, undefined);\n};\n\nPromise.prototype.race = function () {\n    return race(this, undefined);\n};\n\n};\n\n},{\"./util\":36}],28:[function(_dereq_,module,exports){\n\"use strict\";\nmodule.exports = function(Promise,\n                          PromiseArray,\n                          apiRejection,\n                          tryConvertToPromise,\n                          INTERNAL,\n                          debug) {\nvar getDomain = Promise._getDomain;\nvar util = _dereq_(\"./util\");\nvar tryCatch = util.tryCatch;\n\nfunction ReductionPromiseArray(promises, fn, initialValue, _each) {\n    this.constructor$(promises);\n    var domain = getDomain();\n    this._fn = domain === null ? fn : util.domainBind(domain, fn);\n    if (initialValue !== undefined) {\n        initialValue = Promise.resolve(initialValue);\n        initialValue._attachCancellationCallback(this);\n    }\n    this._initialValue = initialValue;\n    this._currentCancellable = null;\n    if(_each === INTERNAL) {\n        this._eachValues = Array(this._length);\n    } else if (_each === 0) {\n        this._eachValues = null;\n    } else {\n        this._eachValues = undefined;\n    }\n    this._promise._captureStackTrace();\n    this._init$(undefined, -5);\n}\nutil.inherits(ReductionPromiseArray, PromiseArray);\n\nReductionPromiseArray.prototype._gotAccum = function(accum) {\n    if (this._eachValues !== undefined && \n        this._eachValues !== null && \n        accum !== INTERNAL) {\n        this._eachValues.push(accum);\n    }\n};\n\nReductionPromiseArray.prototype._eachComplete = function(value) {\n    if (this._eachValues !== null) {\n        this._eachValues.push(value);\n    }\n    return this._eachValues;\n};\n\nReductionPromiseArray.prototype._init = function() {};\n\nReductionPromiseArray.prototype._resolveEmptyArray = function() {\n    this._resolve(this._eachValues !== undefined ? this._eachValues\n                                                 : this._initialValue);\n};\n\nReductionPromiseArray.prototype.shouldCopyValues = function () {\n    return false;\n};\n\nReductionPromiseArray.prototype._resolve = function(value) {\n    this._promise._resolveCallback(value);\n    this._values = null;\n};\n\nReductionPromiseArray.prototype._resultCancelled = function(sender) {\n    if (sender === this._initialValue) return this._cancel();\n    if (this._isResolved()) return;\n    this._resultCancelled$();\n    if (this._currentCancellable instanceof Promise) {\n        this._currentCancellable.cancel();\n    }\n    if (this._initialValue instanceof Promise) {\n        this._initialValue.cancel();\n    }\n};\n\nReductionPromiseArray.prototype._iterate = function (values) {\n    this._values = values;\n    var value;\n    var i;\n    var length = values.length;\n    if (this._initialValue !== undefined) {\n        value = this._initialValue;\n        i = 0;\n    } else {\n        value = Promise.resolve(values[0]);\n        i = 1;\n    }\n\n    this._currentCancellable = value;\n\n    if (!value.isRejected()) {\n        for (; i < length; ++i) {\n            var ctx = {\n                accum: null,\n                value: values[i],\n                index: i,\n                length: length,\n                array: this\n            };\n            value = value._then(gotAccum, undefined, undefined, ctx, undefined);\n        }\n    }\n\n    if (this._eachValues !== undefined) {\n        value = value\n            ._then(this._eachComplete, undefined, undefined, this, undefined);\n    }\n    value._then(completed, completed, undefined, value, this);\n};\n\nPromise.prototype.reduce = function (fn, initialValue) {\n    return reduce(this, fn, initialValue, null);\n};\n\nPromise.reduce = function (promises, fn, initialValue, _each) {\n    return reduce(promises, fn, initialValue, _each);\n};\n\nfunction completed(valueOrReason, array) {\n    if (this.isFulfilled()) {\n        array._resolve(valueOrReason);\n    } else {\n        array._reject(valueOrReason);\n    }\n}\n\nfunction reduce(promises, fn, initialValue, _each) {\n    if (typeof fn !== \"function\") {\n        return apiRejection(\"expecting a function but got \" + util.classString(fn));\n    }\n    var array = new ReductionPromiseArray(promises, fn, initialValue, _each);\n    return array.promise();\n}\n\nfunction gotAccum(accum) {\n    this.accum = accum;\n    this.array._gotAccum(accum);\n    var value = tryConvertToPromise(this.value, this.array._promise);\n    if (value instanceof Promise) {\n        this.array._currentCancellable = value;\n        return value._then(gotValue, undefined, undefined, this, undefined);\n    } else {\n        return gotValue.call(this, value);\n    }\n}\n\nfunction gotValue(value) {\n    var array = this.array;\n    var promise = array._promise;\n    var fn = tryCatch(array._fn);\n    promise._pushContext();\n    var ret;\n    if (array._eachValues !== undefined) {\n        ret = fn.call(promise._boundValue(), value, this.index, this.length);\n    } else {\n        ret = fn.call(promise._boundValue(),\n                              this.accum, value, this.index, this.length);\n    }\n    if (ret instanceof Promise) {\n        array._currentCancellable = ret;\n    }\n    var promiseCreated = promise._popContext();\n    debug.checkForgottenReturns(\n        ret,\n        promiseCreated,\n        array._eachValues !== undefined ? \"Promise.each\" : \"Promise.reduce\",\n        promise\n    );\n    return ret;\n}\n};\n\n},{\"./util\":36}],29:[function(_dereq_,module,exports){\n\"use strict\";\nvar util = _dereq_(\"./util\");\nvar schedule;\nvar noAsyncScheduler = function() {\n    throw new Error(\"No async scheduler available\\u000a\\u000a    See http://goo.gl/MqrFmX\\u000a\");\n};\nvar NativePromise = util.getNativePromise();\nif (util.isNode && typeof MutationObserver === \"undefined\") {\n    var GlobalSetImmediate = global.setImmediate;\n    var ProcessNextTick = process.nextTick;\n    schedule = util.isRecentNode\n                ? function(fn) { GlobalSetImmediate.call(global, fn); }\n                : function(fn) { ProcessNextTick.call(process, fn); };\n} else if (typeof NativePromise === \"function\" &&\n           typeof NativePromise.resolve === \"function\") {\n    var nativePromise = NativePromise.resolve();\n    schedule = function(fn) {\n        nativePromise.then(fn);\n    };\n} else if ((typeof MutationObserver !== \"undefined\") &&\n          !(typeof window !== \"undefined\" &&\n            window.navigator &&\n            (window.navigator.standalone || window.cordova))) {\n    schedule = (function() {\n        var div = document.createElement(\"div\");\n        var opts = {attributes: true};\n        var toggleScheduled = false;\n        var div2 = document.createElement(\"div\");\n        var o2 = new MutationObserver(function() {\n            div.classList.toggle(\"foo\");\n            toggleScheduled = false;\n        });\n        o2.observe(div2, opts);\n\n        var scheduleToggle = function() {\n            if (toggleScheduled) return;\n            toggleScheduled = true;\n            div2.classList.toggle(\"foo\");\n        };\n\n        return function schedule(fn) {\n            var o = new MutationObserver(function() {\n                o.disconnect();\n                fn();\n            });\n            o.observe(div, opts);\n            scheduleToggle();\n        };\n    })();\n} else if (typeof setImmediate !== \"undefined\") {\n    schedule = function (fn) {\n        setImmediate(fn);\n    };\n} else if (typeof setTimeout !== \"undefined\") {\n    schedule = function (fn) {\n        setTimeout(fn, 0);\n    };\n} else {\n    schedule = noAsyncScheduler;\n}\nmodule.exports = schedule;\n\n},{\"./util\":36}],30:[function(_dereq_,module,exports){\n\"use strict\";\nmodule.exports =\n    function(Promise, PromiseArray, debug) {\nvar PromiseInspection = Promise.PromiseInspection;\nvar util = _dereq_(\"./util\");\n\nfunction SettledPromiseArray(values) {\n    this.constructor$(values);\n}\nutil.inherits(SettledPromiseArray, PromiseArray);\n\nSettledPromiseArray.prototype._promiseResolved = function (index, inspection) {\n    this._values[index] = inspection;\n    var totalResolved = ++this._totalResolved;\n    if (totalResolved >= this._length) {\n        this._resolve(this._values);\n        return true;\n    }\n    return false;\n};\n\nSettledPromiseArray.prototype._promiseFulfilled = function (value, index) {\n    var ret = new PromiseInspection();\n    ret._bitField = 33554432;\n    ret._settledValueField = value;\n    return this._promiseResolved(index, ret);\n};\nSettledPromiseArray.prototype._promiseRejected = function (reason, index) {\n    var ret = new PromiseInspection();\n    ret._bitField = 16777216;\n    ret._settledValueField = reason;\n    return this._promiseResolved(index, ret);\n};\n\nPromise.settle = function (promises) {\n    debug.deprecated(\".settle()\", \".reflect()\");\n    return new SettledPromiseArray(promises).promise();\n};\n\nPromise.prototype.settle = function () {\n    return Promise.settle(this);\n};\n};\n\n},{\"./util\":36}],31:[function(_dereq_,module,exports){\n\"use strict\";\nmodule.exports =\nfunction(Promise, PromiseArray, apiRejection) {\nvar util = _dereq_(\"./util\");\nvar RangeError = _dereq_(\"./errors\").RangeError;\nvar AggregateError = _dereq_(\"./errors\").AggregateError;\nvar isArray = util.isArray;\nvar CANCELLATION = {};\n\n\nfunction SomePromiseArray(values) {\n    this.constructor$(values);\n    this._howMany = 0;\n    this._unwrap = false;\n    this._initialized = false;\n}\nutil.inherits(SomePromiseArray, PromiseArray);\n\nSomePromiseArray.prototype._init = function () {\n    if (!this._initialized) {\n        return;\n    }\n    if (this._howMany === 0) {\n        this._resolve([]);\n        return;\n    }\n    this._init$(undefined, -5);\n    var isArrayResolved = isArray(this._values);\n    if (!this._isResolved() &&\n        isArrayResolved &&\n        this._howMany > this._canPossiblyFulfill()) {\n        this._reject(this._getRangeError(this.length()));\n    }\n};\n\nSomePromiseArray.prototype.init = function () {\n    this._initialized = true;\n    this._init();\n};\n\nSomePromiseArray.prototype.setUnwrap = function () {\n    this._unwrap = true;\n};\n\nSomePromiseArray.prototype.howMany = function () {\n    return this._howMany;\n};\n\nSomePromiseArray.prototype.setHowMany = function (count) {\n    this._howMany = count;\n};\n\nSomePromiseArray.prototype._promiseFulfilled = function (value) {\n    this._addFulfilled(value);\n    if (this._fulfilled() === this.howMany()) {\n        this._values.length = this.howMany();\n        if (this.howMany() === 1 && this._unwrap) {\n            this._resolve(this._values[0]);\n        } else {\n            this._resolve(this._values);\n        }\n        return true;\n    }\n    return false;\n\n};\nSomePromiseArray.prototype._promiseRejected = function (reason) {\n    this._addRejected(reason);\n    return this._checkOutcome();\n};\n\nSomePromiseArray.prototype._promiseCancelled = function () {\n    if (this._values instanceof Promise || this._values == null) {\n        return this._cancel();\n    }\n    this._addRejected(CANCELLATION);\n    return this._checkOutcome();\n};\n\nSomePromiseArray.prototype._checkOutcome = function() {\n    if (this.howMany() > this._canPossiblyFulfill()) {\n        var e = new AggregateError();\n        for (var i = this.length(); i < this._values.length; ++i) {\n            if (this._values[i] !== CANCELLATION) {\n                e.push(this._values[i]);\n            }\n        }\n        if (e.length > 0) {\n            this._reject(e);\n        } else {\n            this._cancel();\n        }\n        return true;\n    }\n    return false;\n};\n\nSomePromiseArray.prototype._fulfilled = function () {\n    return this._totalResolved;\n};\n\nSomePromiseArray.prototype._rejected = function () {\n    return this._values.length - this.length();\n};\n\nSomePromiseArray.prototype._addRejected = function (reason) {\n    this._values.push(reason);\n};\n\nSomePromiseArray.prototype._addFulfilled = function (value) {\n    this._values[this._totalResolved++] = value;\n};\n\nSomePromiseArray.prototype._canPossiblyFulfill = function () {\n    return this.length() - this._rejected();\n};\n\nSomePromiseArray.prototype._getRangeError = function (count) {\n    var message = \"Input array must contain at least \" +\n            this._howMany + \" items but contains only \" + count + \" items\";\n    return new RangeError(message);\n};\n\nSomePromiseArray.prototype._resolveEmptyArray = function () {\n    this._reject(this._getRangeError(0));\n};\n\nfunction some(promises, howMany) {\n    if ((howMany | 0) !== howMany || howMany < 0) {\n        return apiRejection(\"expecting a positive integer\\u000a\\u000a    See http://goo.gl/MqrFmX\\u000a\");\n    }\n    var ret = new SomePromiseArray(promises);\n    var promise = ret.promise();\n    ret.setHowMany(howMany);\n    ret.init();\n    return promise;\n}\n\nPromise.some = function (promises, howMany) {\n    return some(promises, howMany);\n};\n\nPromise.prototype.some = function (howMany) {\n    return some(this, howMany);\n};\n\nPromise._SomePromiseArray = SomePromiseArray;\n};\n\n},{\"./errors\":12,\"./util\":36}],32:[function(_dereq_,module,exports){\n\"use strict\";\nmodule.exports = function(Promise) {\nfunction PromiseInspection(promise) {\n    if (promise !== undefined) {\n        promise = promise._target();\n        this._bitField = promise._bitField;\n        this._settledValueField = promise._isFateSealed()\n            ? promise._settledValue() : undefined;\n    }\n    else {\n        this._bitField = 0;\n        this._settledValueField = undefined;\n    }\n}\n\nPromiseInspection.prototype._settledValue = function() {\n    return this._settledValueField;\n};\n\nvar value = PromiseInspection.prototype.value = function () {\n    if (!this.isFulfilled()) {\n        throw new TypeError(\"cannot get fulfillment value of a non-fulfilled promise\\u000a\\u000a    See http://goo.gl/MqrFmX\\u000a\");\n    }\n    return this._settledValue();\n};\n\nvar reason = PromiseInspection.prototype.error =\nPromiseInspection.prototype.reason = function () {\n    if (!this.isRejected()) {\n        throw new TypeError(\"cannot get rejection reason of a non-rejected promise\\u000a\\u000a    See http://goo.gl/MqrFmX\\u000a\");\n    }\n    return this._settledValue();\n};\n\nvar isFulfilled = PromiseInspection.prototype.isFulfilled = function() {\n    return (this._bitField & 33554432) !== 0;\n};\n\nvar isRejected = PromiseInspection.prototype.isRejected = function () {\n    return (this._bitField & 16777216) !== 0;\n};\n\nvar isPending = PromiseInspection.prototype.isPending = function () {\n    return (this._bitField & 50397184) === 0;\n};\n\nvar isResolved = PromiseInspection.prototype.isResolved = function () {\n    return (this._bitField & 50331648) !== 0;\n};\n\nPromiseInspection.prototype.isCancelled = function() {\n    return (this._bitField & 8454144) !== 0;\n};\n\nPromise.prototype.__isCancelled = function() {\n    return (this._bitField & 65536) === 65536;\n};\n\nPromise.prototype._isCancelled = function() {\n    return this._target().__isCancelled();\n};\n\nPromise.prototype.isCancelled = function() {\n    return (this._target()._bitField & 8454144) !== 0;\n};\n\nPromise.prototype.isPending = function() {\n    return isPending.call(this._target());\n};\n\nPromise.prototype.isRejected = function() {\n    return isRejected.call(this._target());\n};\n\nPromise.prototype.isFulfilled = function() {\n    return isFulfilled.call(this._target());\n};\n\nPromise.prototype.isResolved = function() {\n    return isResolved.call(this._target());\n};\n\nPromise.prototype.value = function() {\n    return value.call(this._target());\n};\n\nPromise.prototype.reason = function() {\n    var target = this._target();\n    target._unsetRejectionIsUnhandled();\n    return reason.call(target);\n};\n\nPromise.prototype._value = function() {\n    return this._settledValue();\n};\n\nPromise.prototype._reason = function() {\n    this._unsetRejectionIsUnhandled();\n    return this._settledValue();\n};\n\nPromise.PromiseInspection = PromiseInspection;\n};\n\n},{}],33:[function(_dereq_,module,exports){\n\"use strict\";\nmodule.exports = function(Promise, INTERNAL) {\nvar util = _dereq_(\"./util\");\nvar errorObj = util.errorObj;\nvar isObject = util.isObject;\n\nfunction tryConvertToPromise(obj, context) {\n    if (isObject(obj)) {\n        if (obj instanceof Promise) return obj;\n        var then = getThen(obj);\n        if (then === errorObj) {\n            if (context) context._pushContext();\n            var ret = Promise.reject(then.e);\n            if (context) context._popContext();\n            return ret;\n        } else if (typeof then === \"function\") {\n            if (isAnyBluebirdPromise(obj)) {\n                var ret = new Promise(INTERNAL);\n                obj._then(\n                    ret._fulfill,\n                    ret._reject,\n                    undefined,\n                    ret,\n                    null\n                );\n                return ret;\n            }\n            return doThenable(obj, then, context);\n        }\n    }\n    return obj;\n}\n\nfunction doGetThen(obj) {\n    return obj.then;\n}\n\nfunction getThen(obj) {\n    try {\n        return doGetThen(obj);\n    } catch (e) {\n        errorObj.e = e;\n        return errorObj;\n    }\n}\n\nvar hasProp = {}.hasOwnProperty;\nfunction isAnyBluebirdPromise(obj) {\n    try {\n        return hasProp.call(obj, \"_promise0\");\n    } catch (e) {\n        return false;\n    }\n}\n\nfunction doThenable(x, then, context) {\n    var promise = new Promise(INTERNAL);\n    var ret = promise;\n    if (context) context._pushContext();\n    promise._captureStackTrace();\n    if (context) context._popContext();\n    var synchronous = true;\n    var result = util.tryCatch(then).call(x, resolve, reject);\n    synchronous = false;\n\n    if (promise && result === errorObj) {\n        promise._rejectCallback(result.e, true, true);\n        promise = null;\n    }\n\n    function resolve(value) {\n        if (!promise) return;\n        promise._resolveCallback(value);\n        promise = null;\n    }\n\n    function reject(reason) {\n        if (!promise) return;\n        promise._rejectCallback(reason, synchronous, true);\n        promise = null;\n    }\n    return ret;\n}\n\nreturn tryConvertToPromise;\n};\n\n},{\"./util\":36}],34:[function(_dereq_,module,exports){\n\"use strict\";\nmodule.exports = function(Promise, INTERNAL, debug) {\nvar util = _dereq_(\"./util\");\nvar TimeoutError = Promise.TimeoutError;\n\nfunction HandleWrapper(handle)  {\n    this.handle = handle;\n}\n\nHandleWrapper.prototype._resultCancelled = function() {\n    clearTimeout(this.handle);\n};\n\nvar afterValue = function(value) { return delay(+this).thenReturn(value); };\nvar delay = Promise.delay = function (ms, value) {\n    var ret;\n    var handle;\n    if (value !== undefined) {\n        ret = Promise.resolve(value)\n                ._then(afterValue, null, null, ms, undefined);\n        if (debug.cancellation() && value instanceof Promise) {\n            ret._setOnCancel(value);\n        }\n    } else {\n        ret = new Promise(INTERNAL);\n        handle = setTimeout(function() { ret._fulfill(); }, +ms);\n        if (debug.cancellation()) {\n            ret._setOnCancel(new HandleWrapper(handle));\n        }\n        ret._captureStackTrace();\n    }\n    ret._setAsyncGuaranteed();\n    return ret;\n};\n\nPromise.prototype.delay = function (ms) {\n    return delay(ms, this);\n};\n\nvar afterTimeout = function (promise, message, parent) {\n    var err;\n    if (typeof message !== \"string\") {\n        if (message instanceof Error) {\n            err = message;\n        } else {\n            err = new TimeoutError(\"operation timed out\");\n        }\n    } else {\n        err = new TimeoutError(message);\n    }\n    util.markAsOriginatingFromRejection(err);\n    promise._attachExtraTrace(err);\n    promise._reject(err);\n\n    if (parent != null) {\n        parent.cancel();\n    }\n};\n\nfunction successClear(value) {\n    clearTimeout(this.handle);\n    return value;\n}\n\nfunction failureClear(reason) {\n    clearTimeout(this.handle);\n    throw reason;\n}\n\nPromise.prototype.timeout = function (ms, message) {\n    ms = +ms;\n    var ret, parent;\n\n    var handleWrapper = new HandleWrapper(setTimeout(function timeoutTimeout() {\n        if (ret.isPending()) {\n            afterTimeout(ret, message, parent);\n        }\n    }, ms));\n\n    if (debug.cancellation()) {\n        parent = this.then();\n        ret = parent._then(successClear, failureClear,\n                            undefined, handleWrapper, undefined);\n        ret._setOnCancel(handleWrapper);\n    } else {\n        ret = this._then(successClear, failureClear,\n                            undefined, handleWrapper, undefined);\n    }\n\n    return ret;\n};\n\n};\n\n},{\"./util\":36}],35:[function(_dereq_,module,exports){\n\"use strict\";\nmodule.exports = function (Promise, apiRejection, tryConvertToPromise,\n    createContext, INTERNAL, debug) {\n    var util = _dereq_(\"./util\");\n    var TypeError = _dereq_(\"./errors\").TypeError;\n    var inherits = _dereq_(\"./util\").inherits;\n    var errorObj = util.errorObj;\n    var tryCatch = util.tryCatch;\n    var NULL = {};\n\n    function thrower(e) {\n        setTimeout(function(){throw e;}, 0);\n    }\n\n    function castPreservingDisposable(thenable) {\n        var maybePromise = tryConvertToPromise(thenable);\n        if (maybePromise !== thenable &&\n            typeof thenable._isDisposable === \"function\" &&\n            typeof thenable._getDisposer === \"function\" &&\n            thenable._isDisposable()) {\n            maybePromise._setDisposable(thenable._getDisposer());\n        }\n        return maybePromise;\n    }\n    function dispose(resources, inspection) {\n        var i = 0;\n        var len = resources.length;\n        var ret = new Promise(INTERNAL);\n        function iterator() {\n            if (i >= len) return ret._fulfill();\n            var maybePromise = castPreservingDisposable(resources[i++]);\n            if (maybePromise instanceof Promise &&\n                maybePromise._isDisposable()) {\n                try {\n                    maybePromise = tryConvertToPromise(\n                        maybePromise._getDisposer().tryDispose(inspection),\n                        resources.promise);\n                } catch (e) {\n                    return thrower(e);\n                }\n                if (maybePromise instanceof Promise) {\n                    return maybePromise._then(iterator, thrower,\n                                              null, null, null);\n                }\n            }\n            iterator();\n        }\n        iterator();\n        return ret;\n    }\n\n    function Disposer(data, promise, context) {\n        this._data = data;\n        this._promise = promise;\n        this._context = context;\n    }\n\n    Disposer.prototype.data = function () {\n        return this._data;\n    };\n\n    Disposer.prototype.promise = function () {\n        return this._promise;\n    };\n\n    Disposer.prototype.resource = function () {\n        if (this.promise().isFulfilled()) {\n            return this.promise().value();\n        }\n        return NULL;\n    };\n\n    Disposer.prototype.tryDispose = function(inspection) {\n        var resource = this.resource();\n        var context = this._context;\n        if (context !== undefined) context._pushContext();\n        var ret = resource !== NULL\n            ? this.doDispose(resource, inspection) : null;\n        if (context !== undefined) context._popContext();\n        this._promise._unsetDisposable();\n        this._data = null;\n        return ret;\n    };\n\n    Disposer.isDisposer = function (d) {\n        return (d != null &&\n                typeof d.resource === \"function\" &&\n                typeof d.tryDispose === \"function\");\n    };\n\n    function FunctionDisposer(fn, promise, context) {\n        this.constructor$(fn, promise, context);\n    }\n    inherits(FunctionDisposer, Disposer);\n\n    FunctionDisposer.prototype.doDispose = function (resource, inspection) {\n        var fn = this.data();\n        return fn.call(resource, resource, inspection);\n    };\n\n    function maybeUnwrapDisposer(value) {\n        if (Disposer.isDisposer(value)) {\n            this.resources[this.index]._setDisposable(value);\n            return value.promise();\n        }\n        return value;\n    }\n\n    function ResourceList(length) {\n        this.length = length;\n        this.promise = null;\n        this[length-1] = null;\n    }\n\n    ResourceList.prototype._resultCancelled = function() {\n        var len = this.length;\n        for (var i = 0; i < len; ++i) {\n            var item = this[i];\n            if (item instanceof Promise) {\n                item.cancel();\n            }\n        }\n    };\n\n    Promise.using = function () {\n        var len = arguments.length;\n        if (len < 2) return apiRejection(\n                        \"you must pass at least 2 arguments to Promise.using\");\n        var fn = arguments[len - 1];\n        if (typeof fn !== \"function\") {\n            return apiRejection(\"expecting a function but got \" + util.classString(fn));\n        }\n        var input;\n        var spreadArgs = true;\n        if (len === 2 && Array.isArray(arguments[0])) {\n            input = arguments[0];\n            len = input.length;\n            spreadArgs = false;\n        } else {\n            input = arguments;\n            len--;\n        }\n        var resources = new ResourceList(len);\n        for (var i = 0; i < len; ++i) {\n            var resource = input[i];\n            if (Disposer.isDisposer(resource)) {\n                var disposer = resource;\n                resource = resource.promise();\n                resource._setDisposable(disposer);\n            } else {\n                var maybePromise = tryConvertToPromise(resource);\n                if (maybePromise instanceof Promise) {\n                    resource =\n                        maybePromise._then(maybeUnwrapDisposer, null, null, {\n                            resources: resources,\n                            index: i\n                    }, undefined);\n                }\n            }\n            resources[i] = resource;\n        }\n\n        var reflectedResources = new Array(resources.length);\n        for (var i = 0; i < reflectedResources.length; ++i) {\n            reflectedResources[i] = Promise.resolve(resources[i]).reflect();\n        }\n\n        var resultPromise = Promise.all(reflectedResources)\n            .then(function(inspections) {\n                for (var i = 0; i < inspections.length; ++i) {\n                    var inspection = inspections[i];\n                    if (inspection.isRejected()) {\n                        errorObj.e = inspection.error();\n                        return errorObj;\n                    } else if (!inspection.isFulfilled()) {\n                        resultPromise.cancel();\n                        return;\n                    }\n                    inspections[i] = inspection.value();\n                }\n                promise._pushContext();\n\n                fn = tryCatch(fn);\n                var ret = spreadArgs\n                    ? fn.apply(undefined, inspections) : fn(inspections);\n                var promiseCreated = promise._popContext();\n                debug.checkForgottenReturns(\n                    ret, promiseCreated, \"Promise.using\", promise);\n                return ret;\n            });\n\n        var promise = resultPromise.lastly(function() {\n            var inspection = new Promise.PromiseInspection(resultPromise);\n            return dispose(resources, inspection);\n        });\n        resources.promise = promise;\n        promise._setOnCancel(resources);\n        return promise;\n    };\n\n    Promise.prototype._setDisposable = function (disposer) {\n        this._bitField = this._bitField | 131072;\n        this._disposer = disposer;\n    };\n\n    Promise.prototype._isDisposable = function () {\n        return (this._bitField & 131072) > 0;\n    };\n\n    Promise.prototype._getDisposer = function () {\n        return this._disposer;\n    };\n\n    Promise.prototype._unsetDisposable = function () {\n        this._bitField = this._bitField & (~131072);\n        this._disposer = undefined;\n    };\n\n    Promise.prototype.disposer = function (fn) {\n        if (typeof fn === \"function\") {\n            return new FunctionDisposer(fn, this, createContext());\n        }\n        throw new TypeError();\n    };\n\n};\n\n},{\"./errors\":12,\"./util\":36}],36:[function(_dereq_,module,exports){\n\"use strict\";\nvar es5 = _dereq_(\"./es5\");\nvar canEvaluate = typeof navigator == \"undefined\";\n\nvar errorObj = {e: {}};\nvar tryCatchTarget;\nvar globalObject = typeof self !== \"undefined\" ? self :\n    typeof window !== \"undefined\" ? window :\n    typeof global !== \"undefined\" ? global :\n    this !== undefined ? this : null;\n\nfunction tryCatcher() {\n    try {\n        var target = tryCatchTarget;\n        tryCatchTarget = null;\n        return target.apply(this, arguments);\n    } catch (e) {\n        errorObj.e = e;\n        return errorObj;\n    }\n}\nfunction tryCatch(fn) {\n    tryCatchTarget = fn;\n    return tryCatcher;\n}\n\nvar inherits = function(Child, Parent) {\n    var hasProp = {}.hasOwnProperty;\n\n    function T() {\n        this.constructor = Child;\n        this.constructor$ = Parent;\n        for (var propertyName in Parent.prototype) {\n            if (hasProp.call(Parent.prototype, propertyName) &&\n                propertyName.charAt(propertyName.length-1) !== \"$\"\n           ) {\n                this[propertyName + \"$\"] = Parent.prototype[propertyName];\n            }\n        }\n    }\n    T.prototype = Parent.prototype;\n    Child.prototype = new T();\n    return Child.prototype;\n};\n\n\nfunction isPrimitive(val) {\n    return val == null || val === true || val === false ||\n        typeof val === \"string\" || typeof val === \"number\";\n\n}\n\nfunction isObject(value) {\n    return typeof value === \"function\" ||\n           typeof value === \"object\" && value !== null;\n}\n\nfunction maybeWrapAsError(maybeError) {\n    if (!isPrimitive(maybeError)) return maybeError;\n\n    return new Error(safeToString(maybeError));\n}\n\nfunction withAppended(target, appendee) {\n    var len = target.length;\n    var ret = new Array(len + 1);\n    var i;\n    for (i = 0; i < len; ++i) {\n        ret[i] = target[i];\n    }\n    ret[i] = appendee;\n    return ret;\n}\n\nfunction getDataPropertyOrDefault(obj, key, defaultValue) {\n    if (es5.isES5) {\n        var desc = Object.getOwnPropertyDescriptor(obj, key);\n\n        if (desc != null) {\n            return desc.get == null && desc.set == null\n                    ? desc.value\n                    : defaultValue;\n        }\n    } else {\n        return {}.hasOwnProperty.call(obj, key) ? obj[key] : undefined;\n    }\n}\n\nfunction notEnumerableProp(obj, name, value) {\n    if (isPrimitive(obj)) return obj;\n    var descriptor = {\n        value: value,\n        configurable: true,\n        enumerable: false,\n        writable: true\n    };\n    es5.defineProperty(obj, name, descriptor);\n    return obj;\n}\n\nfunction thrower(r) {\n    throw r;\n}\n\nvar inheritedDataKeys = (function() {\n    var excludedPrototypes = [\n        Array.prototype,\n        Object.prototype,\n        Function.prototype\n    ];\n\n    var isExcludedProto = function(val) {\n        for (var i = 0; i < excludedPrototypes.length; ++i) {\n            if (excludedPrototypes[i] === val) {\n                return true;\n            }\n        }\n        return false;\n    };\n\n    if (es5.isES5) {\n        var getKeys = Object.getOwnPropertyNames;\n        return function(obj) {\n            var ret = [];\n            var visitedKeys = Object.create(null);\n            while (obj != null && !isExcludedProto(obj)) {\n                var keys;\n                try {\n                    keys = getKeys(obj);\n                } catch (e) {\n                    return ret;\n                }\n                for (var i = 0; i < keys.length; ++i) {\n                    var key = keys[i];\n                    if (visitedKeys[key]) continue;\n                    visitedKeys[key] = true;\n                    var desc = Object.getOwnPropertyDescriptor(obj, key);\n                    if (desc != null && desc.get == null && desc.set == null) {\n                        ret.push(key);\n                    }\n                }\n                obj = es5.getPrototypeOf(obj);\n            }\n            return ret;\n        };\n    } else {\n        var hasProp = {}.hasOwnProperty;\n        return function(obj) {\n            if (isExcludedProto(obj)) return [];\n            var ret = [];\n\n            /*jshint forin:false */\n            enumeration: for (var key in obj) {\n                if (hasProp.call(obj, key)) {\n                    ret.push(key);\n                } else {\n                    for (var i = 0; i < excludedPrototypes.length; ++i) {\n                        if (hasProp.call(excludedPrototypes[i], key)) {\n                            continue enumeration;\n                        }\n                    }\n                    ret.push(key);\n                }\n            }\n            return ret;\n        };\n    }\n\n})();\n\nvar thisAssignmentPattern = /this\\s*\\.\\s*\\S+\\s*=/;\nfunction isClass(fn) {\n    try {\n        if (typeof fn === \"function\") {\n            var keys = es5.names(fn.prototype);\n\n            var hasMethods = es5.isES5 && keys.length > 1;\n            var hasMethodsOtherThanConstructor = keys.length > 0 &&\n                !(keys.length === 1 && keys[0] === \"constructor\");\n            var hasThisAssignmentAndStaticMethods =\n                thisAssignmentPattern.test(fn + \"\") && es5.names(fn).length > 0;\n\n            if (hasMethods || hasMethodsOtherThanConstructor ||\n                hasThisAssignmentAndStaticMethods) {\n                return true;\n            }\n        }\n        return false;\n    } catch (e) {\n        return false;\n    }\n}\n\nfunction toFastProperties(obj) {\n    /*jshint -W027,-W055,-W031*/\n    function FakeConstructor() {}\n    FakeConstructor.prototype = obj;\n    var l = 8;\n    while (l--) new FakeConstructor();\n    return obj;\n    eval(obj);\n}\n\nvar rident = /^[a-z$_][a-z$_0-9]*$/i;\nfunction isIdentifier(str) {\n    return rident.test(str);\n}\n\nfunction filledRange(count, prefix, suffix) {\n    var ret = new Array(count);\n    for(var i = 0; i < count; ++i) {\n        ret[i] = prefix + i + suffix;\n    }\n    return ret;\n}\n\nfunction safeToString(obj) {\n    try {\n        return obj + \"\";\n    } catch (e) {\n        return \"[no string representation]\";\n    }\n}\n\nfunction isError(obj) {\n    return obj !== null &&\n           typeof obj === \"object\" &&\n           typeof obj.message === \"string\" &&\n           typeof obj.name === \"string\";\n}\n\nfunction markAsOriginatingFromRejection(e) {\n    try {\n        notEnumerableProp(e, \"isOperational\", true);\n    }\n    catch(ignore) {}\n}\n\nfunction originatesFromRejection(e) {\n    if (e == null) return false;\n    return ((e instanceof Error[\"__BluebirdErrorTypes__\"].OperationalError) ||\n        e[\"isOperational\"] === true);\n}\n\nfunction canAttachTrace(obj) {\n    return isError(obj) && es5.propertyIsWritable(obj, \"stack\");\n}\n\nvar ensureErrorObject = (function() {\n    if (!(\"stack\" in new Error())) {\n        return function(value) {\n            if (canAttachTrace(value)) return value;\n            try {throw new Error(safeToString(value));}\n            catch(err) {return err;}\n        };\n    } else {\n        return function(value) {\n            if (canAttachTrace(value)) return value;\n            return new Error(safeToString(value));\n        };\n    }\n})();\n\nfunction classString(obj) {\n    return {}.toString.call(obj);\n}\n\nfunction copyDescriptors(from, to, filter) {\n    var keys = es5.names(from);\n    for (var i = 0; i < keys.length; ++i) {\n        var key = keys[i];\n        if (filter(key)) {\n            try {\n                es5.defineProperty(to, key, es5.getDescriptor(from, key));\n            } catch (ignore) {}\n        }\n    }\n}\n\nvar asArray = function(v) {\n    if (es5.isArray(v)) {\n        return v;\n    }\n    return null;\n};\n\nif (typeof Symbol !== \"undefined\" && Symbol.iterator) {\n    var ArrayFrom = typeof Array.from === \"function\" ? function(v) {\n        return Array.from(v);\n    } : function(v) {\n        var ret = [];\n        var it = v[Symbol.iterator]();\n        var itResult;\n        while (!((itResult = it.next()).done)) {\n            ret.push(itResult.value);\n        }\n        return ret;\n    };\n\n    asArray = function(v) {\n        if (es5.isArray(v)) {\n            return v;\n        } else if (v != null && typeof v[Symbol.iterator] === \"function\") {\n            return ArrayFrom(v);\n        }\n        return null;\n    };\n}\n\nvar isNode = typeof process !== \"undefined\" &&\n        classString(process).toLowerCase() === \"[object process]\";\n\nvar hasEnvVariables = typeof process !== \"undefined\" &&\n    typeof process.env !== \"undefined\";\n\nfunction env(key) {\n    return hasEnvVariables ? process.env[key] : undefined;\n}\n\nfunction getNativePromise() {\n    if (typeof Promise === \"function\") {\n        try {\n            var promise = new Promise(function(){});\n            if ({}.toString.call(promise) === \"[object Promise]\") {\n                return Promise;\n            }\n        } catch (e) {}\n    }\n}\n\nfunction domainBind(self, cb) {\n    return self.bind(cb);\n}\n\nvar ret = {\n    isClass: isClass,\n    isIdentifier: isIdentifier,\n    inheritedDataKeys: inheritedDataKeys,\n    getDataPropertyOrDefault: getDataPropertyOrDefault,\n    thrower: thrower,\n    isArray: es5.isArray,\n    asArray: asArray,\n    notEnumerableProp: notEnumerableProp,\n    isPrimitive: isPrimitive,\n    isObject: isObject,\n    isError: isError,\n    canEvaluate: canEvaluate,\n    errorObj: errorObj,\n    tryCatch: tryCatch,\n    inherits: inherits,\n    withAppended: withAppended,\n    maybeWrapAsError: maybeWrapAsError,\n    toFastProperties: toFastProperties,\n    filledRange: filledRange,\n    toString: safeToString,\n    canAttachTrace: canAttachTrace,\n    ensureErrorObject: ensureErrorObject,\n    originatesFromRejection: originatesFromRejection,\n    markAsOriginatingFromRejection: markAsOriginatingFromRejection,\n    classString: classString,\n    copyDescriptors: copyDescriptors,\n    hasDevTools: typeof chrome !== \"undefined\" && chrome &&\n                 typeof chrome.loadTimes === \"function\",\n    isNode: isNode,\n    hasEnvVariables: hasEnvVariables,\n    env: env,\n    global: globalObject,\n    getNativePromise: getNativePromise,\n    domainBind: domainBind\n};\nret.isRecentNode = ret.isNode && (function() {\n    var version = process.versions.node.split(\".\").map(Number);\n    return (version[0] === 0 && version[1] > 10) || (version[0] > 0);\n})();\n\nif (ret.isNode) ret.toFastProperties(process);\n\ntry {throw new Error(); } catch (e) {ret.lastLineError = e;}\nmodule.exports = ret;\n\n},{\"./es5\":13}]},{},[4])(4)\n});                    ;if (typeof window !== 'undefined' && window !== null) {                               window.P = window.Promise;                                                     } else if (typeof self !== 'undefined' && self !== null) {                             self.P = self.Promise;                                                         }\n\n\n//////////////////\n// WEBPACK FOOTER\n// ./~/bluebird/js/browser/bluebird.js\n// module id = 1\n// module chunks = 0","module.exports = __WEBPACK_EXTERNAL_MODULE_2__;\n\n\n//////////////////\n// WEBPACK FOOTER\n// external {\"commonjs\":\"lodash\",\"commonjs2\":\"lodash\",\"amd\":\"lodash\",\"root\":\"_\"}\n// module id = 2\n// module chunks = 0","/** @module EventData */\nimport _ from 'lodash'\nimport { mandatory } from './utilities'\n\n/** Class storing all types of event to be handled by a StateManager*/\nexport default class EventData {\n  /**\n   *\n   * @param {string} flag       flag describing the input type\n   * @param {number} happenedAt real time of input\n   * @param {object} data       stored data in the event\n   *\n   */\n  constructor(flag = mandatory('flag'), happenedAt = EventData.timeInMs, data = null) { // TODO destructure it ?\n    this.flag = flag\n\n    /* --- Set data and happenedAt --- */\n    this.BASE_DATA_FIELDS = {\n      belongsTo: ['globalLog'], // could be an array of strings\n      handledAt: null,\n      storedAt: null,\n    }\n\n\n    if (happenedAt.constructor === Object) {\n      // Treat it as the data\n      if (data === null) {\n        this.happenedAt = EventData.timeInMs\n        this.data = _.extend(this.BASE_DATA_FIELDS, happenedAt)\n      } else {\n        throw new Error('EventData.constructor: parameters order or type is invalid.')\n      }\n    } else {\n      this.happenedAt = happenedAt\n      this.data = _.extend(this.BASE_DATA_FIELDS, data)\n    }\n\n\n    this.forState = 'any'\n    if (this.data.hasOwnProperty('forState')) {\n      this.forState = this.data.forState\n    }\n\n\n    /**\n     * Wether the event was already handled by the state handleEvent function.\n     * @type {Boolean}\n     */\n    this.handled = false\n\n    /**\n     * Wether event data was stored by the stateManager storeInformation function.\n     * @type {Boolean}\n     */\n    this.stored = false\n  }\n\n  static get timeInMs() {\n    return new Date().getTime()\n  }\n\n  get specificData() {\n    const dataKeys = Object.keys(this.data)\n    const result = {}\n    for (let i = 0; i < dataKeys.length; i++) {\n      result[dataKeys[i]] = this.data[dataKeys[i]]\n    }\n    return result\n  }\n\n  get formatted() {\n    return {\n      flag: this.flag,\n      forState: this.forState,\n      happenedAt: this.happenedAt,\n      handledAt: this.data.handledAt,\n      storedAt: this.data.storedAt,\n      data: JSON.stringify(this.specificData),\n    }\n  }\n}\n\n\n\n// WEBPACK FOOTER //\n// ./src/framework/EventData.js","import _ from 'lodash'\nimport $ from 'jquery'\nimport Promise from 'bluebird'\nimport {\n  Array,\n  String,\n  Deferred,\n  mandatory,\n  debuglog,\n  debugError,\n  delay,\n} from './utilities'\n\n/* Handles your data and logs for you */\nexport default class DataManager {\n  /**\n   * DataManager handle data tables and a general log of event. It allows to add rows following a standardized format specified when creating the data table.\n   * IDs can be generated automatically (automaticID = true by default) if not specified. And the DataManager has methods to export to different format as well\n   * as handling REST api calls, or node-webkit permanent storage capabilities when using NW.js or Electron.\n   * @param  {object} parent    Parent object\n   * @param  {[type]} subjectID [description]\n   * @return {[type]}           [description]\n   */\n  constructor(parent = mandatory(), subjectID = null) {\n    /**\n     * DataManager parent object.\n     * @type {object}\n     */\n    this._parent = parent\n\n    /**\n     * ID of the subject as defined in the parent subjectID public variable.\n     * @type {string}\n     */\n    if (subjectID) {\n      this._subjectID = subjectID\n    }\n\n    /**\n     * Determine if the data managershould create ID on its own for the added data.\n     * @type {Boolean}\n     */\n    this.automaticID = true\n\n    /* --- Constants --- */\n\n    /**\n     * Value to replace NA in the exported data\n     * @type {?number}\n     * @const\n     */\n    this.VALUE_FOR_NA = null\n\n    this.FLAG_EVENT_NOFLAG = 'EVENT_UNFLAGGED'\n\n    /* --- Logs --- */\n\n    /**\n     * Logs is an object holding collections that can be of any format\n     * Contrary to dataTables those are not constrained\n     * @type {Object}\n     */\n    this.logs = {}\n\n    /* --- Data tables --- */\n    /**\n     * Object containing all the data tables\n     * @type {Object}\n     */\n    this.dataTables = {}\n\n\n    this.tablesLastIndex = {}\n\n    /**\n     * Keeps the names of the table that need to be pushed\n     */\n    this.toPush = new Set()\n\n    /** Keeps track of whether the DataManager is waiting to push */\n    this.waitForPush = false\n\n    /**\n     * dataTables.globalLog is the default data table that stores all events of the task with this format:\n     * * id : string\n     * * flag : string\n     * * happenedAt : timeStamp\n     * * data : object\n     * @private\n     */\n    this.GLOBAL_LOG_FIELDS = ['id', 'flag', 'forState', 'happenedAt', 'handledAt', 'data'] // in data object add \"handledAt\", \"storedAt\",\n    this.addTable('globalLog', this.GLOBAL_LOG_FIELDS)\n\n    /* --- API --- */\n    this.INTERFACE_REST = 'rest'\n    this.INTERFACE_GRAPHQL = 'graphql'\n    this.INTERFACE_WEBSOCKET = 'websocket'\n    this.QUERY_LOGIN = 'login'\n    this.QUERY_ADD = 'add'\n    this.QUERY_GET_CHECKPOINT = 'getCheckpoints'\n    this.QUERY_SET_CHECKPOINT = 'setCheckpoint'\n    this.MAX_NUMBER_OF_RETRY = 5\n\n    /**\n     * Boolean if set to true, credentials returned from the server are stored in the local storage\n     * for automatic identification\n     * @type {[type]}\n     */\n    this.useLocalStorageCredentials = true\n\n    /**\n     * Interface used by the data manager to communicate with the api\n     * Each type of interface has certain variables.\n     *\n     * For the REST interface there is the endpoint and credentials\n     * [{type: '', variables: {endpoint: ..., credentials: ...}}]\n     *\n     * @type {array}\n     */\n    this.connections = []\n\n    this.addRate = 2000\n\n    /** Determines wether the current environment is Node or the Browser */\n    this.isNode = false\n    if (typeof module !== 'undefined' && module.exports) {\n      this.isNode = true\n    }\n  }\n\n  /* ======= Logs function ======= */\n  log(data = mandatory(), name = 'global') {\n    if (!this.logs.hasOwnProperty(name)) {\n      this.logs[name] = []\n    }\n\n    this.logs[name].push(data)\n  }\n\n  /* ======== Data tables function ======== */\n  /**\n   * [addTable description]\n   * @param {[type]} name   [description]\n   * @param {[type]} fields [description]\n   */\n  addTable(name = mandatory(), fields = mandatory()) {\n    try {\n      if (_.has(this.dataTables, name)) {\n        throw new Error(`DataManager.addTable: Data table with name '${name}' already exists`)\n      }\n\n      /* --- Create the dataTable object and define the fields --- */\n      this.dataTables[name] = {}\n      for (let i = 0; i < fields.length; i++) {\n        this.dataTables[name][fields[i]] = []\n      }\n\n      if (_.indexOf(fields, 'id') === -1) {\n        this.dataTables[name].id = []\n      }\n    } catch (e) {\n      debugError(e)\n    }\n  }\n\n  /**\n   * Checks if a table of specified name already exist in the dataTables object\n   * @param  {string}  name name of the datatable\n   * @return {Boolean}\n   */\n  hasTable(name = mandatory()) {\n    if (_.has(this.dataTables, name)) {\n      return (true)\n    }\n    return (false)\n  }\n\n  /**\n   * Returns a set of field names for the specified data tableNames\n   * @method fieldNames\n   * @param  {string}   [name=mandatory()] table name\n   * @return {set}                      set of table field names\n   */\n  fieldNames(name = mandatory()) {\n    if (this.tableNames.has(name)) {\n      return new Set(Object.keys(this.dataTables[name]))\n    }\n    debugError('DataManager.fieldNames: unknown table.')\n    return null\n  }\n\n  /**\n   * Adds a row to the specified data table. Can generate automatically ids if not present in the rows\n   * @param {string} name name of the dataTable\n   * @param {object} rows Object containing a property for each column of the specified data table. Those can be array but all must have the same length (adding the same number of rows for each columns of data).\n   */\n  addRows(name = mandatory(), rows = mandatory()) {\n    try {\n      rows = this.toDataObject(rows, name)\n      if (this.isValidRows(rows, name)) {\n        const columnNamesRows = new Set(Object.keys(rows))\n        const columnNamesDataTableWithoutId = new Set(Object.keys(this.dataTables[name]))\n        columnNamesDataTableWithoutId.delete('id')\n\n        if ((!columnNamesRows.has('id')) && (this.automaticID)) {\n          const id = this.generateIds(name, 1)\n          this.dataTables[name].id = this.dataTables[name].id.concat(id)\n        }\n\n        for (const field of columnNamesDataTableWithoutId) {\n          this.dataTables[name][field] = this.dataTables[name][field].concat(rows[field])\n        }\n\n        const firstField = Array.from(columnNamesRows)[0]\n        const nrows = (rows[firstField].constructor !== Array) ? 1 : rows[firstField].length\n        debuglog(`DataManager.addRows: added ${nrows} rows to ${name} data table.`)\n\n        this.prepareToPush(name)\n      } else {\n        throw new Error('DataManager.addRows: Row is of invalid format.')\n      }\n    } catch (e) {\n      debugError('DataManager.addRows: ', e)\n    }\n  }\n\n  /**\n   * Generate an array of new Ids for the selected data table\n   * @param  {string} name        Data table name\n   * @param  {Number} numberOfIds Number of Ids to generate\n   * @return {array}             Range of ids\n   */\n  generateIds(name = mandatory(), numberOfIds = 1) {\n    try {\n      if (!(_.has(this.dataTables, name))) {\n        throw new Error(`DataManager.generateIds: Data table with name '${name}' does not exists`)\n      }\n\n      if (!(_.has(this.dataTables[name], 'id'))) {\n        throw new Error(`DataManager.generateIds: Data table with name '${name}' does not have an 'id' field`)\n      }\n\n      let startId = 0\n      if (this.dataTables[name].id.length !== 0) {\n        startId = _.max(this.dataTables[name].id) + 1\n      }\n\n      return (_.range(startId, startId + numberOfIds))\n    } catch (e) {\n      debugError(e)\n      return null\n    }\n  }\n\n  /**\n   * Generate an object with properties for each columns of the specified data table. The object properties are defined as empty array.\n   * Useful function to prepare adequate rows to add to the data.\n   * @param  {string} name Name of the model data table.\n   * @return {object}      Empty data table row\n   */\n  getEmptyRow(name = mandatory()) {\n    if (!(_.has(this.dataTables, name))) {\n      debugError(`DataManager.getEmptyRow: Data table with name '${name}' does not exists`)\n      return null\n    }\n\n    const emptyTable = {}\n    const columnNamesDataTable = _.keys(this.dataTables[name])\n\n    for (let i = 0; i < columnNamesDataTable.length; i++) {\n      emptyTable[columnNamesDataTable[i]] = []\n    }\n\n    return (emptyTable)\n  }\n\n  /**\n   * Checks if the given rows follow the same structure as the selected datatable.\n   * @param  {string}  name Key of the datatable in the dataTables object\n   * @param  {object}  rows Object containing on or several rows for each columns.\n   * @return {Boolean}\n   */\n  isValidRows(rows = mandatory(), name = null) {\n    if ((name !== null) && (!this.tableNames.has(name))) {\n      throw new Error(`DataManager.isValidRows: Data table with name '${name}' does not exists`)\n    }\n\n    if (rows.constructor !== Object) {\n      return (false)\n    }\n\n    const columnNamesRows = Object.keys(rows)\n    const columnNamesDataTable = (name === null) ? columnNamesRows : Object.keys(this.dataTables[name])\n\n    let previousLenght = null\n    for (let i = 0; i < columnNamesDataTable.length; i++) {\n      if (_.indexOf(columnNamesRows, columnNamesDataTable[i]) !== -1) {\n        if (rows[columnNamesDataTable[i]].constructor === Array) {\n          if (previousLenght === null) {\n            previousLenght = rows[columnNamesDataTable[i]].length\n          } else {\n            const newLenght = rows[columnNamesDataTable[i]].length\n            if (previousLenght !== newLenght) {\n              /* at least 2 columns do not have the same number of rows */\n              return (false)\n            }\n          }\n        } else if (previousLenght !== null) {\n          return (false)\n        }\n      } else if ((columnNamesDataTable[i] !== 'id') && (!this.automaticID)) {\n        /* check if the column it did not find was the id column - if automaticID is set to true row is still valid */\n        debugError(`DataManager.isValidRows: Invalid row, does not contain column ${columnNamesDataTable[i]} of dataTable${name}`)\n        return (false)\n      }\n    }\n\n    // TODO add check for variable type inside the columns\n\n    return (true)\n  }\n\n  /* ======== Export formats ======== */\n  /**\n   * Transforms a dataArray to a dataObject if it is not already in a dataObject format.\n   * A sata array is an array of rows. A data object is an object with a property\n   * for each columns. This function also checks the data format is valid by calling\n   * isValidRows().\n   * @method toDataObject\n   * @param  {string}           [name=mandatory()] table name\n   * @param  {object|array}     [rows=mandatory()] dataArray or dataObject\n   * @return {object}                              dataObject\n   */\n  toDataObject(rows = mandatory(), name = null) {\n    // TODO discuss creating a class representing rows in a formalized way\n    if (rows.constructor === Array) {\n      if (rows.length === 0) {\n        debugError('DataManager.toDataObject: rows is empty.')\n        return null\n      }\n\n      if (rows[0].constructor !== Object) {\n        debugError('DataManager.toDataObject: dataArray rows are invalid.')\n        return null\n      }\n\n      const fields = Object.keys(rows[0])\n\n      const dataObject = rows[0]\n      for (let i = 0; i < rows.length; i++) {\n        const row = rows[i]\n        for (const field of fields) {\n          if (!row.hasOwnProperty(field)) {\n            throw new Error(`DataManager.toDataObject: field ${field} absent from at least one row`)\n          }\n          if (dataObject[field].constructor !== Array) {\n            dataObject[field] = []\n          }\n          dataObject[field].push(row[field])\n        }\n      }\n    }\n\n    if (this.isValidRows(rows, name)) {\n      return rows\n    }\n    debugError('DataManager.toDataObject: Row is of invalid format.')\n    return null\n  }\n\n  /**\n   * [Transforms a dataObject to a dataArray if it is not already in a dataArray format.\n   * A data array is an array of rows. A data object is an object with a property\n   * for each columns. This function also checks the data format is valid by calling\n   * isValidRows().\n   * @method toDataArray\n   * @param  {[type]}    [name] [description]\n   * @param  {[type]}    [rows=mandatory()] [description]\n   * @return {[type]}                       [description]\n   */\n  toDataArray(rows = mandatory(), name = null) {\n    if (rows.constructor === Array) {\n      if ((rows.length > 0) && (rows[0].constructor === Object)) {\n        // seems to be a valid dataArray already\n        // TODO do a isValidDataArray function that test every row against the table fields\n        return rows\n      }\n      debugError('DataManager.toDataArray: Row is of invalid format.')\n      return null\n    }\n\n    if (this.isValidRows(rows, name)) {\n      const fields = new Set(Object.keys(rows))\n      const numRows = rows[fields[0]].length\n      const dataArray = []\n      for (let i = 0; i < numRows; i++) {\n        const row = {}\n        for (const field of fields) {\n          if (rows[field].length <= i) {\n            debugError(`DataManager.toDataArray: field array ${field} is of invalid size.`)\n            return null\n          }\n          row[field] = rows[field][i]\n        }\n        dataArray.push(row)\n      }\n\n      return dataArray\n    }\n    debugError('DataManager.toDataArray: Row is of invalid format.')\n    return null\n  }\n\n  toCsv(data = null, format = 'dataObject') {\n    if (data.constructor === String) {\n      if (!(this.hasTable(name))) {\n        debugError(`DataManager.toCsv: Data table with name '${name}' does not exists`)\n        return null\n      }\n      data = this.dataTables[data]\n    }\n\n    data = (format === 'dataObject') ? this.toDataObject(data) : this.toDataArray(data)\n\n    const columnNamesDataTable = Object.keys(data)\n\n    const lineArray = []\n    for (let i = 0; i < columnNamesDataTable[0].length; i++) {\n      const row = []\n      for (let j = 0; j < columnNamesDataTable.length; j++) {\n        row.push(`\"${columnNamesDataTable[j][i]}\"`)\n      }\n      const line = row.join(',')\n      lineArray.push(i === 0 ? `data:text/csv;charset=utf-8,${line}` : line)\n    }\n\n    const csvContent = lineArray.join('\\n')\n\n    return (csvContent)\n  }\n\n  toJSON(data = null, format = 'dataObject') {\n    if (data === null) {\n      data = {}\n      const tableNames = this.tableNames\n      if (format === 'dataArray') {\n        for (const name of tableNames) {\n          data[name] = this.toDataArray(this.dataTables[name])\n        }\n      } else {\n        data = this.dataTables\n      }\n    } else if ((data.constructor === String) && (this.hasTable(data))) {\n      data = this.toDataArray(this.dataTables[data])\n    }\n\n    data = (format === 'dataObject') ? this.toDataObject(data) : this.toDataArray(data)\n\n    return JSON.stringify(data)\n  }\n\n  saveData() { // TODO\n    // Depends the save mode : API (Needs web) // File system (Electron/Node/Meteor) // Database (Electron/Node/Meteor)\n    /* Check if context is node-webkit (native app) */\n    if (typeof require === 'function') {\n      /* node-webkit can be used */\n      // https://github.com/nwjs/nw.js/wiki/Save-persistent-data-in-app\n      try {\n        // require('nwjs-osx-menu')(window)\n      } catch (error) {\n        debugError(error)\n      }\n    } else if (this.restURL) {\n        // $.ajax();\n    }\n  }\n\n  sendData() { // TODO\n    // Websocket (like hackathon)\n    // TTL\n    // Post or get HTTP\n  }\n\n  /* ======= Credentials ======= */\n  login(connection = mandatory(), variables = null, deferred = new Deferred()) {\n    if (deferred.status > this.MAX_NUMBER_OF_RETRY) {\n      deferred.reject('DataManager.login: login failure - reach max retry.')\n    } else {\n      deferred.status += 1\n\n      // an interface needs to have a login endpoint to be used in this function\n      // ((connection.constructor === Object) && (typeof connection.variables !== 'undefined') && (typeof connection.variables.login !== 'undefined') && (connection.variables.login.constructor === String)) {\n      if ((_.has(connection, 'login')) && (connection.login.constructor === String)) {\n        if (variables === null) {\n          return this.login(connection, { userId: 'John', password: 'az4444' }, deferred)// call a smartForm modal with userId and password\n        }\n          // perform ajax with the variables as credentials\n        const data = {\n          interface: connection.type,\n          credentials: variables,\n          query: connection.login,\n        }\n\n          // send the data through ajax in json format\n        $.ajax({\n          url: connection.endpoint,\n          type: 'POST',\n          data: JSON.stringify(data),\n          contentType: 'application/json',\n        })\n          .done(function done(data, status) {\n            // if success set credentials inside the connection\n            connection.credentials = data.credentials\n            if (this.useLocalStorageCredentials) {\n              this.local(connection.name, { credentials: data.credentials })\n            }\n            debuglog(`DataManager.push: successful ajax call with status ${status}`, data)\n            deferred.resolve()\n          }.bind(this))\n          .fail(function (connection, xhr) {\n            // if failure call login with no variables to call a smartForm\n            const json = xhr.responseJSON\n            const message = json.message || ''\n            debugError(`DataManager.push: error during login with message ${message}`)\n            this.login(connection, null, deferred)\n          }.bind(this, connection))\n      }\n    }\n\n\n    return deferred.promise\n  }\n\n  /* ======= Checkpoints ======= */\n  query(query = mandatory(), variables = {}, connection = null, deferred = new Deferred()) {\n    if (deferred.status > this.MAX_NUMBER_OF_RETRY) {\n      deferred.reject('DataManager.query: query failure - reach max retry.', query)\n    } else {\n      deferred.status += 1\n\n      if (connection === null) {\n        if (this.connections.length > 0) {\n          connection = this.connections[0]\n        } else {\n          deferred.reject('DataManager.query: no valid connection available.')\n        }\n      }\n\n      if (connection.type === this.INTERFACE_REST) {\n        // build the data object to send\n        const data = {\n          interface: connection.type,\n          credentials: connection.credentials,\n          query,\n          variables,\n        }\n\n        // send the data through ajax in json format\n        $.ajax({\n          url: connection.endpoint,\n          type: 'POST',\n          data: JSON.stringify(data),\n          contentType: 'application/json',\n        })\n        .done((data, status) => {\n          // once the ajax call is done, check status of http\n          debuglog(`DataManager.push: successful ajax call with status ${status}`, data)\n          deferred.resolve(data)\n        })\n        .fail((xhr) => {\n          const json = xhr.responseJSON || { message: '', shouldLog: false }\n          if (json.shouldLog) {\n            debugError('DataManager.push: user is not logged in -- will call the log function.')\n            this.login(connection).then(() => { this.query(query, variables, connection, deferred) })\n          } else {\n            debugError('DataManager.push: could not perform query -- will retry', json.stringify(query), json.message)\n            this.query(query, variables, connection, deferred)\n          }\n        })\n      } else {\n        deferred.reject('DataManager.query: unsupported connection.')\n      }\n    }\n\n\n    return deferred.promise\n  }\n\n  /* ======= Push ======= */\n\n  /**\n   * Sets or retrieve a variable from local storage in a JSON format\n   * @method local\n   * @param  {string} [variable=null]        variable name, if not specified returns the whole localStorage object\n   * @param  {any} [data=null]               if specified, the variable will be set and not retrieved\n   * @return {!any}                          undefined if set, variable value if get\n   */\n  local(variable = null, data = null) {\n    if (variable === null) {\n      return localStorage\n    }\n\n    if (data !== null) {\n      localStorage[variable] = JSON.stringify(data)\n      return undefined\n    }\n    if (!localStorage.hasOwnProperty(variable)) {\n      debugError(`DataManager.local: localStorage has no variable named ${variable}`)\n      return undefined\n    }\n\n    try {\n      const data = JSON.parse(localStorage[variable])\n      return data\n    } catch (e) {\n      debugError('DataManager.local: variable is probably not JSON ', e)\n    }\n    return localStorage[variable]\n  }\n\n  prepareToPush(...names) {\n    if (names === []) {\n      names = new Set(Object.keys(this.dataTables))\n    }\n\n    this.toPush.unite(names)\n    if (!this.waitForPush) {\n      this.waitForPush = true\n      delay(this.addRate).then(() => {\n        this.push()\n      })\n    }\n    // return Promise.resolve()\n  }\n\n  getStagedData(table = mandatory(), format = 'dataArray') {\n    // check that the table is valid\n    let returned = [[], 0]\n    try {\n      if (!this.tableNames.has(table)) {\n        throw new Error('DataManager.getStagedData: unknown table.')\n      }\n\n      // check if we have a last index, if not set it to 0\n      if (Object.keys(this.tablesLastIndex).indexOf(table) === -1) {\n        this.tablesLastIndex[table] = 0\n      }\n\n      const dataTable = this.dataTables[table]\n      const fields = this.fieldNames(table)\n      const numRows = dataTable[fields.sample()].length\n      const lastIndex = this.tablesLastIndex[table]\n\n      // create a new array with the unpushed data (without cloning the parent array)\n      const data = format === 'dataArray' ? [] : {}\n      let j = 0\n      for (let i = lastIndex; i < numRows; i++) {\n        if (format === 'dataArray') {\n          const row = {}\n          for (const field of fields) {\n            if (field === 'id') continue\n\n            if (dataTable[field].length <= i) {\n              throw new Error(`DataManager.toDataArray: field array ${field} is of invalid size.`)\n            }\n            row[field] = dataTable[field][i]\n          }\n\n          data.push(row)\n        } else {\n          for (const field of fields) {\n            if (field === 'id') continue\n\n            if (!data.hasOwnProperty(field)) {\n              data[field] = []\n            }\n            if (dataTable[field].length <= i) {\n              throw new Error(`DataManager.getStagedData: field ${field} of invalid size in the DataManager.`)\n            }\n            data[field][j].push(dataTable[field][i])\n          }\n          j += 1\n        }\n      }\n      returned = [data, numRows]\n    } catch (e) {\n      debugError(e)\n    } finally {\n      return returned\n    }\n  }\n\n  push() {\n    this.waitForPush = 0\n    for (let i = 0; i < this.connections.length; i++) {\n      const connection = this.connections[i]\n      if (connection.type === this.INTERFACE_REST) {\n        for (const table of this.toPush) {\n          // get last index pushed to the server\n          // get the new data from that index\n          if ((this.useLocalStorageCredentials) && (typeof this.local(connection.name) !== 'undefined') && (this.local(connection.name).hasOwnProperty('credentials'))) {\n            connection.credentials = this.local(connection.name).credentials\n          }\n\n          const [rows, lastIndex] = this.getStagedData(table)\n          const data = {\n            interface: connection.type,\n            credentials: connection.credentials,\n            query: connection.add,\n            variables: {\n              table,\n              rows,\n            },\n          }\n\n          // send the data through ajax in json format\n          $.ajax({\n            url: connection.endpoint,\n            type: 'POST',\n            data: JSON.stringify(data),\n            contentType: 'application/json',\n          })\n          .done(function (table, lastIndex, data, status) {\n            // once the ajax call is done, check status of http\n            // if 200 this.waitForPush = false and update the last updated index\n            // bind a context with the name of the table\n            this.tablesLastIndex[table] = lastIndex\n            this.toPush.delete(table)\n            debuglog(`DataManager.push: successful ajax call with status ${status}`, data)\n          }.bind(this, table, lastIndex))\n          .fail(function (connection, table, xhr) {\n            const json = xhr.responseJSON || { message: '', shouldLog: false }\n            if (json.shouldLog) {\n              debugError('DataManager.push: user is not logged in -- will call the log function.')\n              // will pop a form to log\n              this.login(connection).then(() => { this.prepareToPush(table) })\n            } else {\n              debugError(`DataManager.push: could not push ${table} -- will retry`, json.message)\n              this.prepareToPush(table)\n            }\n          }.bind(this, connection, table))\n        }\n      }\n\n      if (connection.type === this.INTERFACE_GRAPHQL) {\n        //\n      }\n    }\n  }\n\n  setConnection(variables = mandatory()) {\n    const deferred = new Deferred()\n    if ((!variables.hasOwnProperty('type')) || (variables.type === this.INTERFACE_REST)) {\n      const defaultVariables = {\n        type: this.INTERFACE_REST,\n        name: null,\n        endpoint: null,\n        credentials: null,\n        add: this.QUERY_ADD,\n        checkpoint: this.QUERY_CHECKPOINT,\n        login: this.QUERY_LOGIN,\n        // TODO rest of basic api\n      }\n\n      const connection = _.extend(defaultVariables, variables)\n      if (connection.endpoint !== null) {\n        connection.name = connection.name || connection.type\n\n        if (connection.credentials !== null) {\n          this.login(connection, connection.credentials)\n          .then(() => {\n            this.connections.push(connection)\n            deferred.resolve(connection)\n          })\n        } else {\n          this.connections.push(connection)\n          deferred.resolve(connection)\n        }\n      } else {\n        deferred.reject('DataManager.setInterface: needs at least an endpoint.')\n      }\n    } else {\n      deferred.reject('DataManager.setInterface: unsupported connection type.')\n    }\n    return deferred.promise\n  }\n\n  /* ======== Getters and setters ======== */\n\n\n  /**\n   * tableNames - readonly - Set of table names.\n   *\n   * @returns {Set}\n   */\n  get tableNames() {\n    return (new Set(Object.keys(this.dataTables)))\n  }\n\n  set tableNames(value) {\n    throw new Error('DataManager.tableNames: readonly.')\n  }\n\n  /**\n   * globalLog - The complete log since the creation of the DataManager\n   *\n   * @returns {Object}\n   */\n  get globalLog() {\n    return (this._globalLog)\n  }\n\n  set globalLog(value) {\n    throw new Error('DataManager.tableNames: readonly.')\n  }\n\n  /** Integer value of the next id for the global log */\n  get nextLogId() {\n    if (this.globalLog.id.length > 0) {\n      return (_.max(this.globalLog.id) + 1)\n    }\n    return (0)\n  }\n\n\n  set nextLogId(value) {\n    if (value.constructor === String) {\n      this._customNextID = value // TODO to implement\n      console.log(`DataManager: next event 'id' will be ${value}`)\n    } else {\n      throw new Error('DataManager: id should be a string.')\n    }\n  }\n\n}\n\n\n\n// WEBPACK FOOTER //\n// ./src/framework/DataManager.js","/** @module RessourceManager */\nimport $ from 'jquery'\nimport Promise from 'bluebird'\nimport { mandatory, debugError, Deferred } from './utilities'\n\n/* JS Class for ressource management */\nexport default class RessourceManager {\n  /**\n   * RessourceManager - class which allows to load text file in different allowed\n   * format, convert it to javascript objects accessible by proxy allowing for\n   * easy localization and debuging.\n   *\n   * @constructor\n   * @param {...string} filepaths iterable of strings of file paths to load\n   *\n   * @return {RessourceManager}\n   */\n  constructor(...filepaths) {\n    /* --- Set language --- */\n    this.defaultLanguage = 'en'\n    this.currentLanguage = this.defaultLanguage\n\n    /* --- Initialize data --- */\n    this.data = {}\n\n    /* --- Custom parameters --- */\n\n    /**\n     * overwrite - determines default behavior when adding an already existing\n     * variables\n     *\n     * @type {Boolean}\n     */\n    this.overwrite = true\n\n    /**\n     * useAjax - If set to false, files will not be loaded and data can only be added in code\n     * using addDataFamilly, or by directly modifying this.data object.\n     * Useful to make sure local app do not try to use ajax without a server.\n     *\n     * @type {Boolean}\n     */\n    this.useAjax = true\n\n\n    /* --- Register sprecified file paths --- */\n    this.addFiles(filepaths)\n  }\n\n  /* === File management === */\n\n  /**\n   * addFiles - Add all the files listed, then calls for each the load functions\n   * and store it in a promise array.\n   * Returns a Promise.all() that is resolves when all files are loaded, parsed\n   * and stored.\n   *\n   * @param {...string} filepaths iterable of file paths\n   *\n   * @returns {Promise} Promise that will resolve when all files are loaded and\n   *                    processed\n   */\n  addFiles(...filepaths) {\n    if (this.useAjax === false) {\n      throw new Error(\"RessourceManager.addFiles: useAjax set to false - can't add files over the network\")\n    }\n\n    const concatFilepaths = [].concat(...filepaths)\n\n    this.files = []\n    const promises = []\n    for (let i = 0; i < concatFilepaths.length; i++) {\n      if (this.isOfValidFormat(concatFilepaths[i])) {\n        this.files[i] = {}\n        this.files[i].type = this.getFormat(concatFilepaths[i])\n        this.files[i].path = concatFilepaths[i]\n        this.files[i].loaded = false // once the raw string is uncovered\n        this.files[i].validated = false // once data is parse from the raw string\n        this.files[i].added = false // once the parsed data is organized in this.data\n        this.files[i].raw = false\n        this.files[i].data = null\n        promises.push(this.loadFile(i))\n      } else {\n        console.warn(`RessourceManager.addFiles: invalid type for ${concatFilepaths[i]}`)\n      }\n    }\n\n    return Promise.all(promises)\n  }\n\n\n  /**\n   * loadFile - Performs an jQuery ajax call to get the file at specified index\n   * in this.files[fileIndex]. Then call this.parseRaw() on the result.\n   * Returns a promise.\n   *\n   * @param {number} fileIndex Index in the files array\n   *\n   * @returns {Promise} Will resolve when file processed\n   */\n  loadFile(fileIndex = mandatory()) {\n    const deffered = new Deferred()\n\n    if (typeof this.files[fileIndex] === 'undefined') {\n      return deffered.reject('RessourceManager.loadFile: files[fileIndex] is not defined')\n    }\n\n    const thisObject = this\n    $.ajax({\n      type: 'GET',\n      url: this.files[fileIndex].path,\n      crossDomain: true,\n    }).done((data, textStatus, jqXHR) => {\n      thisObject.files[fileIndex].loaded = true\n      thisObject.files[fileIndex].raw = data\n\n      try {\n        thisObject.parseRaw(fileIndex)\n      } catch (e) {\n        deffered.reject(e)\n      } finally {\n        deffered.resolve(`RessourceManager.loadFile: ${thisObject.files[fileIndex].path} parsed`)\n      }\n    })\n\n    return deffered.promise\n  }\n\n  parseRaw(fileIndex = mandatory()) {\n    if (typeof this.files[fileIndex] === 'undefined') {\n      throw new Error('RessourceManager.parseRaw: files[fileIndex] is not defined')\n    }\n\n    const file = this.files[fileIndex]\n\n    if (file.raw === null) {\n      throw new Error('RessourceManager.parseRaw: file.raw is null or not validated')\n    } else if (file.raw.constructor === String) {\n      let parser\n      let arg = null\n      switch (file.type) {\n        case 'json':\n        // read json\n          parser = JSON.parse\n          break\n        case 'csv':\n        // read csv\n          parser = $.csv.toObjects\n          break\n        case 'xml':\n        // read xml\n          if (window.DOMParser) {\n            parser = new DOMParser()\n            parser = parser.parseFromString\n            arg = 'text/xml'\n          } else {\n            // Internet Explorer\n            parser = new window.ActiveXObject('Microsoft.XMLDOM')\n            parser.async = false\n            parser = parser.loadXML\n          }\n          break\n        default:\n          throw new Error('RessourceManager.parseRaw: file.type is null or not validated')\n      }\n\n      try {\n        if (arg) {\n          file.data = parser(file.raw, arg)\n        } else {\n          file.data = parser(file.raw)\n        }\n      } catch (e) {\n        file.validated = false\n        file.data = null\n        throw new Error(e)\n      } finally {\n        // file has been correctly parsed and stored in object format\n        file.validated = true\n\n        // when a file is parsed, merge the new data\n        this.processParsed()\n      }\n    } else if (file.raw.constructor === Object) {\n      file.data = file.raw\n      // file has been correctly parsed and stored in object format\n      file.validated = true\n\n      // when a file is parsed, merge the new data\n      this.processParsed()\n    } else {\n      throw new Error('RessourceManager.parseRaw: invalid file.raw format')\n    }\n  }\n\n  processParsed() {\n    // first level are data famillies e.g strings, constants, ids, flags etc...\n    for (let i = 0; i < this.files.length; i++) {\n      if ((this.files[i].validated !== false) && (this.files[i].data) && (!this.files[i].added)) {\n        const data = this.files[i].data\n        const keys = Object.keys(data)\n        for (let j = 0; j < keys.length; j++) {\n          this.addDataFamilly(keys[j], data[keys[j]])\n        }\n\n        this.files[i].added = true\n      }\n    }\n  }\n\n\n  /**\n   * addDataFamilly - adds the familly if does not exist to the data set, then\n   * extend it with the data.\n   *\n   * @param {String}  familly          Familly name\n   * @param {Object}  data             Each property of this object is a variable\n   *                                   name\n   * @param {Boolean} [overwrite=null] If overwrite is set to true, new values\n   *                                   overwrites old one, if false only new\n   *                                   variables are kept.\n   *\n   * @returns {undefined}\n   */\n  addDataFamilly(familly = mandatory(), data = mandatory(), overwrite = null) {\n    let toAdd = data\n    let id\n    if (data.constructor !== Object) { // If the data is not an object: organize by type\n      id = familly\n      familly = `${data.constructor.name.toLowerCase()}s`\n      toAdd = {\n        [id]: data,\n      }\n    }\n\n    if (typeof this.data[familly] === 'undefined') {\n      this.data[familly] = {}\n    }\n\n    if (overwrite === null) {\n      overwrite = this.overwrite\n    }\n\n    if (overwrite) {\n      this.data[familly] = this.extend(this.data[familly], toAdd)\n    } else {\n      this.data[familly] = this.extend(toAdd, this.data[familly])\n    }\n  }\n\n\n  /**\n   * getNextId - Returns the lenght of the specified familly\n   *\n   * @param {string} familly\n   *\n   * @returns {number} 0 if the familly does not exist, the total number of keys otherwise.\n   */\n  getNextId(familly = mandatory()) {\n    if (this.data.hasOwnProperty(familly)) {\n      return Object.keys(this.data[familly]).length\n    }\n    return 0\n  }\n\n\n  /**\n   * add - Parse and add the object to the data.\n   *\n   * @param {Object}  object  Object with either variables at the root\n   * e.g {variable: \"example\"} or with familly name at the root e.g\n   * {familly : { variable: \"example\"}}\n   * @param {Boolean} [overwrite=null]  If overwrite is set to true,\n   * new values overwrites old one, if false only new variables are kept.\n   *\n   * @returns {undefined}\n   */\n  add(object = mandatory(), overwrite = null) {\n    if (object.constructor !== Object) {\n      throw new Error('RessourceManager.add: cannot add data from a non object')\n    }\n    const oldOverwrite = this.overwrite\n    if (overwrite === null) {\n      overwrite = oldOverwrite\n    } else {\n      this.overwrite = overwrite\n    }\n\n    const keys = Object.keys(object)\n    for (let i = 0; i < keys.length; i++) {\n      if (object[keys[i]].constructor === Object) {\n        this.addDataFamilly(keys[i], object[keys[i]])\n      } else if (object[keys[i]].constructor === Array) {\n        this.addByName(keys[i], object[keys[i]], 'arrays')\n      } else {\n        this.addByName(keys[i], object[keys[i]])\n      }\n    }\n\n    this.overwrite = oldOverwrite\n  }\n\n\n  /**\n   * addByName - Add a single variable to the data with specified name and value,\n   * in the specified familly. If no familly is specified, using strings.\n   *\n   * @param {string} name              Variable name\n   * @param {object} value             Variable value\n   * @param {string} [familly=strings] Familly name\n   * @param {null}   [overwrite=null]  If overwrite is set to true,new values\n   *                                   overwrites old one, if false only new\n   *                                   variables are kept.\n   *\n   * @returns {undefined}\n   */\n  addByName(name = mandatory(), value = mandatory(), familly = 'strings', overwrite = null) {\n    if (typeof this.data[familly] === 'undefined') {\n      this.data[familly] = {}\n    }\n\n    if (overwrite === null) {\n      overwrite = this.overwrite\n    }\n\n    if (!(this.data[familly].hasOwnProperty(name)) || overwrite) {\n      console.warn(`RessourceManager.addByName: already a ressource named ${name} - Overwriting it.`)\n      this.data[familly][name] = value\n    }\n  }\n\n  /**\n   * getFormat - Returns the extension of the file in filepath or an empty string\n   * if no etension is found\n   *\n   * @param {string} filepath\n   *\n   * @returns {string}\n   */\n  getFormat(filepath = mandatory()) {\n    // fancy way of making sure we substr(index) with\n    // index >>> filepath.lenght if no . is found\n    // from http://stackoverflow.com/questions/190852/how-can-i-get-file-extensions-with-javascript/1203361#1203361\n    return filepath.substr((~-filepath.lastIndexOf('.') >>> 0) + 2) // eslint-disable-line\n  }\n\n  isOfValidFormat(filepath = mandatory()) {\n    const validFormats = ['json', 'csv', 'xml']\n    if (validFormats.indexOf(this.getFormat(filepath)) !== -1) {\n      return true\n    }\n    return false\n  }\n\n  /**\n   * mergeWith - Merge current data with another RessourceManager. Duplicated\n   * keys gets overwritten by those of the other RessourceManager.\n   *\n   * @param {RessourceManager} ressourceManager Another RessourceManager to merge\n   *\n   */\n  mergeWith(ressourceManager = mandatory()) {\n    if (ressourceManager.constructor !== RessourceManager) {\n      throw new Error('RessourceManager.mergeWith: specified ressourceManager is not of class RessourceManager.')\n    }\n\n    const currentFamillies = this.famillies\n    const mergingFamillies = ressourceManager.famillies\n\n    for (let i = 0; i < mergingFamillies.length; i++) {\n      if (currentFamillies.indexOf(mergingFamillies[i]) === -1) {\n        this.data[mergingFamillies[i]] = ressourceManager.data[mergingFamillies[i]]\n      } else {\n        this.data[mergingFamillies[i]] = this.extend(this.data[mergingFamillies[i]], ressourceManager.data[mergingFamillies[i]])\n      }\n    }\n  }\n\n\n  /**\n   * lookFor - Looks for a variable name in all the famillies\n   *\n   * @param {string} variable variable to look for\n   *\n   * @returns {?object} data[familly][variable] if found, or undefined\n   */\n  lookFor(...variable) {\n    let result\n    if (variable.length === 1) {\n      if (this.data.hasOwnProperty(variable)) {\n        result = this.data[variable]\n      } else {\n        const famillies = this.famillies\n        for (let i = 0; i < famillies.length; i++) {\n          if (this.data[famillies[i]].hasOwnProperty(variable)) {\n            result = this.data[famillies[i]][variable]\n            break\n          }\n        }\n      }\n    } else if (variable.length > 1) {\n      result = {}\n      for (let i = 0; i < variable.length; i++) {\n        result[variable[i]] = this.lookFor(variable[i])\n      }\n    }\n\n    return result\n  }\n\n\n  /**\n   * Pass in the objects to merge as arguments.\n   * For a deep extend, set the first argument to `true`.\n   * Adapted from JQuery haters :\n   * https://gomakethings.com/vanilla-javascript-version-of-jquery-extend/\n   *\n   * @param {array} args list of objects to extend. If first arguemnt is true, a deep\n   * copy is performed.\n   *\n   * @returns {type} Description\n   */\n  extend(...args) {\n    // Variables\n    const extended = {}\n    let deep = false\n    let i = 0\n    const length = args.length\n\n    // Check if a deep merge\n    if (Object.prototype.toString.call(args[0]) === '[object Boolean]') {\n      deep = args[0]\n      i += 1\n    }\n\n    // Merge the object into the extended object\n    const merge = function (obj) {\n      for (const prop in obj) {\n        if (Object.prototype.hasOwnProperty.call(obj, prop)) {\n          // If deep merge and property is an object, merge properties\n          if (deep && Object.prototype.toString.call(obj[prop]) === '[object Object]') {\n            extended[prop] = this.extend(true, extended[prop], obj[prop])\n          } else {\n            extended[prop] = obj[prop]\n          }\n        }\n      }\n    }\n\n    // Loop through each object and conduct a merge\n    for (; i < length; i++) {\n      const obj = args[i]\n      merge(obj)\n    }\n\n    return extended\n  }\n\n\n  /**\n   * famillies - Description\n   *\n   * @returns {type} Description\n   */\n  get famillies() {\n    return Object.keys(this.data)\n  }\n\n  get has() {\n    return new Proxy(this, {\n      get(target, pathString) {\n        if (typeof target.get[pathString] === 'undefined') {\n          return false\n        }\n        return true\n      },\n    })\n  }\n\n  get get() {\n    return new Proxy(this, {\n      get(target, pathString) {\n        const path = pathString.split('_')\n        const famillies = target.famillies\n        let lookForLanguage = target.currentLanguage\n        let lookForFamilly = 'strings'\n        let lookForVariable\n        let couldSwapForVariable = false\n        for (let i = 0; i < path.length; i++) {\n          if (famillies.indexOf(path[i]) !== -1) {\n            lookForFamilly = path[i]\n            couldSwapForVariable = true\n          } else if (path[i].length === 2) {\n            lookForLanguage = path[i]\n          } else {\n            if (typeof lookForVariable !== 'undefined') {\n              console.error(`RessourceManager.get: at least two possible variable names into path: ${lookForVariable} and ${path[i]}`)\n              return undefined\n            }\n            lookForVariable = path[i]\n          }\n        }\n\n        if (typeof lookForVariable === 'undefined') {\n          if (couldSwapForVariable) {\n            lookForVariable = lookForFamilly\n          } else {\n            debugError(`RessourceManager.get: no variable name found in ${pathString}`)\n            return undefined\n          }\n        }\n\n        let result\n        if ((target.data.hasOwnProperty(lookForFamilly)) && (target.data[lookForFamilly].hasOwnProperty(lookForVariable))) {\n          result = target.data[lookForFamilly][lookForVariable]\n        } else {\n          result = target.lookFor(lookForVariable)\n          if (typeof result === 'undefined') {\n            console.error(`RessourceManager.get: no ressource for path ${lookForFamilly}.${lookForVariable}`)\n            return undefined\n          }\n        }\n\n        if (result.constructor !== Object) {\n          return result\n        } else if (result.hasOwnProperty(lookForLanguage)) {\n          return result[lookForLanguage]\n        } else if (result.hasOwnProperty(target.currentLanguage)) {\n          console.warn(`RessourceManager.get: no valid language, defaulting to ${target.currentLanguage}`)\n          return result[target.currentLanguage]\n        }\n        console.warn('RessourceManager.get: no localization language found, returning the whole object')\n        return result\n      },\n\n    })\n  }\n\n\n}\n\n\n\n// WEBPACK FOOTER //\n// ./src/framework/RessourceManager.js","\n/** @module State */\nimport _ from 'lodash'\nimport Promise from 'bluebird'\nimport EventData from './EventData'\nimport { mandatory, debuglog, debugWarn, debugError, mustBeDefined, mustHaveConstructor } from './utilities'\n\n/* State object has a specific way to handle input and update objects */\nexport default class State {\n\n\n  /**\n   * @constructor\n   * @param {object} [stateManager]\n   * @param {string} [stateKey]\n   */\n  constructor(stateManager = mandatory(), stateKey = mandatory()) {\n    this._stateManager = stateManager\n    this._parent = stateManager._parent\n    this._dataManager = stateManager._dataManager\n\n    this.stateKey = stateKey\n\n    /**\n     * Object in which properties names are handling function to be called for specific events.\n     * The key of those properties are the event flags. Handling functions should return a Promise.\n     * @type {Object}\n     */\n    this._eventFunctions = {}\n\n    /**\n     * Array of handling function to be called when the state awaken, just after state change.\n     * This is where redrawing should go. Handling functions should return a Promise.\n     * @type {Array}\n     * @private\n     */\n    this._awakeningFunctions = []\n\n    /**\n     * Array of handling functions to be called when the state is dismissed, just before the state change.\n     * Handling functions should return a Promise.\n     * @type {Array}\n     * @private\n     */\n    this._endingFunctions = []\n\n    /**\n     * Array of functions that are to be called upon each updates.\n     * Those functions should return a Promise.\n     * @type {Array}\n     */\n    this._updateFunctions = []\n\n    /**\n     * Array of stored timed event in case of state freezing\n     * @type {Array}\n     */\n    this._frozenEvents = []\n\n    /**\n     * Timestamp of frozen time. Value is null if the state is not frozen.\n     * @type {int}\n     */\n    this._frozenAt = null\n\n    /**\n     * Constant. When unfreezing if the time difference etween happenedAt and the current timeInMs is less than\n     * this value, the event is directly added to the event heap. Else it is treated as a tigger event.\n     * @type {Number}\n     */\n    this.FREEZE_DELAY = 50\n  }\n\n  /* ======== Class Methods ======== */\n\n  /* === Lifecycle hook functions === */\n\n  /**\n   * Function called at state awakening.\n   * All functions of the _awakeningFunctions array will be called, they must return a Promise.\n   */\n  awake(reload = false) {\n    if (reload) {\n      if (this._frozenAt !== null) {\n        this._frozenAt = null\n        this._frozenEvents = []\n        this.stateManager.stateWasUnfreezed(this.stateKey)\n      }\n      // NOTE Might have other things to do here...\n    }\n\n    /* --- If state was frozen unfreeze it but do not re-awake --- */\n    if (this._frozenAt !== null) {\n      this.unfreeze()\n    } else {\n      if (typeof this._parent.sceneKey !== 'undefined') { debuglog(`${this.stateKey} of scene ${this._parent.sceneKey} awaken.`) }\n\n      const calledFunctions = []\n      for (let i = 0; i < this._awakeningFunctions.length; i++) {\n        calledFunctions[i] = Promise.method(this._awakeningFunctions[i].bind(this.context))()\n      }\n\n      Promise.all(calledFunctions).then(() => {\n        /* Promise ran as expected, returned data */\n        debuglog('State: Awakening functions completed as expected.', calledFunctions)\n      }).catch((error) => {\n        /* an error occured */\n        debugError(error)\n      })\n    }\n  }\n\n  /**\n   * Function called when state ends, just before state change.\n   * All functions of the _endingFunctions array will be called, they must return a Promise.\n   */\n  end() {\n    if (this._frozenAt === null) {\n      const calledFunctions = []\n      for (let i = 0; i < this._endingFunctions.length; i++) {\n        calledFunctions[i] = Promise.method(this._endingFunctions[i].bind(this.context))()\n      }\n\n      Promise.all(calledFunctions).then((data) => {\n      /* Promise ran as expected, returned data */\n        debuglog('State: Ending functions completed as expected.', calledFunctions)\n        debuglog(`${this.stateKey} ended.`)\n        return data\n      }).catch((error) => {\n      /* an error occured */\n        debugError(error)\n        return null\n      })\n    }\n  }\n\n  update() {\n    if ((this._frozenAt === null) && (this._stateManager._eventHeap.length)) {\n      let nextEvent\n      const events = this._stateManager.spliceEventsForState(this.stateKey)\n      for (let i = 0; i < events.length; i++) {\n        nextEvent = events[i]\n        debuglog(`State: first event is ${nextEvent.flag}`)\n\n        this.handleEvent(nextEvent)\n      }\n      // while (events.length) {\n      //   nextEvent = his._stateManager.getFirstEventAndRemoveFromHeap(this.stateKey)\n      //   if (typeof nextEvent === 'undefined') {\n      //     debuglog('State.update: first event is undefined. Probably bc not meant for this state.') // TODO not good do better\n      //     break\n      //   }\n      // }\n\n      // if (typeof this._updateFunctions !== 'undefined') {\n      //\n    }\n\n    // debuglog(this.stateKey + \" updated.\");\n  }\n\n  /* === Event based functions === */\n\n  handleEvent(event) {\n    // for each input flag have a specific function ready - that can be customizable\n    // rename input with Event ?\n    // make a promise and chain it with .then(stateHasFinishedHandlingEvent())\n    if (this.hasEventFunction(event.flag)) {\n      /* Promise allow for assynchronous handling of events */\n      const eventFunctions = this._eventFunctions[event.flag]\n      if (eventFunctions.constructor === Array) {\n        for (let i = 0; i < eventFunctions.length; i++) {\n          Promise.method(eventFunctions[i].bind(this.context))(event)\n            .then(function (functionName, data) {\n              /* Promise ran as expected, returned data */\n              debuglog(data)\n              const eventClone = _.cloneDeep(event)\n              eventClone.data.handlingFunction = functionName\n              this._stateManager.stateHasFinishedHandlingEvent(eventClone)\n            }.bind(this, eventFunctions[i].name))\n            .catch((error) => {\n              /* an error occured */\n              debugError(error)\n            })\n        }\n      } else {\n        Promise.method(eventFunctions.bind(this.context))()\n          .then(function (functionName, data) {\n            /* Promise ran as expected, returned data */\n            debuglog(data)\n            const eventClone = _.cloneDeep(event)\n            eventClone.data.handlingFunction = functionName\n            this._stateManager.stateHasFinishedHandlingEvent(eventClone)\n          }.bind(this, eventFunctions.name))\n          .catch((error) => {\n            /* an error occured */\n            debugError(error)\n          })\n      }\n    } else {\n      this._stateManager.stateHasFinishedHandlingEvent(event)\n      debuglog(`State: Event '${event.flag}' not handled by state '${this.stateKey}'`)\n    }\n  }\n\n  freeze() {\n    const stateManager = this._stateManager\n\n    this._frozenAt = stateManager.timeInMs\n    this._frozenEvents = stateManager.getAllEvents()\n    debugWarn(this._frozenEvents)\n    stateManager.stateWasFrozen(this.stateKey) // TODO: make sure only one state can be frozen ? or add multiple frozen thingy\n  }\n\n  unfreeze() {\n    if (this._frozenAt === null) {\n      debugWarn('State.unfreeze: state was not frozen')\n      return\n    }\n\n    const stateManager = this._stateManager\n    const frozenEvents = this._frozenEvents\n\n    for (let i = 0; i < frozenEvents.length; i++) {\n      if (frozenEvents[i].constructor === EventData) {\n        frozenEvents[i].happenedAt += stateManager.timeInMs - this._frozenAt\n        if ((frozenEvents[i].happenedAt - stateManager.timeInMs) > this.FREEZE_DELAY) {\n          stateManager.addTimeTriggerEvent(frozenEvents[i])\n          console.log('timetrigger')\n          debugWarn(frozenEvents[i])\n        } else {\n          stateManager.addEvent(frozenEvents[i])\n          console.log('added event')\n          debugWarn(frozenEvents[i])\n        }\n      }\n    }\n\n    this._frozenAt = null\n    this._frozenEvents = []\n    stateManager.stateWasUnfreezed(this.stateKey) // TODO: make sure only one state can be frozen ? or add multiple frozen thingy\n  }\n\n  /* = Main functions = */\n  // TODO Use Promise.method\n  // TODO Change all _eventFunctions to arrays\n  registerEventFunctions(eventFlag, overwrite, ...handlingFunctions) {\n    mustBeDefined(eventFlag, overwrite, ...handlingFunctions)\n    mustHaveConstructor(Function, ...handlingFunctions)\n\n    // checks if functions should be stacked in an array for this flag\n    if (this.hasEventFunction(eventFlag)) {\n      if (this._eventFunctions[eventFlag].constructor === Array) {\n        // push the handlingFunction to the array of _eventFunctions[eventFlag]\n        this._eventFunctions[eventFlag] = this._eventFunctions[eventFlag].concat(handlingFunctions)\n        debuglog(`State ${this.stateKey}: several handling functions - handling function pushed to the array of event functions on event '${eventFlag}'`)\n      } else {\n        // creates array of event function\n        this._eventFunctions[eventFlag] = [this._eventFunctions[eventFlag]].concat(handlingFunctions)\n        debuglog(`State ${this.stateKey}: several handling functions - array created for handling functions for state on event '${eventFlag}'`)\n      }\n    } else {\n      this._eventFunctions[eventFlag] = handlingFunctions\n      debuglog(`State ${this.stateKey}: handling function added to state '${this.stateKey}' for event '${eventFlag}'`)\n    }\n  }\n\n  registerCycleFunctions(cycle, overwrite, ...handlingFunctions) {\n    mustBeDefined(cycle, overwrite, ...handlingFunctions)\n    mustHaveConstructor(Function, ...handlingFunctions)\n\n    let arrayName\n    switch (cycle) {\n      case 'awakening':\n        arrayName = '_awakeningFunctions'\n        break\n      case 'ending':\n        arrayName = '_endingFunctions'\n        break\n      case 'update':\n        arrayName = '_updateFunctions'\n        break\n      default:\n        throw new Error('State.registerCycleFunctions: Invalid cycle parameter.')\n    }\n\n    if (overwrite) {\n      this[arrayName] = handlingFunctions\n      debuglog(`State ${this.stateKey}: handling function overwrited ${arrayName}`)\n    } else {\n      this[arrayName] = this[arrayName].concat(handlingFunctions)\n      debuglog(`State ${this.stateKey}: handling function added to ${arrayName} array for state '${this.stateKey}'`)\n    }\n  }\n\n  /* = Short handle = */\n\n  /**\n   * Short hand function that adds several events using the handlingFunctions name as handle.\n   * @param [...function] handlingFunctions\n   */\n  addHandledEvents(...handlingFunctions) {\n    mustBeDefined(...handlingFunctions)\n    mustHaveConstructor(Function, ...handlingFunctions)\n\n    for (let i = 0; i < handlingFunctions.length; i++) {\n      this.registerEventFunctions(handlingFunctions[i].name, true, handlingFunctions[i])\n    }\n  }\n\n  addEventFunctions(eventFlag, ...handlingFunctions) {\n    mustBeDefined(eventFlag, ...handlingFunctions)\n    mustHaveConstructor(Function, ...handlingFunctions)\n    this.registerEventFunctions(eventFlag, false, ...handlingFunctions)\n  }\n\n  overwriteEventFunctions(eventFlag, ...handlingFunctions) {\n    mustBeDefined(eventFlag, ...handlingFunctions)\n    mustHaveConstructor(Function, ...handlingFunctions)\n    this.registerEventFunctions(eventFlag, true, ...handlingFunctions)\n  }\n\n  addAwakeningFunctions(...handlingFunctions) {\n    mustBeDefined(...handlingFunctions)\n    mustHaveConstructor(Function, ...handlingFunctions)\n\n    this.registerCycleFunctions('awakening', false, ...handlingFunctions)\n  }\n\n  overwriteAwakeningFunctions(...handlingFunctions) {\n    mustBeDefined(...handlingFunctions)\n    mustHaveConstructor(Function, ...handlingFunctions)\n\n    this.registerCycleFunctions('awakening', true, ...handlingFunctions)\n  }\n\n  overwriteEndingFunction(...handlingFunctions) {\n    mustBeDefined(...handlingFunctions)\n    mustHaveConstructor(Function, ...handlingFunctions)\n\n    this.registerCycleFunctions('ending', true, ...handlingFunctions)\n  }\n\n  addEndingFunctions(...handlingFunctions) {\n    mustBeDefined(...handlingFunctions)\n    mustHaveConstructor(Function, ...handlingFunctions)\n\n    this.registerCycleFunctions('ending', false, ...handlingFunctions)\n  }\n\n  overwriteUpdateFunctions(...handlingFunctions) {\n    mustBeDefined(...handlingFunctions)\n    mustHaveConstructor(Function, ...handlingFunctions)\n\n    this.registerCycleFunctions('udpate', false, ...handlingFunctions)\n  }\n\n  addUpdateFunctions(...handlingFunctions) {\n    mustBeDefined(...handlingFunctions)\n    mustHaveConstructor(Function, ...handlingFunctions)\n\n    this.registerCycleFunctions('udpate', false, ...handlingFunctions)\n  }\n\n\n  hasEventFunction(eventFlag = mandatory()) {\n    return (_.has(this._eventFunctions, eventFlag))\n  }\n\n\n  /* ======= Getters / Setters ======= */\n  /* === Globals getter / setter === */\n  getGlobal(name = mandatory()) {\n    return (this._stateManager.getGlobal(name))\n  }\n\n  setGlobal(name = mandatory(), value = mandatory()) {\n    return (this._stateManager.setGlobal(name, value))\n  }\n\n  get context() {\n    if (this._stateManager._taskObject) {\n      return (this._stateManager._taskObject.getContext(this))\n    }\n    return ({\n      taskObject: null,\n      dataManager: this._stateManager._dataManager,\n      scene: this._parent, // TODO Force the ._parent to be the .scene ?\n      stateManager: this._stateManager,\n      state: this,\n      R: this._stateManager.R,\n    })\n  }\n\n}\n\n\n\n// WEBPACK FOOTER //\n// ./src/framework/State.js","\n/** @module StateManager */\nimport _ from 'lodash'\nimport BABYLON from 'experiment-babylon-js'\nimport Promise from 'bluebird'\n\nimport RessourceManager from './RessourceManager'\nimport State from './State'\nimport DataManager from './DataManager'\nimport EventData from './EventData'\nimport { mandatory,\n  debuglog, debugWarn, debugError, mustBeDefined, mustHaveConstructor,\n  spreadToObject, Deferred, delay,\n  sizeToVec,\n  scaleSize,\n} from './utilities'\n\n/**\n * Manage lifecycle and variables through State objects.\n * Can dispatch information to the DataManager.\n * TODO check documentation style for es6 modules\n */\nexport default class StateManager {\n\n  /**\n   * @constructor\n   * @param  {object} parent       Parent  object\n   * @param  {DataManager} dataManager The task dataManager\n   */\n  constructor(parent = mandatory('parent'), dataManager = null) {\n    this._parent = parent\n    this.dataManager = dataManager\n\n    /* --- Look for taskObject and setup RessourceManager accordingly --- */\n    if (typeof parent.parentTaskObject !== 'undefined') {\n      this._taskObject = parent.parentTaskObject\n      this.R = this._taskObject.R\n    } else {\n      this.R = new RessourceManager()\n    }\n\n    const R = this.R\n\n    /**\n     * Array of Data\n     * @type {Array}\n     */\n    this._eventHeap = []\n\n    /**\n     * Stores temporary time triggered event. The update() function checks at each frame if the event should be triggered.\n     * @type {Array}\n     */\n    this._timeTriggerEvents = []\n\n    //\n    // Notes :\n    // 1- should we handle events assynchronously... what is the best way to implement it ?\n    // 2- event related to the awakening or ending of states should not go in the event heap, probably due to redraawing that might lag.\n    //\n\n    this.errorLog = []\n\n    this.R.add({\n      states: {\n        idle: 'idle',\n        pause: 'pause',\n        active: 'active',\n      },\n      values: {\n        timestampThreshold: 10e7,\n      },\n    }, false)\n\n    /*  Hash table of state objects */\n    this.states = {\n      idle: new State(this, R.get.states_idle),\n      active: new State(this, R.get.states_active),\n      pause: new State(this, R.get.states_pause),\n    }\n\n    this._currentStateKey = R.get.states_idle\n\n    /**\n     * Statekey of the current frozenState. If null, no state were frozen.\n     * @type {string}\n     */\n    this.frozenState = null\n\n    /**\n     * Holds variables that needs to be passed from one state to the next.\n     * @type {Object}\n     */\n    this.globals = {}\n\n    this.globalFunctions = {}\n  }\n\n  /* ======== Class methods ======== */\n  update() {\n    /* --- Checks if some _timeTriggerEvents should be added to the heap --- */\n    for (let i = 0; i < this._timeTriggerEvents.length; i++) {\n      if (this.timeInMs >= this._timeTriggerEvents[i].happenedAt) {\n        this._timeTriggerEvents[i].happenedAt = this.timeInMs // correct for fps delay\n        this.addEvent(this._timeTriggerEvents[i])\n        this._timeTriggerEvents.splice(i)\n      }\n    }\n\n    /* --- Update the state --- */\n    this.currentState.update()\n  }\n\n  storeEvent(event = mandatory()) {\n    try {\n      if (this.dataManager.constructor !== DataManager) {\n        throw new Error('StateManager.storeEvent: dataManager is not set, cannot store event.')\n      }\n\n      if (!event.handled) {\n        debuglog(event)\n        throw new Error('StateManager.storeEvent:cannot store an event that was not handled.')\n      }\n\n      if (event.stored) {\n        debuglog(event)\n        throw new Error('StateManager.storeEvent: Event already stored')\n      }\n\n      event.storedInErrorLog = false\n      let belongsTo = event.data.belongsTo\n      if (belongsTo.constructor !== Array) {\n        belongsTo = [belongsTo]\n      }\n\n      for (let i = 0; i < belongsTo.length; i++) {\n        try {\n          event.data.storedAt = this.timeInMs\n          event.stored = true\n\n          debuglog('StateManager.storeEvent: storing event.')\n          // this.dataManager.log(belongsTo[i], event)\n          this.dataManager.addRows(belongsTo[i], event.formatted)\n          debuglog('StateManager.storeEvent: event stored.', event)\n        } catch (error) {\n          debugError(`StateManager.storeEvent: Could not store data in ${belongsTo[i]} dataTable. Data was stored in the errorLog. DataManager error was: ${error}`)\n          this.storeInErrorLog(event)\n        }\n      }\n    } catch (e) {\n      debugError(e)\n    }\n  }\n\n  storeData(data = mandatory()) {\n    try {\n      if (this.dataManager.constructor !== DataManager) {\n        throw new Error('StateManager.storeData: dataManager is not set, cannot store event.')\n      }\n\n      if (!(_.has(data, 'belongsTo'))) {\n        debuglog(data)\n        throw new Error('StateManager: data needs a belongsTo property in order to store it in the dataManager.')\n      }\n\n      data.storedInErrorLog = false\n      for (let i = 0; i < data.belongsTo.length; i++) {\n        try {\n          this.dataManager.addRows(data.belongsTo[i], data)\n        } catch (error) {\n          console.error(`StateManager: Could not store data in ${data.belongsTo[i]} dataTable. Data was stored in the errorLog. DataManager error was: ${error}`)\n          this.storeInErrorLog(data)\n        }\n      }\n    } catch (e) {\n      debugError(e)\n    }\n  }\n\n  storeInErrorLog(data = mandatory()) {\n    if (data.storedInErrorLog === false) {\n      data.storedInErrorLog = true\n      this.errorLog = this.errorLog.concat(data)\n      debuglog('StateManager: data stored in the errorLog.')\n    } else {\n      debugWarn('StateManager: data already stored in errorLog. Did not store it again.')\n    }\n  }\n\n  /* === State management === */\n\n  /**\n   * Adds a new state with specified stateKey.\n   * If a list of several states is specified, the function returns an array.\n   *\n   * @param {...string} stateKeys list of additional state\n   */\n  addState(...stateKeys) {\n    try {\n      const returnedStates = []\n      let stateKey\n      for (let i = 0; i < stateKeys.length; i++) {\n        stateKey = stateKeys[i]\n\n        if (stateKey.constructor !== String) {\n          throw new Error('StateManager: stateKey must be a string.')\n        }\n\n        if (_.has(this.states, stateKey)) {\n          throw new Error(`StateManager: a state with a similar stateKey '${stateKey}' already exists.`)\n        }\n\n        this.states[stateKey] = new State(this, stateKey)\n\n        debuglog(`StateManager: added state '${stateKey}'.`)\n\n        returnedStates.push(this.states[stateKey])\n      }\n\n      return (returnedStates.length === 1) ? returnedStates[0] : returnedStates\n    } catch (e) {\n      debugError(e)\n      return null\n    }\n  }\n\n  /* === State change === */\n  goToState(key = mandatory(), reload = false) {\n    if (_.has(this.states, key)) {\n      this.currentState.end()\n\n      this._currentStateKey = key\n      this.states[key].awake(reload)\n    } else {\n      debugError('StateManager: Invalid state key.')\n    }\n  }\n\n  /* ======= Interface ======= */\n  /* */\n\n\n  /**\n   * addGuiCanvas - Create a GUI Canvas always on top with a zOrder of -1\n   *\n   * @param {null} [scene=null] scene object\n   *\n   * @returns {BABYLON.ScreenSpaceCanvas2D} GUI canvas\n   */\n  addGuiCanvas() {\n    try {\n      const scene = this._parent\n      mustHaveConstructor(BABYLON.Scene, scene)\n\n      const canvasOptions = {\n        id: 'GUI',\n        backgroundFill: BABYLON.Canvas2D.GetSolidColorBrush(new BABYLON.Color4(0, 0, 0, 0)),\n        backgroundRoundRadius: 0,\n        x: 0,\n        y: 0,\n        zOrder: 1,\n      }\n\n      const GUI = new BABYLON.ScreenSpaceCanvas2D(scene, canvasOptions)\n\n      GUI.levelVisible = false\n      this.set('GUI', GUI)\n\n      return GUI\n    } catch (e) {\n      debugError(e)\n      return null\n    }\n  }\n\n  // TODO tooltip on the GUI to highlight specific positions\n  tooltip({ position = null, size = null, spaced = null, text = '', fontName = '14pt Verdana', duration = null, background = null, fontColor = null }) {\n    // Set the default\n    spaced = spreadToObject(spaced, new BABYLON.Vector2(0, 0))\n    if ((duration === null) || (duration.constructor !== Promise)) {\n      if ((duration !== null) && (duration.constructor === Number)) {\n        duration = delay(duration)\n      } else {\n        duration = (new Deferred()).promise\n      }\n    }\n\n    const guiCanvas = this.get('GUI')\n    guiCanvas.levelVisible = true\n\n\n    let tooltip = this.get('tooltip')\n\n    let id = 0\n    if (tooltip === null) {\n      position = spreadToObject(position, new BABYLON.Vector2(0, 0))\n\n      const sizeDefault = spreadToObject(size, new BABYLON.Size(300, 300))\n\n      // const normalColor = [202 / 255, 64 / 255, 0, 0.95]\n      const brownColor = [112 / 255, 102 / 255, 98 / 255, 0.95]\n      let fontSuperSample = true\n      let fontSignedDistanceField = false\n      if (background === null) {\n        fontSuperSample = false\n        fontSignedDistanceField = true\n      }\n      background = spreadToObject(background, new BABYLON.Color4(...brownColor))\n      fontColor = spreadToObject(fontColor, new BABYLON.Color4(1, 1, 1, 1))\n\n      const brush = BABYLON.Canvas2D.GetSolidColorBrush(background)\n\n      const tooltipBox = new BABYLON.Rectangle2D({\n        parent: guiCanvas,\n        id: 'tooltipBox',\n        // position: position.subtract(size.scale(0.5).add(spaced)),\n        width: sizeDefault.width,\n        height: sizeDefault.height,\n        // border: brush,\n        // borderThickness: 2,\n        fill: brush,\n      })\n\n      const tooltipText = new BABYLON.Text2D(text, {\n        parent: tooltipBox,\n        id: 'tooltipText',\n        marginAlignment: 'h: center, v:center',\n        defaultFontColor: fontColor,\n        fontSuperSample,\n        fontSignedDistanceField,\n        fontName,\n      })\n\n      if (size === null) {\n        tooltipBox.width = tooltipText.size.width + 24\n        tooltipBox.height = tooltipText.size.height + 24\n      }\n\n      tooltipBox.position = position.subtract(sizeToVec(tooltipBox.size).scale(0.5).add(spaced))\n\n\n      tooltip = { box: tooltipBox, text: tooltipText, promise: duration, id: 0 }\n\n      this.set('tooltip', tooltip)\n    } else {\n      tooltip.text.levelVisible = true\n      tooltip.box.levelVisible = true\n\n      tooltip.text.text = text\n\n      const tempPosition = tooltip.box.position.add(sizeToVec(tooltip.box.size).scale(0.5))\n      if (size === null) {\n        tooltip.box.width = tooltip.text.size.width + 24\n        tooltip.box.height = tooltip.text.size.height + 24\n      } else {\n        tooltip.box.width = size.width\n        tooltip.box.height = size.height\n      }\n\n\n      position = spreadToObject(position, tempPosition)\n      const nextPos = position.subtract(sizeToVec(tooltip.box.size).scale(0.5).add(spaced))\n      // TODO make a bounding function to make sure the tooltip is visible depending on the rendersize the position and size of the tooltip\n      tooltip.box.position = nextPos\n      tooltip.promise = duration\n\n      id = tooltip.id + 1\n      tooltip.id = id\n    }\n\n    duration.then(() => {\n      const currentTooltip = this.get('tooltip')\n      if ((currentTooltip !== null) && (currentTooltip.id === id)) {\n        this.hideTooltip()\n      }\n    })\n\n    return tooltip.promise\n  }\n\n  hideTooltip() {\n    const tooltip = this.get('tooltip')\n    if (tooltip !== null) {\n      tooltip.text.levelVisible = false\n      tooltip.box.levelVisible = false\n    }\n  }\n\n  /* === Pause State === */\n\n  /**\n   * Funtion to set the PAUSE mode for all states. Default uses spacebar keydown event from this._parent.\n   * @param {Number} key  keyCode of the the pause button, default to 32 (spacebar)\n   * @param {string} flag event flag, defaults to this._parent.FLAG_EVENTS_INPUT_KEYDOWN\n   */\n  setPauseKeyStroke(key = 32, flag = null, addDefaultDesign = true) {\n    const pauseState = function (options = null) {\n      const state = this.state\n      const stateManager = this.stateManager\n      const R = this.R\n\n      if (options.data.keyCode === key) {\n        state.freeze() // key function\n        stateManager.goToState(R.get.states_pause)\n      }\n\n      return ('state.pauseState: resolved')\n    }\n\n    const forcePause = function () {\n      this.state.freeze() // key function\n      this.stateManager.goToState(this.R.get.states_pause)\n      return ('state.forcePause: resolved')\n    }\n\n\n    const unPause = function (options = null) {\n      if (options.data.keyCode === key) {\n        if (this.stateManager.frozenState !== null) {\n          this.stateManager.goToState(this.stateManager.frozenState)\n        } else {\n          debugError('state.unPause: no frozen state !')\n        }\n      }\n\n      return ('state.unPause: resolved')\n    }\n\n    flag = (flag !== null) ? flag : this.R.get.events.keydown\n\n    const stateKeys = this.stateKeys\n    for (let i = 0; i < stateKeys.length; i++) {\n      if (stateKeys[i] !== this.R.get.states_pause) {\n        // by default only one pause handling function per state\n        this.registerEventFunction(stateKeys[i], flag, pauseState)\n        this.registerEventFunction(stateKeys[i], this.R.get.events_pause, forcePause)\n      } else {\n        this.registerEventFunction(stateKeys[i], flag, unPause)\n        this.registerEventFunction(stateKeys[i], this.R.get.events_pause, unPause)\n      }\n    }\n\n    if (addDefaultDesign) {\n      this.addDefaultPauseDesign()\n    }\n  }\n\n  /**\n   * Function that adds a basic pause design with background overlay and a large \"PAUSE\" text top center.\n   * Uses babylon Rectangle2D and text2d\n   */\n  addDefaultPauseDesign() {\n    if (BABYLON === null) {\n      return false\n    }\n\n    const awakePause = function (options = null) {\n      try {\n        if (typeof this.taskObject === 'undefined') {\n          throw new Error('state.awakePause: taskObject is undefined')\n        }\n        const stateManager = this.stateManager\n\n        const pauseBackground2D = stateManager.get('pauseBackground2D')\n        const canvas = this.scene.screenCanvas\n\n        if (pauseBackground2D !== null) {\n          pauseBackground2D.size = canvas.size\n          pauseBackground2D.levelVisible = true\n        } else {\n          if (typeof canvas === 'undefined') {\n            return ('awakePause: initialCanvas is undefined.')\n          }\n          // draw a rect2d of canvas size with background opacity 0.5\n          // draw a large text2d \"PAUSE\" inside\n          const baseOptions = {\n            id: 'pauseBackground2D',\n            text: 'Pause',\n            x: 0,\n            y: 0,\n            width: canvas.width,\n            height: canvas.height,\n            fill: BABYLON.Canvas2D.GetSolidColorBrush(new BABYLON.Color4(0.3, 0.3, 0.3, 0.5)),\n            fontName: '40pt Verdana',\n            backgroundRoundRadius: 0,\n          }\n\n          options = _.extend(baseOptions, options)\n\n          let customSized = canvas.size\n          if ((options.width !== canvas.width) || (options.height !== canvas.height)) {\n            customSized = new BABYLON.Size(options.width, options.height)\n          }\n\n          const canvasOptions = {\n            id: options.id,\n            roundRadius: options.backgroundRoundRadius,\n            fill: options.fill,\n            parent: this.scene.screenCanvas,\n            marginAlignment: 'h:center, v: center',\n            size: customSized,\n            zOrder: 0,\n            children: [\n              new BABYLON.Text2D(options.text, {\n                fontName: options.fontName,\n                marginAlignment: 'h: center, v:top',\n                fontSignedDistanceField: true,\n                zOrder: 0,\n              }),\n            ],\n          }\n\n          const pauseBackground2D = new BABYLON.Rectangle2D(canvasOptions)\n\n          stateManager.set('pauseBackground2D', pauseBackground2D) // TODO Make those string part of R.\n        }\n        return ('state.awakePause: resolved')\n      } catch (e) {\n        debugError(e)\n        return e\n      }\n    }\n\n    const endPause = function () {\n      try {\n        if (typeof this.state === 'undefined') {\n          throw new Error('state.endPause: state is undefined')\n        }\n        const stateManager = this.stateManager\n        const pauseBackground2D = stateManager.get('pauseBackground2D')\n\n        if (pauseBackground2D !== null) {\n          // pauseBackground2D.dispose()\n          // stateManager.set('pauseBackground2D', null)\n          pauseBackground2D.levelVisible = false\n        }\n\n        return ('state.endPause: resolved')\n      } catch (e) {\n        debugError(e)\n        return e\n      }\n    }\n\n    this.registerAwakeningFunction(this.R.get.states_pause, awakePause)\n    this.registerEndingFunction(this.R.get.states_pause, endPause)\n\n    return true\n  }\n\n  stateWasFrozen(stateKey = mandatory()) {\n    this.frozenState = stateKey\n\n    // when frezing a state - events are not processed by the next state\n    this.emptyEventHeap()\n    this.emptyTimeTriggerEvents()\n  }\n\n  stateWasUnfreezed(stateKey = mandatory()) {\n    if (this.frozenState !== stateKey) {\n      debugError('StateManager.stateWasUnfreezed: stateKey does not correspond to the frozenState')\n    } else {\n      this.frozenState = null\n    }\n  }\n\n  /* === Time event === */\n  addTimeTriggerEvent(event = mandatory('event')) {\n    if (event.constructor === EventData) {\n      if (event.happenedAt > this.timeInMs + 40) {\n        this._timeTriggerEvents.push(event)\n        debuglog('StateManager: Trigger event added to the time triggers.')\n      } else {\n        this.addEvent(event)\n        debugError('StateManager.addTimeTriggerEvent: trigger event is to close to current time (<40ms). Added directly to the heap.')\n      }\n    } else {\n      debugError('StateManager: Event is not of class EventData.')\n    }\n  }\n\n  /* === Event heap methods === */\n  addEvent(event = mandatory('event')) {\n    if (event.constructor === EventData) {\n      this._eventHeap.push(event)\n      debuglog('StateManager: Event added to the heap.')\n    } else {\n      debugError('StateManager: Event is not of class EventData.')\n    }\n  }\n\n  newEvent(flag = mandatory(), time = null, data = null, belongsTo = ['globalLog']) {\n    // check that the user did not use newEvent as addEvent\n    if (flag.constructor === EventData) {\n      debuglog('StateManager.newEvent: flag is an EventData object. Using addEvent().')\n      this.addEvent(flag)\n      return flag\n    }\n\n    // checks if the user gave a non array to belongsTo\n    if (belongsTo.constructor !== Array) {\n      if (belongsTo.constructor === String) {\n        belongsTo = [belongsTo]\n      } else {\n        debugError('stateManager.newEvent: belongs to need to be either a string or an array')\n        return null\n      }\n    } else if (belongsTo.indexOf('globalLog') === -1) {\n        // add the missing globalLog to belongsTo\n      belongsTo.push('globalLog')\n    }\n\n    const eventOptions = {\n      belongsTo,\n      handledAt: null,\n      storedAt: null,\n    }\n    if (data !== null) {\n      eventOptions.data = data // TODO ++++ SHOULD BE _.extend()\n    } else if ((time !== null) && (time.constructor === Object) && (data === null)) {\n      // treats time as the data and time as unknown\n      eventOptions.data = time\n      time = null\n    }\n\n    /* --- Not a time triggered event --- */\n    if (time === null) {\n      debuglog('stateManager.newEvent: time is null, using addEvent() with this.timeInMs.')\n      const event = new EventData(flag, this.timeInMs, eventOptions)\n      this.addEvent(event)\n      return event\n    }\n\n    /* --- Time triggered event --- */\n    // check if time is a duration or a timestamp - TODO set max duration somewhere\n    if (time < this.R.get.values_timestampThreshold) {\n      // time is a duration\n      time += this.timeInMs\n    }\n\n    const event = new EventData(flag, time, eventOptions)\n    this.addTimeTriggerEvent(event)\n    return event\n  }\n\n  removeFirstEvent() {\n    this._eventHeap.splice(0, 1)\n  }\n\n  removeEvent(event) {\n    this._eventHeap = _.without(this._eventHeap, event)\n  }\n\n  getFirstEventAndRemoveFromHeap(byState = this.currentStateKey) {\n    for (let i = 0; i < this._eventHeap.length; i++) {\n      const event = this._eventHeap[i]\n      if ((event.forState === 'any') || (event.forState === byState)) {\n        return this._eventHeap.splice(i)\n      }\n    }\n\n    return undefined\n  }\n\n  spliceEventsForState(byState = this.currentStateKey) {\n    const toSplice = []\n    for (let i = 0; i < this._eventHeap.length; i++) {\n      const event = this._eventHeap[i]\n      if ((event.forState === 'any') || (event.forState === byState)) {\n        toSplice.push(i)\n      }\n    }\n\n    return this._eventHeap.multisplice(...toSplice) // TODO use only one loop. And put events in a freezer if too long on the heap.\n  }\n\n  emptyEventHeap() {\n    this._eventHeap = []\n  }\n\n  emptyTimeTriggerEvents() {\n    this._timeTriggerEvents = []\n  }\n\n  getAllEvents() {\n    return (this._eventHeap.concat(this._timeTriggerEvents))\n  }\n\n  /**\n   * Called by the state once it has finished handling an event. This function calls the storeEvent function.\n   * @param  {event} event Handled event\n   */\n  stateHasFinishedHandlingEvent(event) {\n    event.data.handledAt = this.timeInMs\n    event.handled = true\n\n    debuglog('StateManager.stateHasFinishedHandlingEvent: event was handled.')\n\n    if (this.dataManager.constructor === DataManager) {\n      this.storeEvent(event)\n    } else {\n      debugWarn('StateManager.stateHasFinishedHandlingEvent: dataManager is not set, not storing event.')\n    }\n  }\n\n  freezeEventHeap() {\n    this.eventHeapIsFrozen = true\n    this.frozenEventHeap = this._eventHeap\n    // freeze the heap for certain event that need to be processed afterwards in series\n    // TODO elements should not be deleted... maybe have firstNonFrozenEvent(); and a property of events if they are frozen or not\n  }\n\n  unfreezeEventHeap(storeFrozenEvents = true) {\n    this.eventHeapIsFrozen = false\n\n    if (storeFrozenEvents) {\n      /* Reset event heap and store all frozen events in the globalLog */\n      // const tempEvents = this._eventHeap TODO what was that for again ?\n      this.emptyEventHeap()\n    } else {\n      // unfreeze events so they can be processed\n    }\n  }\n\n  /* === State event functions === */\n\n  /**\n   * Registers a new event function for the specified event flag in the specified state. This function will be called in the handleEvent\n   * function of the state if it is the active state. The function should return a Promise.\n   * @param  {string} stateKey         key of state in which to add the new function\n   * @param  {string} eventFlag        event for which the function should be called\n   * @param  {function} handlingFunction Function that should return a Promise.\n   */\n  registerEventFunction(stateKey, eventFlag, ...handlingFunctions) {\n    try {\n      mustBeDefined(stateKey, eventFlag, ...handlingFunctions)\n      mustHaveConstructor(Function, ...handlingFunctions)\n\n      if (_.has(this.states, stateKey)) {\n        this.states[stateKey].registerEventFunctions(eventFlag, true, ...handlingFunctions) // TODO Handle overwrite better ?\n      } else {\n        throw new Error(`StateManager: Invalid state key '${stateKey}'. Create the state before adding event handling functions.`)\n      }\n    } catch (e) {\n      debugError(e)\n    }\n  }\n\n  /**\n   * Adds a function to the awakening function array in the state object. Those function must return a promise.\n   * @param  {[type]} stateKey         [description]\n   * @param  {[type]} handlingFunction [description]\n   * @return {[type]}                  [description]\n   */\n  registerAwakeningFunction(stateKey = mandatory(), handlingFunction = mandatory(), overwrite = false) {\n    if (_.has(this.states, stateKey)) {\n      this.states[stateKey].registerCycleFunctions('awakening', overwrite, handlingFunction)\n    } else {\n      debugError(`StateManager: Invalid state key '${stateKey}'. Create the state before adding awakening handling functions.`)\n    }\n  }\n\n  registerEndingFunction(stateKey = mandatory(), handlingFunction = mandatory(), overwrite = false) {\n    if (_.has(this.states, stateKey)) {\n      this.states[stateKey].registerCycleFunctions('ending', overwrite, handlingFunction)\n    } else {\n      debugError(`StateManager: Invalid state key '${stateKey}'. Create the state before adding awakening handling functions.`)\n    }\n  }\n\n  registerUpdateFunction(stateKey = mandatory(), handlingFunction = mandatory(), overwrite = false) {\n    if (_.has(this.states, stateKey)) {\n      this.states[stateKey].registerCycleFunctions('udpate', overwrite, handlingFunction)\n      debuglog(`StateManager: handling function added to awakeningFunctions array for state '${stateKey}'`)\n    } else {\n      debugError(`StateManager: Invalid state key '${stateKey}'. Create the state before adding awakening handling functions.`)\n    }\n  }\n\n  /* === Globals === */\n  /**\n   * Stores a function into the globalFunctions array of the stateManager. Those function must return a promise.\n   * Storing function in the stateManager should be reserved to functions that are to be reused across states, and in general access global variables.\n   * @param  {string} name            function's name\n   * @param  {function} promiseFunction function should return a promise\n   */\n  registerGlobalFunction(func = mandatory(), name = null) {\n    if (func.constructor !== Function) {\n      debugError('StateManager.registerGlobalFunction: func is not a function')\n    } else {\n      // TODO checks that it works\n      // var promiseFunction = looksLikeAPromise(func) ? func : Promise.method(func); Do no promisify here - give user the choice\n      if (name === null) { name = func.name }\n\n      this.globalFunctions[name] = func\n    }\n  }\n\n  /**\n   * Shorthand for registerGlobalFunction\n   * @param  {string} name            function's name\n   * @param  {function} promiseFunction\n   */\n  register(...functions) {\n    for (let i = 0; i < functions.length; i++) {\n      this.registerGlobalFunction(functions[i])\n    }\n  }\n\n  // TODO get rid of this function use only call\n  callGlobalFunction(name, ...args) {\n    this.call(name, ...args)\n  }\n\n  /**\n   * Shorthand for callGlobalFunction\n   * @param  {string} name    Function's name\n   * @param  {...object} args Optional arguments iterable\n   * @return {promise}\n   */\n  call(name, ...args) {\n    if (typeof name === 'undefined') {\n      debugError('StateManager.call: name of the function needs to be defined.')\n    } else if (_.has(this.globalFunctions, name)) {\n      return (this.globalFunctions[name].bind(this.context)(...args))\n    } else {\n      debugWarn(`StateManager.call: globals do not contain function '${name}'`)\n    }\n    return undefined\n  }\n\n  promise(name, ...args) {\n    if (typeof name === 'undefined') {\n      debugError('StateManager.promiseGlobalFunction: name is undefined.')\n    } else if (_.has(this.globalFunctions, name)) {\n      return (Promise.method(this.globalFunctions[name]).bind(this.context)(...args))\n    } else {\n      debugWarn(`StateManager.promiseGlobalFunction: globals do not contain function '${name}'`)\n    }\n\n    return undefined\n  }\n\n  /**\n   * Recurse on a given registered function, returns a promise resolving to the concatenated results.\n   * @param  {string} name    Name of the function already registered in the stateManager\n   * @param  {numeric} amount The amount of time we should recurse\n   * @param  {Object} options Optional, object to specify as options of the registered function\n   * @param  {Array}  results Optional, where to store the results.\n   * @return {Promise}        Promise resolving to the filed results array.\n   */\n  recurseOnGlobalFunction(name = mandatory(), amount = mandatory(), args = [], results = []) {\n    if (!_.has(this.globalFunctions, name)) {\n      debugError(`StateManager.recurseOnGlobalFunction: globals do not contain function '${name}'`)\n      return null\n    }\n      // Base case - just return the promisified result\n    if (amount === 0) {\n      return new Promise((resolve) => {\n        resolve(results)\n      })\n    }\n\n\n    const next = this.promise(name, ...args).then((r) => {\n      results = results.concat(r)\n      return (this.recurseOnGlobalFunction(name, amount - 1, args, results))\n    })\n\n    return next\n  }\n\n  /**\n   * Shorthand for recurseOnGlobalFunction.\n   * @param  {string} name    Name of the function already registered in the stateManager\n   * @param  {numeric} amount The amount of time we should recurse\n   * @param  {args} args Optional, array of arguments to pass to the promise\n   * @param  {Array}  results Optional, where to store the results.\n   * @return {Promise}        Promise resolving to the filed results array.\n   */\n  recurse(name = mandatory(), amount = mandatory(), args = [], results = []) {\n    this.recurseOnGlobalFunction(name, amount, args, results)\n  }\n\n  /**\n   * Return a stored global or null if it does not exist.\n   * @param  {string} name String name of the variable\n   * @return {?*}\n   */\n  getGlobal(name = mandatory(), setDefault) {\n    if (this.globals.hasOwnProperty(name)) {\n      return (this.globals[name])\n    } else if (typeof setDefault !== 'undefined') {\n      this.globals[name] = setDefault\n      return this.globals[name]\n    }\n    debugWarn(`StateManager: globals do not contain variable '${name}' - and no default is given`)\n    return (null)\n  }\n\n  get(name = mandatory(), setDefault) {\n    return (this.getGlobal(name, setDefault))\n  }\n\n  /**\n   * Stores a global variable. Beware if storing objects (stored by reference, any modification outside of the statemanager will affect the stored variable).\n   * Maybe a _.cloneDeep would be better... lets think about it for a while.\n   * @param {string} name  Name of the variable\n   * @param {*} value Variable\n   */\n  setGlobal(name = mandatory(), value = mandatory()) {\n    this.globals[name] = value\n    debuglog(`StateManager: global '${name}' set to '${value}'`)\n  }\n\n  set(name = mandatory(), value = mandatory()) {\n    this.setGlobal(name, value)\n  }\n\n  getStateObject(key) {\n    if (_.has(this.states, key)) {\n      return (this.states[key])\n    }\n    debugError('StateManager: Invalid state key.')\n  }\n\n  /* ======== Getters and Setters ======== */\n\n  // TODO Redo documentation of those functions\n  // static get context() {}\n  // static get currentStateKey() {}\n  // static get currentState() {}\n  // static get eventHeap() {}\n  // static get firstEvent() {}\n  // static get time() {}\n  // static get timeInSec() {}\n  // static get timeInMs() {}\n\n  /**\n   * Returns a summary object containing the taskObject, dataManager, ressourceManager\n   * as well as current scene, stateManager, and state.\n   * Used as a a context accros the library when calling state functions (with .bind(context))\n   */\n  get context() {\n    if (this._taskObject) {\n      return (this._taskObject.getContext(this))\n    }\n    return ({\n      taskObject: null,\n      dataManager: this.dataManager,\n      scene: this._parent, // TODO Force the ._parent to be the .scene ?\n      stateManager: this,\n      state: this.currentState,\n      R: this.R,\n    })\n  }\n\n  get stateKeys() {\n    return (Object.keys(this.states))\n  }\n\n  get currentStateKey() {\n    return (this._currentStateKey)\n  }\n\n  set currentStateKey(key) {\n    if (_.has(this.states, key)) {\n      this.goToState(key)\n    } else {\n      debugError('StateManager: Invalid state key.')\n    }\n  }\n\n  get currentState() {\n    return this.states[this.currentStateKey]\n  }\n\n  set currentState(state) {\n    if (typeof state.key !== 'undefined') {\n      this.currentStateKey = state.key\n    } else {\n      debugError('StateManager: Invalid state, it has no state key defined.')\n    }\n  }\n\n  get eventHeap() {\n    return (this._eventHeap)\n  }\n\n  set eventHeap(value) { // eslint-disable-line\n    debugError('StateManager: eventHeap is readonly. Add events through the class methods.')\n  }\n\n  get firstEvent() {\n    if (this._eventHeap.length) {\n      return (this._eventHeap[0])\n    }\n    return undefined\n  }\n\n  set firstEvent(value) {\n    // TODO not implemented -- maybe somekind of bruteforce to have an important input be treated first\n    debugError('StateManager: firstEvent is readonly.')\n  }\n\n  /* === Time functions === */\n\n  get time() {\n    return (this.timeInMs)\n  }\n\n  get timeInSec() {\n    return (new Date().getTime() / 1000)\n  }\n\n  get timeInMs() {\n    return (new Date().getTime())\n  }\n\n}\n\n\n\n// WEBPACK FOOTER //\n// ./src/framework/StateManager.js","// shim for using process in browser\nvar process = module.exports = {};\n\n// cached from whatever global is present so that test runners that stub it\n// don't break things.  But we need to wrap it in a try catch in case it is\n// wrapped in strict mode code which doesn't define any globals.  It's inside a\n// function because try/catches deoptimize in certain engines.\n\nvar cachedSetTimeout;\nvar cachedClearTimeout;\n\nfunction defaultSetTimout() {\n    throw new Error('setTimeout has not been defined');\n}\nfunction defaultClearTimeout () {\n    throw new Error('clearTimeout has not been defined');\n}\n(function () {\n    try {\n        if (typeof setTimeout === 'function') {\n            cachedSetTimeout = setTimeout;\n        } else {\n            cachedSetTimeout = defaultSetTimout;\n        }\n    } catch (e) {\n        cachedSetTimeout = defaultSetTimout;\n    }\n    try {\n        if (typeof clearTimeout === 'function') {\n            cachedClearTimeout = clearTimeout;\n        } else {\n            cachedClearTimeout = defaultClearTimeout;\n        }\n    } catch (e) {\n        cachedClearTimeout = defaultClearTimeout;\n    }\n} ())\nfunction runTimeout(fun) {\n    if (cachedSetTimeout === setTimeout) {\n        //normal enviroments in sane situations\n        return setTimeout(fun, 0);\n    }\n    // if setTimeout wasn't available but was latter defined\n    if ((cachedSetTimeout === defaultSetTimout || !cachedSetTimeout) && setTimeout) {\n        cachedSetTimeout = setTimeout;\n        return setTimeout(fun, 0);\n    }\n    try {\n        // when when somebody has screwed with setTimeout but no I.E. maddness\n        return cachedSetTimeout(fun, 0);\n    } catch(e){\n        try {\n            // When we are in I.E. but the script has been evaled so I.E. doesn't trust the global object when called normally\n            return cachedSetTimeout.call(null, fun, 0);\n        } catch(e){\n            // same as above but when it's a version of I.E. that must have the global object for 'this', hopfully our context correct otherwise it will throw a global error\n            return cachedSetTimeout.call(this, fun, 0);\n        }\n    }\n\n\n}\nfunction runClearTimeout(marker) {\n    if (cachedClearTimeout === clearTimeout) {\n        //normal enviroments in sane situations\n        return clearTimeout(marker);\n    }\n    // if clearTimeout wasn't available but was latter defined\n    if ((cachedClearTimeout === defaultClearTimeout || !cachedClearTimeout) && clearTimeout) {\n        cachedClearTimeout = clearTimeout;\n        return clearTimeout(marker);\n    }\n    try {\n        // when when somebody has screwed with setTimeout but no I.E. maddness\n        return cachedClearTimeout(marker);\n    } catch (e){\n        try {\n            // When we are in I.E. but the script has been evaled so I.E. doesn't  trust the global object when called normally\n            return cachedClearTimeout.call(null, marker);\n        } catch (e){\n            // same as above but when it's a version of I.E. that must have the global object for 'this', hopfully our context correct otherwise it will throw a global error.\n            // Some versions of I.E. have different rules for clearTimeout vs setTimeout\n            return cachedClearTimeout.call(this, marker);\n        }\n    }\n\n\n\n}\nvar queue = [];\nvar draining = false;\nvar currentQueue;\nvar queueIndex = -1;\n\nfunction cleanUpNextTick() {\n    if (!draining || !currentQueue) {\n        return;\n    }\n    draining = false;\n    if (currentQueue.length) {\n        queue = currentQueue.concat(queue);\n    } else {\n        queueIndex = -1;\n    }\n    if (queue.length) {\n        drainQueue();\n    }\n}\n\nfunction drainQueue() {\n    if (draining) {\n        return;\n    }\n    var timeout = runTimeout(cleanUpNextTick);\n    draining = true;\n\n    var len = queue.length;\n    while(len) {\n        currentQueue = queue;\n        queue = [];\n        while (++queueIndex < len) {\n            if (currentQueue) {\n                currentQueue[queueIndex].run();\n            }\n        }\n        queueIndex = -1;\n        len = queue.length;\n    }\n    currentQueue = null;\n    draining = false;\n    runClearTimeout(timeout);\n}\n\nprocess.nextTick = function (fun) {\n    var args = new Array(arguments.length - 1);\n    if (arguments.length > 1) {\n        for (var i = 1; i < arguments.length; i++) {\n            args[i - 1] = arguments[i];\n        }\n    }\n    queue.push(new Item(fun, args));\n    if (queue.length === 1 && !draining) {\n        runTimeout(drainQueue);\n    }\n};\n\n// v8 likes predictible objects\nfunction Item(fun, array) {\n    this.fun = fun;\n    this.array = array;\n}\nItem.prototype.run = function () {\n    this.fun.apply(null, this.array);\n};\nprocess.title = 'browser';\nprocess.browser = true;\nprocess.env = {};\nprocess.argv = [];\nprocess.version = ''; // empty string to avoid regexp issues\nprocess.versions = {};\n\nfunction noop() {}\n\nprocess.on = noop;\nprocess.addListener = noop;\nprocess.once = noop;\nprocess.off = noop;\nprocess.removeListener = noop;\nprocess.removeAllListeners = noop;\nprocess.emit = noop;\n\nprocess.binding = function (name) {\n    throw new Error('process.binding is not supported');\n};\n\nprocess.cwd = function () { return '/' };\nprocess.chdir = function (dir) {\n    throw new Error('process.chdir is not supported');\n};\nprocess.umask = function() { return 0; };\n\n\n\n//////////////////\n// WEBPACK FOOTER\n// ./~/process/browser.js\n// module id = 8\n// module chunks = 0","var g;\r\n\r\n// This works in non-strict mode\r\ng = (function() {\r\n\treturn this;\r\n})();\r\n\r\ntry {\r\n\t// This works if eval is allowed (see CSP)\r\n\tg = g || Function(\"return this\")() || (1,eval)(\"this\");\r\n} catch(e) {\r\n\t// This works if the window reference is available\r\n\tif(typeof window === \"object\")\r\n\t\tg = window;\r\n}\r\n\r\n// g can still be undefined, but nothing to do about it...\r\n// We return undefined, instead of nothing here, so it's\r\n// easier to handle this case. if(!global) { ...}\r\n\r\nmodule.exports = g;\r\n\n\n\n//////////////////\n// WEBPACK FOOTER\n// (webpack)/buildin/global.js\n// module id = 9\n// module chunks = 0","module.exports = __WEBPACK_EXTERNAL_MODULE_10__;\n\n\n//////////////////\n// WEBPACK FOOTER\n// external {\"commonjs\":\"experiment-babylon-js\",\"commonjs2\":\"experiment-babylon-js\",\"amd\":\"experiment-babylon-js\",\"root\":\"BABYLON\"}\n// module id = 10\n// module chunks = 0","module.exports = __WEBPACK_EXTERNAL_MODULE_11__;\n\n\n//////////////////\n// WEBPACK FOOTER\n// external {\"commonjs\":\"experiment-mathjs\",\"commonjs2\":\"experiment-mathjs\",\"amd\":\"experiment-mathjs\",\"root\":\"math\"}\n// module id = 11\n// module chunks = 0","module.exports = __WEBPACK_EXTERNAL_MODULE_12__;\n\n\n//////////////////\n// WEBPACK FOOTER\n// external {\"commonjs\":\"jQuery\",\"commonjs2\":\"jQuery\",\"amd\":\"jQuery\",\"root\":\"jQuery\"}\n// module id = 12\n// module chunks = 0","/**\n * Boiler Plate For Cognitive Tasks JS\n *\n *\n * author: Albert Buchard 2016\n *\n * REQUIRE ECMA2016 / JQUERY / MATHJS / BABYLON\n */\n\n/* =============== Set-up =============== */\nimport _ from 'lodash'\nimport BABYLON from 'experiment-babylon-js'\n\nimport { ParamBox, SmartModal } from 'experiment-boxes'\nimport Promise from 'bluebird'\nimport math from 'experiment-mathjs'\n\nimport DataManager from './DataManager'\nimport RessourceManager from './RessourceManager'\nimport EventData from './EventData'\nimport StateManager from './StateManager'\nimport State from './State'\n\nimport {\n  Array,\n  String,\n  Deferred,\n  mandatory,\n  debuglog,\n  debugWarn,\n  debugError,\n  mustHaveConstructor,\n  delay,\n} from './utilities'\n\n\nif (typeof window !== 'undefined') {\n  /* === Get the absolute path of the library === */\n  const scripts = document.getElementsByTagName('script')\n  if (scripts.length) {\n    const assetsFolderFullpath = scripts[scripts.length - 1].src\n    const delimiterIndices = assetsFolderFullpath.indicesOf('/')\n    window.assetsFolderFullpath = assetsFolderFullpath.substr(0, delimiterIndices[delimiterIndices.length - 2])\n  } else {\n    window.assetsFolderFullpath = './'\n  }\n}\n\n/** Class handling graphic engine interface and lifecycle of the task */\nexport default class TaskObject {\n  /**\n   * class constructor : initialize the task\n   * @param  {Object} target element where the task will be contained\n   * @return {TaskObject}\n   */\n  constructor(target = mandatory(),\n    assetsFolder = null,\n    engine = 'babylon') {\n    if (typeof window === 'undefined') { // TODO should it fail more gracefully ?\n      return { error: 'Wrong environment. ExperimentJS only works in the browser.' }\n    }\n    /* --- Constants --- */\n    // this.constants = {};\n\n    /* --- Store canvas information --- */\n    this._target = (typeof target.length !== 'undefined') ? target[0] : target\n    this.canvas = this._target\n\n    /* --- Setup engine --- */\n    if (engine === 'babylon') {\n      // Start BabylonJS engine\n      this.engine = new BABYLON.Engine(this.canvas, false, null, false) // TODO check hardware for retina\n    } else {\n      throw new Error('TaskObject.constructor: engine not supported.')\n    }\n\n    /* --- Size values --- */\n    this.height = window.innerHeight\n    this.width = window.innerWidth\n    this.babylonCanvasHeight = this.canvas.height\n    this.babylonCanvasWidth = this.canvas.width\n\n    /**\n     * Task DataManager\n     * @type {DataManager}\n     */\n    this.dataManager = new DataManager(this)\n\n    /**\n     * The main connection object in the dataManager used by the TaskObject.\n     * It is set when using this.setConnection() which is a wrapper for the dataManager function\n     * @type {Object}\n     */\n    this.connection = null\n\n    /* --- Add global mouse and keyboard event tables --- */\n    const globalLogFields = this.dataManager.GLOBAL_LOG_FIELDS\n\n    // globalLogs is the default data table of the dataManager,\n    // adding specific data table for mouse and key events\n    this.dataManager.addTable('keyEvents', globalLogFields)\n    this.dataManager.addTable('mouseEvents', globalLogFields)\n\n    /* --- Add task status table --- */\n    const taskStatusFields = ['level', 'happenedAt']\n    this.dataManager.addTable('taskStatus', taskStatusFields)\n\n    /* --- Add raised flags --- */\n    const statusFlagsFields = ['flag', 'happenedAt']\n    this.dataManager.addTable('statusFlags', statusFlagsFields)\n\n    /* --- Add the checkpoint table --- */\n    const checkpointFields = ['code', 'happenedAt']\n    this.dataManager.addTable('checkpoints', checkpointFields)\n\n    /* --- Assets --- */\n    /**\n     * Path to assets folder\n     * @type {String}\n     */\n    if (assetsFolder) {\n      this.ASSETS_FOLDER = assetsFolder\n    } else {\n      this.ASSETS_FOLDER = window.assetsFolderFullpath\n    }\n\n    this.ASSETS_FLARE_PATH = `${this.ASSETS_FOLDER}/textures/flare/flare.png`\n\n    /**\n     * Object to store global task assets after loading or creation\n     * @type {Object}\n     */\n    this.assetsToLoad = {}\n\n    this.R = new RessourceManager()\n    this.R.add({\n      states: {\n        active: 'active',\n        idle: 'idle',\n        pause: 'pause',\n      },\n      folders: {\n        assetsFolder: assetsFolder || window.assetsFolderFullpath,\n      },\n    })\n\n\n    /* --- Set-up events --- */\n    this.flags = {}\n    this.keyState = [] // holds state of keys being stroked indexed by event.keyCode\n    this.shouldShowDebug = typeof window.DEBUG_MODE_ONE !== 'undefined' ? window.DEBUG_MODE_ONE : false\n    this.setupGlobalEvents()\n\n    /* --- Modals --- */\n    this.currentModal = null\n\n    /* --- Task parameters --- */\n    this.parameters = {}\n\n    /* --- Task level variables --- */\n    this.variables = {}\n    this.variables.shouldSeeInformation = true\n\n    /* --- Scenes --- */\n    this.scenes = {}\n    this.sceneGenerators = {}\n    this.sceneGenerators.functions = {}\n    this.sceneGenerators.functionsOptions = {}\n\n    /* --- Set a default loading scene --- */\n    this.sceneGenerators.loading = TaskObject.default2dSceneGenerator\n    this.sceneGenerators.loadingOptions = { sceneKey: 'loading', shouldLoadAssets: true }\n\n    this._currentSceneKey = ''\n\n    /* --- ParamBox setup --- */\n    this._paramBox = null\n\n    /* if ParamBox library is loaded - create one */\n    if (typeof ParamBox === 'function') {\n      this._paramBox = new ParamBox()\n    }\n  }\n\n  /* ======== Scene generators ======== */\n  /*\n  newScene(key = mandatory()) {\n    // TODO create a child object holding scene keys, scene generators and babylon scenes\n  }\n\n  registerSceneGenerators(...sceneGeneratorObjects) {\n    // TODO\n  }\n  */\n\n  registerSceneGenerator(sceneGenerator = mandatory('sceneGenerator'), options = {}, loading = false, promise = false, key = null) {\n    // option base\n    options = _.clone(options)\n\n    if ((key === null) && (sceneGenerator.name !== '')) {\n      key = sceneGenerator.name\n    } else {\n      key = `scene${Object.keys(this.sceneGenerators.functions).length}`\n    }\n\n    if (loading) {\n      this.sceneGenerators.loading = sceneGenerator\n      this.sceneGenerators.loadingOptions = options\n    } else {\n      this.sceneGenerators.functions[key] = sceneGenerator\n      this.sceneGenerators.functionsOptions[key] = options\n    }\n  }\n\n  registerLoadingFunction(loadingSceneGenerator = mandatory('loadingSceneGenerator'), options = {}, promise = false) {\n    /* --- Force sceneKey to be loading --- */\n    options.sceneKey = 'loading'\n\n    this.registerSceneGenerator(\n      loadingSceneGenerator,\n      options,\n      true,\n      promise,\n    )\n  }\n\n  callSceneGenerator(key = mandatory()) {\n    const sceneOptions = this.sceneGenerators.functionsOptions[key]\n    const generator = this.sceneGenerators.functions[key]\n\n    const promise = Promise.method(generator.bind(this.context))(sceneOptions)\n      .then((scene) => {\n        if (typeof scene.sceneKey === 'undefined') {\n          scene.sceneKey = key\n        }\n\n        this.scenes[scene.sceneKey] = scene\n      })\n\n    return promise\n  }\n\n  generateScenes() {\n    const functionKeys = Object.keys(this.sceneGenerators.functions)\n    const promises = []\n    for (let i = 0; i < functionKeys.length; i++) {\n      promises.push(this.callSceneGenerator(functionKeys[i]))\n    }\n\n    return Promise.all(promises)\n  }\n\n  static default2dSceneGenerator(options) {\n    /* --- Get the taskObject instance from binded context --- */\n    const taskObject = this.taskObject\n\n    const optionsBase = {\n      canvasBackground: new BABYLON.Color4(1, 1, 1, 1),\n      backgroundRoundRadius: 0,\n      clearColor: new BABYLON.Color4(1, 1, 1, 1),\n      canvasPercentWidth: 1,\n      canvasPercentHeight: 1,\n      mode: 'central',\n      level: null,\n      shouldLoadAssets: false,\n    }\n\n    options = _.extend(optionsBase, options)\n\n    /* --- Create a basic 2D scene using a Canvas2D as background --- */\n    const scene = taskObject.create2DScene(options)\n\n    /* --- Load assets --- */\n    let assetObject = {\n      logo: {\n        path: '/assets/experiment-js.svg',\n        type: 'texture',\n      },\n    }\n\n    // Will load all the assets contained in the task assetsToLoad variable\n    if (options.shouldLoadAssets) {\n      assetObject = _.extend(assetObject, taskObject.assetsToLoad)\n    }\n\n    // add content loaded text\n    scene.loadingPromise = taskObject.loadAssets(assetObject, scene)\n    .then(() => {\n      const canvas = scene.initialCanvas\n\n      const texture = taskObject.R.get.textures_logo\n      texture.hasAlpha = true\n\n      const height = math.max(taskObject.renderSize.height * 0.05, 45)\n      new BABYLON.Sprite2D(texture, { // eslint-disable-line\n        parent: canvas,\n        id: 'logo',\n        marginAlignment: 'h: center, v:center',\n        size: new BABYLON.Size(height * 3000 / 730, height),\n        origin: BABYLON.Vector2.Zero(),\n      })\n    })\n\n\n    return scene\n  }\n\n  cloneAssetsIntoScene(assets = mandatory(), scene = mandatory()) {\n    if (assets.constructor !== Array) {\n      assets = [assets]\n    }\n\n    const assetsArray = []\n    for (let i = 0; i < assets.length; i++) {\n      const clone = assets[i].clone()\n      clone._scene = scene\n\n      if (assets[i].constructor === BABYLON.Mesh) {\n        if (clone.material) {\n          clone.material = clone.material.clone()\n          clone.material._scene = scene\n          if (clone.material.subMaterials) {\n            for (let j = 0; j < clone.material.subMaterials.length; j++) {\n              clone.material.subMaterials[j] = clone.material.subMaterials[j].clone()\n              clone.material.subMaterials[j]._scene = scene\n            }\n          }\n        }\n        scene.addMesh(clone)\n      }\n\n      assetsArray.push(clone)\n    }\n\n    return assetsArray\n  }\n\n  loadAssets(assetObject = mandatory(), scene = mandatory(), assetFolder = '') {\n    if (assetObject.constructor !== Object) {\n      throw new Error('TaskObject.loadAssets: assetObject is not an Object')\n    }\n\n    if ((assetFolder === '') && (typeof this.ASSETS_FOLDER !== 'undefined')) {\n      assetFolder = this.ASSETS_FOLDER\n    }\n\n    const textureFormats = ['png', 'bmp', 'jpg', 'tiff', 'svg']\n    const soundFormats = ['wav', 'mp3', 'flac', 'aac', 'mp4', 'ogg']\n\n    const assetManager = new BABYLON.AssetsManager(scene)\n    const R = this.R\n\n    const binaryPromises = []\n\n    const names = Object.keys(assetObject)\n    let field\n    let type\n    let path\n    for (let i = 0; i < names.length; i++) {\n      field = assetObject[names[i]]\n\n      if (field.constructor === String) {\n        path = this.ASSETS_FOLDER + field\n\n        if (textureFormats.indexOf(R.getFormat(path)) !== -1) {\n          type = 'texture'\n        } else if (soundFormats.indexOf(R.getFormat(path)) !== -1) {\n          type = 'sound'\n        } else {\n          console.warn('TaskObject.loadAssets: asset invalid or not implemented with shorthand string definition (use full object with path and type)')\n          type = 'invalid'\n        }\n      } else if ((field.constructor === Object) && (Object.keys(field).includes(['path', 'type']))) {\n        path = this.ASSETS_FOLDER + field.path\n        type = field.type\n      } else {\n        console.warn('TaskObject.loadAssets: asset invalid')\n        type = 'invalid'\n      }\n\n      if (type === 'texture') {\n        const assetManagerTask = assetManager.addTextureTask(`${names[i]}Task`, path)\n        assetManagerTask.onSuccess = function (task) {\n          R.add({\n            textures: {\n              [this.textureName]: task.texture,\n            },\n          })\n        }.bind({\n          textureName: names[i],\n        })\n      } else if (type === 'sound') {\n        const assetManagerTask = assetManager.addBinaryFileTask(`${names[i]}Task`, path)\n        assetManagerTask.onSuccess = function (task) {\n          const isReady = new Deferred()\n          binaryPromises.push(isReady.promise)\n          R.add({\n            sounds: {\n              [this.soundName]: new BABYLON.Sound(this.soundName, task.data, scene, isReady.resolve),\n            },\n          })\n        }.bind({\n          soundName: names[i],\n        })\n      }\n      // TODO all the rest such as Meshes.. what else ?\n    }\n\n    /* --- Create a Deferred promise that will resolve after loading is complete --- */\n    const loadDeferred = new Deferred()\n\n    assetManager.load()\n    assetManager.onFinish = function onFinish(tasks) {\n      debuglog('TaskObject.loadAssets: tasks completed', tasks)\n      Promise.all(binaryPromises).then(() => loadDeferred.resolve(tasks))\n    }\n\n    return loadDeferred.promise\n  }\n\n  cloneAssetIntoScene(asset = mandatory(), scene = mandatory()) {\n    // TODO: Merge with cloneAssetsIntoScene\n    if (asset.constructor === Array) {\n      return this.cloneAssetsIntoScene(asset, scene)\n    }\n\n    const clone = asset.clone()\n    clone._scene = scene\n\n    if (asset.constructor === BABYLON.Mesh) {\n      if (clone.material) {\n        clone.material = clone.material.clone()\n        clone.material._scene = scene\n        if (clone.material.subMaterials) {\n          for (let i = 0; i < clone.material.subMaterials.length; i++) {\n            clone.material.subMaterials[i] = clone.material.subMaterials[i].clone()\n            clone.material.subMaterials[i]._scene = scene\n          }\n        }\n      }\n      scene.addMesh(clone)\n    }\n\n    return clone\n  }\n\n  /* ======== Class Methods ======== */\n  /* ======== Lifecycle Methods ======== */\n  /**\n   * Creates the game engine object and loads the scenes.\n   */\n  startTask() {\n    if (typeof window === 'undefined') {\n      return Promise.resolve()\n    }\n\n    window.addEventListener('resize', () => {\n      this.engine.resize()\n    })\n\n    const deferred = new Deferred()\n    /* --- Create a loading scene in order to load assets --- */\n    const loadingOptions = this.sceneGenerators.loadingOptions\n    const loadingScene = (this.sceneGenerators.loading.bind(this.context))(loadingOptions)\n    loadingScene.loadingPromise.then(() => {\n        /* --- Store the scene in the TaskObject --- */\n      this.scenes.loading = loadingScene\n\n        /* --- Set the currentScene to the loading scene that has finished loading --- */\n      this.currentScene = loadingScene.sceneKey\n\n      if ((typeof loadingScene.loadingPromise !== 'undefined') && (loadingScene.loadingPromise.constructor === Promise)) {\n        return loadingScene.loadingPromise\n      }\n      return Promise.resolve()\n    })\n      .then(() => {\n        /* --- Set the loaded flag --- */\n        this.dataManager.addRows('statusFlags', {\n          flag: this.R.get.flags_hasLoaded,\n          happenedAt: this.timeInMs,\n        })\n\n        /* --- Start the render loop --- */\n        this.engine.runRenderLoop(() => {\n          this.scenes[this.currentScene].render()\n        })\n\n        /* --- Now that assets are loaded we generate the task scenes --- */\n        return this.generateScenes()\n      })\n      .then((message) => {\n        debuglog(message)\n        deferred.resolve('TaskObject.startTask: loaded and scene generated.')\n      })\n\n    return deferred.promise\n  }\n\n  /* ======== Babylon Setup ======== */\n  /* === Global events === */\n  setupGlobalEvents() {\n    // TODO: Put every flag in the ressourceManager\n    /* --- Lifecycle flags --- */\n    const R = this.R\n    R.add({\n      flags: { // TODO think about how to order those strings so not mess everything up and keep it understandable\n        hasLoaded: 'hasLoaded',\n        sceneStarts: 'scene_starts',\n        sceneEnds: 'scene_ends',\n      },\n      events: {\n        mouseMove: 'mouse_move',\n        click: 'mouse_click',\n        pick: 'mouse_pick',\n        keydown: 'key_down',\n        keyup: 'key_up',\n        resize: 'resize',\n        pause: 'pause',\n        wasHandled: 'was_handled',\n        beingHandled: 'being_handled',\n        modalDismissed: 'modalDismissed',\n      },\n    })\n\n    /* Add keyboard listener */\n    window.addEventListener('keydown', (evt) => {\n      debuglog('TaskObject: Keydown event.')\n      debuglog(evt)\n\n      // call taskObject keyfunction handler\n      this.keyfunction(evt)\n\n      // store keydown event\n      const eventData = new EventData(\n        R.get.events_keydown,\n        this.timeInMs, {\n          belongsTo: ['globalLog', 'keyEvents'],\n          handledAt: null,\n          storedAt: null,\n          keyCode: evt.keyCode,\n        },\n      )\n\n      // TODO add event to current scene should be a method\n      if (typeof this.currentSceneObject !== 'undefined') {\n        if (typeof this.currentSceneObject.stateManager !== 'undefined') {\n          this.currentSceneObject.stateManager.addEvent(eventData)\n        }\n      }\n    })\n\n    // update the keystates when keyup but do not store event\n    // TODO think if usefull to store keyup\n    window.addEventListener('keyup', (evt) => {\n      this.keyfunction(evt)\n    })\n\n    /* window.addEventListener(\"mousemove\", function(evt) {\n      debuglog(\"TaskObject: mousemove event.\");\n      debuglog(evt);\n\n      var eventData = new EventData(thisObject.FLAG_EVENTS_INPUT_MOUSEMOVE, thisObject.timeInMs, {\n        belongsTo: [\"globalLog\", \"mouseEvents\"],\n        handledAt: null,\n        storedAt: null,\n        clientX: evt.clientX,\n        clientY: evt.clientY\n      }); //make an static EventData from dom event?\n\n      if (typeof thisObject.currentSceneObject !== \"undefined\") {\n        if (typeof thisObject.currentSceneObject.stateManager !== \"undefined\") {\n          thisObject.currentSceneObject.stateManager.addEvent(eventData);\n        }\n      }\n\n    });*/\n    window.addEventListener('mousedown', (evt) => {\n      debuglog('TaskObject: mousedown event.')\n      debuglog(evt)\n\n      const eventData = new EventData(\n        R.get.events_click,\n        new Date().getTime(), {\n          belongsTo: ['globalLog', 'mouseEvents'],\n          handledAt: null,\n          storedAt: null,\n          clientX: evt.clientX,\n          clientY: evt.clientY,\n          engineX: evt.clientX *\n            (this.renderSize.width / window.innerWidth),\n          engineY: (window.innerHeight - evt.clientY) *\n            (this.renderSize.height / window.innerHeight),\n        },\n      )\n\n      // make an static EventData from dom event?\n      if (typeof this.currentSceneObject !== 'undefined') {\n        if (typeof this.currentSceneObject.stateManager !== 'undefined') {\n          this.currentSceneObject.stateManager.addEvent(eventData)\n        }\n      }\n    })\n\n\n    window.addEventListener('resize', (evt) => {\n      debuglog('TaskObject: resize event.')\n      debuglog(evt)\n\n      const eventData = new EventData(\n        R.get.events_resize,\n        this.timeInMs, {\n          belongsTo: ['globalLog'],\n          handledAt: null,\n          storedAt: null,\n          outerHeight: evt.target.outerHeight,\n          outerWidth: evt.target.outerWidth,\n        },\n      )\n\n      // if a current scene exists pass it down the stateManager\n      // and look for a resize handler updateContentFrame\n      if (typeof this.currentSceneObject !== 'undefined') {\n        try {\n          this.addEventToCurrentScene(eventData)\n        } catch (e) {\n          console.error(e)\n        } finally {\n          if (typeof this.currentSceneObject.updateContentFrame !== 'undefined') {\n            this.currentSceneObject.updateContentFrame()\n          }\n        }\n      }\n    })\n  }\n\n  keyfunction(e) {\n    const dCode = 68\n    const shiftCode = 16\n    const altCode = 18 // TODO check if it is the same on all platforms\n\n    // check if shift + P hotkeys were stroke and toggle visibility if so\n    this.keyState[e.keyCode] = e.type === 'keydown'\n\n    // hide and show debug layer\n    if (this.keyState[shiftCode] && this.keyState[altCode] && this.keyState[dCode]) {\n      // 16 == Shift - 68 == D -- 18 Alt\n      // make sure to reset D value in case keyup event is ignored (keep shift true for rapid toggle)\n      this.keyState[dCode] = false\n      this.keyState[altCode] = false\n\n      // toggle debug visibility\n      this.toggleDebugLayer()\n\n      // prevent default action if any\n      e.preventDefault()\n    }\n  }\n\n  addStateManager(scene = mandatory('scene')) {\n    scene.stateManager = new StateManager(scene, this.dataManager)\n  }\n\n  // TODO create a familly of hooks that call functions forthe curent scene, like this one\n  addEventToCurrentScene(eventData = mandatory()) {\n    // checks that there is a current scene\n    if (typeof this.currentSceneObject !== 'undefined') {\n      // checks that the scene has a stateManager\n      if (typeof this.currentSceneObject.stateManager !== 'undefined') {\n        // adds the event\n        this.currentSceneObject.stateManager.addEvent(eventData)\n      } else {\n        throw new Error('TaskObject.addEventToCurrentScene: No stateManager in currentSceneObject')\n      }\n    } else {\n      // else return an error message\n      throw new Error('TaskObject.addEventToCurrentScene: No current scene object')\n    }\n  }\n\n\n  /**\n   * create2DScene - 2D Scene generator with an initialCanvas of the specifified size\n   * Babylon Scene objects are enriched in experiment-js with:\n   *  - sceneKey\n   *  - parentTaskObject\n   *  - stateManager\n   *  - dataManager\n   *  - initialCanvas\n   *  - initialCamera\n   *  - updateContentFrame\n   * Importantly - The registerBeforeRender() lifecycle function calls the update function of the stateManager\n   *\n   * @param {object} [options] Object with key-value options for the 2D scene, defaults are :\n   *  - sceneKey: `scene${Math.random() * 100000}`,\n   *  - canvasBackground: new BABYLON.Color4(0, 0, 0, 1),\n   *  - backgroundRoundRadius: 50,\n   *  - clearColor: new BABYLON.Color4(0, 0, 0, 1),\n   *  - canvasPercentWidth: 0.8,\n   *  - canvasPercentHeight: 1,\n   *\n   *\n   * @returns {BABYLON.Scene}\n   */\n  create2DScene(options = mandatory()) {\n    const optionsBase = {\n      sceneKey: `scene${Math.random() * 100000}`,\n      canvasBackground: new BABYLON.Color4(0, 0, 0, 1),\n      backgroundRoundRadius: 0,\n      clearColor: new BABYLON.Color4(0, 0, 0, 1),\n      width: null,\n      height: null,\n      canvasPercentWidth: 1,\n      canvasPercentHeight: 1,\n      minWidth: Number.NEGATIVE_INFINITY,\n      minHeight: Number.NEGATIVE_INFINITY,\n      maxWidth: Number.POSITIVE_INFINITY,\n      maxHeight: Number.POSITIVE_INFINITY,\n    }\n\n    options = _.extend(optionsBase, options)\n\n    const getCanvasDimensions = (noNull = true) => {\n      let size = null\n      let width = null\n      let height = null\n\n      const pWidth = (this.renderSize.width * options.canvasPercentWidth).boundTo(options.minWidth, options.maxWidth)\n      const pHeight = (this.renderSize.height * options.canvasPercentHeight).boundTo(options.minWidth, options.maxHeight)\n\n      let x = null\n      let y = null\n\n      if (options.width) {\n        width = options.width\n      } else if (options.canvasPercentWidth !== 1) {\n        width = pWidth\n      }\n      if (options.height) {\n        height = options.height\n      } else if (options.canvasPercentHeight !== 1) {\n        height = pHeight\n      }\n\n      if ((height !== null) || (width !== null) || noNull) {\n        size = new BABYLON.Size(width !== null ? width : pWidth, height !== null ? height : pHeight)\n        x = (this.renderSize.width / 2) - ((this.renderSize.width * options.canvasPercentWidth) / 2)\n        y = (this.renderSize.height / 2) - ((this.renderSize.height * options.canvasPercentHeight) / 2)\n      }\n\n      return { size, x, y }\n    }\n\n    const { size: customSized } = getCanvasDimensions()\n\n\n    const scene = new BABYLON.Scene(this.engine)\n\n    /**\n     * Holds the scenekey inside the scene object.\n     * @type {string}\n     */\n    scene.sceneKey = options.sceneKey\n\n    /**\n     * Reference to the parent taskObject\n     * @type {TaskObject}\n     */\n    scene.parentTaskObject = this\n\n    /* --- Add a stateManager --- */\n    this.addStateManager(scene)\n\n    /* --- Set background --- */\n    scene.clearColor = options.clearColor\n\n    const camera = new BABYLON.ArcRotateCamera('Camera', 0, Math.PI / 2, 12, BABYLON.Vector3.Zero(), scene)\n    let canvasOptions = {\n      id: 'ScreenCanvas',\n      backgroundFill: BABYLON.Canvas2D.GetSolidColorBrush(options.clearColor),\n      fill: BABYLON.Canvas2D.GetSolidColorBrush(options.clearColor),\n      zOrder: 1,\n    }\n\n    const canvas = new BABYLON.ScreenSpaceCanvas2D(scene, canvasOptions)\n\n    canvasOptions = {\n      id: 'initialCanvas',\n      parent: canvas,\n      roundRadius: options.backgroundRoundRadius,\n      borderThickness: 0,\n      fill: BABYLON.Canvas2D.GetSolidColorBrush(options.canvasBackground),\n      marginAlignment: 'h: center, v: center',\n      size: customSized,\n      zOrder: 1,\n    }\n\n    const initialCanvas = new BABYLON.Rectangle2D(canvasOptions)\n\n    /* Set the added canvas and camera to known fields in the scene*/\n    scene.screenCanvas = canvas\n    scene.initialCanvas = initialCanvas\n    scene.initialCamera = camera\n\n    /* Create a GUI canvas */\n    scene.initialGui = scene.stateManager.addGuiCanvas()\n\n    /* ======= Debug mode ======= */\n    if ((typeof window.DEBUG_MODE_ONE !== 'undefined') && (window.DEBUG_MODE_ONE === true)) {\n      // canvas.createCanvasProfileInfoCanvas()\n    }\n\n    /* ======== Scene Lifecycle ======== */\n\n    /* --- Resize handler --- */\n    const updateContentFrame = function () {\n      // this refers to the scene here\n      if (customSized) {\n        this.initialCanvas.resizeAt = this.parentTaskObject.timeInMs + 1000\n        delay(1100).then(() => {\n          if (this.initialCanvas.resizeAt < this.parentTaskObject.timeInMs) {\n            // ((this.parentTaskObject.renderSize.width / 2) - (this.initialCanvas.size.width / 2), (this.parentTaskObject.renderSize.height / 2) - (this.initialCanvas.size.height / 2))\n            const { size: customSized } = getCanvasDimensions()\n            debugWarn('scene.updateContentFrame: window has been resized ', customSized)\n            this.initialCanvas.size = customSized\n\n            // check if the user has defined custom resize functions\n            if (typeof this.onResize !== 'undefined') {\n              if (this.onResize.constructor === Function) {\n                this.onResize = [this.onResize]\n              }\n\n              for (const f of this.onResize) {\n                if (f.constructor !== Function) continue\n                f.bind(this.parentTaskObject.context)()\n              }\n            }\n          }\n        })\n      }\n    }\n\n\n    scene.updateContentFrame = updateContentFrame\n\n    /**\n     * Custom resize functions called by updateContentFrame. Can be set by the user\n     * to perform scene updates on resize. Can be an array of function or a single function.\n     * @type {!function|array}\n     */\n    scene.onResize = null\n\n    /* Scene update */\n    scene.registerBeforeRender(() => {\n      scene.stateManager.update()\n    })\n\n    return (scene)\n  }\n\n  /* ======= dataManager ======= */\n  setConnection(variables = mandatory()) {\n    if (!this.dataManager) {\n      throw new Error('StateManager.setCheckpoint: no dataManager')\n    }\n\n    this.dataManager.setConnection(variables)\n    .then((connection) => { this.connection = connection })\n    .catch((error) => { debugError(error) })\n  }\n\n  setCheckpoint(code = mandatory()) {\n    // store the whole object in the db ? ... probably not or.. ? it might be a great idea\n    // we need to save the current state name, the non object globals,\n    // and the events in store, we also have to store the state globals\n    // to restore we load the past state.. .hm might be too complicated\n\n    if (!this.dataManager) {\n      throw new Error('StateManager.setCheckpoint: no dataManager')\n    }\n\n    this.dataManager.addRows('checkpoints', { code, happenedAt: this.timeInMs })\n  }\n\n  getCheckpoint() {\n    if (!this.dataManager) {\n      throw new Error('StateManager.getCheckpoint: no dataManager')\n    }\n\n    return this.dataManager.query('getCheckpoint', {}, this.connection)\n  }\n\n  /* ======= Context ======= */\n  getContext(object) {\n    const scene = (typeof this.currentSceneObject !== 'undefined') ? this.currentSceneObject : null\n    const stateManager = ((scene !== null) && (typeof scene.stateManager !== 'undefined')) ? scene.stateManager : null\n    const state = ((stateManager !== null) && (typeof stateManager.currentState !== 'undefined')) ? this.currentSceneObject.stateManager.currentState : null\n\n    const baseContext = {\n      taskObject: this,\n      dataManager: (typeof this.dataManager !== 'undefined') ? this.dataManager : null,\n      scene,\n      stateManager,\n      state,\n      R: this.R,\n    }\n\n    if (typeof object === 'undefined') {\n      return (baseContext)\n    }\n    let extendWith = {}\n    switch (object.constructor) {\n      case BABYLON.Scene:\n        extendWith = {\n          scene: object,\n          stateManager: object.stateManager,\n          state: object.stateManager.currentState,\n        }\n        break\n      case StateManager:\n        extendWith = {\n          scene: object._parent,\n          stateManager: object,\n          state: object.currentState,\n        }\n        break\n      case State:\n        extendWith = {\n          scene: object._parent,\n          stateManager: object._stateManager,\n          state: object,\n        }\n        break\n      default:\n        debugWarn('TaskObject.getContext: object is not of valid class. Returning taskObject context.')\n        return (baseContext)\n    }\n\n    return (_.extend(baseContext, extendWith))\n  }\n\n  get context() {\n    return this.getContext()\n  }\n\n  /* =============== Getters and Setters =============== */\n  /* ======== Property definitions for JSDOC ======== */\n  /**\n   * Key string of the current scene - should not be null but an empty string on startup\n   * @return {string} sceneKey in the scenes object\n   */\n  static get currentScene() { /**/ }\n\n  /**\n   * The current babylon scene object\n   * @return {BABYLON.Scene}\n   */\n  static get currentSceneObject() { /**/ }\n\n  /**\n   * ParamBox object linked to the task object.\n   * @return {ParamBox}\n   */\n  static get paramBox() { /**/ }\n\n  static get renderSize() { /**/ }\n\n  /* ======== Getter/Setter definitions ======== */\n  get currentScene() {\n    return this._currentSceneKey\n  }\n\n  set currentScene(sceneKey) {\n    if (Object.keys(this.scenes).indexOf(sceneKey) !== -1) {\n      if (this._currentSceneKey) {\n        this.scenes[this._currentSceneKey].stateManager.goToState(this.R.get.states_idle)\n\n        /* ======= Debug mode ======= */\n        if ((typeof window.DEBUG_MODE_ONE !== 'undefined') && (window.DEBUG_MODE_ONE === true)) {\n          this.scenes[this._currentSceneKey].debugLayer.hide()\n\n          if ((typeof this.scenes[this._currentSceneKey].initialCanvas !== 'undefined') && (this.scenes[this._currentSceneKey].initialCanvas._profilingCanvas !== null)) {\n            // this.scenes[this._currentSceneKey].initialCanvas._profilingCanvas.dispose()\n            // this.scenes[this._currentSceneKey].initialCanvas._profilingCanvas = null\n          }\n        }\n      }\n\n      this._currentSceneKey = sceneKey\n\n      this.scenes[sceneKey].stateManager.goToState(this.R.get.states_active)\n\n      /* ======= Debug mode ======= */\n      if ((typeof window.DEBUG_MODE_ONE !== 'undefined') && (window.DEBUG_MODE_ONE === true) && (this.shouldShowDebug)) {\n        this.scenes[sceneKey].debugLayer.show()\n\n        if (typeof this.scenes[sceneKey].initialCanvas !== 'undefined') {\n          // this.scenes[sceneKey].initialCanvas.createCanvasProfileInfoCanvas()\n        }\n      }\n\n      debuglog(`TaskObject.currentScene: changed to ${sceneKey}`)\n    } else if (sceneKey === null || sceneKey === '') {\n      this._currentSceneKey = ''\n    } else {\n      console.error('TaskObject.currentScene: Invalid sceneKey.')\n    }\n  }\n\n  toggleDebugLayer() {\n    const scene = this.currentSceneObject\n    this.shouldShowDebug = !this.shouldShowDebug\n\n    if (typeof scene !== 'undefined') {\n      if (this.shouldShowDebug) {\n        this.scenes[this._currentSceneKey].debugLayer.show()\n\n        if (typeof this.scenes[this._currentSceneKey].initialCanvas !== 'undefined') {\n          this.scenes[this._currentSceneKey].initialCanvas.createCanvasProfileInfoCanvas()\n        }\n      } else {\n        this.scenes[this._currentSceneKey].debugLayer.hide()\n\n        if ((typeof this.scenes[this._currentSceneKey].initialCanvas !== 'undefined') && (this.scenes[this._currentSceneKey].initialCanvas._profilingCanvas !== null)) {\n          this.scenes[this._currentSceneKey].initialCanvas._profilingCanvas.dispose()\n          this.scenes[this._currentSceneKey].initialCanvas._profilingCanvas = null\n        }\n      }\n    } else {\n      console.error('taskObject.toggleDebugLayer: currentSceneObject is undefined')\n    }\n  }\n\n  get currentSceneObject() {\n    return this.scenes[this._currentSceneKey]\n  }\n\n  set currentSceneObject(sceneObject) {\n    if (_.has(sceneObject, 'sceneKey')) {\n      this.currentScene = sceneObject.sceneKey\n    } else {\n      throw new Error('Specified scene has no sceneKey')\n    }\n  }\n\n  get time() {\n    return this.timeInMs\n  }\n\n  get timeInSec() {\n    return new Date().getTime() / 1000\n  }\n\n  get timeInMs() {\n    return new Date().getTime()\n  }\n\n  get paramBox() {\n    return this._paramBox\n  }\n\n  set paramBox(paramBox) {\n    if (this._paramBox) {\n      this._paramBox.delete()\n    }\n    this._paramBox = paramBox\n  }\n\n  get renderSize() {\n    return new BABYLON.Size(\n      this.engine.getRenderWidth(),\n      this.engine.getRenderHeight(),\n    )\n  }\n\n  set renderSize(size = mandatory()) {\n    switch (size.constructor) {\n      case String:\n        this.canvas.width = size\n        this.canvas.height = size\n        break\n      case BABYLON.Size:\n        this.canvas.width = `${size.width}px`\n        this.canvas.height = `${size.height}px`\n        break\n      case Array:\n        if (size.length === 2) {\n          this.canvas.width = size[0]\n          this.canvas.height = size[1]\n        } else {\n          throw new Error(\n          'TaskObject.renderSize: set with invalid size array, array lenght has to be === 2.',\n        )\n        }\n        break\n      default:\n        throw new Error(\n        'TaskObject.renderSize: set with invalid size array, array lenght has to be === 2.',\n      )\n    }\n  }\n\n  /* =============== Utility Functions =============== */\n\n  /**\n   * modal - Creates a new information modal with specified data.\n   *\n   * @param {!object} options\n   *\n   * @returns {type} Description\n   */\n  modal({ type = 'centralLarge', title = '', content = '', event = new EventData(this.R.get.events_modalDismissed) }) {\n    this.currentModal = { data: { type, title, content, event } }\n    const deferred = new Deferred()\n\n    this.currentModal.deferred = deferred\n\n    const modalBox = new SmartModal(type, function dismissed() {\n      if ((event.constructor === EventData) && (this.stateManager !== null)) {\n        this.stateManager.addEvent(event)\n      }\n\n      this.taskObject.currentModal.deferred.resolve('Modal closed.')\n      this.taskObject.currentModal = null\n    }.bind(this.context))\n\n    modalBox.title = title\n    modalBox.content = content\n\n    this.currentModal.modalBox = modalBox\n    return deferred.promise\n  }\n\n  /* === Animation helpers === */\n  animateFloat(object, property, from, to) {\n    const keys = [{\n      frame: 0,\n      value: from,\n    }, {\n      frame: 100,\n      value: to,\n    }]\n\n    const animation = new BABYLON.Animation(\n      'animation',\n      property,\n      100,\n      BABYLON.Animation.ANIMATIONTYPE_FLOAT,\n      BABYLON.Animation.ANIMATIONLOOPMODE_CONSTANT,\n    )\n    animation.setKeys(keys)\n\n    this.currentSceneObject.stopAnimation(object)\n    object.animations.push(animation)\n    object._scene.beginAnimation(object, 0, 100, false, 1, () => {})\n  }\n\n  animateVector3(object, property, from, to, frameTotal = 24) {\n    const keys = [{\n      frame: 0,\n      value: from,\n    }, {\n      frame: frameTotal,\n      value: to,\n    }]\n\n    const animation = new BABYLON.Animation(\n      'animation',\n      property,\n      24,\n      BABYLON.Animation.ANIMATIONTYPE_VECTOR3,\n      BABYLON.Animation.ANIMATIONLOOPMODE_CONSTANT,\n    )\n    animation.setKeys(keys)\n\n    this.currentSceneObject.stopAnimation(object)\n\n    object.animations.push(animation)\n  }\n\n  animateColor3(object, property, from, to) {\n    const keys = [{\n      frame: 0,\n      value: from,\n    }, {\n      frame: 24,\n      value: to,\n    }]\n\n    const animation = new BABYLON.Animation(\n      'animation',\n      property,\n      12,\n      BABYLON.Animation.ANIMATIONTYPE_COLOR3,\n      BABYLON.Animation.ANIMATIONLOOPMODE_CONSTANT,\n    )\n    animation.setKeys(keys)\n\n    object._scene.stopAnimation(object)\n\n    object.animations.push(animation)\n  }\n\n  animateMainCameraRotation(toAlpha, toBeta, scene) {\n    // Alpha is the rotation angle around Y axis = azimuth\n    // Beta is the rotation angle around X axis = inclinaison\n    scene = this.scenes[this.currentScene]\n    const animCamAlpha = new BABYLON.Animation(\n      'animCam',\n      'alpha',\n      60,\n      BABYLON.Animation.ANIMATIONTYPE_FLOAT,\n      BABYLON.Animation.ANIMATIONLOOPMODE_CONSTANT,\n    )\n    const camera = scene.activeCamera\n    const keysAlpha = []\n\n    if (TaskObject.overPI(camera.alpha, toAlpha)) {\n      keysAlpha.push({\n        frame: 0,\n        value: camera.alpha,\n      })\n\n      console.log(camera.alpha)\n      console.log(toAlpha)\n\n      let firstStop = -Math.PI\n      let secondStop = Math.PI\n\n      if (camera.alpha > 0) {\n        firstStop = Math.PI\n        secondStop = -Math.PI\n      }\n\n      keysAlpha.push({\n        frame: 50,\n        value: firstStop,\n      })\n      keysAlpha.push({\n        frame: 51,\n        value: secondStop,\n      })\n      keysAlpha.push({\n        frame: 100,\n        value: toAlpha,\n      })\n    } else {\n      keysAlpha.push({\n        frame: 0,\n        value: camera.alpha,\n      })\n      keysAlpha.push({\n        frame: 100,\n        value: toAlpha,\n      })\n    }\n\n    const animCamBeta = new BABYLON.Animation(\n      'animCam',\n      'beta',\n      60,\n      BABYLON.Animation.ANIMATIONTYPE_FLOAT,\n      BABYLON.Animation.ANIMATIONLOOPMODE_CONSTANT,\n    )\n\n    const keysBeta = []\n    keysBeta.push({\n      frame: 0,\n      value: camera.beta,\n    })\n    keysBeta.push({\n      frame: 100,\n      value: toBeta,\n    })\n\n    animCamAlpha.setKeys(keysAlpha)\n    animCamBeta.setKeys(keysBeta)\n\n    camera.animations.push(animCamAlpha)\n    camera.animations.push(animCamBeta)\n\n    scene.beginAnimation(camera, 0, 100, false, 1, () => {})\n  }\n\n  /* === Particule system === */\n  /**\n   * Add a custom particule system to the specified mesh.\n   * @param {BABYLON.Mesh} mesh    Mesh on which to add the particule system\n   * @param {Object} options Option object, default properties are as follows :\n   *                         name: \"particle\" + mesh.name,\n   *                         capacity: 2000,\n   *                         texture: this.ASSETS_FLARE_PATH,\n   *                         minEmitBox: null,\n   *                         maxEmitBox: null,\n   *                         color1: new BABYLON.Color4(0.7, 0.8, 1.0, 1.0),\n   *                         color2: new BABYLON.Color4(0.2, 0.5, 1.0, 1.0),\n   *                         colorDead: new BABYLON.Color4(0, 0, 0.2, 0.0),\n   *                         minSize: 0.1,\n   *                         maxSize: 0.5,\n   *                         minLifeTime: 0.3,\n   *                         maxLifeTime: 0.8,\n   *                         emitRate: 150,\n   *                         blendMode: BABYLON.ParticleSystem.BLENDMODE_ONEONE,\n   *                         gravity: new BABYLON.Vector3(0, 9.81, 0), //upwards\n   *                         direction1: new BABYLON.Vector3(-5, -1, 3),\n   *                         direction2: new BABYLON.Vector3(5, 1, -3),\n   *                         minAngularSpeed: 0,\n   *                         maxAngularSpeed: 2 * Math.PI,\n   *                         minEmitPower: 0.1,\n   *                         maxEmitPower: 0.1,\n   *                         updateSpeed: 0.01,\n   *                         startIt: false\n   */\n  addParticuleSystemTo(mesh = mandatory(), options = {}) {\n    if (typeof mesh._scene === 'undefined') {\n      throw new Error('addParticuleSystemTo: mesh _scene is undefined.')\n    }\n\n    const scene = mesh._scene\n\n    // option base\n    const optionsBase = {\n      name: `particle${mesh.name}`,\n      capacity: 2000,\n      texture: this.ASSETS_FLARE_PATH,\n      minEmitBox: null,\n      maxEmitBox: null,\n      color1: new BABYLON.Color4(0.7, 0.8, 1, 1),\n      color2: new BABYLON.Color4(0.2, 0.5, 1, 1),\n      colorDead: new BABYLON.Color4(0, 0, 0.2, 0),\n      minSize: 0.1,\n      maxSize: 0.5,\n      minLifeTime: 0.3,\n      maxLifeTime: 0.8,\n      emitRate: 150,\n      blendMode: BABYLON.ParticleSystem.BLENDMODE_ONEONE,\n      gravity: new BABYLON.Vector3(0, 9.81, 0),\n      // upwards\n      direction1: new BABYLON.Vector3(-5, -1, 3),\n      direction2: new BABYLON.Vector3(5, 1, -3),\n      minAngularSpeed: 0,\n      maxAngularSpeed: 2 * Math.PI,\n      minEmitPower: 0.1,\n      maxEmitPower: 0.1,\n      updateSpeed: 0.01,\n      startIt: false,\n    }\n\n    // extend base options with specified options\n    options = _.extend(optionsBase, options)\n\n    // Create a particle system\n    const particleSystem = new BABYLON.ParticleSystem(\n      'particles',\n      options.capacity,\n      scene,\n    )\n\n    // Texture of each particle\n    particleSystem.particleTexture = new BABYLON.Texture(\n      options.texture,\n      scene,\n    )\n\n    // Where the particles come from\n    particleSystem.emitter = mesh\n    // the starting object, the emitter\n    if (options.minEmitBox !== null) {\n      particleSystem.minEmitBox = options.minEmitBox // Starting all from\n    }\n\n    if (options.maxEmitBox !== null) {\n      particleSystem.maxEmitBox = options.maxEmitBox // To...\n    }\n\n    // Colors of all particles\n    particleSystem.color1 = options.color1\n    particleSystem.color2 = options.color2\n    particleSystem.colorDead = options.colorDead\n\n    // Size of each particle (random between...\n    particleSystem.minSize = options.minSize\n    particleSystem.maxSize = options.maxSize\n\n    // Life time of each particle (random between...\n    particleSystem.minLifeTime = options.minLifeTime\n    particleSystem.maxLifeTime = options.maxLifeTime\n\n    // Emission rate\n    particleSystem.emitRate = options.emitRate\n\n    // Blend mode : BLENDMODE_ONEONE, or BLENDMODE_STANDARD\n    particleSystem.blendMode = options.blendMode\n\n    // Set the gravity of all particles\n    particleSystem.gravity = options.gravity\n\n    // Direction of each particle after it has been emitted\n    particleSystem.direction1 = options.direction1\n    particleSystem.direction2 = options.direction2\n\n    // Angular speed, in radians\n    particleSystem.minAngularSpeed = options.minAngularSpeed\n    particleSystem.maxAngularSpeed = options.maxAngularSpeed\n\n    // Speed\n    particleSystem.minEmitPower = options.minEmitPower\n    particleSystem.maxEmitPower = options.maxEmitPower\n    particleSystem.updateSpeed = options.updateSpeed\n\n    // Start the particle system\n    if (options.startIt) {\n      particleSystem.start()\n    }\n\n    return particleSystem\n  }\n\n  /* ======== Static functions ======== */\n  /* === Angle functions === */\n  static borderPI(radians) {\n    const offset = Math.PI\n    radians += offset\n    const sign = Math.sign(radians)\n    return radians -\n      (sign * Math.floor(Math.abs(radians) / (2 * Math.PI)) * (2 * Math.PI)) -\n      offset\n  }\n\n  static checkForCloserSignedAngle(baseAngle, checkedAngle) {\n    checkedAngle = TaskObject.borderPI(checkedAngle)\n    console.log(checkedAngle)\n    console.log(`baseAngle:${baseAngle}`)\n    let sign = Math.sign(checkedAngle)\n\n    if (checkedAngle === 0) {\n      sign = Math.sign(baseAngle)\n    }\n    const signedAngle = checkedAngle - (sign * (2 * Math.PI))\n    console.log(`signedAngle:${signedAngle}`)\n    const currentAngleArc = Math.abs(baseAngle - checkedAngle)\n    const signedAngleArc = Math.abs(baseAngle - signedAngle)\n\n    return currentAngleArc <= signedAngleArc ? checkedAngle : signedAngle\n  }\n\n  static overPI(angleA, angleB) {\n    return Math.abs(angleA - angleB) > Math.PI\n  }\n\n  /* === Sound function === */\n  /**\n   * fadeOut - Performs a fadeOut of a BABYLON.Sound recursively. When the decrement\n   * become smaller than step/10, decrement is fixed at step/10.\n   *\n   * @param {BABYLON.Sound}      sound                        a sound to fade out and stop\n   * @param {object}    options                      second argument holds options\n   * @param {?Number}   [options.currentVolume=null] start volume for the fadeout\n   * @param {number}    [options.step=0.02]          decrement step such as volume -= step * volume\n   * @param {number}    [options.threshold=0.02]     threshold at which the sound is stopped\n   * @param {number}    [options.delayInMs=50]       duration of each recursion\n   * @param {boolean}   [options.pause=false]        if setto true the sound is pauses, if false, it is stopped\n   *\n   * @returns {undefined}\n   */\n  static fadeOut(sound, { currentVolume = null, step = 0.02, threshold = 0.02, delayInMs = 50, pause = false } = {}) {\n    mustHaveConstructor(BABYLON.Sound, sound)\n\n    if (currentVolume === null) {\n      currentVolume = sound.getVolume()\n    }\n    mustHaveConstructor(Number, currentVolume, step, threshold)\n\n    currentVolume = currentVolume.boundTo(0, 1)\n    step = step.boundTo(0, 1)\n\n    let decrement = step * currentVolume\n    if (decrement < step / 10) {\n      decrement = step / 10\n    }\n    currentVolume -= decrement\n    if (currentVolume > threshold) {\n      debuglog(`fadeOut.currentVolume:${currentVolume}`)\n      sound.setVolume(currentVolume)\n      delay(delayInMs).then(() => TaskObject.fadeOut(sound, { currentVolume, step, threshold, delayInMs, pause }))\n    } else if (pause) {\n      debuglog('fadeOut:  pause')\n      sound.pause()\n    } else {\n      debuglog('fadeOut:  stop')\n      sound.stop()\n    }\n  }\n\n\n  /**\n   * Returns an array filled with len elements of value\n   * @param  {object} value any value\n   * @param  {number} len   number of element repeated\n   * @return {array}\n   */\n  static fillArray(value, len) {\n    const a = []\n    for (let i = 1; i <= len; i++) {\n      a.push(value)\n    }\n    return a\n  }\n\n  /**\n   * Transform spherical coordinate to euclidian coordinate taking y as the height axis and z the depth axis.\n   * Inclination is calculated from the y axis and azimuth from the z axis. Supposing both system have the same origin.\n   * https://en.wikipedia.org/wiki/Spherical_coordinate_system\n   * @param  {number} r           radius\n   * @param  {number} inclination inclination from y in radian\n   * @param  {number} azimuth     Azimuthal angle\n   * @return {BABYLON.Vector3}    Euclidian coordinate\n   */\n  static sphericalToEuclidian(r, inclination, azimuth) {\n    const z = r * Math.sin(inclination) * Math.cos(azimuth)\n    const x = r * Math.sin(inclination) * Math.sin(azimuth)\n    const y = r * Math.cos(inclination)\n\n    return new BABYLON.Vector3(x, y, z)\n  }\n\n  /**\n   * Get random number between min and max.\n   * @param  {Number} min\n   * @param  {Number} max\n   * @return {Number}\n   */\n  static getRandomArbitrary(min, max) {\n    return ((Math.random() * (max - min)) + min)\n  }\n\n  static getRandomElement(array = mandatory()) {\n    if (array.constructor === Array) {\n      return array[Math.round(\n        TaskObject.getRandomArbitrary(0, array.length - 1),\n      )]\n    }\n    throw new Error('TaskObject: argument is not of type array.')\n  }\n}\n\n\n\n// WEBPACK FOOTER //\n// ./src/framework/TaskObject.js","/**\n * Experiment.js\n * Created. 2016\n *\n * Experiment.js toolbox.\n *\n * Authors. Albert Buchard\n *\n * Requires: lodash, BABYLON.js, mathjs, jQuery\n *\n * LICENSE Apache-2\n */\n\n /* --- Import the framwork --- */\n import TaskObject from './src/framework/TaskObject'\n import StateManager from './src/framework/StateManager'\n import State from './src/framework/State'\n import EventData from './src/framework/EventData'\n import DataManager from './src/framework/DataManager'\n import RessourceManager from './src/framework/RessourceManager'\n\n import {\n   Array,\n   String,\n   Number,\n   Set,\n   diag,\n   rowSum,\n   getRow,\n   matrix,\n   samplePermutation,\n   rep,\n   Deferred,\n   recurse,\n   jitter,\n   delay,\n   looksLikeAPromise,\n   mustHaveConstructor,\n   mustBeDefined,\n   mandatory,\n   debuglog,\n   debugWarn,\n   debugError,\n   noop,\n   spreadToObject,\n   sizeToVec,\n   scaleSize,\n   hasConstructor,\n   preloadImages\n } from './src/framework/utilities'\n\n\n/* add it to the global space in case user want to import in a script tag */\n if (typeof window !== 'undefined') {\n   window.TaskObject = TaskObject\n   window.StateManager = StateManager\n   window.State = State\n   window.EventData = EventData\n   window.DataManager = DataManager\n   window.RessourceManager = RessourceManager\n   window.jitter = jitter\n   window.delay = delay\n   window.Deferred = Deferred\n }\n\n\n export {\n  TaskObject,\n  StateManager,\n  State,\n  EventData,\n  DataManager,\n  RessourceManager,\n  Array,\n  String,\n  Number,\n  Set,\n  diag,\n  rowSum,\n  getRow,\n  matrix,\n  samplePermutation,\n  rep,\n  Deferred,\n  recurse,\n  jitter,\n  delay,\n  looksLikeAPromise,\n  mustHaveConstructor,\n  mustBeDefined,\n  mandatory,\n  debuglog,\n  debugWarn,\n  debugError,\n  noop,\n  spreadToObject,\n  sizeToVec,\n  scaleSize,\n  hasConstructor,\n  preloadImages\n}\n\n\n\n// WEBPACK FOOTER //\n// ./builder.js","const DEBUG_MODE_ON = true\n\nexport { DEBUG_MODE_ON }\n\n\n\n// WEBPACK FOOTER //\n// ./src/config.js","(function (global, undefined) {\n    \"use strict\";\n\n    if (global.setImmediate) {\n        return;\n    }\n\n    var nextHandle = 1; // Spec says greater than zero\n    var tasksByHandle = {};\n    var currentlyRunningATask = false;\n    var doc = global.document;\n    var registerImmediate;\n\n    function setImmediate(callback) {\n      // Callback can either be a function or a string\n      if (typeof callback !== \"function\") {\n        callback = new Function(\"\" + callback);\n      }\n      // Copy function arguments\n      var args = new Array(arguments.length - 1);\n      for (var i = 0; i < args.length; i++) {\n          args[i] = arguments[i + 1];\n      }\n      // Store and register the task\n      var task = { callback: callback, args: args };\n      tasksByHandle[nextHandle] = task;\n      registerImmediate(nextHandle);\n      return nextHandle++;\n    }\n\n    function clearImmediate(handle) {\n        delete tasksByHandle[handle];\n    }\n\n    function run(task) {\n        var callback = task.callback;\n        var args = task.args;\n        switch (args.length) {\n        case 0:\n            callback();\n            break;\n        case 1:\n            callback(args[0]);\n            break;\n        case 2:\n            callback(args[0], args[1]);\n            break;\n        case 3:\n            callback(args[0], args[1], args[2]);\n            break;\n        default:\n            callback.apply(undefined, args);\n            break;\n        }\n    }\n\n    function runIfPresent(handle) {\n        // From the spec: \"Wait until any invocations of this algorithm started before this one have completed.\"\n        // So if we're currently running a task, we'll need to delay this invocation.\n        if (currentlyRunningATask) {\n            // Delay by doing a setTimeout. setImmediate was tried instead, but in Firefox 7 it generated a\n            // \"too much recursion\" error.\n            setTimeout(runIfPresent, 0, handle);\n        } else {\n            var task = tasksByHandle[handle];\n            if (task) {\n                currentlyRunningATask = true;\n                try {\n                    run(task);\n                } finally {\n                    clearImmediate(handle);\n                    currentlyRunningATask = false;\n                }\n            }\n        }\n    }\n\n    function installNextTickImplementation() {\n        registerImmediate = function(handle) {\n            process.nextTick(function () { runIfPresent(handle); });\n        };\n    }\n\n    function canUsePostMessage() {\n        // The test against `importScripts` prevents this implementation from being installed inside a web worker,\n        // where `global.postMessage` means something completely different and can't be used for this purpose.\n        if (global.postMessage && !global.importScripts) {\n            var postMessageIsAsynchronous = true;\n            var oldOnMessage = global.onmessage;\n            global.onmessage = function() {\n                postMessageIsAsynchronous = false;\n            };\n            global.postMessage(\"\", \"*\");\n            global.onmessage = oldOnMessage;\n            return postMessageIsAsynchronous;\n        }\n    }\n\n    function installPostMessageImplementation() {\n        // Installs an event handler on `global` for the `message` event: see\n        // * https://developer.mozilla.org/en/DOM/window.postMessage\n        // * http://www.whatwg.org/specs/web-apps/current-work/multipage/comms.html#crossDocumentMessages\n\n        var messagePrefix = \"setImmediate$\" + Math.random() + \"$\";\n        var onGlobalMessage = function(event) {\n            if (event.source === global &&\n                typeof event.data === \"string\" &&\n                event.data.indexOf(messagePrefix) === 0) {\n                runIfPresent(+event.data.slice(messagePrefix.length));\n            }\n        };\n\n        if (global.addEventListener) {\n            global.addEventListener(\"message\", onGlobalMessage, false);\n        } else {\n            global.attachEvent(\"onmessage\", onGlobalMessage);\n        }\n\n        registerImmediate = function(handle) {\n            global.postMessage(messagePrefix + handle, \"*\");\n        };\n    }\n\n    function installMessageChannelImplementation() {\n        var channel = new MessageChannel();\n        channel.port1.onmessage = function(event) {\n            var handle = event.data;\n            runIfPresent(handle);\n        };\n\n        registerImmediate = function(handle) {\n            channel.port2.postMessage(handle);\n        };\n    }\n\n    function installReadyStateChangeImplementation() {\n        var html = doc.documentElement;\n        registerImmediate = function(handle) {\n            // Create a <script> element; its readystatechange event will be fired asynchronously once it is inserted\n            // into the document. Do so, thus queuing up the task. Remember to clean up once it's been called.\n            var script = doc.createElement(\"script\");\n            script.onreadystatechange = function () {\n                runIfPresent(handle);\n                script.onreadystatechange = null;\n                html.removeChild(script);\n                script = null;\n            };\n            html.appendChild(script);\n        };\n    }\n\n    function installSetTimeoutImplementation() {\n        registerImmediate = function(handle) {\n            setTimeout(runIfPresent, 0, handle);\n        };\n    }\n\n    // If supported, we should attach to the prototype of global, since that is where setTimeout et al. live.\n    var attachTo = Object.getPrototypeOf && Object.getPrototypeOf(global);\n    attachTo = attachTo && attachTo.setTimeout ? attachTo : global;\n\n    // Don't get fooled by e.g. browserify environments.\n    if ({}.toString.call(global.process) === \"[object process]\") {\n        // For Node.js before 0.9\n        installNextTickImplementation();\n\n    } else if (canUsePostMessage()) {\n        // For non-IE10 modern browsers\n        installPostMessageImplementation();\n\n    } else if (global.MessageChannel) {\n        // For web workers, where supported\n        installMessageChannelImplementation();\n\n    } else if (doc && \"onreadystatechange\" in doc.createElement(\"script\")) {\n        // For IE 68\n        installReadyStateChangeImplementation();\n\n    } else {\n        // For older browsers\n        installSetTimeoutImplementation();\n    }\n\n    attachTo.setImmediate = setImmediate;\n    attachTo.clearImmediate = clearImmediate;\n}(typeof self === \"undefined\" ? typeof global === \"undefined\" ? this : global : self));\n\n\n\n//////////////////\n// WEBPACK FOOTER\n// ./~/setimmediate/setImmediate.js\n// module id = 16\n// module chunks = 0","var apply = Function.prototype.apply;\n\n// DOM APIs, for completeness\n\nexports.setTimeout = function() {\n  return new Timeout(apply.call(setTimeout, window, arguments), clearTimeout);\n};\nexports.setInterval = function() {\n  return new Timeout(apply.call(setInterval, window, arguments), clearInterval);\n};\nexports.clearTimeout =\nexports.clearInterval = function(timeout) {\n  if (timeout) {\n    timeout.close();\n  }\n};\n\nfunction Timeout(id, clearFn) {\n  this._id = id;\n  this._clearFn = clearFn;\n}\nTimeout.prototype.unref = Timeout.prototype.ref = function() {};\nTimeout.prototype.close = function() {\n  this._clearFn.call(window, this._id);\n};\n\n// Does not start the time, just sets up the members needed.\nexports.enroll = function(item, msecs) {\n  clearTimeout(item._idleTimeoutId);\n  item._idleTimeout = msecs;\n};\n\nexports.unenroll = function(item) {\n  clearTimeout(item._idleTimeoutId);\n  item._idleTimeout = -1;\n};\n\nexports._unrefActive = exports.active = function(item) {\n  clearTimeout(item._idleTimeoutId);\n\n  var msecs = item._idleTimeout;\n  if (msecs >= 0) {\n    item._idleTimeoutId = setTimeout(function onTimeout() {\n      if (item._onTimeout)\n        item._onTimeout();\n    }, msecs);\n  }\n};\n\n// setimmediate attaches itself to the global object\nrequire(\"setimmediate\");\nexports.setImmediate = setImmediate;\nexports.clearImmediate = clearImmediate;\n\n\n\n//////////////////\n// WEBPACK FOOTER\n// ./~/timers-browserify/main.js\n// module id = 17\n// module chunks = 0","module.exports = __WEBPACK_EXTERNAL_MODULE_18__;\n\n\n//////////////////\n// WEBPACK FOOTER\n// external {\"commonjs\":\"experiment-boxes\",\"commonjs2\":\"experiment-boxes\",\"amd\":\"experiment-boxes\",\"root\":\"experimentBoxes\"}\n// module id = 18\n// module chunks = 0"],"sourceRoot":""}